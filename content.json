{"meta":{"title":"biglovewheat","subtitle":"","description":"","author":"biglovewheat","url":"https://biglovewheat.gihub.io","root":"/"},"pages":[{"title":"categories","date":"2022-07-25T08:47:31.000Z","updated":"2022-07-25T08:47:54.000Z","comments":true,"path":"categories/index.html","permalink":"https://biglovewheat.gihub.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2022-07-26T02:00:56.000Z","updated":"2022-07-26T02:00:56.078Z","comments":true,"path":"tags/index-1.html","permalink":"https://biglovewheat.gihub.io/tags/index-1.html","excerpt":"","text":""},{"title":"标签","date":"2022-07-25T08:39:39.000Z","updated":"2022-07-26T02:02:13.894Z","comments":true,"path":"tags/index.html","permalink":"https://biglovewheat.gihub.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Jenkins-Systemd-发布脚本","slug":"jenkins-systemd-发布脚本","date":"2022-07-26T01:27:11.497Z","updated":"2022-07-26T01:19:46.000Z","comments":true,"path":"2022/07/26/jenkins-systemd-发布脚本/","link":"","permalink":"https://biglovewheat.gihub.io/2022/07/26/jenkins-systemd-%E5%8F%91%E5%B8%83%E8%84%9A%E6%9C%AC/","excerpt":"","text":"Jenkins-Systemd-发布脚本发布脚本1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/bin/bash## /data/publish.sh update js hx-basic 5 4 &quot;www-test/&quot;action=$1apptype=$2svc=$3ver=$4webpath=$6## envROOT=/datacase $apptype in## java&#x27;java&#x27;) if [ ! -f /usr/lib/systemd/system/$svc.service ];then if [ ! -f $ROOT/java_demo.service ];then echo &quot;java_demo.service not found&quot;; exit ; fi sed &quot;s/__SVC__/$&#123;svc&#125;/g&quot; $ROOT/java_demo.service &gt; /usr/lib/systemd/system/$svc.service systemctl daemon-reload systemctl enable $svc.service fi case $action in &#x27;restart&#x27;) systemctl restart $svc.service ;; &#x27;update&#x27;) ln -snf $ROOT/temp/$&#123;svc&#125;-$&#123;ver&#125;.jar $ROOT/app/$&#123;svc&#125;.jar systemctl restart $svc.service ;; &#x27;stop&#x27;) systemctl stop $svc.service ;; &#x27;restore&#x27;) ver=$5 ln -snf $ROOT/temp/$&#123;svc&#125;-$&#123;ver&#125;.jar $ROOT/app/$&#123;svc&#125;.jar systemctl restart $svc.service ;; *) ;; esac;;## js&#x27;js&#x27;) if [ &quot;v$webpath&quot; = &quot;v&quot; ]; then echo &quot;error,path is null,exit&quot;; exit; fi case $action in update) rm -rf $ROOT/webapp/$webpath mkdir -p $ROOT/webapp/$webpath tar -xf $ROOT/temp/$svc-$ver.tgz -C $ROOT/webapp/$webpath ;; restore) ver=$5 rm -rf $ROOT/webapp/$webpath mkdir -p $ROOT/webapp/$webpath tar -xf $ROOT/temp/$svc-$ver.tgz -C $ROOT/webapp/$webpath ;; *) ;; esac;;## other*);;esac Service java_demo.service123456789101112131415[Unit]Description=__SVC__After=network.target[Service]Type=forkingUser=rootEnvironment=&quot;SVC=__SVC__&quot;ExecStart=/data/start_jar.sh start $&#123;SVC&#125;ExecReload=/bin/kill -s HUP $MAINPIDExecStop=/bin/kill -s QUIT $MAINPID#Restart=always[Install]WantedBy=multi-user.target 启动脚本1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162#!/bin/bashsvc=$2## dirAPP_HOME=/data/appLOG_HOME=/data/logsif [ ! -d $&#123;LOG_HOME&#125;/analyzeGc ]; then mkdir -p $&#123;LOG_HOME&#125;/analyzeGc; fi## nacosexport nacos_address=&quot;172.31.71.117&quot;export nacos_port=&quot;8848&quot;export nacos_namespace=&#x27;c876967c-d8dd-4318-9bf1-e7e72eb47d13&#x27;## javaexport JAVA_HOME=/data/soft/jdk-11.0.11export PATH=$JAVA_HOME/bin:$PATHexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar## app envcase $svc in&#x27;hx-schedule-algorithm&#x27;)JAVA_OPS=&quot;-Xms512m -Xmx4g -Xmn1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$&#123;LOG_HOME&#125;/analyzeGc/ -XX:+PrintGCDetails -verbosegc -Xloggc:$&#123;LOG_HOME&#125;/analyzeGc/gc.$&#123;svc&#125;.log&quot;;;*)JAVA_OPS=&quot;-Xms512m -Xmx2g -Xmn1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$&#123;LOG_HOME&#125;/analyzeGc/ -XX:+PrintGCDetails -verbosegc -Xloggc:$&#123;LOG_HOME&#125;/analyzeGc/gc.$&#123;svc&#125;.log&quot;;;esaccase $svc in#&#x27;hx-thirdparty&#x27;|&#x27;hx-sensordata&#x27;)&#x27;hx-thirdparty&#x27;)SPRING_ENV=prod ## prod,sit,local;;*)SPRING_ENV=local ## prod,sit,local;;esaccase $1 instart) nohup java $&#123;JAVA_OPS&#125; -jar $&#123;APP_HOME&#125;/$&#123;svc&#125;.jar --spring.profiles.active=$&#123;SPRING_ENV&#125; &gt;&gt; $&#123;APP_HOME&#125;/$&#123;svc&#125;.log 2&gt;&amp;1 &amp;;;restart) $0 stop $svc sleep 2 $0 start $svc;;stop) PID=`jps |grep $&#123;svc&#125;|awk &#x27;&#123;print $1&#125;&#x27;` if [ -z &quot;$PID&quot; ]; then echo &quot;no pid found. $0 no start&quot; else kill -9 $PID &amp;&amp; echo &quot;kill pid $PID success.&quot; || echo &quot;kill pid $PID failed.&quot; fi;;*) echo &quot;Usage: $0 [start|restart|update|stop|restore|log|check]&quot; exit 0esac","categories":[{"name":"devops","slug":"devops","permalink":"https://biglovewheat.gihub.io/categories/devops/"}],"tags":[{"name":"devops","slug":"devops","permalink":"https://biglovewheat.gihub.io/tags/devops/"},{"name":"jenkins","slug":"jenkins","permalink":"https://biglovewheat.gihub.io/tags/jenkins/"},{"name":"shell","slug":"shell","permalink":"https://biglovewheat.gihub.io/tags/shell/"}]}],"categories":[{"name":"devops","slug":"devops","permalink":"https://biglovewheat.gihub.io/categories/devops/"}],"tags":[{"name":"devops","slug":"devops","permalink":"https://biglovewheat.gihub.io/tags/devops/"},{"name":"jenkins","slug":"jenkins","permalink":"https://biglovewheat.gihub.io/tags/jenkins/"},{"name":"shell","slug":"shell","permalink":"https://biglovewheat.gihub.io/tags/shell/"}]}