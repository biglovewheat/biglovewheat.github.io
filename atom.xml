<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-08-04T03:24:18.000Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Linux-swap扩容</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/</id>
    <published>2022-08-04T03:25:27.206Z</published>
    <updated>2022-08-04T03:24:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-swap扩容"><a href="#Linux-swap扩容" class="headerlink" title="Linux-swap扩容"></a>Linux-swap扩容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=4096000</span><br><span class="line"><span class="comment">#8G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=8192000</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分区类型为swap</span></span><br><span class="line">/sbin/mkswap /swapfile01</span><br><span class="line"><span class="built_in">chmod</span> 0600 /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#激活swap分区</span></span><br><span class="line">/sbin/swapon /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置自动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/swapfile01 swap swap defaults 0 0</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-swap扩容&quot;&gt;&lt;a href=&quot;#Linux-swap扩容&quot; class=&quot;headerlink&quot; title=&quot;Linux-swap扩容&quot;&gt;&lt;/a&gt;Linux-swap扩容&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-Centos7-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-04T03:25:26.799Z</published>
    <updated>2022-08-04T03:24:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kubernetes-Centos7-安装"><a href="#Kubernetes-Centos7-安装" class="headerlink" title="Kubernetes-Centos7-安装"></a>Kubernetes-Centos7-安装</h2><h2 id="关闭swap-x2F-selinux-x2F-firewalld"><a href="#关闭swap-x2F-selinux-x2F-firewalld" class="headerlink" title="关闭swap&#x2F;selinux&#x2F;firewalld"></a>关闭swap&#x2F;selinux&#x2F;firewalld</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭swap</span></span><br><span class="line">swapoff -a</span><br><span class="line">vi /etc/fstab</span><br><span class="line">注释掉swap的一行</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭selinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum install -y bash-completion</span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum install -y docker-ce-20.10.8</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h2 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://nn5bgten.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="修改docker-cgroup驱动为systemd"><a href="#修改docker-cgroup驱动为systemd" class="headerlink" title="修改docker cgroup驱动为systemd"></a>修改docker cgroup驱动为systemd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s|ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock|ExecStart=/usr/bin/dockerd --exec-opt native.cgroupdriver=systemd|g&quot;</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker info | grep -i cgroup</span><br></pre></td></tr></table></figure><h2 id="添加k8s仓库"><a href="#添加k8s仓库" class="headerlink" title="添加k8s仓库"></a>添加k8s仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="安装kubeadm"><a href="#安装kubeadm" class="headerlink" title="安装kubeadm"></a>安装kubeadm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum list kubeadm --showduplicates</span><br><span class="line">yum install -y kubeadm-1.20.9 kubectl-1.20.9 kubelet-1.20.9</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure><h2 id="修改网络参数（centos7）"><a href="#修改网络参数（centos7）" class="headerlink" title="修改网络参数（centos7）"></a>修改网络参数（centos7）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><h2 id="kubeadm初始化"><a href="#kubeadm初始化" class="headerlink" title="kubeadm初始化"></a>kubeadm初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=127.0.0.1 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.20.9 --pod-network-cidr=10.133.0.0/16 \</span><br><span class="line">--image-repository=registry.aliyuncs.com/google_containers</span><br><span class="line"></span><br><span class="line"><span class="comment">## kubeadm 初始化清理（如果失败，可以reset进行清理）</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><h2 id="安装calico（指定版本）"><a href="#安装calico（指定版本）" class="headerlink" title="安装calico（指定版本）"></a>安装calico（指定版本）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.19/manifests/calico.yaml</span><br></pre></td></tr></table></figure><h2 id="节点加入"><a href="#节点加入" class="headerlink" title="节点加入"></a>节点加入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##节点执行到安装完kubeadm</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token 74kuf2.6f1pv9lbrkxw5n0k \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47</span><br><span class="line"></span><br><span class="line"><span class="comment">## master节点加入</span></span><br><span class="line"><span class="comment"># 主节点运行获取证书</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token lb45cr.d5s17hnbgsj6sf5b   \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47 \</span><br><span class="line">--control-plane   --certificate-key f3657ba47289c8994771aaf2ebd2a90ee335f0fff41b9c1470ad15d21e185094</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误：</span></span><br><span class="line"><span class="comment"># unable to add a new control plane instance a cluster that doesn&#x27;t have a stable controlPlaneEndpoint address</span></span><br><span class="line"><span class="comment"># 解决办法：加上controlPlaneEndpoint</span></span><br><span class="line">kubectl edit configmap -n kube-system   kubeadm-config</span><br><span class="line">    clusterName: kubernetes</span><br><span class="line">    controlPlaneEndpoint: 192.168.8.112:6443</span><br></pre></td></tr></table></figure><h2 id="kubectl自动补全"><a href="#kubectl自动补全" class="headerlink" title="kubectl自动补全"></a>kubectl自动补全</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; /etc/profile; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="kubeadm安装后scheduler状态为unhealthy"><a href="#kubeadm安装后scheduler状态为unhealthy" class="headerlink" title="kubeadm安装后scheduler状态为unhealthy"></a>kubeadm安装后scheduler状态为unhealthy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cs</span><br><span class="line"><span class="comment">#备份修改两个文件</span></span><br><span class="line">vi /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class="line">vi /etc/kubernetes/manifests/kube-scheduler.yaml</span><br><span class="line"></span><br><span class="line">去掉 --port=0</span><br><span class="line"><span class="comment">## 重启kubelet</span></span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;a href=&quot;#Kubernetes-Centos7-安装&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;/a&gt;Kubernetes-Centos7-安装&lt;/</summary>
      
    
    
    
    <category term="K8S" scheme="https://biglovewheat.gihub.io/categories/K8S/"/>
    
    
    <category term="K8S" scheme="https://biglovewheat.gihub.io/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>iftop流量监控</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/iftop%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/iftop%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/</id>
    <published>2022-08-04T03:25:26.332Z</published>
    <updated>2022-08-04T03:24:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iftop流量监控"><a href="#iftop流量监控" class="headerlink" title="iftop流量监控"></a>iftop流量监控</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y iftop</span><br><span class="line"></span><br><span class="line"><span class="comment">## 参数</span></span><br><span class="line">-i 指定网卡</span><br><span class="line">-n 直接显示IP</span><br><span class="line">-N 直接显示端口号</span><br><span class="line">-P 同时显示IP和端口号</span><br><span class="line"></span><br><span class="line">iftop -i eth0  -PNn</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;iftop流量监控&quot;&gt;&lt;a href=&quot;#iftop流量监控&quot; class=&quot;headerlink&quot; title=&quot;iftop流量监控&quot;&gt;&lt;/a&gt;iftop流量监控&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>Python-Jira-自动受理工单</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/python-jira-%E8%87%AA%E5%8A%A8%E5%8F%97%E7%90%86%E5%B7%A5%E5%8D%95/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/python-jira-%E8%87%AA%E5%8A%A8%E5%8F%97%E7%90%86%E5%B7%A5%E5%8D%95/</id>
    <published>2022-08-03T07:55:02.728Z</published>
    <updated>2022-08-03T07:51:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-Jira-自动受理工单"><a href="#Python-Jira-自动受理工单" class="headerlink" title="Python-Jira-自动受理工单"></a>Python-Jira-自动受理工单</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding( <span class="string">&quot;utf-8&quot;</span> )</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> commands <span class="keyword">as</span> cmd</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&#x27;http://10.8.17.24:8080&#x27;</span></span><br><span class="line"></span><br><span class="line">log = <span class="built_in">open</span>(<span class="string">&#x27;/home/piccism/sapchk/jira_zdsl_gdzc.log&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">now_time = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> &gt;&gt;log,now_time</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;os_username&#x27;</span>:<span class="string">&#x27;yangwenwei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os_password&#x27;</span>:<span class="string">&#x27;1111&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os_cookie&#x27;</span>:<span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">login_url = base_url+<span class="string">&#x27;/rest/gadget/1.0/login&#x27;</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">resp = session.post(login_url, data)</span><br><span class="line"></span><br><span class="line">query_url = base_url+<span class="string">&#x27;/secure/IssueNavigator!executeAdvanced.jspa&#x27;</span></span><br><span class="line">query_str = <span class="string">&quot;project = GDZC AND (assignee = aaa or assignee = bbb ) AND status=open&quot;</span></span><br><span class="line">query_data = &#123;<span class="string">&#x27;jqlQuery&#x27;</span>:query_str,</span><br><span class="line">              <span class="string">&#x27;runQuery&#x27;</span>:<span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line">resp_query = session.post(query_url, query_data)</span><br><span class="line"></span><br><span class="line">htmlpage = resp_query.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">soup = BeautifulSoup(htmlpage,<span class="string">&#x27;lxml&#x27;</span>)  </span><br><span class="line"></span><br><span class="line">trs = soup.find_all(<span class="string">&#x27;tr&#x27;</span>,&#123;<span class="string">&quot;rel&quot;</span>:<span class="literal">True</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> trs:</span><br><span class="line">    rel = tr[<span class="string">&#x27;rel&#x27;</span>]        </span><br><span class="line">    tds = tr.find_all(<span class="string">&#x27;td&#x27;</span>)</span><br><span class="line">    issuekey = tds[<span class="number">1</span>].find(<span class="string">&#x27;a&#x27;</span>).string</span><br><span class="line">    assignee = tds[<span class="number">3</span>].find(<span class="string">&#x27;a&#x27;</span>).string</span><br><span class="line">    status = tds[<span class="number">5</span>].contents[<span class="number">2</span>].strip()</span><br><span class="line">    logstr = <span class="string">&#x27;new job &#x27;</span> +rel+<span class="string">&#x27; &#x27;</span>+issuekey+<span class="string">&#x27; &#x27;</span>+assignee+<span class="string">&#x27; &#x27;</span>+status</span><br><span class="line">    <span class="built_in">print</span> &gt;&gt;log,logstr</span><br><span class="line">    <span class="keyword">if</span> assignee != <span class="string">&#x27;zvb&#x27;</span>:</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/AssignIssue.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;assignee=yangwenwei&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/WorkflowUIDispatcher.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;action=4&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/WorkflowUIDispatcher.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;action=4&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line"></span><br><span class="line">log.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-Jira-自动受理工单&quot;&gt;&lt;a href=&quot;#Python-Jira-自动受理工单&quot; class=&quot;headerlink&quot; title=&quot;Python-Jira-自动受理工单&quot;&gt;&lt;/a&gt;Python-Jira-自动受理工单&lt;/h2&gt;&lt;figure c</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-异库同步</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/</id>
    <published>2022-08-03T07:55:02.327Z</published>
    <updated>2022-08-03T07:51:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-异库同步"><a href="#Gitlab-异库同步" class="headerlink" title="Gitlab-异库同步"></a>Gitlab-异库同步</h2><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── gitlab_sync_ignore.lst      <span class="comment"># 不同步的库</span></span><br><span class="line">├── gitlab_sync_lib.py          <span class="comment"># 计算本次需同步的库，分全量和增量</span></span><br><span class="line">├── gitlab_sync.sh              <span class="comment"># 同步脚本</span></span><br><span class="line">├── gitlab_sync_old.lst</span><br><span class="line">├── gitlab_sync_to_full.lst     <span class="comment"># 全同步列表，脚本生成</span></span><br><span class="line">├── gitlab_sync_to_inc.lst      <span class="comment"># 增量同步列表，脚本生成</span></span><br></pre></td></tr></table></figure><h3 id="gitlab-sync-sh"><a href="#gitlab-sync-sh" class="headerlink" title="gitlab_sync.sh"></a>gitlab_sync.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/home/gitlab_sync</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">git_url1=<span class="string">&quot;192.168.8.1:8090&quot;</span></span><br><span class="line">git_user1=jenkins</span><br><span class="line">git_key1=xxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_url2=<span class="string">&quot;10.249.2.40:8690&quot;</span></span><br><span class="line">git_user2=abc</span><br><span class="line">git_key2=xxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_group2=<span class="string">&#x27;aa/bb/10/operations&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_full</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_inc</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst</span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst</span><br><span class="line"></span><br><span class="line"><span class="variable">$ROOT_PATH</span>/gitlab_sync_lib.py <span class="variable">$git_url1</span> <span class="variable">$git_key1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start full sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> --bare http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git push --mirror http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span> &gt;&gt; <span class="variable">$ROOT_PATH</span>/gitlab_sync_old.lst</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start inc sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br><span class="line">  git fetch --all</span><br><span class="line">  git branch -r  |grep -v HEAD |awk -F<span class="string">&quot;origin/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> repo; <span class="keyword">do</span> git checkout <span class="variable">$repo</span>;git pull --rebase; <span class="keyword">done</span></span><br><span class="line">  git pull --all --rebase</span><br><span class="line">  git push --all http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="gitlab-sync-lib-py"><a href="#gitlab-sync-lib-py" class="headerlink" title="gitlab_sync_lib.py"></a>gitlab_sync_lib.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> gitlab</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">repo_url = <span class="string">&quot;http://&quot;</span> + sys.argv[<span class="number">1</span>]</span><br><span class="line">token = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(columns=[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">g1 = gitlab.Gitlab(repo_url, private_token=token)</span><br><span class="line">projects = g1.projects.<span class="built_in">list</span>(<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> project <span class="keyword">in</span> projects:</span><br><span class="line">     df1 = df1.append(&#123;<span class="string">&#x27;url&#x27;</span>:project.http_url_to_repo&#125;, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>):</span><br><span class="line">  df2 = pd.read_csv(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df2.rename(columns=&#123;df2.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df1-df2</span></span><br><span class="line">  df3 = pd.concat([df1, df2, df2]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df3 = df1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>):</span><br><span class="line">  df4 = pd.read_csv(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df4.rename(columns=&#123;df4.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df5=df3-df4,df4=df3-df5</span></span><br><span class="line">  df5 = pd.concat([df3, df4, df4]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4 = pd.concat([df3, df5, df5]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4.to_csv(<span class="string">&quot;gitlab_sync_to_inc.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df5 = df3</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-异库同步&quot;&gt;&lt;a href=&quot;#Gitlab-异库同步&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-异库同步&quot;&gt;&lt;/a&gt;Gitlab-异库同步&lt;/h2&gt;&lt;h3 id=&quot;结构&quot;&gt;&lt;a href=&quot;#结构&quot; class=&quot;head</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-批量操作</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/gitlab-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/gitlab-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C/</id>
    <published>2022-08-03T07:55:01.872Z</published>
    <updated>2022-08-03T07:51:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-批量操作"><a href="#Gitlab-批量操作" class="headerlink" title="Gitlab-批量操作"></a>Gitlab-批量操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/python3/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> gitlab</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">repo_url = <span class="string">&quot;http://192.168.8.1:8090&quot;</span></span><br><span class="line">token = <span class="string">&quot;xxxxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;PRIVATE-TOKEN&quot;</span> : token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session=requests.Session()</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(columns=[<span class="string">&#x27;pid&#x27;</span>,<span class="string">&#x27;url&#x27;</span>,<span class="string">&#x27;uid&#x27;</span>,<span class="string">&#x27;uname&#x27;</span>,<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line"></span><br><span class="line">gl = gitlab.Gitlab(repo_url, private_token=token)</span><br><span class="line">projects = gl.projects.<span class="built_in">list</span>(<span class="built_in">all</span>=<span class="literal">True</span>)    <span class="comment">## 获取所有project</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> projects:</span><br><span class="line"><span class="comment">#    print(p.id)</span></span><br><span class="line"><span class="comment">#    if p.id==370:</span></span><br><span class="line">        url=repo_url+<span class="string">&quot;/api/v4/projects/&quot;</span>+<span class="built_in">str</span>(p.<span class="built_in">id</span>)+<span class="string">&quot;/members&quot;</span>    <span class="comment">## 获取project下所有member</span></span><br><span class="line">        resp=session.get(url,headers=headers)</span><br><span class="line">        j_member=json.loads(resp.text)</span><br><span class="line">        df_member=pd.json_normalize(j_member)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df_member)):</span><br><span class="line">           df1 = df1.append(&#123;<span class="string">&#x27;pid&#x27;</span>:p.<span class="built_in">id</span>,<span class="string">&#x27;url&#x27;</span>:p.http_url_to_repo,<span class="string">&#x27;uid&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;id&#x27;</span>],<span class="string">&#x27;uname&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;username&#x27;</span>],<span class="string">&#x27;role&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;access_level&#x27;</span>]&#125;, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (df1)</span><br><span class="line">df1.to_csv(<span class="string">&#x27;project_member.csv&#x27;</span>,index = <span class="literal">False</span>)    <span class="comment">## 导出csv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#for i in range(len(df1)):</span></span><br><span class="line"><span class="comment">#    if df1.iloc[i][&#x27;uname&#x27;]==&quot;maiqixian&quot;:</span></span><br><span class="line"><span class="comment">#        url=repo_url+&quot;/api/v4/projects/&quot;+str(df1.iloc[i][&#x27;pid&#x27;])+&quot;/members/&quot;+str(df1.iloc[i][&#x27;uid&#x27;])    ## 按条件更新member的access_level</span></span><br><span class="line"><span class="comment">#        print(url)</span></span><br><span class="line"><span class="comment">#        data=&#123;&quot;access_level&quot;:30&#125;</span></span><br><span class="line"><span class="comment">#        resp=session.put(url,headers=headers,data=data)</span></span><br><span class="line"><span class="comment">#        print(resp)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-批量操作&quot;&gt;&lt;a href=&quot;#Gitlab-批量操作&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-批量操作&quot;&gt;&lt;/a&gt;Gitlab-批量操作&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;tab</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Geoserver安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/geoserver%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/geoserver%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-03T07:55:01.468Z</published>
    <updated>2022-08-03T07:51:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Geoserver安装"><a href="#Geoserver安装" class="headerlink" title="Geoserver安装"></a>Geoserver安装</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jdk-1.8</span><br><span class="line">geoserver-2.14</span><br><span class="line">tomcat-9</span><br><span class="line">postgresql-13.2</span><br><span class="line">postgis-3.1.1</span><br><span class="line">pgrouting-3.3.0</span><br></pre></td></tr></table></figure><h3 id="安装postgresql"><a href="#安装postgresql" class="headerlink" title="安装postgresql"></a>安装postgresql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装仓库</span></span><br><span class="line">yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装postgresql</span></span><br><span class="line">yum install -y postgresql13-server</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line">/usr/pgsql-13/bin/postgresql-13-setup initdb</span><br><span class="line"></span><br><span class="line"><span class="comment">## 放开访问，其中 trust--信任，不用输密码; md5--密码认证</span></span><br><span class="line">sed -i <span class="string">&#x27;s|host    all             all             127.0.0.1/32            scram-sha-256|host  all  all  0.0.0.0/0  md5|g&#x27;</span>  /var/lib/pgsql/13/data/pg_hba.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改监听网段</span></span><br><span class="line">sed -i <span class="string">&quot;s|#listen_addresses = &#x27;localhost&#x27;|listen_addresses = &#x27;*&#x27;|g&quot;</span>  /var/lib/pgsql/13/data/postgresql.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改监听端口</span></span><br><span class="line">sed -i <span class="string">&quot;s|#port = 5432|port = 5083|g&quot;</span>  /var/lib/pgsql/13/data/postgresql.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启数据库</span></span><br><span class="line">systemctl <span class="built_in">enable</span> postgresql-13</span><br><span class="line">systemctl restart postgresql-13</span><br></pre></td></tr></table></figure><h3 id="安装postgis和pgrouting"><a href="#安装postgis和pgrouting" class="headerlink" title="安装postgis和pgrouting"></a>安装postgis和pgrouting</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y postgis32_13.x86_64</span><br><span class="line">yum install -y postgis32_13-utils</span><br><span class="line">yum install -y postgis32_13-client</span><br><span class="line">yum install -y pgrouting_13.x86_64</span><br></pre></td></tr></table></figure><h3 id="数据库设置"><a href="#数据库设置" class="headerlink" title="数据库设置"></a>数据库设置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> extension postgis;</span><br><span class="line"><span class="keyword">create</span> extension postgis_topology;</span><br><span class="line"><span class="keyword">create</span> extension fuzzystrmatch;</span><br><span class="line"><span class="keyword">create</span> extension address_standardizer;</span><br><span class="line"><span class="keyword">create</span> extension address_standardizer_data_us;</span><br><span class="line"><span class="keyword">create</span> extension postgis_tiger_geocoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> extension pgrouting;</span><br></pre></td></tr></table></figure><h3 id="安装tomcat和geoserver"><a href="#安装tomcat和geoserver" class="headerlink" title="安装tomcat和geoserver"></a>安装tomcat和geoserver</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">## 下载tomcat9和gerserver.war包，把war包放到tomcat的webapps目录下</span></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">/data/geoserver/apache-tomcat-9.0.64/bin/startup.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Geoserver安装&quot;&gt;&lt;a href=&quot;#Geoserver安装&quot; class=&quot;headerlink&quot; title=&quot;Geoserver安装&quot;&gt;&lt;/a&gt;Geoserver安装&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;head</summary>
      
    
    
    
    <category term="GIS" scheme="https://biglovewheat.gihub.io/categories/GIS/"/>
    
    
    <category term="GIS" scheme="https://biglovewheat.gihub.io/tags/GIS/"/>
    
    <category term="Postgresql" scheme="https://biglovewheat.gihub.io/tags/Postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Shell-获取Mysql查询返回值</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/</id>
    <published>2022-08-02T06:07:37.355Z</published>
    <updated>2022-08-02T01:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell-获取Mysql查询返回值"><a href="#Shell-获取Mysql查询返回值" class="headerlink" title="Shell-获取Mysql查询返回值"></a>Shell-获取Mysql查询返回值</h2><h3 id="获取单个值"><a href="#获取单个值" class="headerlink" title="获取单个值"></a>获取单个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MYSQL_PWD=123abc!!!</span><br><span class="line">aa=$(mysql -h192.168.8.240 -uroot -Ddatacut -e <span class="string">&quot;select apppath from sys_d_code&quot;</span> --skip-column-names)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$aa</span></span><br><span class="line"></span><br><span class="line">user=root</span><br><span class="line">pass=yfgzSap123</span><br><span class="line">port=9901</span><br><span class="line">db=datacut</span><br><span class="line">table=sys_d_code</span><br><span class="line"><span class="built_in">set</span> `mysql -u<span class="variable">$user</span> -p<span class="variable">$pass</span> -D<span class="variable">$db</span> -P <span class="variable">$port</span> -e <span class="string">&quot;select outpath from <span class="variable">$table</span>&quot;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure><h3 id="获取多个值"><a href="#获取多个值" class="headerlink" title="获取多个值"></a>获取多个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pmysqlroot -Dmmmtest -e <span class="string">&quot;select &#x27;aa&#x27;,count(1) from aa&quot;</span> --skip-column-names|<span class="keyword">while</span> <span class="built_in">read</span> a b</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;a href=&quot;#Shell-获取Mysql查询返回值&quot; class=&quot;headerlink&quot; title=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;/a&gt;Shell-获取Mysql查询返回值&lt;/h2&gt;&lt;h3 id=&quot;获</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql备份恢复</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/</id>
    <published>2022-08-02T06:07:36.950Z</published>
    <updated>2022-08-02T01:19:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql备份恢复"><a href="#Mysql备份恢复" class="headerlink" title="Mysql备份恢复"></a>Mysql备份恢复</h2><h3 id="mysqldump备份恢复"><a href="#mysqldump备份恢复" class="headerlink" title="mysqldump备份恢复"></a>mysqldump备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/mysqldata_backup</span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"></span><br><span class="line">passwd=$(grep password /etc/my.cnf |awk  <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> |<span class="built_in">head</span> -1)</span><br><span class="line">mysqldump -uroot -p<span class="variable">$passwd</span> --all-databases --set-gtid-purged=OFF |gzip &gt;<span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 上传到aws s3</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz s3://aaa/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 清理过期</span></span><br><span class="line">find <span class="variable">$ROOT_PATH</span> -mtime +1 -<span class="built_in">type</span> f -name <span class="string">&quot;*.sql.gz&quot;</span> | xargs <span class="built_in">rm</span> -vf</span><br><span class="line"></span><br><span class="line"><span class="comment">##恢复</span></span><br><span class="line"><span class="comment">#gunzip &lt; test.tar.gz |mysql -hlocalhost -uroot -pxxxxx</span></span><br></pre></td></tr></table></figure><h3 id="xtrabackup备份恢复"><a href="#xtrabackup备份恢复" class="headerlink" title="xtrabackup备份恢复"></a>xtrabackup备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##全量备份</span></span><br><span class="line">$ xtrabackup --backup --target-dir=/data/backups/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复1-修改root密码为备份数据库密码</span></span><br><span class="line">use mysql；</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复2-新建目录，修改my.cnf指向目录，并修改目录权限mysql:mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复3-准备步骤</span></span><br><span class="line">$ xtrabackup --prepare --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复4-拷贝文件</span></span><br><span class="line">$ xtrabackup --copy-back --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复5-修改目录权限mysql:mysql</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">##启动数据库</span></span><br><span class="line">systemctl start mysql</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql备份恢复&quot;&gt;&lt;a href=&quot;#Mysql备份恢复&quot; class=&quot;headerlink&quot; title=&quot;Mysql备份恢复&quot;&gt;&lt;/a&gt;Mysql备份恢复&lt;/h2&gt;&lt;h3 id=&quot;mysqldump备份恢复&quot;&gt;&lt;a href=&quot;#mysqldump备份恢</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-too-many-connections错误</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/</id>
    <published>2022-08-02T06:07:36.549Z</published>
    <updated>2022-08-02T01:19:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-too-many-connections错误"><a href="#Mysql-too-many-connections错误" class="headerlink" title="Mysql-too-many-connections错误"></a>Mysql-too-many-connections错误</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## 查看最大连接数</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> processlist;  </span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;Threads%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 查看timeout</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%timeout&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 设置timeout</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> wait_timeout<span class="operator">=</span><span class="number">300</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> interactive_timeout<span class="operator">=</span><span class="number">500</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;a href=&quot;#Mysql-too-many-connections错误&quot; class=&quot;headerlink&quot; title=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;/a&gt;My</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-RPM-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-02T06:07:36.144Z</published>
    <updated>2022-08-02T01:20:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-RPM-安装"><a href="#Mysql-RPM-安装" class="headerlink" title="Mysql-RPM-安装"></a>Mysql-RPM-安装</h2><h3 id="mysql5-7-centos7"><a href="#mysql5-7-centos7" class="headerlink" title="mysql5.7+centos7"></a>mysql5.7+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mysql-libs</span></span><br><span class="line">rpm -qa |grep mysql</span><br><span class="line">rpm -e mysql-libs-5.1.73-8.el6_8.x86_64 --nodeps</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-compat-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-5.7.24-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mysql8-centos7"><a href="#mysql8-centos7" class="headerlink" title="mysql8+centos7"></a>mysql8+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mariadb</span></span><br><span class="line">rpm -e $(rpm -qa |grep maria) --nodeps</span><br><span class="line">yum install -y net-tools.x86_64 libaio.x86_64 perl.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-plugins-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-server-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-RPM-安装&quot;&gt;&lt;a href=&quot;#Mysql-RPM-安装&quot; class=&quot;headerlink&quot; title=&quot;Mysql-RPM-安装&quot;&gt;&lt;/a&gt;Mysql-RPM-安装&lt;/h2&gt;&lt;h3 id=&quot;mysql5-7-centos7&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Linux设置最大文件打开数</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/</id>
    <published>2022-08-02T06:07:35.739Z</published>
    <updated>2022-08-02T01:36:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux设置最大文件打开数"><a href="#Linux设置最大文件打开数" class="headerlink" title="Linux设置最大文件打开数"></a>Linux设置最大文件打开数</h2><h3 id="系统级"><a href="#系统级" class="headerlink" title="系统级"></a>系统级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file-max一般为内存大小（KB）的10%来计算，一般我们不需要主动设置这个值，除非这个值确实较小</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/fs/file-max</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改方法</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max = 2000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="用户级"><a href="#用户级" class="headerlink" title="用户级"></a>用户级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line">或</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（session生效）</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（永久）</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux设置最大文件打开数&quot;&gt;&lt;a href=&quot;#Linux设置最大文件打开数&quot; class=&quot;headerlink&quot; title=&quot;Linux设置最大文件打开数&quot;&gt;&lt;/a&gt;Linux设置最大文件打开数&lt;/h2&gt;&lt;h3 id=&quot;系统级&quot;&gt;&lt;a href=&quot;#系统</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>shell循环例子</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/</id>
    <published>2022-08-01T07:19:52.825Z</published>
    <updated>2022-08-01T07:19:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell循环例子"><a href="#shell循环例子" class="headerlink" title="shell循环例子"></a>shell循环例子</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> aa.txt);<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$row</span> ;<span class="built_in">sleep</span> 2; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 3</span></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=100; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> <span class="built_in">date</span>; <span class="built_in">uptime</span>; <span class="built_in">sleep</span> 5; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 2</span></span><br><span class="line"><span class="built_in">cat</span> a.txt | <span class="keyword">while</span> <span class="built_in">read</span> row</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell循环例子&quot;&gt;&lt;a href=&quot;#shell循环例子&quot; class=&quot;headerlink&quot; title=&quot;shell循环例子&quot;&gt;&lt;/a&gt;shell循环例子&lt;/h2&gt;&lt;h3 id=&quot;for循环&quot;&gt;&lt;a href=&quot;#for循环&quot; class=&quot;header</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Oracle用户管理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</id>
    <published>2022-08-01T07:19:52.339Z</published>
    <updated>2022-08-01T07:18:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle用户管理"><a href="#Oracle用户管理" class="headerlink" title="Oracle用户管理"></a>Oracle用户管理</h2><h3 id="创建只读用户"><a href="#创建只读用户" class="headerlink" title="创建只读用户"></a>创建只读用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> query identified <span class="keyword">by</span> query <span class="keyword">default</span> tablespace cc;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">connect</span> <span class="keyword">to</span> query ;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">to</span> query;</span><br><span class="line"><span class="comment">--grant select on  aaa to query;</span></span><br><span class="line"><span class="comment">--数据字典权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">any</span> dictionary <span class="keyword">to</span> query;</span><br></pre></td></tr></table></figure><h3 id="创建sysdba权限用户"><a href="#创建sysdba权限用户" class="headerlink" title="创建sysdba权限用户"></a>创建sysdba权限用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> zdbackup identified <span class="keyword">by</span> zdbackup ;</span><br><span class="line"><span class="keyword">grant</span> sysdba <span class="keyword">to</span> zdbackup;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> session, <span class="keyword">connect</span>, resource <span class="keyword">to</span> zdbackup ;</span><br></pre></td></tr></table></figure><h3 id="用户解锁"><a href="#用户解锁" class="headerlink" title="用户解锁"></a>用户解锁</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott account unlock;</span><br></pre></td></tr></table></figure><h3 id="用户更改密码"><a href="#用户更改密码" class="headerlink" title="用户更改密码"></a>用户更改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> user01 identified <span class="keyword">by</span> user10;</span><br></pre></td></tr></table></figure><h3 id="不知道密码的情况下，修改新密码等于旧密码"><a href="#不知道密码的情况下，修改新密码等于旧密码" class="headerlink" title="不知道密码的情况下，修改新密码等于旧密码"></a>不知道密码的情况下，修改新密码等于旧密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_users;</span><br><span class="line">FSSC_LINK                      <span class="number">737</span>A7F19A6C8315B</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> FSSC_LINK identified <span class="keyword">by</span> <span class="keyword">values</span> <span class="string">&#x27;737A7F19A6C8315B&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> xxxDROP <span class="keyword">USER</span> XXx CASCADE</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle用户管理&quot;&gt;&lt;a href=&quot;#Oracle用户管理&quot; class=&quot;headerlink&quot; title=&quot;Oracle用户管理&quot;&gt;&lt;/a&gt;Oracle用户管理&lt;/h2&gt;&lt;h3 id=&quot;创建只读用户&quot;&gt;&lt;a href=&quot;#创建只读用户&quot; class=&quot;</summary>
      
    
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/categories/oracle/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Mysql数据导入导出</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</id>
    <published>2022-08-01T07:19:51.917Z</published>
    <updated>2022-08-01T07:18:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql数据导入导出"><a href="#Mysql数据导入导出" class="headerlink" title="Mysql数据导入导出"></a>Mysql数据导入导出</h2><h3 id="导出到文本"><a href="#导出到文本" class="headerlink" title="导出到文本"></a>导出到文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">select tablename,keymap from cut_table <span class="built_in">where</span> iskeymap=1</span><br><span class="line">into outfile <span class="string">&quot;<span class="variable">$OUTFILE</span>&quot;</span></span><br><span class="line">FIELDS TERMINATED BY <span class="string">&#x27;|&#x27;</span> ;</span><br><span class="line">!</span><br></pre></td></tr></table></figure><h3 id="导入文本"><a href="#导入文本" class="headerlink" title="导入文本"></a>导入文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">load data infile <span class="string">&#x27;$OUTFILE&#x27;</span> into table cut_pkey fields terminated by <span class="string">&#x27;|&#x27;</span></span><br><span class="line">(dbname,list_code,pkeyname,pkeyvalue,status);</span><br><span class="line">!</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql数据导入导出&quot;&gt;&lt;a href=&quot;#Mysql数据导入导出&quot; class=&quot;headerlink&quot; title=&quot;Mysql数据导入导出&quot;&gt;&lt;/a&gt;Mysql数据导入导出&lt;/h2&gt;&lt;h3 id=&quot;导出到文本&quot;&gt;&lt;a href=&quot;#导出到文本&quot; class</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql数据同步脚本</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E8%84%9A%E6%9C%AC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E8%84%9A%E6%9C%AC/</id>
    <published>2022-08-01T07:19:51.452Z</published>
    <updated>2022-08-01T06:36:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql数据同步脚本"><a href="#Mysql数据同步脚本" class="headerlink" title="Mysql数据同步脚本"></a>Mysql数据同步脚本</h2><p><em>用mysqldump同步两个数据库</em></p><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── db.lst                   <span class="comment">## 数据库对照表</span></span><br><span class="line">├── ignore-table.lst         <span class="comment">## 只同步结构，不同步数据的表</span></span><br><span class="line">├── mysql_sync.sh            <span class="comment">## 主程序</span></span><br><span class="line">├── source.lst               <span class="comment">## 源数据库的配置信息</span></span><br><span class="line">└── target.lst               <span class="comment">## 目标数据库的配置信息</span></span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat db.lst</span></span><br><span class="line"><span class="comment">##sourcedb|targetdb</span></span><br><span class="line">telematics|telematics</span><br><span class="line">iot_sit|iot</span><br><span class="line">baseinfo_sit|base_info</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat ignore-table.lst </span></span><br><span class="line"><span class="comment">#sourcedb.table</span></span><br><span class="line">farm_sit.t_task_machinery_msg_log_20220511</span><br><span class="line">smart_farm_test.t_ag_machinery_work_log</span><br><span class="line">farm_sit.t_task_machinery_msg_log</span><br><span class="line">smart_farm_test.um_user_action_log</span><br><span class="line">farm_sit.t_synergy_task_realtime_info</span><br><span class="line">smart_farm_test.t_drainirrigate_eq_log</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat source.lst</span></span><br><span class="line">[client]</span><br><span class="line">user=super</span><br><span class="line">password=123456</span><br><span class="line">host=172.31.40.125</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat target.lst </span></span><br><span class="line">[client]</span><br><span class="line">user=root</span><br><span class="line">password=123456</span><br><span class="line">host=localhost</span><br><span class="line">port=3306</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> db <span class="keyword">in</span> $(<span class="built_in">cat</span> db.lst|grep -v ^<span class="comment">#)</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">sdb=$(<span class="built_in">echo</span> <span class="variable">$db</span>|awk -F\| <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">tdb=$(<span class="built_in">echo</span> <span class="variable">$db</span>|awk -F\| <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sync <span class="variable">$sdb</span> --&gt; <span class="variable">$tdb</span> &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;drop database if exists \`<span class="variable">$tdb</span>\`;&quot;</span>|mysql --defaults-extra-file=target.lst</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;create database \`<span class="variable">$tdb</span>\`;&quot;</span>|mysql --defaults-extra-file=target.lst</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="variable">$x</span> ^<span class="variable">$sdb</span> ignore-table.lst</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(grep ^<span class="variable">$sdb</span> ignore-table.lst)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">row1=$(<span class="built_in">echo</span> row |awk -F\. <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">row2=<span class="variable">$row</span></span><br><span class="line">str1=<span class="variable">$str1</span><span class="string">&quot; &quot;</span><span class="variable">$row1</span></span><br><span class="line">str2=<span class="variable">$str2</span><span class="string">&quot; --ignore-table &quot;</span><span class="variable">$row2</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str1</span> <span class="variable">$str2</span></span><br><span class="line">mysqldump --defaults-extra-file=source.lst --opt <span class="variable">$sdb</span> --tables <span class="variable">$str1</span> --no-data| mysql --defaults-extra-file=target.lst -C <span class="variable">$tdb</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mysqldump --defaults-extra-file=source.lst --opt <span class="variable">$sdb</span> <span class="variable">$str2</span> | mysql --defaults-extra-file=target.lst -C <span class="variable">$tdb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## no data</span></span><br><span class="line"><span class="comment">#mysqldump --defaults-extra-file=source.lst --opt $sdb $str2 --no-data | mysql --defaults-extra-file=target.lst -C $tdb</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql数据同步脚本&quot;&gt;&lt;a href=&quot;#Mysql数据同步脚本&quot; class=&quot;headerlink&quot; title=&quot;Mysql数据同步脚本&quot;&gt;&lt;/a&gt;Mysql数据同步脚本&lt;/h2&gt;&lt;p&gt;&lt;em&gt;用mysqldump同步两个数据库&lt;/em&gt;&lt;/p&gt;
&lt;h3</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql实现dblink</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E5%AE%9E%E7%8E%B0dblink/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E5%AE%9E%E7%8E%B0dblink/</id>
    <published>2022-08-01T07:19:51.021Z</published>
    <updated>2022-08-01T07:18:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql实现dblink"><a href="#Mysql实现dblink" class="headerlink" title="Mysql实现dblink"></a>Mysql实现dblink</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server version: 8.0.23 MySQL Community Server - GPL</span><br></pre></td></tr></table></figure><h3 id="查看引擎"><a href="#查看引擎" class="headerlink" title="查看引擎"></a>查看引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">show engines;</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |</span><br><span class="line">| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |</span><br><span class="line">| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables      | NO           | NO   | NO         |</span><br><span class="line">| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#federated 有安装但没有开启</span></span><br></pre></td></tr></table></figure><h3 id="设置参数并重启数据库"><a href="#设置参数并重启数据库" class="headerlink" title="设置参数并重启数据库"></a>设置参数并重启数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;federated&quot;</span> &gt;&gt;/etc/my.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_tasks_operate` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `tasks_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度任务id&#x27;</span>,</span><br><span class="line">  KEY `tasks_id_index` (`tasks_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>FEDERATED <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_general_ci ROW_FORMAT<span class="operator">=</span>COMPACT CONNECTION<span class="operator">=</span><span class="string">&#x27;mysql://root:123456@192.168.1.1:3306/farm_test/t_tasks_operate&#x27;</span> ;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql实现dblink&quot;&gt;&lt;a href=&quot;#Mysql实现dblink&quot; class=&quot;headerlink&quot; title=&quot;Mysql实现dblink&quot;&gt;&lt;/a&gt;Mysql实现dblink&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; cla</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>rsync同步</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/rsync%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/rsync%E5%90%8C%E6%AD%A5/</id>
    <published>2022-07-27T05:58:10.731Z</published>
    <updated>2022-07-27T00:30:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="rsync同步"><a href="#rsync同步" class="headerlink" title="rsync同步"></a>rsync同步</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y rsync</span><br></pre></td></tr></table></figure><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-a 归档模式</span><br><span class="line">-v 详细模式</span><br><span class="line">-z 传输过程中压缩</span><br><span class="line">-u 更新模式</span><br><span class="line">-t 保持文件时间</span><br><span class="line">-P 显示进度</span><br><span class="line">--progress 显示过程中的状态</span><br><span class="line">--delete 实现无差异数据同步，删掉dst的文件</span><br><span class="line">--exclude 排除,目录相对于src目录</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -avzut -P --progress /data/aaa/ root@10.9.127.33:/data/bbb/</span><br><span class="line"></span><br><span class="line">rsync -avzut -P --progress /var/lib/jenkins/ ops_root@172.31.51.65:/data/backup/jenkins/  --exclude workspace  --exclude .cache --exclude .npm</span><br></pre></td></tr></table></figure><h3 id="排除列表脚本"><a href="#排除列表脚本" class="headerlink" title="排除列表脚本"></a>排除列表脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 排除列表</span></span><br><span class="line"><span class="built_in">cat</span> sync_gis.exclude.lst</span><br><span class="line">geoserver/8083/</span><br><span class="line">geoserver/8084/logs/</span><br><span class="line">geoserver/8084/temp/</span><br><span class="line">geoserver/6066/logs/</span><br><span class="line">geoserver/6066/temp/</span><br><span class="line">geoserver/data/data_8083/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">geoserver/data/data_6066/data/test0903</span><br><span class="line">geoserver/data/data_6066/logs/</span><br><span class="line">geoserver/data/data_6066/gwc/</span><br><span class="line">geoserver/data/data_8084/logs/</span><br><span class="line">geoserver/data/data_8084/gwc/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"></span><br><span class="line">CMDSTR=<span class="string">&#x27;cd /home/gis/server;rsync -avzut geoserver /s3mnt/gis_data/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> sync_gis.exclude.lst |grep -v ^<span class="comment"># |grep -v ^$);do</span></span><br><span class="line">    CMDSTR=<span class="variable">$CMDSTR</span><span class="string">&quot; --exclude &quot;</span><span class="variable">$row</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CMDSTR</span> |sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;rsync同步&quot;&gt;&lt;a href=&quot;#rsync同步&quot; class=&quot;headerlink&quot; title=&quot;rsync同步&quot;&gt;&lt;/a&gt;rsync同步&lt;/h2&gt;&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="backup" scheme="https://biglovewheat.gihub.io/tags/backup/"/>
    
  </entry>
  
  <entry>
    <title>Python-查数据库-邮件告警</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/python-%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/python-%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/</id>
    <published>2022-07-27T05:58:10.255Z</published>
    <updated>2022-07-27T00:39:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-查数据库-邮件告警"><a href="#Python-查数据库-邮件告警" class="headerlink" title="Python-查数据库-邮件告警"></a>Python-查数据库-邮件告警</h2><p><em>一个python写的简单的查数据库脚本，配合crontab和邮件实现定时监控和告警。</em></p><h3 id="监控脚本"><a href="#监控脚本" class="headerlink" title="监控脚本"></a>监控脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/python3/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">dd=(datetime.datetime.now()+datetime.timedelta(days=-<span class="number">1</span>)).strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> (dd)</span><br><span class="line"></span><br><span class="line">db = pymysql.Connect(host=<span class="string">&#x27;10.0.0.1&#x27;</span>,port=<span class="number">3306</span>,user=<span class="string">&#x27;root&#x27;</span>,passwd=<span class="string">&#x27;123456&#x27;</span>,db=<span class="string">&#x27;testdb&#x27;</span>,charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;select * from t_farm where time=&#x27;&quot;</span>+dd+<span class="string">&quot;&#x27;;&quot;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">row=cursor.rowcount</span><br><span class="line"><span class="comment">#print (row)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> row == <span class="number">0</span> :</span><br><span class="line">    msg = MIMEText(dd+<span class="string">&#x27;的条目数是: &#x27;</span>+<span class="built_in">str</span>(row)+<span class="string">&#x27; ,请检查。&#x27;</span>,<span class="string">&#x27;plain&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    from_addr = <span class="string">&#x27;biglovewheat@126.com&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;GQYRFCDKEXEIHQGH&#x27;</span>   <span class="comment">## 邮箱的授权密码，非用户密码</span></span><br><span class="line">    to_addr = [<span class="string">&#x27;biglovewheat@126.com&#x27;</span>,<span class="string">&#x27;aa@126.com&#x27;</span>]</span><br><span class="line">    smtp_server = <span class="string">&#x27;smtp.126.com&#x27;</span></span><br><span class="line">    msg[<span class="string">&#x27;From&#x27;</span>] = from_addr</span><br><span class="line">    msg[<span class="string">&#x27;To&#x27;</span>] = <span class="string">&#x27;,&#x27;</span>.join(to_addr)</span><br><span class="line">    msg[<span class="string">&#x27;Subject&#x27;</span>] = <span class="string">&#x27;Python脚本告警&#x27;</span></span><br><span class="line">    server = smtplib.SMTP_SSL(smtp_server,<span class="number">465</span>)</span><br><span class="line">    server.login(from_addr,password)</span><br><span class="line">    server.sendmail(from_addr,to_addr,msg.as_string())</span><br><span class="line">    server.quit()</span><br></pre></td></tr></table></figure><h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">31 4 * * * /data/app/moni.py &gt;&gt; /data/app/moni.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-查数据库-邮件告警&quot;&gt;&lt;a href=&quot;#Python-查数据库-邮件告警&quot; class=&quot;headerlink&quot; title=&quot;Python-查数据库-邮件告警&quot;&gt;&lt;/a&gt;Python-查数据库-邮件告警&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个python写的</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Python" scheme="https://biglovewheat.gihub.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>prometheus-mysql-监控</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/prometheus-mysql-%E7%9B%91%E6%8E%A7/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/prometheus-mysql-%E7%9B%91%E6%8E%A7/</id>
    <published>2022-07-27T05:58:09.755Z</published>
    <updated>2022-07-27T02:10:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="prometheus-mysql-监控"><a href="#prometheus-mysql-监控" class="headerlink" title="prometheus-mysql-监控"></a>prometheus-mysql-监控</h2><h3 id="mysql创建用户并授权"><a href="#mysql创建用户并授权" class="headerlink" title="mysql创建用户并授权"></a>mysql创建用户并授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>; </span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION CLIENT,PROCESS,<span class="keyword">SELECT</span>  <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ; </span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="mysql-exporter配置"><a href="#mysql-exporter配置" class="headerlink" title="mysql-exporter配置"></a>mysql-exporter配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client.cnf</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;/opt/mysqld_exporter/.client.cnf</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">user=exporter</span></span><br><span class="line"><span class="string">password=123456</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;/usr/lib/systemd/system/mysqld_exporter.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description= Prometheus MySQL Exporter</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">Group=root</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">ExecStart=/opt/mysqld_exporter/mysqld_exporter \</span></span><br><span class="line"><span class="string">--config.my-cnf /opt/mysqld_exporter/.client.cnf \</span></span><br><span class="line"><span class="string">--web.listen-address=0.0.0.0:51235</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="prometheus配置"><a href="#prometheus配置" class="headerlink" title="prometheus配置"></a>prometheus配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加配置并重启prometheus</span></span><br><span class="line">prometheus 配置</span><br><span class="line">  - job_name: mysql</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&#x27;172.31.40.125:51235&#x27;</span>, <span class="string">&#x27;172.31.36.28:51235&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="grafana配置"><a href="#grafana配置" class="headerlink" title="grafana配置"></a>grafana配置</h3><p><a href="https://grafana.com/grafana/dashboards/7362">grafana.com&#x2F;grafana&#x2F;dashboards&#x2F;</a></p><h3 id="alert-manager告警配置"><a href="#alert-manager告警配置" class="headerlink" title="alert-manager告警配置"></a>alert-manager告警配置</h3><p>待补充</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;prometheus-mysql-监控&quot;&gt;&lt;a href=&quot;#prometheus-mysql-监控&quot; class=&quot;headerlink&quot; title=&quot;prometheus-mysql-监控&quot;&gt;&lt;/a&gt;prometheus-mysql-监控&lt;/h2&gt;&lt;h3 i</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
    <category term="prometheus" scheme="https://biglovewheat.gihub.io/tags/prometheus/"/>
    
  </entry>
  
</feed>
