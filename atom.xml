<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2023-11-25T04:42:31.744Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Ansible-批量安装mysql</title>
    <link href="https://biglovewheat.gihub.io/2023/11/06/ansible-%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85mysql/"/>
    <id>https://biglovewheat.gihub.io/2023/11/06/ansible-%E6%89%B9%E9%87%8F%E5%AE%89%E8%A3%85mysql/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-批量安装mysql"><a href="#Ansible-批量安装mysql" class="headerlink" title="Ansible-批量安装mysql"></a>Ansible-批量安装mysql</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libselinux-python</span><br><span class="line"><span class="comment">#创建用户、文件夹</span></span><br><span class="line">groupadd mysql</span><br><span class="line">useradd mysql -g mysql -s /sbin/nologin -M</span><br><span class="line"><span class="built_in">mkdir</span> -p /home/data</span><br><span class="line"><span class="comment">#安装rpm包</span></span><br><span class="line">rpm -e --nodeps mysql-libs-5.1.73-8.el6_8.x86_64</span><br><span class="line">rpm -ivh MySQL-devel-5.6.37-1.el6.x86_64.rpm MySQL-client-5.6.37-1.el6.x86_64.rpm MySQL-server-5.6.37-1.el6.x86_64.rpm</span><br><span class="line"><span class="comment">#复制配置文件</span></span><br><span class="line"><span class="built_in">cp</span> my.cnf /etc/my.cnf</span><br><span class="line"><span class="comment">#转移文件</span></span><br><span class="line"><span class="built_in">mv</span> /var/lib/mysql /home/data</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /home/data</span><br><span class="line"><span class="comment">##启动mysql</span></span><br><span class="line">service mysql start</span><br><span class="line"><span class="comment">##开机启动</span></span><br><span class="line">chkconfig mysql on</span><br><span class="line"></span><br><span class="line"><span class="comment">##初始化脚本</span></span><br><span class="line">sh setmysql.sh</span><br><span class="line">setmysql.sh</span><br><span class="line">passwd=`awk -F<span class="string">&quot;time):&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> /root/.mysql_secret |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">mysql -uroot -p<span class="variable">$passwd</span> -b --connect-expired-password &lt;setmysql.sql</span><br><span class="line">setmysql.sql</span><br><span class="line">SET PASSWORD = PASSWORD(<span class="string">&#x27;ShSflow!@#123&#x27;</span>);</span><br><span class="line">create user mysql identified by <span class="string">&quot;ShSflow!@#123&quot;</span>;</span><br><span class="line">grant all privileges on *.* to <span class="string">&#x27;mysql&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;ShSflow!@#123&#x27;</span> with grant option;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="comment">##重启mysql</span></span><br><span class="line">service mysql restart</span><br><span class="line"><span class="comment">##防火墙设置</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 3306 -j ACCEPT</span><br><span class="line">service iptables save</span><br><span class="line">service iptables restart</span><br><span class="line"><span class="comment">##ansible脚本</span></span><br><span class="line">---</span><br><span class="line">- hosts: ggall</span><br><span class="line">remote_user: root</span><br><span class="line">tasks:</span><br><span class="line">- name: make user,group,<span class="built_in">dir</span></span><br><span class="line">shell: groupadd mysql; useradd mysql -g mysql -s /sbin/nologin -M; <span class="built_in">mkdir</span> -p /home/data ;<span class="built_in">mkdir</span> -p /home/shanghang/soft</span><br><span class="line">- name: remove mysql-libs*</span><br><span class="line">shell: yum remove mysql-libs* -y</span><br><span class="line">- name: install numactl</span><br><span class="line">shell: yum install -y numactl</span><br><span class="line">- name: copy rpm</span><br><span class="line">copy: src=/soft/ansible/MySQL-client-5.6.37-1.el6.x86_64.rpm dest=/home/shanghang/soft/MySQL-client-5.6.37-1.el6.x86_64.rpm</span><br><span class="line">- name: copy rpm</span><br><span class="line">copy: src=/soft/ansible/MySQL-devel-5.6.37-1.el6.x86_64.rpm dest=/home/shanghang/soft/MySQL-devel-5.6.37-1.el6.x86_64.rpm</span><br><span class="line">- name: copy rpm</span><br><span class="line">copy: src=/soft/ansible/MySQL-server-5.6.37-1.el6.x86_64.rpm dest=/home/shanghang/soft/MySQL-server-5.6.37-1.el6.x86_64.rpm</span><br><span class="line">- name: install rpm</span><br><span class="line">shell: rpm -ivh MySQL-devel-5.6.37-1.el6.x86_64.rpm MySQL-client-5.6.37-1.el6.x86_64.rpm MySQL-server-5.6.37-1.el6.x86_64.rpm</span><br><span class="line">args:</span><br><span class="line"><span class="built_in">chdir</span>: /home/shanghang/soft/</span><br><span class="line">- name: copy my.cnf</span><br><span class="line">copy: src=/soft/ansible/my.cnf dest=/etc/my.cnf</span><br><span class="line">- name: move mysqldir to /home/data</span><br><span class="line">shell: <span class="built_in">mv</span> /var/lib/mysql /home/data ; <span class="built_in">chown</span> -R mysql:mysql /home/data</span><br><span class="line">- name: start mysql</span><br><span class="line">shell: service mysql start</span><br><span class="line">- name: <span class="built_in">set</span> autorun</span><br><span class="line">shell: chkconfig mysql on</span><br><span class="line">- name: <span class="built_in">set</span> autorun</span><br><span class="line">shell: chkconfig mysql on</span><br><span class="line">- name: copy setmysql.sh</span><br><span class="line">copy: src=/soft/ansible/setmysql.sh dest=/home/shanghang/soft/setmysql.sh</span><br><span class="line">- name: copy setmysql.sql</span><br><span class="line">copy: src=/soft/ansible/setmysql.sql dest=/home/shanghang/soft/setmysql.sql</span><br><span class="line">- name: run setmysql.sh</span><br><span class="line">shell: sh setmysql.sh</span><br><span class="line">args:</span><br><span class="line"><span class="built_in">chdir</span>: /home/shanghang/soft/</span><br><span class="line">- name: restart mysql</span><br><span class="line">shell: service mysql restart</span><br><span class="line">- name: <span class="built_in">set</span> iptables</span><br><span class="line">shell: iptables -A INPUT -p tcp --dport 3306 -j ACCEPT</span><br><span class="line">- name: save iptables</span><br><span class="line">shell: service iptables save</span><br><span class="line">- name: restart iptables</span><br><span class="line">shell: service iptables restart</span><br><span class="line"><span class="comment">##my.cnf</span></span><br><span class="line">[client]</span><br><span class="line">socket=/home/data/mysql/mysql.sock</span><br><span class="line">[mysqld]</span><br><span class="line">skip-name-resolve</span><br><span class="line">port=3306</span><br><span class="line">basedir=/usr</span><br><span class="line">datadir=/home/data/mysql</span><br><span class="line">socket=/home/data/mysql/mysql.sock</span><br><span class="line">server-id=2</span><br><span class="line">max_allowed_packet = 20M</span><br><span class="line">federated</span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line">innodb_buffer_pool_size=2G</span><br><span class="line">innodb_log_file_size=1G</span><br><span class="line"><span class="comment"># Other</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line">max-connect-errors=6000</span><br><span class="line">max-connections=3000</span><br><span class="line">thread_cache_size = 300</span><br><span class="line">thread_concurrency =32</span><br><span class="line">innodb_thread_concurrency =16</span><br><span class="line">max-connect-errors=6000</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">lower_case_table_names=1</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Ansible-批量安装mysql&quot;&gt;&lt;a href=&quot;#Ansible-批量安装mysql&quot; class=&quot;headerlink&quot; title=&quot;Ansible-批量安装mysql&quot;&gt;&lt;/a&gt;Ansible-批量安装mysql&lt;/h2&gt;&lt;figure class</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="ansible" scheme="https://biglovewheat.gihub.io/tags/ansible/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-limit用法</title>
    <link href="https://biglovewheat.gihub.io/2023/11/06/mysql-limit%E7%94%A8%E6%B3%95/"/>
    <id>https://biglovewheat.gihub.io/2023/11/06/mysql-limit%E7%94%A8%E6%B3%95/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-limit用法"><a href="#Mysql-limit用法" class="headerlink" title="Mysql-limit用法"></a>Mysql-limit用法</h2><p>语法：<br>SELECT * FROM table LIMIT [offset,] rows | rows OFFSET offset<br>LIMIT 接受一个或两个数字参数。参数必须是一个整数常量。</p><p>如果给定两个参数，第一个参数指定第一个返回记录行的偏移量，第二个参数指定返回记录行的最大数目。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>取前<span class="number">15</span>条记录：</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tablename limit <span class="number">15</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tablename <span class="keyword">order</span> <span class="keyword">by</span> orderfield <span class="keyword">desc</span><span class="operator">/</span><span class="keyword">asc</span> limit <span class="number">0</span>,<span class="number">15</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 检索记录行 <span class="number">6</span><span class="number">-15</span> ,注意，<span class="number">10</span>为偏移量 </span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="number">5</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 检索记录行 <span class="number">96</span><span class="operator">-</span><span class="keyword">last</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="number">95</span>,<span class="number">-1</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-limit用法&quot;&gt;&lt;a href=&quot;#Mysql-limit用法&quot; class=&quot;headerlink&quot; title=&quot;Mysql-limit用法&quot;&gt;&lt;/a&gt;Mysql-limit用法&lt;/h2&gt;&lt;p&gt;语法：&lt;br&gt;SELECT * FROM table</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-双主复制和keepalived</title>
    <link href="https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6%E5%92%8Ckeepalived/"/>
    <id>https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6%E5%92%8Ckeepalived/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-双主复制和keepalived"><a href="#Mysql-双主复制和keepalived" class="headerlink" title="Mysql-双主复制和keepalived"></a>Mysql-双主复制和keepalived</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test1  192.168.8.201 centos7 mysql5.7</span><br><span class="line">test2  192.168.8.202  centos7 mysql5.7</span><br><span class="line">虚拟vip  192.168.8.203  keepalived 1.2.13</span><br><span class="line">xtrabackup 2.4</span><br></pre></td></tr></table></figure><h3 id="mysql安装配置"><a href="#mysql安装配置" class="headerlink" title="mysql安装配置"></a>mysql安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装xtrabackup</span></span><br><span class="line">rpm -ivh libev-4.15-7.el7.x86_64.rpm</span><br><span class="line">yum install -y percona-xtrabackup-80-8.0.10-1.el7.x86_64.rpm</span><br><span class="line">``</span><br><span class="line"><span class="comment">## 安装mysql</span></span><br><span class="line">rpm -qa |grep maria</span><br><span class="line">rpm -e mariadb-libs-5.5.60-1.el7_5.x86_64 --nodeps</span><br><span class="line">yum install -y net-tools perl</span><br><span class="line"></span><br><span class="line">rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-compat-5.7.28-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line">systemctl restart mysqld</span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line">mysql&gt;use mysql;</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql8</span></span><br><span class="line">create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br></pre></td></tr></table></figure><h4 id="1号机开启binlog"><a href="#1号机开启binlog" class="headerlink" title="1号机开启binlog"></a>1号机开启binlog</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"><span class="comment">##开启binlog</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="comment">##binlog模式</span></span><br><span class="line">server-id=1</span><br><span class="line"><span class="comment">##serverid,两台机不能相同</span></span><br><span class="line">auto_increment_increment=2</span><br><span class="line"><span class="comment">##自增量步进，一般为服务器数量</span></span><br><span class="line">auto_increment_offset=1</span><br><span class="line"><span class="comment">##自增量偏移量</span></span><br><span class="line">replicate-do-db=monitor</span><br><span class="line"><span class="comment">##需复制数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启</span></span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><h4 id="1号机开启脚本，不停插入数据"><a href="#1号机开启脚本，不停插入数据" class="headerlink" title="1号机开启脚本，不停插入数据"></a>1号机开启脚本，不停插入数据</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建测试表</span></span><br><span class="line">create database monitor;</span><br><span class="line">use monitor;</span><br><span class="line">create table moni(monidata datetime,host varchar(20));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@mysql1 mysqlbackup]<span class="comment"># cat /aa.sh</span></span><br><span class="line"><span class="built_in">export</span> MYSQL_PWD=<span class="string">&quot;2014Picc!!!&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">mysql -u root -D monitor &lt;&lt;! 2&gt;&gt; aa.log 1&gt;&amp;2</span><br><span class="line">insert into moni(monidata,host)</span><br><span class="line">select now(),<span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">!</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h4 id="1号机全量备份，设置备份用户"><a href="#1号机全量备份，设置备份用户" class="headerlink" title="1号机全量备份，设置备份用户"></a>1号机全量备份，设置备份用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT,PROCESS,SUPER ON *.* TO <span class="string">&#x27;bkpuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h4 id="全量备份"><a href="#全量备份" class="headerlink" title="全量备份"></a>全量备份</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup --defaults-file=/etc/my.cnf --host=localhost --port=3306 --user=bkpuser --password=2014Picc!!! --target-dir=/mysqlbackup/ --backup</span><br></pre></td></tr></table></figure><h4 id="从1号机拷贝数据导2号机"><a href="#从1号机拷贝数据导2号机" class="headerlink" title="从1号机拷贝数据导2号机"></a>从1号机拷贝数据导2号机</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r 2019-08-26_15-43-26 192.168.8.202:/backup</span><br></pre></td></tr></table></figure><h4 id="2号机停止mysql"><a href="#2号机停止mysql" class="headerlink" title="2号机停止mysql"></a>2号机停止mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql stop</span><br></pre></td></tr></table></figure><h4 id="2号机清空mysqldata文件件"><a href="#2号机清空mysqldata文件件" class="headerlink" title="2号机清空mysqldata文件件"></a>2号机清空mysqldata文件件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /mysqldata/*</span><br></pre></td></tr></table></figure><h4 id="2号机查看备份的日志信息（同步时用到"><a href="#2号机查看备份的日志信息（同步时用到" class="headerlink" title="2号机查看备份的日志信息（同步时用到)"></a>2号机查看备份的日志信息（同步时用到)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">innobackupex --apply-log /backup/2019-08-26_16-37-20</span><br><span class="line">InnoDB: xtrabackup: Last MySQL binlog file position 15398, file name mysql-bin.000003</span><br></pre></td></tr></table></figure><h4 id="2号机恢复备份"><a href="#2号机恢复备份" class="headerlink" title="2号机恢复备份"></a>2号机恢复备份</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innobackupex --defaults-file=/etc/my.cnf --use-memory=1G --copy-back /backup/2019-08-26_16-37-20</span><br></pre></td></tr></table></figure><h4 id="恢复后更改属主"><a href="#恢复后更改属主" class="headerlink" title="恢复后更改属主"></a>恢复后更改属主</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R mysql:mysql /mysqldata</span><br></pre></td></tr></table></figure><h4 id="2号机开启binlog"><a href="#2号机开启binlog" class="headerlink" title="2号机开启binlog"></a>2号机开启binlog</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">log-bin=mysql-bin</span><br><span class="line"><span class="comment">##开启binlog</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"><span class="comment">##binlog模式</span></span><br><span class="line">server-id=2</span><br><span class="line"><span class="comment">##serverid,两台机不能相同</span></span><br><span class="line">auto_increment_increment=2</span><br><span class="line"><span class="comment">##自增量步进，一般为服务器数量</span></span><br><span class="line">auto_increment_offset=2</span><br><span class="line"><span class="comment">##自增量偏移量</span></span><br><span class="line">replicate-do-db=monitor</span><br><span class="line"><span class="comment">##需复制数据库</span></span><br></pre></td></tr></table></figure><h4 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure><h4 id="查看表情况"><a href="#查看表情况" class="headerlink" title="查看表情况"></a>查看表情况</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select max(<span class="built_in">id</span>) from moni;</span><br><span class="line">+---------+</span><br><span class="line">| max(<span class="built_in">id</span>) |</span><br><span class="line">+---------+</span><br><span class="line">|    2689 |</span><br><span class="line">+---------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt;  select max(<span class="built_in">id</span>) from moni;</span><br><span class="line">+---------+</span><br><span class="line">| max(<span class="built_in">id</span>) |</span><br><span class="line">+---------+</span><br><span class="line">|    1935 |</span><br><span class="line">+---------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="1号机创建复制用户"><a href="#1号机创建复制用户" class="headerlink" title="1号机创建复制用户"></a>1号机创建复制用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO <span class="string">&#x27;repuser&#x27;</span>@<span class="string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line">show master status;</span><br></pre></td></tr></table></figure><h4 id="2号机开启slave"><a href="#2号机开启slave" class="headerlink" title="2号机开启slave"></a>2号机开启slave</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=<span class="string">&#x27;192.168.8.201&#x27;</span>, master_user=<span class="string">&#x27;repuser&#x27;</span>, master_password=<span class="string">&#x27;2014Picc!!!&#x27;</span>, master_log_file=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, master_log_pos=15398;</span><br><span class="line">start slave;</span><br><span class="line">show slave status\G</span><br></pre></td></tr></table></figure><h4 id="停掉插入脚本，对比两边数据状态"><a href="#停掉插入脚本，对比两边数据状态" class="headerlink" title="停掉插入脚本，对比两边数据状态"></a>停掉插入脚本，对比两边数据状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ps -ef |grep aa.sh |grep -v grep |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="built_in">kill</span> -9</span><br><span class="line">mysql&gt; select max(<span class="built_in">id</span>) from moni;</span><br><span class="line">+---------+</span><br><span class="line">| max(<span class="built_in">id</span>) |</span><br><span class="line">+---------+</span><br><span class="line">|    3369 |</span><br><span class="line">+---------+</span><br><span class="line">mysql&gt; select max(<span class="built_in">id</span>) from moni;</span><br><span class="line">+---------+</span><br><span class="line">| max(<span class="built_in">id</span>) |</span><br><span class="line">+---------+</span><br><span class="line">|    3369 |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure><h4 id="同理，创建2号机到1号机的复制，2号机创建复制用户"><a href="#同理，创建2号机到1号机的复制，2号机创建复制用户" class="headerlink" title="同理，创建2号机到1号机的复制，2号机创建复制用户"></a>同理，创建2号机到1号机的复制，2号机创建复制用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO <span class="string">&#x27;repuser&#x27;</span>@<span class="string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;2014Picc&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h4 id="查看2号机日志状态"><a href="#查看2号机日志状态" class="headerlink" title="查看2号机日志状态"></a>查看2号机日志状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><h4 id="1号机开启slave，并查看状态"><a href="#1号机开启slave，并查看状态" class="headerlink" title="1号机开启slave，并查看状态"></a>1号机开启slave，并查看状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=<span class="string">&#x27;192.168.8.202&#x27;</span>, master_user=<span class="string">&#x27;repuser&#x27;</span>, master_password=<span class="string">&#x27;2014Picc&#x27;</span>, master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos=434;</span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line">show slave status\G</span><br></pre></td></tr></table></figure><h4 id="2号机开启插入脚本"><a href="#2号机开启插入脚本" class="headerlink" title="2号机开启插入脚本"></a>2号机开启插入脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql1 mysqlbackup]<span class="comment"># cat /bb.sh</span></span><br><span class="line"><span class="built_in">export</span> MYSQL_PWD=<span class="string">&quot;2014Picc&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">mysql -u root -D monitor &lt;&lt;! 2&gt;&gt; aa.log 1&gt;&amp;2</span><br><span class="line">insert into moni(monidata,host)</span><br><span class="line">select now(),<span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">!</span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h4 id="停止1、2号机上的脚本"><a href="#停止1、2号机上的脚本" class="headerlink" title="停止1、2号机上的脚本"></a>停止1、2号机上的脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef |grep aa.sh |grep -v grep |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="built_in">kill</span> -9</span><br><span class="line">ps -ef |grep bb.sh |grep -v grep |awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure><h4 id="对比数据状态，数据一致"><a href="#对比数据状态，数据一致" class="headerlink" title="对比数据状态，数据一致"></a>对比数据状态，数据一致</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,count(1) from moni group by host;</span><br><span class="line">+------+----------+</span><br><span class="line">| host | count(1) |</span><br><span class="line">+------+----------+</span><br><span class="line">| A    |     1038 |</span><br><span class="line">| B    |       84 |</span><br><span class="line">+------+----------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt;  select host,count(1) from moni group by host;</span><br><span class="line">+------+----------+</span><br><span class="line">| host | count(1) |</span><br><span class="line">+------+----------+</span><br><span class="line">| A    |     1038 |</span><br><span class="line">| B    |       84 |</span><br><span class="line">+------+----------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></table></figure><h3 id="keepalived配置"><a href="#keepalived配置" class="headerlink" title="keepalived配置"></a>keepalived配置</h3><h4 id="安装（1，2号机）"><a href="#安装（1，2号机）" class="headerlink" title="安装（1，2号机）"></a>安装（1，2号机）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh keepalived-1.2.13-5.el6_6.x86_64.rpm</span><br></pre></td></tr></table></figure><h4 id="1号机配置"><a href="#1号机配置" class="headerlink" title="1号机配置"></a>1号机配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql1 haproxy15_keepalived12_el6_rpm]<span class="comment"># cat /etc/keepalived/keepalived.conf</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id rr1</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script check_mysql &#123;</span><br><span class="line">    script <span class="string">&quot;/root/check_mysql.sh&quot;</span></span><br><span class="line">    interval 5</span><br><span class="line">&#125;</span><br><span class="line">vrrp_sync_group VG1 &#123;</span><br><span class="line">     group &#123;</span><br><span class="line">       VI_1</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 2014Picc</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.8.199</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">       check_mysql</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2号机配置"><a href="#2号机配置" class="headerlink" title="2号机配置"></a>2号机配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql2 ~]<span class="comment"># cat /etc/keepalived/keepalived.conf</span></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id rr2</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script check_mysql &#123;</span><br><span class="line">    script <span class="string">&quot;/root/check_mysql.sh&quot;</span></span><br><span class="line">    interval 5</span><br><span class="line">&#125;</span><br><span class="line">vrrp_sync_group VG1 &#123;</span><br><span class="line">     group &#123;</span><br><span class="line">       VI_1</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth1</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 50</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 2014Picc</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.8.199</span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">    check_mysql</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1，2号机配置脚本"><a href="#1，2号机配置脚本" class="headerlink" title="1，2号机配置脚本"></a>1，2号机配置脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql2 ~]<span class="comment"># cat /root/check_mysql.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">MYSQL=/usr/bin/mysql</span><br><span class="line">MYSQL_HOST=localhost</span><br><span class="line">MYSQL_USER=root</span><br><span class="line"><span class="built_in">export</span> MYSQL_PWD=<span class="string">&quot;2014Picc&quot;</span></span><br><span class="line">CHECK_TIME=3</span><br><span class="line"><span class="comment">#mysql  is working MYSQL_OK is 1 , mysql down MYSQL_OK is 0</span></span><br><span class="line">MYSQL_OK=1</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_mysql_health</span></span> ()&#123;</span><br><span class="line"><span class="variable">$MYSQL</span> -h <span class="variable">$MYSQL_HOST</span> -u <span class="variable">$MYSQL_USER</span> -e <span class="string">&quot;show status;&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? = 0 ] ;<span class="keyword">then</span></span><br><span class="line">     MYSQL_OK=1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">     MYSQL_OK=0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">     <span class="built_in">return</span> <span class="variable">$MYSQL_OK</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$CHECK_TIME</span> -ne 0 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     <span class="built_in">let</span> <span class="string">&quot;CHECK_TIME-=1&quot;</span></span><br><span class="line">     check_mysql_health</span><br><span class="line">     <span class="keyword">if</span> [ <span class="variable">$MYSQL_OK</span> = 1 ] ; <span class="keyword">then</span></span><br><span class="line">          CHECK_TIME=0</span><br><span class="line">          <span class="built_in">exit</span> 0</span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line">     <span class="keyword">if</span> [ <span class="variable">$MYSQL_OK</span> -eq 0 ] &amp;&amp;  [ <span class="variable">$CHECK_TIME</span> -eq 0 ]</span><br><span class="line">     <span class="keyword">then</span></span><br><span class="line">          /etc/init.d/keepalived stop</span><br><span class="line">     <span class="built_in">exit</span> 1</span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line">     <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h4 id="1，2号机启动keepalived"><a href="#1，2号机启动keepalived" class="headerlink" title="1，2号机启动keepalived"></a>1，2号机启动keepalived</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service keepalived start</span><br></pre></td></tr></table></figure><h4 id="测试，用vip连接数据库，查看实例id"><a href="#测试，用vip连接数据库，查看实例id" class="headerlink" title="测试，用vip连接数据库，查看实例id"></a>测试，用vip连接数据库，查看实例id</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 192.168.8.199 -u root -p</span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%server_id%&#x27;</span>;</span><br><span class="line">+----------------+-------+</span><br><span class="line">| Variable_name  | Value |</span><br><span class="line">+----------------+-------+</span><br><span class="line">| server_id      | 1     |</span><br><span class="line">| server_id_bits | 32    |</span><br><span class="line">+----------------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="关掉1号机mysql"><a href="#关掉1号机mysql" class="headerlink" title="关掉1号机mysql"></a>关掉1号机mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql stop</span><br></pre></td></tr></table></figure><h4 id="重新登录查询，已成功切换"><a href="#重新登录查询，已成功切换" class="headerlink" title="重新登录查询，已成功切换"></a>重新登录查询，已成功切换</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 192.168.8.199 -u root -p</span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%server_id%&#x27;</span>;</span><br><span class="line">+----------------+-------+</span><br><span class="line">| Variable_name  | Value |</span><br><span class="line">+----------------+-------+</span><br><span class="line">| server_id      | 2     |</span><br><span class="line">| server_id_bits | 32    |</span><br><span class="line">+----------------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h4 id="重启1号机mysql、keepalived"><a href="#重启1号机mysql、keepalived" class="headerlink" title="重启1号机mysql、keepalived"></a>重启1号机mysql、keepalived</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@mysql1 haproxy15_keepalived12_el6_rpm]<span class="comment"># service mysql start</span></span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br><span class="line">[root@mysql1 haproxy15_keepalived12_el6_rpm]<span class="comment"># service keepalived start</span></span><br><span class="line">Starting keepalived:                                       [  OK  ]</span><br></pre></td></tr></table></figure><h4 id="再次登录查询，已成功回切"><a href="#再次登录查询，已成功回切" class="headerlink" title="再次登录查询，已成功回切"></a>再次登录查询，已成功回切</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 192.168.8.199 -u root -p</span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%server_id%&#x27;</span>;</span><br><span class="line">+----------------+-------+</span><br><span class="line">| Variable_name  | Value |</span><br><span class="line">+----------------+-------+</span><br><span class="line">| server_id      | 1     |</span><br><span class="line">| server_id_bits | 32    |</span><br><span class="line">+----------------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-双主复制和keepalived&quot;&gt;&lt;a href=&quot;#Mysql-双主复制和keepalived&quot; class=&quot;headerlink&quot; title=&quot;Mysql-双主复制和keepalived&quot;&gt;&lt;/a&gt;Mysql-双主复制和keepalived&lt;/</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-多实例配置</title>
    <link href="https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%A4%9A%E5%AE%9E%E4%BE%8B%E9%85%8D%E7%BD%AE/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-多实例配置"><a href="#Mysql-多实例配置" class="headerlink" title="Mysql-多实例配置"></a>Mysql-多实例配置</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">/etc/my.cnf</span><br><span class="line"> </span><br><span class="line">[mysqld_multi]</span><br><span class="line">mysqld=/usr/bin/mysqld_safe</span><br><span class="line">mysqladmin=/usr/bin/mysqladmin</span><br><span class="line"><span class="built_in">log</span>=/data/mysql/mysqld_multi.log</span><br><span class="line">user=mysql_shutdown                                          <span class="comment">#--&gt;关闭用户,只有关闭权限,不配置不能用 mysqld_multi stop命令</span></span><br><span class="line">password=Sino!Sh!Dbwx!123                               <span class="comment">#--&gt;关闭用户密码,安全起见,比标准的少了一个符号</span></span><br><span class="line"> </span><br><span class="line">[mysqld3306]</span><br><span class="line">port=3306</span><br><span class="line">basedir=/usr</span><br><span class="line">datadir=/data/mysql</span><br><span class="line">socket=/data/mysql/mysql3306.sock</span><br><span class="line">server-id=2</span><br><span class="line">federated</span><br><span class="line"> </span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line">innodb_buffer_pool_size=5G</span><br><span class="line">innodb_log_file_size=1G</span><br><span class="line"> </span><br><span class="line">replicate-do-db=<span class="built_in">test</span></span><br><span class="line">replicate-ignore-db=mysql</span><br><span class="line">log-slave-updates</span><br><span class="line">slave-skip-errors=all</span><br><span class="line">slave-net-timeout=60</span><br><span class="line"></span><br><span class="line"><span class="comment"># Other</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"> </span><br><span class="line">max-connect-errors=6000</span><br><span class="line">max-connections=3000</span><br><span class="line">thread_cache_size = 300</span><br><span class="line">thread_concurrency =32</span><br><span class="line">innodb_thread_concurrency =16</span><br><span class="line">max-connect-errors=6000</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"> </span><br><span class="line">[mysqld3307]</span><br><span class="line">port=3307</span><br><span class="line">basedir=/usr</span><br><span class="line">datadir=/data/mysql3307</span><br><span class="line">socket=/data/mysql3307/mysql3307.sock</span><br><span class="line">server-id=22</span><br><span class="line">federated</span><br><span class="line"> </span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line">innodb_buffer_pool_size=5G</span><br><span class="line">innodb_log_file_size=1G</span><br><span class="line"> </span><br><span class="line">replicate-do-db=<span class="built_in">test</span></span><br><span class="line">replicate-ignore-db=mysql</span><br><span class="line">log-slave-updates</span><br><span class="line">slave-skip-errors=all</span><br><span class="line">slave-net-timeout=60</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Other</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"> </span><br><span class="line">max-connect-errors=6000</span><br><span class="line">max-connections=3000</span><br><span class="line">thread_cache_size = 300</span><br><span class="line">thread_concurrency =32</span><br><span class="line">innodb_thread_concurrency =16</span><br><span class="line">max-connect-errors=6000</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">lower_case_table_names=1</span><br><span class="line"> </span><br><span class="line">[mysqld3308]</span><br><span class="line">port=3308</span><br><span class="line">basedir=/usr</span><br><span class="line">datadir=/data/mysql3308</span><br><span class="line">socket=/data/mysql3308/mysql3308.sock</span><br><span class="line">server-id=22</span><br><span class="line">federated</span><br><span class="line"> </span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line">innodb_buffer_pool_size=5G</span><br><span class="line">innodb_log_file_size=1G</span><br><span class="line"> </span><br><span class="line">replicate-do-db=<span class="built_in">test</span></span><br><span class="line">replicate-ignore-db=mysql</span><br><span class="line">log-slave-updates</span><br><span class="line">slave-skip-errors=all</span><br><span class="line">slave-net-timeout=60</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Other</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line"> </span><br><span class="line">max-connect-errors=6000</span><br><span class="line">max-connections=3000</span><br><span class="line">thread_cache_size = 300</span><br><span class="line">thread_concurrency =32</span><br><span class="line">innodb_thread_concurrency =16</span><br><span class="line">max-connect-errors=6000</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line">lower_case_table_names=1</span><br></pre></td></tr></table></figure><h3 id="startup-and-stopd"><a href="#startup-and-stopd" class="headerlink" title="startup and stopd"></a>startup and stopd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## start all</span></span><br><span class="line">mysqld_multi start</span><br><span class="line"></span><br><span class="line"><span class="comment">## start single</span></span><br><span class="line">mysqld_multi start 3307</span><br><span class="line"></span><br><span class="line"><span class="comment">## check status</span></span><br><span class="line">mysqld_multi report</span><br><span class="line"></span><br><span class="line"><span class="comment">## stop</span></span><br><span class="line">mysqld_multi stop</span><br><span class="line">mysqld_multi stop 3307</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-多实例配置&quot;&gt;&lt;a href=&quot;#Mysql-多实例配置&quot; class=&quot;headerlink&quot; title=&quot;Mysql-多实例配置&quot;&gt;&lt;/a&gt;Mysql-多实例配置&lt;/h2&gt;&lt;h3 id=&quot;配置文件&quot;&gt;&lt;a href=&quot;#配置文件&quot; class=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-常用查询</title>
    <link href="https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2/"/>
    <id>https://biglovewheat.gihub.io/2023/11/06/mysql-%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2/</id>
    <published>2023-11-05T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-常用查询"><a href="#Mysql-常用查询" class="headerlink" title="Mysql-常用查询"></a>Mysql-常用查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查询表大小</span><br><span class="line"><span class="keyword">SELECT</span> table_schema,TABLE_NAME,round((DATA_LENGTH<span class="operator">+</span>INDEX_LENGTH)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>) <span class="keyword">as</span> M,TABLE_ROWS</span><br><span class="line"><span class="keyword">FROM</span> information_schema.TABLES <span class="keyword">order</span> <span class="keyword">by</span> M <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>复制表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> targetTable <span class="keyword">LIKE</span> sourceTable; </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> targetTable <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sourceTable;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>修改排序字符集</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>表</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `hx<span class="operator">-</span>farm_sit`.`t_synergy_task` <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_general_ci;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `hx<span class="operator">-</span>farm_sit`.`t_synergy_task` MODIFY <span class="keyword">COLUMN</span> `task_code` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;任务编码，规则：C+年月日+****&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-常用查询&quot;&gt;&lt;a href=&quot;#Mysql-常用查询&quot; class=&quot;headerlink&quot; title=&quot;Mysql-常用查询&quot;&gt;&lt;/a&gt;Mysql-常用查询&lt;/h2&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-binlog清理</title>
    <link href="https://biglovewheat.gihub.io/2023/11/03/mysql-binlog%E6%B8%85%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2023/11/03/mysql-binlog%E6%B8%85%E7%90%86/</id>
    <published>2023-11-02T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-binlog清理"><a href="#Mysql-binlog清理" class="headerlink" title="Mysql-binlog清理"></a>Mysql-binlog清理</h2><h3 id="mysql5-x"><a href="#mysql5-x" class="headerlink" title="mysql5.x"></a>mysql5.x</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">expire_logs_days = 7</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global expire_logs_days = 7;</span><br><span class="line">mysql&gt; flush logs;</span><br></pre></td></tr></table></figure><h3 id="mysql8"><a href="#mysql8" class="headerlink" title="mysql8"></a>mysql8</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##查看数</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;binlog_expire%&#x27;</span>;</span><br><span class="line">+----------------------------+---------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+----------------------------+---------+</span><br><span class="line">| binlog_expire_logs_seconds | 2592000 |</span><br><span class="line">+----------------------------+---------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show binary logs;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置有效期，清理5天前的binlog的配置</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global binlog_expire_logs_seconds = 432000;</span><br><span class="line">mysql&gt; flush logs;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件</span></span><br><span class="line">binlog_expire_logs_seconds = 432000</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-binlog清理&quot;&gt;&lt;a href=&quot;#Mysql-binlog清理&quot; class=&quot;headerlink&quot; title=&quot;Mysql-binlog清理&quot;&gt;&lt;/a&gt;Mysql-binlog清理&lt;/h2&gt;&lt;h3 id=&quot;mysql5-x&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-Mysqldump-获取表结构</title>
    <link href="https://biglovewheat.gihub.io/2023/11/03/mysql-mysqldump-%E8%8E%B7%E5%8F%96%E8%A1%A8%E7%BB%93%E6%9E%84/"/>
    <id>https://biglovewheat.gihub.io/2023/11/03/mysql-mysqldump-%E8%8E%B7%E5%8F%96%E8%A1%A8%E7%BB%93%E6%9E%84/</id>
    <published>2023-11-02T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-Mysqldump-获取表结构"><a href="#Mysql-Mysqldump-获取表结构" class="headerlink" title="Mysql-Mysqldump-获取表结构"></a>Mysql-Mysqldump-获取表结构</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -pmysqlroot -d datacut --no-data -R &gt;all.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-Mysqldump-获取表结构&quot;&gt;&lt;a href=&quot;#Mysql-Mysqldump-获取表结构&quot; class=&quot;headerlink&quot; title=&quot;Mysql-Mysqldump-获取表结构&quot;&gt;&lt;/a&gt;Mysql-Mysqldump-获取表结构&lt;/</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-分区表</title>
    <link href="https://biglovewheat.gihub.io/2023/11/03/mysql-%E5%88%86%E5%8C%BA%E8%A1%A8/"/>
    <id>https://biglovewheat.gihub.io/2023/11/03/mysql-%E5%88%86%E5%8C%BA%E8%A1%A8/</id>
    <published>2023-11-02T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-分区表"><a href="#Mysql-分区表" class="headerlink" title="Mysql-分区表"></a>Mysql-分区表</h2><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## MYSQL的分区字段，必须包含在主键字段内。</span></span><br><span class="line"><span class="comment">## Error Code: 1171. All parts of a PRIMARY KEY must be NOT NULL; if you need NULL in a key, use UNIQUE instead</span></span><br><span class="line"></span><br><span class="line">CREATE TABLE farm.`test1` (</span><br><span class="line">`<span class="built_in">id</span>` bigint NOT NULL COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">`task_id` bigint DEFAULT NULL COMMENT <span class="string">&#x27;作业ID&#x27;</span>,</span><br><span class="line">`speed_per_hour` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;时速&#x27;</span>,</span><br><span class="line">`total_used_time` int DEFAULT NULL COMMENT <span class="string">&#x27;累计耗时&#x27;</span>,</span><br><span class="line">`operated_offset` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;偏移量&#x27;</span>,</span><br><span class="line">`percent` varchar(10) DEFAULT NULL COMMENT <span class="string">&#x27;作业任务进度（规则：作业里程结束为任务进度100%）&#x27;</span>,</span><br><span class="line">`operated_area` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;已作业亩数（使用田块规划里程和总里程计算）&#x27;</span>,</span><br><span class="line">`operated_mileage` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;已作业总路程&#x27;</span>,</span><br><span class="line">`no_operated_mileage` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;未作业路程&#x27;</span>,</span><br><span class="line">`total_mileage` double DEFAULT NULL COMMENT <span class="string">&#x27;作业总里程&#x27;</span>,</span><br><span class="line">`no_operate_area` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;未作业亩数&#x27;</span>,</span><br><span class="line">`type_name` varchar(20) DEFAULT NULL COMMENT <span class="string">&#x27;作业类型名称&#x27;</span>,</span><br><span class="line">`total_area` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;要求作业总亩数&#x27;</span>,</span><br><span class="line">`remaining_oil` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;剩余油量&#x27;</span>,</span><br><span class="line">`driver_mode` tinyint DEFAULT NULL COMMENT <span class="string">&#x27;驾驶模式&#x27;</span>,</span><br><span class="line">`rtk_status` int DEFAULT NULL COMMENT <span class="string">&#x27;RTK状态 固定解=4， 0无效解，1单点定位解，2伪距差分，5浮动解&#x27;</span>,</span><br><span class="line">`engine_speed` int DEFAULT NULL COMMENT <span class="string">&#x27;发动机转速&#x27;</span>,</span><br><span class="line">`real_oil` double(10,2) DEFAULT NULL COMMENT <span class="string">&#x27;实时油耗&#x27;</span>,</span><br><span class="line">`machine_name` varchar(50) DEFAULT NULL COMMENT <span class="string">&#x27;作业农机名称&#x27;</span>,</span><br><span class="line">`implement_name` varchar(50) DEFAULT NULL COMMENT <span class="string">&#x27;作业农具名称&#x27;</span>,</span><br><span class="line">`segment_percent` varchar(10) DEFAULT NULL COMMENT <span class="string">&#x27;路径完成度&#x27;</span>,</span><br><span class="line">`yaw` double DEFAULT NULL COMMENT <span class="string">&#x27;航向角&#x27;</span>,</span><br><span class="line">`longitude_position` double DEFAULT NULL COMMENT <span class="string">&#x27;位置经度&#x27;</span>,</span><br><span class="line">`latitude_position` double DEFAULT NULL COMMENT <span class="string">&#x27;位置纬度&#x27;</span>,</span><br><span class="line">`gnss_num` int DEFAULT NULL COMMENT <span class="string">&#x27;当前卫星数量&#x27;</span>,</span><br><span class="line">`network_signal` int DEFAULT NULL COMMENT <span class="string">&#x27;网络信号强度&#x27;</span>,</span><br><span class="line">`json_values` json DEFAULT NULL COMMENT <span class="string">&#x27;网络信号强度&#x27;</span>,</span><br><span class="line">`generate_time` bigint DEFAULT NULL COMMENT <span class="string">&#x27;设备消息生成时间戳&#x27;</span>,</span><br><span class="line">`create_time` datetime NOT NULL COMMENT <span class="string">&#x27;创建时间&#x27;</span>,test1</span><br><span class="line">`task_index` int NOT NULL COMMENT <span class="string">&#x27;子任务id&#x27;</span>,</span><br><span class="line">`x_position` double DEFAULT NULL COMMENT <span class="string">&#x27;位置x&#x27;</span>,</span><br><span class="line">`y_position` double DEFAULT NULL COMMENT <span class="string">&#x27;位置y&#x27;</span>,</span><br><span class="line">`operated_offset_direction` tinyint DEFAULT NULL COMMENT <span class="string">&#x27;偏移量方向(1左,2右)&#x27;</span>,</span><br><span class="line">`width_of_cloth` double DEFAULT NULL COMMENT <span class="string">&#x27;农具工作幅宽&#x27;</span>,</span><br><span class="line">`imple_work_state` tinyint DEFAULT NULL COMMENT <span class="string">&#x27;农具工作状态: 1未作业 2正在作业&#x27;</span>,</span><br><span class="line">PRIMARY KEY (`<span class="built_in">id</span>`,create_time),</span><br><span class="line">KEY `index_name` (`task_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=<span class="string">&#x27;农机实时消息LOG&#x27;</span></span><br><span class="line"></span><br><span class="line">partition by range columns (create_time)(</span><br><span class="line">partition p1 values less than (<span class="string">&#x27;2021-11-01&#x27;</span>),</span><br><span class="line">partition p2 values less than (<span class="string">&#x27;2021-12-01&#x27;</span>),</span><br><span class="line">partition p3 values less than (<span class="string">&#x27;2022-01-01&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-分区表&quot;&gt;&lt;a href=&quot;#Mysql-分区表&quot; class=&quot;headerlink&quot; title=&quot;Mysql-分区表&quot;&gt;&lt;/a&gt;Mysql-分区表&lt;/h2&gt;&lt;h3 id=&quot;例子&quot;&gt;&lt;a href=&quot;#例子&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-字符集</title>
    <link href="https://biglovewheat.gihub.io/2023/11/03/mysql-%E5%AD%97%E7%AC%A6%E9%9B%86/"/>
    <id>https://biglovewheat.gihub.io/2023/11/03/mysql-%E5%AD%97%E7%AC%A6%E9%9B%86/</id>
    <published>2023-11-02T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-字符集"><a href="#Mysql-字符集" class="headerlink" title="Mysql-字符集"></a>Mysql-字符集</h2><h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##ai--accent insensitivity--不区分音调；ci--case insensitivity--不区分大小写</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改表的排序字符集</span></span><br><span class="line">ALTER TABLE `hx-farm_sit`.`t_synergy_task` COLLATE=utf8mb4_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改字段的排序字符集</span></span><br><span class="line">ALTER TABLE `hx-farm_sit`.`t_synergy_task` MODIFY COLUMN `task_code` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;任务编码&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-字符集&quot;&gt;&lt;a href=&quot;#Mysql-字符集&quot; class=&quot;headerlink&quot; title=&quot;Mysql-字符集&quot;&gt;&lt;/a&gt;Mysql-字符集&lt;/h2&gt;&lt;h3 id=&quot;笔记&quot;&gt;&lt;a href=&quot;#笔记&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-用户管理</title>
    <link href="https://biglovewheat.gihub.io/2023/11/03/mysql-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2023/11/03/mysql-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</id>
    <published>2023-11-02T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-用户管理"><a href="#Mysql-用户管理" class="headerlink" title="Mysql-用户管理"></a>Mysql-用户管理</h2><h3 id="增加用户"><a href="#增加用户" class="headerlink" title="增加用户"></a>增加用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>mysql8</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;mysql&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="operator">=</span> PASSWORD(&quot;ShSflow!@#123&quot;);</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> password<span class="operator">=</span>PASSWORD(&quot;Sino!Sh!Dbwx!123#&quot;) <span class="keyword">WHERE</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_dev`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;52.82.81.179&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.230.215.225&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.231.162.38&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_uat`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;52.82.81.179&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_uat`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.230.215.225&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_uat`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.231.162.38&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `algorithm_uat`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">on</span> `hx<span class="operator">-</span>farm_dev`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">on</span> `hx<span class="operator">-</span>farm_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `gis_manage_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.231.162.38&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">EXECUTE</span>, <span class="keyword">SELECT</span>, <span class="keyword">SHOW</span> <span class="keyword">VIEW</span>, <span class="keyword">ALTER</span>, <span class="keyword">ALTER</span> ROUTINE, <span class="keyword">CREATE</span>, <span class="keyword">CREATE</span> ROUTINE, <span class="keyword">CREATE</span> TEMPORARY TABLES, <span class="keyword">CREATE</span> <span class="keyword">VIEW</span>, <span class="keyword">DELETE</span>, <span class="keyword">DROP</span>, EVENT, INDEX, <span class="keyword">INSERT</span>, <span class="keyword">REFERENCES</span>, <span class="keyword">TRIGGER</span>, <span class="keyword">UPDATE</span>, LOCK TABLES <span class="keyword">ON</span> `gis_manage_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.234.245.185&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">on</span> `gis_manage_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `hx<span class="operator">-</span>schedule_dev` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `hx<span class="operator">-</span>schedule_sit` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">on</span> `hx<span class="operator">-</span>schedule_dev`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> `hx<span class="operator">-</span>schedule_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">on</span> `hx<span class="operator">-</span>schedule_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.231.162.38&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">on</span> `hx<span class="operator">-</span>schedule_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;69.234.245.185&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">all</span> <span class="keyword">on</span> `hx<span class="operator">-</span>schedule_sit`.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;app&#x27;</span>@<span class="string">&#x27;52.83.200.4&#x27;</span>;</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-用户管理&quot;&gt;&lt;a href=&quot;#Mysql-用户管理&quot; class=&quot;headerlink&quot; title=&quot;Mysql-用户管理&quot;&gt;&lt;/a&gt;Mysql-用户管理&lt;/h2&gt;&lt;h3 id=&quot;增加用户&quot;&gt;&lt;a href=&quot;#增加用户&quot; class=&quot;head</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-MGR-router安装配置</title>
    <link href="https://biglovewheat.gihub.io/2023/10/20/mysql-mgr-route%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/10/20/mysql-mgr-route%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</id>
    <published>2023-10-19T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-MGR-router安装配置"><a href="#Mysql-MGR-router安装配置" class="headerlink" title="Mysql-MGR-router安装配置"></a>Mysql-MGR-router安装配置</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">10.77.114.192  mgr01</span><br><span class="line">10.77.114.192  mgr02</span><br><span class="line">10.77.114.192  mgr03</span><br><span class="line"></span><br><span class="line">mysql 8.0.34</span><br><span class="line">mysql shell 8.0.34</span><br><span class="line">mysql router 8.0.34</span><br><span class="line">centos 7.9</span><br></pre></td></tr></table></figure><h3 id="操作系统配置"><a href="#操作系统配置" class="headerlink" title="操作系统配置"></a>操作系统配置</h3><p>包括防火墙、selinux、内核优化参数等<br>（略）</p><h3 id="安装mysqlserver"><a href="#安装mysqlserver" class="headerlink" title="安装mysqlserver"></a>安装mysqlserver</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mariadb</span></span><br><span class="line">rpm -e $(rpm -qa |grep maria) --nodeps</span><br><span class="line"></span><br><span class="line"><span class="comment">## rpm 安装</span></span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-common-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-client-plugins-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-libs-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-libs-compat-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-client-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-icu-data-files-8*.rpm</span><br><span class="line">yum localinstall -y <span class="variable">$RPM_PATH</span>/mysql-community-server-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动mysql</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line">systemctl start mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 拿到初始密码，并修改密码</span></span><br><span class="line">mysql_passwd=$(grep password /var/log/mysqld.log | awk -F<span class="string">&#x27;root@localhost: &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|<span class="built_in">tail</span> -1) </span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">&#x27;EOF&#x27;</span> &gt; /tmp/temp.sql</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Abc123!!!&#x27;</span>;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">mysql -uroot -p<span class="variable">$mysql_passwd</span> -b --connect-expired-password &lt; /tmp/temp.sql</span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/temp.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## copy data file, copy my.cnf</span></span><br><span class="line">systemctl stop mysqld</span><br><span class="line">\<span class="built_in">cp</span> -f <span class="variable">$INSTALL_PATH</span>/other/my.cnf  /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -d /data/mysql ]; <span class="keyword">then</span> <span class="built_in">mv</span> /data/mysql /data/mysql_$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M%S&quot;</span>); <span class="keyword">fi</span></span><br><span class="line"><span class="built_in">mv</span> /var/lib/mysql /data/mysql ; <span class="built_in">chown</span> -R mysql:mysql /data/mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置文件my.cnf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[client]</span><br><span class="line">#default-character-set = utf8mb4</span><br><span class="line">host = localhost</span><br><span class="line">user = root</span><br><span class="line">port = 33066</span><br><span class="line">password = Abc123!!!</span><br><span class="line">socket=/data/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"># basic settings #</span><br><span class="line">default-storage-engine= InnoDB</span><br><span class="line">server_id = 1</span><br><span class="line">#basedir = /app/mysql8.0.34</span><br><span class="line">datadir = /data/mysql/</span><br><span class="line">socket =  /data/mysql/mysql.sock</span><br><span class="line">pid_file = /data/mysql/mysqld.pid</span><br><span class="line">port = 33066</span><br><span class="line">default-time_zone = &#x27;+8:00&#x27;</span><br><span class="line">character_set_server = utf8mb4</span><br><span class="line">explicit_defaults_for_timestamp = 1</span><br><span class="line">autocommit = 1</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line">#secure_file_priv = &quot;/data/mysql/&quot;</span><br><span class="line">max_allowed_packet = 64M</span><br><span class="line">lower_case_table_names = 0</span><br><span class="line">default_authentication_plugin = mysql_native_password</span><br><span class="line">sql_mode=&#x27;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION&#x27;</span><br><span class="line"></span><br><span class="line"># connection #</span><br><span class="line">back_log = 500</span><br><span class="line">interactive_timeout = 300</span><br><span class="line">wait_timeout = 1800</span><br><span class="line">lock_wait_timeout = 300</span><br><span class="line">max_user_connections = 800</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">max_connections = 2500</span><br><span class="line">max_connect_errors = 1000</span><br><span class="line"></span><br><span class="line">#table cache performance settings</span><br><span class="line">#table_open_cache = 1024</span><br><span class="line">#table_definition_cache = 1024</span><br><span class="line">#table_open_cache_instances = 16</span><br><span class="line"></span><br><span class="line">#session memory settings #</span><br><span class="line">#read_buffer_size = 16M</span><br><span class="line">#read_rnd_buffer_size = 32M</span><br><span class="line">#sort_buffer_size = 32M</span><br><span class="line">#tmp_table_size = 64M</span><br><span class="line">#join_buffer_size = 128M</span><br><span class="line">#thread_cache_size = 256</span><br><span class="line"></span><br><span class="line"># log settings #</span><br><span class="line">slow_query_log = ON</span><br><span class="line">slow_query_log_file = /data/mysql/slow.log</span><br><span class="line">log_error = /data/mysql/mysqld.log</span><br><span class="line">log_error_verbosity = 3</span><br><span class="line">#log_bin = /data/mysqldb/binlog/mysql_bin</span><br><span class="line">#log_bin_index = /data/mysqldb/binlog/mysql_binlog.index</span><br><span class="line"># general_log_file = /data/mysql/generallog/general.log</span><br><span class="line">log_queries_not_using_indexes = 1</span><br><span class="line">log_slow_admin_statements = 1</span><br><span class="line">#log_slow_slave_statements = 1</span><br><span class="line">#expire_logs_days = 15</span><br><span class="line">binlog_expire_logs_seconds = 2592000</span><br><span class="line">long_query_time = 5</span><br><span class="line">min_examined_row_limit = 100</span><br><span class="line">log_throttle_queries_not_using_indexes = 1000</span><br><span class="line">#log_bin_trust_function_creators = 1</span><br><span class="line">log_replica_updates = 1</span><br><span class="line">mysqlx_port = 33060</span><br><span class="line">#mysqlx_socket = /data/mysqldb/socket/mysqlx.sock</span><br><span class="line"></span><br><span class="line"># innodb settings #</span><br><span class="line">innodb_buffer_pool_size = 16G</span><br><span class="line">innodb_buffer_pool_instances = 4</span><br><span class="line">innodb_log_buffer_size = 100M</span><br><span class="line">innodb_buffer_pool_load_at_startup = 1</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown = 1</span><br><span class="line">innodb_lru_scan_depth = 4096</span><br><span class="line">innodb_lock_wait_timeout = 20</span><br><span class="line">innodb_io_capacity = 5000</span><br><span class="line">innodb_io_capacity_max = 10000</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_log_file_size = 1G</span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line">innodb_purge_threads = 4</span><br><span class="line">innodb_thread_concurrency = 200</span><br><span class="line">innodb_print_all_deadlocks = 1</span><br><span class="line">innodb_print_ddl_logs = 1</span><br><span class="line">innodb_strict_mode = 1</span><br><span class="line">innodb_sort_buffer_size = 32M</span><br><span class="line">innodb_write_io_threads = 16</span><br><span class="line">innodb_read_io_threads = 16 </span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_stats_persistent_sample_pages = 64</span><br><span class="line">innodb_autoinc_lock_mode = 2</span><br><span class="line">innodb_online_alter_log_max_size = 1G</span><br><span class="line">innodb_open_files = 4096</span><br><span class="line">innodb_buffer_pool_dump_pct = 25</span><br><span class="line">innodb_page_cleaners = 16</span><br><span class="line">innodb_undo_log_truncate = 1</span><br><span class="line">innodb_max_undo_log_size = 2G</span><br><span class="line">innodb_purge_rseg_truncate_frequency = 128</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line">log_timestamps = UTC</span><br><span class="line"></span><br><span class="line"># replication settings #</span><br><span class="line">sync_binlog = 1</span><br><span class="line">binlog_format = ROW</span><br><span class="line">gtid_mode = ON</span><br><span class="line">enforce_gtid_consistency = ON</span><br><span class="line">relay_log_recovery = 1</span><br><span class="line">#relay_log = /data/mysqldb/relaylog/relay.log</span><br><span class="line">#relay_log_index = /data/mysqldb/relaylog/mysql_relay.index</span><br><span class="line">replica_parallel_type = LOGICAL_CLOCK</span><br><span class="line">replica_parallel_workers = 16</span><br><span class="line">binlog_gtid_simple_recovery = 1</span><br><span class="line">replica_preserve_commit_order = 1</span><br><span class="line">binlog_rows_query_log_events = 1</span><br><span class="line">replica_transaction_retries = 10</span><br><span class="line"></span><br><span class="line"># group replication settings</span><br><span class="line">transaction_write_set_extraction = XXHASH64</span><br><span class="line">binlog_checksum = NONE</span><br><span class="line">loose_group_replication_group_name = &quot;957e8af0-bc63-11ea-bb19-005056a52572&quot;</span><br><span class="line">loose_group_replication_start_on_boot = off</span><br><span class="line">loose_group_replication_local_address = &quot;10.77.114.192:24901&quot;</span><br><span class="line">loose_group_replication_group_seeds = &quot;10.77.114.192:24901,10.77.114.193:24901,10.77.114.194:24901&quot;</span><br><span class="line">loose_group_replication_bootstrap_group = off</span><br><span class="line">loose_group_replication_ip_whitelist = &quot;10.77.114.0/24&quot;</span><br><span class="line">loose_group_replication_member_expel_timeout=30</span><br><span class="line">report_host = 10.77.114.192</span><br><span class="line">report_port = 33066</span><br><span class="line">#read_only=1</span><br><span class="line">#super_read_only=1</span><br><span class="line">binlog_transaction_dependency_tracking = WRITESET</span><br></pre></td></tr></table></figure><p>每个节点需要更改的是</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server_id = 1</span><br><span class="line">loose_group_replication_local_address = &quot;10.77.114.192:24901&quot;</span><br><span class="line">report_host = 10.77.114.192</span><br></pre></td></tr></table></figure><p>启动mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br></pre></td></tr></table></figure><h3 id="开启组复制"><a href="#开启组复制" class="headerlink" title="开启组复制"></a>开启组复制</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装组复制插件</span></span><br><span class="line">INSTALL PLUGIN group_replication SONAME <span class="string">&#x27;group_replication.so&#x27;</span>;</span><br><span class="line">show plugins;</span><br><span class="line"></span><br><span class="line"><span class="comment">## node1 执行</span></span><br><span class="line">SET SQL_LOG_BIN=0;</span><br><span class="line">CREATE USER rep@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Abc123!!!&#x27;</span>;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rep@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">SET SQL_LOG_BIN=1;</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_USER=<span class="string">&#x27;rep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;Abc123!!!&#x27;</span> FOR CHANNEL <span class="string">&#x27;group_replication_recovery&#x27;</span>;</span><br><span class="line"></span><br><span class="line">SET GLOBAL group_replication_bootstrap_group=ON;</span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line">SET GLOBAL group_replication_bootstrap_group=OFF;</span><br><span class="line"></span><br><span class="line"><span class="comment">## node2/node3 执行</span></span><br><span class="line"></span><br><span class="line">SET SQL_LOG_BIN=0;</span><br><span class="line">CREATE USER rep@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;Abc123!!!&#x27;</span>;</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* TO rep@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">SET SQL_LOG_BIN=1;</span><br><span class="line"></span><br><span class="line">CHANGE MASTER TO MASTER_USER=<span class="string">&#x27;rep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;Abc123!!!&#x27;</span> FOR CHANNEL <span class="string">&#x27;group_replication_recovery&#x27;</span>;</span><br><span class="line"></span><br><span class="line">START GROUP_REPLICATION;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 成功后查询，应该可以看到3个节点</span></span><br><span class="line">SELECT * FROM performance_schema.replication_group_members;</span><br></pre></td></tr></table></figure><h3 id="安装mysql-shell"><a href="#安装mysql-shell" class="headerlink" title="安装mysql-shell"></a>安装mysql-shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall -y mysql-shell-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## node1登录</span></span><br><span class="line">mysqlsh root@10.77.114.192:33066 --py</span><br><span class="line"></span><br><span class="line">dba.create_cluster(<span class="string">&#x27;mysqlrouter&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看集群状态</span></span><br><span class="line">c=dba.get_cluster()</span><br><span class="line">c.status()</span><br></pre></td></tr></table></figure><h3 id="安装mysql-router"><a href="#安装mysql-router" class="headerlink" title="安装mysql-router"></a>安装mysql-router</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## rpm安装</span></span><br><span class="line">yum localinstall -y mysql-router-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line">mysqlrouter  --bootstrap root@10.77.114.192:33066 --force</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> mysqlrouter</span><br><span class="line">systemctl restart mysqlrouter</span><br><span class="line"></span><br><span class="line"><span class="comment">## 链接测试</span></span><br><span class="line">mysql -u root -p 10.77.114.192 6446  //读写</span><br><span class="line">mysql -u root -p 10.77.114.192 6447  //只读 </span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此，一个高可用，单主的mysql mgr集群已搭建完毕，应用可按需链接读写6446或只读 6447，也可将3台机器安装mysql-router，使用nginx反向代理</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-MGR-router安装配置&quot;&gt;&lt;a href=&quot;#Mysql-MGR-router安装配置&quot; class=&quot;headerlink&quot; title=&quot;Mysql-MGR-router安装配置&quot;&gt;&lt;/a&gt;Mysql-MGR-router安装配置&lt;/h2&gt;&lt;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mongodb-安装配置</title>
    <link href="https://biglovewheat.gihub.io/2023/10/12/mongodb-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/10/12/mongodb-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</id>
    <published>2023-10-11T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mongodb-安装配置"><a href="#Mongodb-安装配置" class="headerlink" title="Mongodb-安装配置"></a>Mongodb-安装配置</h2><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">centos7</span><br><span class="line">mongodb 6.0.11</span><br><span class="line">mongodb shell 2.0.1</span><br></pre></td></tr></table></figure><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>mongodb下载，这里选择6.0.11，tar.gz<br><a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p><p>mongodb shell命令行客户端下载，这里选择2.0.1，tar.gz<br><a href="https://www.mongodb.com/try/download/shell">https://www.mongodb.com/try/download/shell</a></p><p>windows客户端，studio-3t<br><a href="https://download.studio3t.com/studio-3t/windows/2023.6.2/studio-3t-x64.zip">https://download.studio3t.com/studio-3t/windows/2023.6.2/studio-3t-x64.zip</a></p><h3 id="mongodb安装"><a href="#mongodb安装" class="headerlink" title="mongodb安装"></a>mongodb安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 解压，并创建配置文件</span></span><br><span class="line"><span class="comment">## 配置文件参考 https://blog.csdn.net/cold___play/article/details/130549381</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; mongod.conf</span></span><br><span class="line"><span class="string">systemLog:</span></span><br><span class="line"><span class="string">destination: file</span></span><br><span class="line"><span class="string">path: /data/mongodb/logs/mongodb.log   ## 日志</span></span><br><span class="line"><span class="string">logAppend: true</span></span><br><span class="line"><span class="string">storage:</span></span><br><span class="line"><span class="string">dbPath: /data/mongodb/data     ## 数据目录</span></span><br><span class="line"><span class="string">net:</span></span><br><span class="line"><span class="string">bindIp: 0.0.0.0</span></span><br><span class="line"><span class="string">port: 27017                           ## 默认端口</span></span><br><span class="line"><span class="string">processManagement:</span></span><br><span class="line"><span class="string">fork: true</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动server</span></span><br><span class="line">/data/mongodb/bin/mongod -config /data/mongodb/mongod.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用mongodb shell 登录，默认有3个数据库</span></span><br><span class="line">./mongosh</span><br><span class="line">&gt; show dbs</span><br><span class="line"><span class="built_in">test</span>&gt; show databases</span><br><span class="line">admin   180.00 KiB</span><br><span class="line">config   60.00 KiB</span><br><span class="line"><span class="built_in">local</span>    72.00 KiB</span><br></pre></td></tr></table></figure><h3 id="创建管理员，并设置权限"><a href="#创建管理员，并设置权限" class="headerlink" title="创建管理员，并设置权限"></a>创建管理员，并设置权限</h3><p>默认情况下，mongdb没有开启权限验证，需增加管理员，并开启验证<br><img src="/../images/mongodb-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE_01.jpg"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">./mongosh</span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="built_in">pwd</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">roles: [&#123;role:<span class="string">&#x27;root&#x27;</span>,db:<span class="string">&#x27;admin&#x27;</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">&#123; ok: 1 &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建root用户</span></span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="built_in">pwd</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">roles: [&#123;role:<span class="string">&#x27;root&#x27;</span>,db:<span class="string">&#x27;admin&#x27;</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"><span class="comment">## 所有库可以读写账户</span></span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: <span class="string">&#x27;userAdminAnyDatabase&#x27;</span>,</span><br><span class="line"><span class="built_in">pwd</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">roles: [&#123;role:<span class="string">&#x27;userAdminAnyDatabase&#x27;</span>,db:<span class="string">&#x27;admin&#x27;</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建test库的读写权限的账号</span></span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line"><span class="built_in">pwd</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">roles: [&#123;role:<span class="string">&#x27;readWrite&#x27;</span>,db:<span class="string">&#x27;test&#x27;</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line"><span class="built_in">pwd</span>: <span class="string">&#x27;123456&#x27;</span>,</span><br><span class="line">roles: [&#123;role:<span class="string">&#x27;dbOwner&#x27;</span>,db:<span class="string">&#x27;test&#x27;</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="修改配置，增加登录验证"><a href="#修改配置，增加登录验证" class="headerlink" title="修改配置，增加登录验证"></a>修改配置，增加登录验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置文件增加</span></span><br><span class="line">security:</span><br><span class="line">    authorization: enabled</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启mongodb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启后需要指定用户密码，否则登录后没有权限</span></span><br><span class="line">./mongosh -u root -p </span><br></pre></td></tr></table></figure><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>参考<br><a href="http://it028.com/mongodb-create-database.html">http://it028.com/mongodb-create-database.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mongodb-安装配置&quot;&gt;&lt;a href=&quot;#Mongodb-安装配置&quot; class=&quot;headerlink&quot; title=&quot;Mongodb-安装配置&quot;&gt;&lt;/a&gt;Mongodb-安装配置&lt;/h2&gt;&lt;h3 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mongodb" scheme="https://biglovewheat.gihub.io/tags/mongodb/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-增加agent</title>
    <link href="https://biglovewheat.gihub.io/2023/10/11/jenkins-%E5%A2%9E%E5%8A%A0agent/"/>
    <id>https://biglovewheat.gihub.io/2023/10/11/jenkins-%E5%A2%9E%E5%8A%A0agent/</id>
    <published>2023-10-10T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-增加agent"><a href="#Jenkins-增加agent" class="headerlink" title="Jenkins-增加agent"></a>Jenkins-增加agent</h2><p><em>单台jenkins处理能力有限，一般只能同时处理数个发布，当发布增多时，需增加jenkins agent，并行处理发布，增加jenkins总体处理能力</em></p><h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jenkins 2.308</span><br><span class="line">master：192.168.1.101</span><br><span class="line">agent：192.168.1.102</span><br></pre></td></tr></table></figure><h3 id="信任配置"><a href="#信任配置" class="headerlink" title="信任配置"></a>信任配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## step 1 master和agent新建ssh证书（已有可忽略）</span></span><br><span class="line">ssh-keygen  <span class="comment">## 一路回车即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 复制master证书到agent，使master可以免密登录agent</span></span><br><span class="line">ssh-copy-id root@192.168.1.102</span><br></pre></td></tr></table></figure><h3 id="添加凭证"><a href="#添加凭证" class="headerlink" title="添加凭证"></a>添加凭证</h3><p>登录jenkins–》manage jenkins–》manage credentials–》全局–》添加凭证<br>添加一个agent的ssh用户和密码、或证书</p><p><img src="/../images/jenkins-agent-01"></p><h3 id="添加节点"><a href="#添加节点" class="headerlink" title="添加节点"></a>添加节点</h3><p>登录jenkins–》manage node and clouds–》新建节点<br>远程工作目录：输入agent的工作目录，如：&#x2F;data&#x2F;jenkins，注意目录权限</p><p>启动方式：Lauch agents via SSH，输入agent的用户和凭证</p><p>用法：按需，这里选指定标签的任务才使用agent执行</p><p>标签：按需</p><h3 id="启动节点"><a href="#启动节点" class="headerlink" title="启动节点"></a>启动节点</h3><p>登录jenkins–》manage node and clouds–》选中节点，启动代理<br>注意看启动日志，如有报错按日志处理，如ssh认证问题、缺少java环境等</p><h3 id="使用agent构建项目"><a href="#使用agent构建项目" class="headerlink" title="使用agent构建项目"></a>使用agent构建项目</h3><p>项目配置里，选中“限制项目的运行节点”，输入标签表达式，即可指定该项目以特定agent运行</p><p><img src="/../images/jenkins-agent-02"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-增加agent&quot;&gt;&lt;a href=&quot;#Jenkins-增加agent&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-增加agent&quot;&gt;&lt;/a&gt;Jenkins-增加agent&lt;/h2&gt;&lt;p&gt;&lt;em&gt;单台jenkins处理能力有</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>阿里云-DNS负载均衡配置</title>
    <link href="https://biglovewheat.gihub.io/2023/09/21/%E9%98%BF%E9%87%8C%E4%BA%91-dns%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/09/21/%E9%98%BF%E9%87%8C%E4%BA%91-dns%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE/</id>
    <published>2023-09-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="阿里云-DNS负载均衡配置"><a href="#阿里云-DNS负载均衡配置" class="headerlink" title="阿里云-DNS负载均衡配置"></a>阿里云-DNS负载均衡配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## step 0</span></span><br><span class="line">通过xxx.abc.com域名，负载均衡到3个后端IP</span><br><span class="line">8.8.8.1</span><br><span class="line">8.8.8.2</span><br><span class="line">8.8.8.3</span><br><span class="line"></span><br><span class="line"><span class="comment">## step 1</span></span><br><span class="line">阿里云-云解析-域名解析，添加三条A记录</span><br><span class="line">xxx.abc.com    8.8.8.1</span><br><span class="line">xxx.abc.com    8.8.8.2</span><br><span class="line">xxx.abc.com    8.8.8.3</span><br><span class="line"></span><br><span class="line"><span class="comment">## step 2</span></span><br><span class="line">阿里云-云解析-域名解析-权重配置</span><br><span class="line">开启权重配置，3个ip权重按需设置，默认都为1</span><br><span class="line">权重范围0-100，权重越大表示访问越频繁，0则不访问</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;阿里云-DNS负载均衡配置&quot;&gt;&lt;a href=&quot;#阿里云-DNS负载均衡配置&quot; class=&quot;headerlink&quot; title=&quot;阿里云-DNS负载均衡配置&quot;&gt;&lt;/a&gt;阿里云-DNS负载均衡配置&lt;/h2&gt;&lt;figure class=&quot;highlight bash</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="阿里云" scheme="https://biglovewheat.gihub.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>Kafka-集群安装</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/Kafka-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/Kafka-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kafka-集群安装"><a href="#Kafka-集群安装" class="headerlink" title="Kafka-集群安装"></a>Kafka-集群安装</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><h3 id="部署主机"><a href="#部署主机" class="headerlink" title="部署主机"></a>部署主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.31.34.25   aws-sit-app-01  </span><br><span class="line">172.31.43.98   aws-sit-app-03</span><br><span class="line">172.31.43.45   aws-sit-app-04</span><br></pre></td></tr></table></figure><h3 id="zookeeper配置"><a href="#zookeeper配置" class="headerlink" title="zookeeper配置"></a>zookeeper配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##重命名配置文件</span></span><br><span class="line"><span class="built_in">mv</span> conf/zoo_sample.cfg conf/conzoo.cfg</span><br><span class="line"><span class="comment">#编辑</span></span><br><span class="line">vim conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/data/zookeeper/zkdata</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=172.31.34.25:2888:3888</span><br><span class="line">server.2=172.31.43.98:2888:3888</span><br><span class="line">server.3=172.31.43.45:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="comment">#上面这段server.A=B:C:D中</span></span><br><span class="line"><span class="comment">#A代表的就是每个节点中myid文件中的编号</span></span><br><span class="line"><span class="comment">#B代表的是节点的服务地址</span></span><br><span class="line"><span class="comment">#C代表这个服务器 Follower 与集群中的 Leader 服务器交换信息的端口</span></span><br><span class="line"><span class="comment">#D代表是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的Leader，而这个端口就是用#来执行选举时服务器相互通信的端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建myid文件，每个节点id是唯一</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zookeeper/zkdata;<span class="built_in">echo</span> 1&gt;/data/zookeeper/zkdata/myid</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zookeeper/zkdata;<span class="built_in">echo</span> 2&gt;/data/zookeeper/zkdata/myid</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/zookeeper/zkdata;<span class="built_in">echo</span> 3&gt;/data/zookeeper/zkdata/myid</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/data/zookeeper</span><br><span class="line"></span><br><span class="line"><span class="variable">$ROOT_PATH</span>/bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查</span></span><br><span class="line">./bin/zkServer.sh  status</span><br></pre></td></tr></table></figure><h3 id="kafka配置"><a href="#kafka配置" class="headerlink" title="kafka配置"></a>kafka配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改配置文件</span></span><br><span class="line">vi confile/server.properties</span><br><span class="line"></span><br><span class="line"><span class="comment">#broker.id不重复</span></span><br><span class="line">broker.id=0</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/data/kafka/kafka-logs</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=60</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=172.31.34.25:2181,172.31.43.98:2181,172.31.43.45:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"><span class="comment"># 自动创建topic</span></span><br><span class="line">auto.create.topics.enable=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/data/kafka</span><br><span class="line"></span><br><span class="line"><span class="variable">$ROOT_PATH</span>/bin/kafka-server-start.sh -daemon <span class="variable">$ROOT_PATH</span>/config/server.properties</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建topic</span></span><br><span class="line">bin/kafka-topics.sh --create --topic quickstart-events1 --bootstrap-server 172.31.34.25:9092,172.31.43.98:9092,172.31.43.45:9092</span><br><span class="line">bin/kafka-topics.sh --describe --topic quickstart-events1 --bootstrap-server 172.31.34.25:9092,172.31.43.98:9092,172.31.43.45:9092</span><br><span class="line"></span><br><span class="line"><span class="comment">## 往topic写入信息</span></span><br><span class="line">$ bin/kafka-console-producer.sh --topic quickstart-events1 --bootstrap-server 172.31.34.25:9092,172.31.43.98:9092,172.31.43.45:9092</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line"><span class="comment">## 读取信息</span></span><br><span class="line">$ bin/kafka-console-consumer.sh --topic quickstart-events1 --from-beginning --bootstrap-server 172.31.34.25:9092,172.31.43.98:9092,172.31.43.45:9092</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092</span><br><span class="line">bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Kafka-集群安装&quot;&gt;&lt;a href=&quot;#Kafka-集群安装&quot; class=&quot;headerlink&quot; title=&quot;Kafka-集群安装&quot;&gt;&lt;/a&gt;Kafka-集群安装&lt;/h2&gt;&lt;h3 id=&quot;官方文档&quot;&gt;&lt;a href=&quot;#官方文档&quot; class=&quot;head</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/tags/middleware/"/>
    
    <category term="mq" scheme="https://biglovewheat.gihub.io/tags/mq/"/>
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
  </entry>
  
  <entry>
    <title>AWS-子网划分</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/aws-%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/aws-%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-子网划分"><a href="#AWS-子网划分" class="headerlink" title="AWS-子网划分"></a>AWS-子网划分</h2><h3 id="参考网址"><a href="#参考网址" class="headerlink" title="参考网址"></a>参考网址</h3><p>在线网络计算器</p><p><a href="https://www.sojson.com/convert/subnetmask.html">https://www.sojson.com/convert/subnetmask.html</a></p><h3 id="列子"><a href="#列子" class="headerlink" title="列子"></a>列子</h3><p>网络列表网络 172.31.0.0 ，掩码255.255.240.0或20</p><p>可用网络16，每个网络可用主机4096</p><p><img src="/./../images/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86_01.jpg"></p><p><img src="/./../images/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86_02.jpg"></p><p><img src="/./../images/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86_03.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-子网划分&quot;&gt;&lt;a href=&quot;#AWS-子网划分&quot; class=&quot;headerlink&quot; title=&quot;AWS-子网划分&quot;&gt;&lt;/a&gt;AWS-子网划分&lt;/h2&gt;&lt;h3 id=&quot;参考网址&quot;&gt;&lt;a href=&quot;#参考网址&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>Git-常用命令</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/git-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/git-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-常用命令"><a href="#Git-常用命令" class="headerlink" title="Git-常用命令"></a>Git-常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 下载</span></span><br><span class="line">git <span class="built_in">clone</span> [url]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示配置</span></span><br><span class="line">git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置用户信息</span></span><br><span class="line">git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 增加文件</span></span><br><span class="line">git add [file1] [file2] ...</span><br><span class="line">git add [<span class="built_in">dir</span>]</span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line"><span class="comment">## 代码提交</span></span><br><span class="line">git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 列出分支</span></span><br><span class="line">git branch</span><br><span class="line">git branch -r</span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment">## 切换分支</span></span><br><span class="line">git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 合并分支</span></span><br><span class="line">git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看变更的文件</span></span><br><span class="line">git status</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-常用命令&quot;&gt;&lt;a href=&quot;#Git-常用命令&quot; class=&quot;headerlink&quot; title=&quot;Git-常用命令&quot;&gt;&lt;/a&gt;Git-常用命令&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cla</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>Git-角色</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/git-%E8%A7%92%E8%89%B2/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/git-%E8%A7%92%E8%89%B2/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Git-角色"><a href="#Git-角色" class="headerlink" title="Git-角色"></a>Git-角色</h2><h3 id="用户在项目中的角色"><a href="#用户在项目中的角色" class="headerlink" title="用户在项目中的角色"></a>用户在项目中的角色</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Guest：访客。可以创建issue、发表评论，不能读写版本库。（就是看不了代码…）</span><br><span class="line">Reporter：Git项目测试人员。可以克隆代码，不能提交。QA、PM可以赋予这个权限。</span><br><span class="line">Developer：项目开发人员。可以克隆代码、开发、提交、push。RD可以赋予这个权限。</span><br><span class="line">Maintainer：Git项目管理员。可以创建项目、添加tag、保护分支、添加项目成员、编辑项目。核心RD负责人可以赋予这个权限。</span><br><span class="line">Owner：Git系统管理员即Administrator。拥有至高无上的权限。开发组leader可以赋予这个权限。</span><br></pre></td></tr></table></figure><h3 id="项目的访问权限"><a href="#项目的访问权限" class="headerlink" title="项目的访问权限"></a>项目的访问权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Private：只有组成员才能看到</span><br><span class="line">Internal：只要登录的用户就能看到</span><br><span class="line">Public：所有人都能看到</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Git-角色&quot;&gt;&lt;a href=&quot;#Git-角色&quot; class=&quot;headerlink&quot; title=&quot;Git-角色&quot;&gt;&lt;/a&gt;Git-角色&lt;/h2&gt;&lt;h3 id=&quot;用户在项目中的角色&quot;&gt;&lt;a href=&quot;#用户在项目中的角色&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-常用查询</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/oracle-%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/oracle-%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-常用查询"><a href="#Oracle-常用查询" class="headerlink" title="Oracle-常用查询"></a>Oracle-常用查询</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-常用查询&quot;&gt;&lt;a href=&quot;#Oracle-常用查询&quot; class=&quot;headerlink&quot; title=&quot;Oracle-常用查询&quot;&gt;&lt;/a&gt;Oracle-常用查询&lt;/h2&gt;&lt;h3 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-常见ora错误</title>
    <link href="https://biglovewheat.gihub.io/2023/08/21/oracle-%E5%B8%B8%E8%A7%81ora%E9%94%99%E8%AF%AF/"/>
    <id>https://biglovewheat.gihub.io/2023/08/21/oracle-%E5%B8%B8%E8%A7%81ora%E9%94%99%E8%AF%AF/</id>
    <published>2023-08-20T16:00:00.000Z</published>
    <updated>2023-11-25T04:42:31.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-常见ora错误"><a href="#Oracle-常见ora错误" class="headerlink" title="Oracle-常见ora错误"></a>Oracle-常见ora错误</h2><h3 id="ORA-ORA-00257-空间不足错误"><a href="#ORA-ORA-00257-空间不足错误" class="headerlink" title="ORA_ORA-00257 空间不足错误"></a>ORA_ORA-00257 空间不足错误</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查看使用情况</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> V$FLASH_RECOVERY_AREA_USAGE;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看存储目录</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">parameter</span> recover;</span><br><span class="line"></span><br><span class="line"><span class="comment">--增大空间</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> DB_RECOVERY_FILE_DEST_SIZE<span class="operator">=</span><span class="number">20</span>g;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-常见ora错误&quot;&gt;&lt;a href=&quot;#Oracle-常见ora错误&quot; class=&quot;headerlink&quot; title=&quot;Oracle-常见ora错误&quot;&gt;&lt;/a&gt;Oracle-常见ora错误&lt;/h2&gt;&lt;h3 id=&quot;ORA-ORA-00257-空间不</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="all" scheme="https://biglovewheat.gihub.io/tags/all/"/>
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
</feed>
