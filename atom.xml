<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-09-03T06:07:51.992Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python-Nacos-备份</title>
    <link href="https://biglovewheat.gihub.io/2022/09/02/python-nacos-%E5%A4%87%E4%BB%BD/"/>
    <id>https://biglovewheat.gihub.io/2022/09/02/python-nacos-%E5%A4%87%E4%BB%BD/</id>
    <published>2022-09-01T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-Nacos-备份"><a href="#Python-Nacos-备份" class="headerlink" title="Python-Nacos-备份"></a>Python-Nacos-备份</h2><p><em>一个python写的nacos配置备份，并上传到s3的脚本</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"><span class="keyword">from</span> fileinput <span class="keyword">import</span> filename</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> boto3.session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line"><span class="comment">## s3 config</span></span><br><span class="line">aws_key = <span class="string">&quot;XXXX&quot;</span></span><br><span class="line">aws_secret = <span class="string">&quot;XXXX&quot;</span></span><br><span class="line">region_name = <span class="string">&quot;cn-northwest-1&quot;</span></span><br><span class="line">session = Session(aws_access_key_id=aws_key,</span><br><span class="line">aws_secret_access_key=aws_secret,</span><br><span class="line">region_name=region_name)</span><br><span class="line"></span><br><span class="line">s3 = session.resource(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">client = session.client(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">bucket = <span class="string">&quot;hxs3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nacos</span></span><br><span class="line">nacos_list=[</span><br><span class="line">    <span class="string">&#x27;http://10.9.127.244:8848|c23a1b4c-e97f-45ae-a5c0-1e7f1a8d22e9|nacos|nacos|nacos-dev&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://10.9.127.245:8848|da7aaaa2-7505-4c1d-98c6-9e2e7778ef55|nacos|nacos|nacos-prod&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> nacos_list:</span><br><span class="line">    url,namespace,username,password,filename = row.strip().split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    login_url = url+<span class="string">&#x27;/nacos/v1/auth/users/login&#x27;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;username&#x27;</span>:username,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:password&#125;</span><br><span class="line">    s = requests.session()</span><br><span class="line">    resp = s.post(login_url,data)</span><br><span class="line">    token = json.loads(resp.text)[<span class="string">&#x27;accessToken&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    backup_url = url+<span class="string">&#x27;/nacos/v1/cs/configs?export=true&amp;tenant=&#x27;</span>+namespace+<span class="string">&#x27;&amp;group=&amp;appName=&amp;dataId=&amp;ids=&amp;accessToken=&#x27;</span>+token</span><br><span class="line">    </span><br><span class="line">    filename = os.path.abspath(os.path.dirname(__file__))+<span class="string">&#x27;/&#x27;</span>+filename+<span class="string">&#x27;-&#x27;</span>+datetime.datetime.now().strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>)+<span class="string">&#x27;.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">    r = requests.get(backup_url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> code:</span><br><span class="line">        code.write(r.content)</span><br><span class="line"></span><br><span class="line">    upload_data = <span class="built_in">open</span>(filename,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    upload_key = <span class="string">&quot;backup/&quot;</span>+os.path.basename(filename)</span><br><span class="line">    file_obj = s3.Bucket(bucket).put_object(Key=upload_key, Body=upload_data)</span><br><span class="line">    <span class="built_in">print</span>(file_obj)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-Nacos-备份&quot;&gt;&lt;a href=&quot;#Python-Nacos-备份&quot; class=&quot;headerlink&quot; title=&quot;Python-Nacos-备份&quot;&gt;&lt;/a&gt;Python-Nacos-备份&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个python写的naco</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
    <category term="nacos" scheme="https://biglovewheat.gihub.io/tags/nacos/"/>
    
  </entry>
  
  <entry>
    <title>Java程序占用cpu高排查</title>
    <link href="https://biglovewheat.gihub.io/2022/09/01/java%E7%A8%8B%E5%BA%8F%E5%8D%A0%E7%94%A8cpu%E9%AB%98%E6%8E%92%E6%9F%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/09/01/java%E7%A8%8B%E5%BA%8F%E5%8D%A0%E7%94%A8cpu%E9%AB%98%E6%8E%92%E6%9F%A5/</id>
    <published>2022-08-31T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.991Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Java程序占用cpu高排查"><a href="#Java程序占用cpu高排查" class="headerlink" title="Java程序占用cpu高排查"></a>Java程序占用cpu高排查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## top + 大写C  用cpu占用率排序，记录进程</span></span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment">## top -Hp ，记录该进程中的线程号</span></span><br><span class="line">top -Hp 26750</span><br><span class="line"></span><br><span class="line"><span class="comment">## 找到占用最高的线程，将pid换算成16进制</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%x\n&#x27;</span> 26751</span><br><span class="line"></span><br><span class="line"><span class="comment">## 通过jstack找到线程信息</span></span><br><span class="line">jstack 26750 |grep xxxxx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Java程序占用cpu高排查&quot;&gt;&lt;a href=&quot;#Java程序占用cpu高排查&quot; class=&quot;headerlink&quot; title=&quot;Java程序占用cpu高排查&quot;&gt;&lt;/a&gt;Java程序占用cpu高排查&lt;/h2&gt;&lt;figure class=&quot;highlight </summary>
      
    
    
    
    <category term="故障排查" scheme="https://biglovewheat.gihub.io/categories/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    
    <category term="java" scheme="https://biglovewheat.gihub.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>K8s-crontabjob</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/k8s-crontabjob/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/k8s-crontabjob/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-crontabjob"><a href="#K8s-crontabjob" class="headerlink" title="K8s-crontabjob"></a>K8s-crontabjob</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Cronjob的时区和kube-controller-manager服务的时区一致,默认为0时区,需-8小时</span></span><br><span class="line"><span class="comment">## 或修改kube-controller-manager时区</span></span><br><span class="line">apiVersion: batch/v1beta1</span><br><span class="line">kind: CronJob</span><br><span class="line">metadata:</span><br><span class="line">  name: hx-python-jiage</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  schedule: <span class="string">&quot;2 16 * * *&quot;</span></span><br><span class="line">  jobTemplate:</span><br><span class="line">    spec:</span><br><span class="line">      template:</span><br><span class="line">        spec:</span><br><span class="line">          containers:</span><br><span class="line">          - name: hx-python-jiage</span><br><span class="line">            image: 10.9.127.243:30002/library/hx-python-jiage:1.0</span><br><span class="line">            imagePullPolicy: IfNotPresent</span><br><span class="line">          restartPolicy: OnFailure</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-crontabjob&quot;&gt;&lt;a href=&quot;#K8s-crontabjob&quot; class=&quot;headerlink&quot; title=&quot;K8s-crontabjob&quot;&gt;&lt;/a&gt;K8s-crontabjob&lt;/h2&gt;&lt;figure class=&quot;highlight </summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8s-组件安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/k8s%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/k8s%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-组件安装"><a href="#K8s-组件安装" class="headerlink" title="K8s-组件安装"></a>K8s-组件安装</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## metrics</span></span><br><span class="line">kubectl apply -f https://download.osichina.net/tools/kubernetes/metrics-server/components.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## deshboard</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## calico</span></span><br><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.19/manifests/calico.yaml</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-组件安装&quot;&gt;&lt;a href=&quot;#K8s-组件安装&quot; class=&quot;headerlink&quot; title=&quot;K8s-组件安装&quot;&gt;&lt;/a&gt;K8s-组件安装&lt;/h2&gt;&lt;h3 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Lvs+keepalived安装配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/lvs-keepalive%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/lvs-keepalive%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Lvs-keepalived安装配置"><a href="#Lvs-keepalived安装配置" class="headerlink" title="Lvs+keepalived安装配置"></a>Lvs+keepalived安装配置</h2><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><table><thead><tr><th>主机</th><th>软件</th><th>IP</th></tr></thead><tbody><tr><td></td><td>vip</td><td>192.168.8.209</td></tr><tr><td>lvs1</td><td>lvs+keepalived</td><td>192.168.8.201</td></tr><tr><td>lvs2</td><td>lvs+keepalived</td><td>192.168.8.202</td></tr><tr><td>nginx1</td><td>nginx</td><td>192.168.8.203</td></tr><tr><td>nginx2</td><td>nginx</td><td>192.168.8.204</td></tr></tbody></table><h3 id="lvs和keepalived安装"><a href="#lvs和keepalived安装" class="headerlink" title="lvs和keepalived安装"></a>lvs和keepalived安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装lvs管理工具ipvsadm</span></span><br><span class="line">yum install -y gcc openssl openssl-devel ipvsadm</span><br><span class="line"></span><br><span class="line"><span class="comment">## keepalived 编译安装</span></span><br><span class="line">./configure  --prefix=/usr/local/keepalived</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">## keepalived 注册服务 &amp; 开机启动</span></span><br><span class="line"><span class="built_in">cp</span> /soft/keepalived-2.0.20/keepalived/etc/init.d/keepalived /etc/init.d/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/keepalived/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/etc/keepalived/keepalived.conf  /etc/keepalived/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/sbin/keepalived /usr/sbin</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> keepalived</span><br><span class="line">systemctl restart keepalived</span><br></pre></td></tr></table></figure><h3 id="lvs1-主机-配置"><a href="#lvs1-主机-配置" class="headerlink" title="lvs1(主机)配置"></a>lvs1(主机)配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;</span><br><span class="line">   <span class="comment">#xxxx@itcast.com                                   # 发生故障时发送的邮箱</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#notification_email_from xxxx@itcast.com             # 使用哪个邮箱发送</span></span><br><span class="line">  <span class="comment">#smtp_server xxx.com                                  # 发件服务器</span></span><br><span class="line">  smtp_connect_timeout 30</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state MASTER             <span class="comment"># 标示为主lvs</span></span><br><span class="line">   interface ens33           <span class="comment"># HA检测端口</span></span><br><span class="line">   virtual_router_id 66     <span class="comment"># 主备的virtual_router_id 必须相同</span></span><br><span class="line">   priority 100             <span class="comment"># 优先级,备lvs要比主lvs稍小</span></span><br><span class="line">   advert_int 1             <span class="comment"># VRRP Multicast 广播周期秒数</span></span><br><span class="line">   authentication &#123;         <span class="comment"># 定义认证</span></span><br><span class="line">       auth_type PASS       <span class="comment"># 认证方式为口令认证</span></span><br><span class="line">       auth_pass 6666       <span class="comment"># 定义口令</span></span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;      <span class="comment"># 定义vip</span></span><br><span class="line">       192.168.3.209      <span class="comment"># 多个vip可换行添加</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.209 80 &#123;</span><br><span class="line">   delay_loop 6       <span class="comment"># 每隔6秒查看realserver状态</span></span><br><span class="line">   lb_algo wlc        <span class="comment"># 调度算法为加权最小连接数</span></span><br><span class="line">   lb_kind DR         <span class="comment"># lvs工作模式为DR(直接路由)模式</span></span><br><span class="line">   nat_mask 255.255.255.0</span><br><span class="line">   persistence_timeout 50  <span class="comment"># 同一IP 的连接50秒内被分配到同一台realserver(测试时建议改为0)</span></span><br><span class="line">   protocol TCP            <span class="comment"># 用TCP监测realserver的状态</span></span><br><span class="line">   real_server 192.168.3.203 80 &#123;       <span class="comment"># 定义realserver</span></span><br><span class="line">       weight 3                       <span class="comment"># 定义权重</span></span><br><span class="line">       TCP_CHECK &#123;  <span class="comment"># 注意TCP_CHECK和&#123;之间的空格,如果没有的话只会添加第一个realserver</span></span><br><span class="line">           connect_timeout 3          <span class="comment"># 三秒无响应超时</span></span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   real_server 192.168.3.204 80 &#123;</span><br><span class="line">       weight 3</span><br><span class="line">       TCP_CHECK &#123;</span><br><span class="line">           connect_timeout 3</span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lvs2-备机-配置"><a href="#lvs2-备机-配置" class="headerlink" title="lvs2(备机)配置"></a>lvs2(备机)配置</h3><p>配置和主机相同，唯一区别是priority的值要少于主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;</span><br><span class="line">   <span class="comment">#xxxx@itcast.com                                   # 发生故障时发送的邮箱</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#notification_email_from xxxx@itcast.com             # 使用哪个邮箱发送</span></span><br><span class="line">  <span class="comment">#smtp_server xxx.com                                  # 发件服务器</span></span><br><span class="line">  smtp_connect_timeout 30</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state BACKUP             <span class="comment"># 标示为主lvs</span></span><br><span class="line">   interface ens33           <span class="comment"># HA检测端口</span></span><br><span class="line">   virtual_router_id 66     <span class="comment"># 主备的virtual_router_id 必须相同</span></span><br><span class="line">   priority 99             <span class="comment"># 优先级,备lvs要比主lvs稍小</span></span><br><span class="line">   advert_int 1             <span class="comment"># VRRP Multicast 广播周期秒数</span></span><br><span class="line">   authentication &#123;         <span class="comment"># 定义认证</span></span><br><span class="line">       auth_type PASS       <span class="comment"># 认证方式为口令认证</span></span><br><span class="line">       auth_pass 6666       <span class="comment"># 定义口令</span></span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;      <span class="comment"># 定义vip</span></span><br><span class="line">       192.168.3.209      <span class="comment"># 多个vip可换行添加</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.209 80 &#123;</span><br><span class="line">   delay_loop 6       <span class="comment"># 每隔6秒查看realserver状态</span></span><br><span class="line">   lb_algo wlc        <span class="comment"># 调度算法为加权最小连接数</span></span><br><span class="line">   lb_kind DR         <span class="comment"># lvs工作模式为DR(直接路由)模式</span></span><br><span class="line">   nat_mask 255.255.255.0</span><br><span class="line">   persistence_timeout 50  <span class="comment"># 同一IP 的连接50秒内被分配到同一台realserver(测试时建议改为0)</span></span><br><span class="line">   protocol TCP            <span class="comment"># 用TCP监测realserver的状态</span></span><br><span class="line">   real_server 192.168.3.203 80 &#123;       <span class="comment"># 定义realserver</span></span><br><span class="line">       weight 3                       <span class="comment"># 定义权重</span></span><br><span class="line">       TCP_CHECK &#123;  <span class="comment"># 注意TCP_CHECK和&#123;之间的空格,如果没有的话只会添加第一个realserver</span></span><br><span class="line">           connect_timeout 3          <span class="comment"># 三秒无响应超时</span></span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   real_server 192.168.3.204 80 &#123;</span><br><span class="line">       weight 3</span><br><span class="line">       TCP_CHECK &#123;</span><br><span class="line">           connect_timeout 3</span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lvs配置"><a href="#lvs配置" class="headerlink" title="lvs配置"></a>lvs配置</h3><p>将lvs启动配置成服务，随开机启动（lvs1、lvs2都需配置）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/init.d/lvs_dr_rs</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment">#chkconfig:345 85 15</span></span><br><span class="line"><span class="comment">#description:lvs_dr_rs</span></span><br><span class="line">VIP=192.168.3.209</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;lo:0 port starting&quot;</span></span><br><span class="line">        ifconfig lo:0 <span class="variable">$VIP</span> broadcast <span class="variable">$VIP</span> netmask 255.255.255.255 up</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;;</span><br><span class="line">        stop)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;lo:0 port closing&quot;</span></span><br><span class="line">        ifconfig lo:0 down</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> &#123;start ¦ stop&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">chmod</span> u+x /etc/init.d/lvs_dr_rs</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> lvs_dr_rs</span><br><span class="line">systemctl start lvs_dr_rs</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Lvs-keepalived安装配置&quot;&gt;&lt;a href=&quot;#Lvs-keepalived安装配置&quot; class=&quot;headerlink&quot; title=&quot;Lvs+keepalived安装配置&quot;&gt;&lt;/a&gt;Lvs+keepalived安装配置&lt;/h2&gt;&lt;h3 id=&quot;实</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="lvs" scheme="https://biglovewheat.gihub.io/tags/lvs/"/>
    
    <category term="keepalived" scheme="https://biglovewheat.gihub.io/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>ssl证书类型和价格</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/ssl%E8%AF%81%E4%B9%A6%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BB%B7%E6%A0%BC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/ssl%E8%AF%81%E4%B9%A6%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BB%B7%E6%A0%BC/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ssl证书类型和价格"><a href="#ssl证书类型和价格" class="headerlink" title="ssl证书类型和价格"></a>ssl证书类型和价格</h2><h3 id="ssl证书简介"><a href="#ssl证书简介" class="headerlink" title="ssl证书简介"></a>ssl证书简介</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_01.jpg"></p><h3 id="ssl证书类型"><a href="#ssl证书类型" class="headerlink" title="ssl证书类型"></a>ssl证书类型</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_02.jpg"></p><h3 id="ssl证书价格"><a href="#ssl证书价格" class="headerlink" title="ssl证书价格"></a>ssl证书价格</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_03.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ssl证书类型和价格&quot;&gt;&lt;a href=&quot;#ssl证书类型和价格&quot; class=&quot;headerlink&quot; title=&quot;ssl证书类型和价格&quot;&gt;&lt;/a&gt;ssl证书类型和价格&lt;/h2&gt;&lt;h3 id=&quot;ssl证书简介&quot;&gt;&lt;a href=&quot;#ssl证书简介&quot; class</summary>
      
    
    
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="ssl" scheme="https://biglovewheat.gihub.io/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>Nexus减肥</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/Nexus%E5%87%8F%E8%82%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/Nexus%E5%87%8F%E8%82%A5/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nexus减肥"><a href="#Nexus减肥" class="headerlink" title="Nexus减肥"></a>Nexus减肥</h2><p><em>nexus默认安装时，没有开启清理的任务，时间一长，容易占用大量磁盘空间</em></p><h3 id="清理maven-snapshot库"><a href="#清理maven-snapshot库" class="headerlink" title="清理maven-snapshot库"></a>清理maven-snapshot库</h3><p>system–task–create task–Maven - Delete SNAPSHOT Task</p><p>默认策略，只保留一个，多于1个且超过30天将删除</p><p><img src="/../images/nexus%E5%87%8F%E8%82%A5_01.jpg"></p><h3 id="释放blob-store空间"><a href="#释放blob-store空间" class="headerlink" title="释放blob store空间"></a>释放blob store空间</h3><p>清理完成后，不会马上释放空间，需要运行另外一个任务释放</p><p>system–task–create task–Create Admin - Compact blob store Task</p><p><img src="/../images/nexus%E5%87%8F%E8%82%A5_02.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nexus减肥&quot;&gt;&lt;a href=&quot;#Nexus减肥&quot; class=&quot;headerlink&quot; title=&quot;Nexus减肥&quot;&gt;&lt;/a&gt;Nexus减肥&lt;/h2&gt;&lt;p&gt;&lt;em&gt;nexus默认安装时，没有开启清理的任务，时间一长，容易占用大量磁盘空间&lt;/em&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="nexus" scheme="https://biglovewheat.gihub.io/tags/nexus/"/>
    
  </entry>
  
  <entry>
    <title>AWS-S3</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/aws-s3/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/aws-s3/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-S3"><a href="#AWS-S3" class="headerlink" title="AWS-S3"></a>AWS-S3</h2><h3 id="中国区价格"><a href="#中国区价格" class="headerlink" title="中国区价格"></a>中国区价格</h3><p><a href="https://www.amazonaws.cn/s3/pricing/">https://www.amazonaws.cn/s3/pricing/</a></p><h3 id="存储类别"><a href="#存储类别" class="headerlink" title="存储类别"></a>存储类别</h3><p><img src="/../images/aws-s3_01.png"></p><h3 id="client安装配置"><a href="#client安装配置" class="headerlink" title="client安装配置"></a>client安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">curl <span class="string">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span> -o <span class="string">&quot;awscliv2.zip&quot;</span></span><br><span class="line">unzip awscliv2.zip</span><br><span class="line">./aws/install</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">## 帮助</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">/usr/local/bin/aws configure</span><br><span class="line">AWS Access Key ID [None]: AKIAUPGCAPWX4FXXXXXX</span><br><span class="line">AWS Secret Access Key [None]: SsOupysZ4ZBptxGCxPm+aLWq+dTfShrgsdXXXXXX</span><br><span class="line">Default region name [None]: cn-northwest-1</span><br><span class="line">Default output format [None]:</span><br></pre></td></tr></table></figure><h3 id="上传下载"><a href="#上传下载" class="headerlink" title="上传下载"></a>上传下载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> mysqlbackup_all_202109280515.tar.gz s3://aas3</span><br><span class="line"><span class="comment">## 复制和排除文件夹</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> miniodata s3://aas3/permanent_backup/minio_backup/  --exclude sensordata/*  --exclude .minio.sys/*  --recursive</span><br><span class="line"></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> s3://aas3/AWSLogs/307497041326/vpcflowlogs/cn-northwest-1/2021/11/19/ . --recursive</span><br></pre></td></tr></table></figure><h3 id="挂载S3为文件系统"><a href="#挂载S3为文件系统" class="headerlink" title="挂载S3为文件系统"></a>挂载S3为文件系统</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.参考文档</span></span><br><span class="line"><span class="comment">## https://aws.amazon.com/cn/blogs/china/s3fs-amazon-ec2-linux/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.安装elep</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.安装s3fs-fuse</span></span><br><span class="line">yum install s3fs-fuse -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4.配置登录信息</span></span><br><span class="line">    <span class="built_in">echo</span> AKIAUPGCAPWX4FD5N2CO:SsOupysZ4ZBptxGCxPm+aLWq+dTfShrgsdITVib2 &gt; /etc/passwd-s3fs</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/passwd-s3fs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 5.手工挂载</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /s3mnt</span><br><span class="line">s3fs hxs3 /s3mnt -o passwd_file=/etc/passwd-s3fs -o url=http://s3.cn-northwest-1.amazonaws.com.cn -o endpoint=cn-northwest-1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 6.自动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">s3fs<span class="comment">#hxs3 /s3mnt fuse allow_other,url=http://s3.cn-northwest-1.amazonaws.com.cn,endpoint=cn-northwest-1 0  0</span></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line"><span class="comment">## 7.卸载</span></span><br><span class="line">umount /s3mnt</span><br><span class="line">umount -l /s3mnt</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-S3&quot;&gt;&lt;a href=&quot;#AWS-S3&quot; class=&quot;headerlink&quot; title=&quot;AWS-S3&quot;&gt;&lt;/a&gt;AWS-S3&lt;/h2&gt;&lt;h3 id=&quot;中国区价格&quot;&gt;&lt;a href=&quot;#中国区价格&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="s3" scheme="https://biglovewheat.gihub.io/tags/s3/"/>
    
  </entry>
  
  <entry>
    <title>AWS-阿里云对比</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/aws-%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E6%AF%94/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/aws-%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E6%AF%94/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-阿里云对比"><a href="#AWS-阿里云对比" class="headerlink" title="AWS-阿里云对比"></a>AWS-阿里云对比</h2><p><em>AWS为中国区价格</em></p><h3 id="云服务器"><a href="#云服务器" class="headerlink" title="云服务器"></a>云服务器</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>阿里云</th><th>AWS</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>ecs.g7.xlarge</td><td>ecs.r7.xlarge</td><td>m5.xlarge</td><td>r5.xlarge</td></tr><tr><td>类型</td><td>通用型</td><td>内存型</td><td>通用型</td><td>内存型</td></tr><tr><td>规格</td><td>4c16g</td><td>4c32g</td><td>4c16g</td><td>4c32g</td></tr><tr><td>小时价</td><td>1.0465</td><td>1.392442</td><td>2.026</td><td>2.437</td></tr><tr><td>小时-月</td><td>753.48</td><td>1002.55824</td><td>1458.72</td><td>1754.64</td></tr><tr><td>包月价</td><td>502.32</td><td>668.37</td><td>303.12</td><td>396</td></tr><tr><td>包年-月</td><td>426.97</td><td>568.12</td><td>282.96</td><td>369.36</td></tr></tbody></table><h3 id="块存储"><a href="#块存储" class="headerlink" title="块存储"></a>块存储</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>阿里云</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>PL0</td><td>PL1</td><td>GP3</td></tr><tr><td>性能指标</td><td>10000IOPS&#x2F;180MB</td><td>50000IOPS&#x2F;350MB</td><td>3000IOPS&#x2F;125MB</td></tr><tr><td>计价方式</td><td>按量-小时&#x2F;GiB</td><td>按量-小时&#x2F;GiB</td><td>按量-小时&#x2F;GiB</td></tr><tr><td>单价</td><td>0.00105</td><td>0.0021</td><td></td></tr><tr><td>折算</td><td>0.756</td><td>1.512</td><td>0.5312</td></tr><tr><td>计价方式</td><td>包月-月&#x2F;GiB</td><td>包月-月&#x2F;GiB</td><td></td></tr><tr><td>单价</td><td>0.5</td><td>1</td><td></td></tr></tbody></table><h3 id="对象存储"><a href="#对象存储" class="headerlink" title="对象存储"></a>对象存储</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>oss标准型单价</td><td>S3标准存储</td></tr><tr><td>单价</td><td>0.12</td><td>0.1755</td></tr><tr><td>流量费用</td><td>0.25gb(闲时)&#x2F;0.5gb（忙时）</td><td>0.933&#x2F;gb</td></tr><tr><td>请求费用</td><td>PUT:0.01元&#x2F;万次</td><td>PUT:0.0405&#x2F;万次，GET:0.0135&#x2F;万次</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-阿里云对比&quot;&gt;&lt;a href=&quot;#AWS-阿里云对比&quot; class=&quot;headerlink&quot; title=&quot;AWS-阿里云对比&quot;&gt;&lt;/a&gt;AWS-阿里云对比&lt;/h2&gt;&lt;p&gt;&lt;em&gt;AWS为中国区价格&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;云服务器&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="阿里云" scheme="https://biglovewheat.gihub.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>正则表达式</title>
    <link href="https://biglovewheat.gihub.io/2022/08/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>https://biglovewheat.gihub.io/2022/08/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</id>
    <published>2022-08-23T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="身份证校验"><a href="#身份证校验" class="headerlink" title="身份证校验"></a>身份证校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 前六位，地区</span></span><br><span class="line">([1-6][1-9]|50)\d&#123;4&#125;</span><br><span class="line"><span class="comment">## 7-8位置，年份前两位，1800-2099</span></span><br><span class="line">(18|19|20)</span><br><span class="line"><span class="comment">## 9-10位置，年份后两位</span></span><br><span class="line">\d&#123;2&#125;</span><br><span class="line"><span class="comment">## 11-12，月份</span></span><br><span class="line">((0[1-9])|10|11|12)</span><br><span class="line"><span class="comment">## 13-14，日期</span></span><br><span class="line">(([0-2][1-9])|10|20|30|31) </span><br><span class="line"><span class="comment">## 15-17，顺序码</span></span><br><span class="line">\d&#123;3&#125;</span><br><span class="line"><span class="comment">## 校验码： </span></span><br><span class="line">[0-9Xx]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 校验18位的身份证</span></span><br><span class="line">^([1-6][1-9]|50)\d&#123;4&#125;(18|19|20)\d&#123;2&#125;((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]$</span><br></pre></td></tr></table></figure><h3 id="email校验"><a href="#email校验" class="headerlink" title="email校验"></a>email校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;</span><br></pre></td></tr></table></figure><h3 id="ip校验"><a href="#ip校验" class="headerlink" title="ip校验"></a>ip校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1-255).(0-255).(0-255).(0-255)</span><br></pre></td></tr></table></figure><h3 id="python使用正则"><a href="#python使用正则" class="headerlink" title="python使用正则"></a>python使用正则</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">idlist=[<span class="string">&#x27;440107199808180637&#x27;</span>,<span class="string">&#x27;100107199808180637&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pat=<span class="string">r&#x27;^([1-6][1-9]|50)\d&#123;4&#125;(18|19|20)\d&#123;2&#125;((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]$&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> idlist:</span><br><span class="line">    <span class="keyword">if</span> re.search(pat,<span class="built_in">id</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;NO&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;正则表达式&quot;&gt;&lt;a href=&quot;#正则表达式&quot; class=&quot;headerlink&quot; title=&quot;正则表达式&quot;&gt;&lt;/a&gt;正则表达式&lt;/h2&gt;&lt;h3 id=&quot;身份证校验&quot;&gt;&lt;a href=&quot;#身份证校验&quot; class=&quot;headerlink&quot; title=&quot;身份证</summary>
      
    
    
    
    <category term="基础概念" scheme="https://biglovewheat.gihub.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    
    
    <category term="正则表达式" scheme="https://biglovewheat.gihub.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Redis-编译安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/23/redis-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/23/redis-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-22T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redis-编译安装"><a href="#Redis-编译安装" class="headerlink" title="Redis-编译安装"></a>Redis-编译安装</h2><h3 id="升级gcc版本"><a href="#升级gcc版本" class="headerlink" title="升级gcc版本"></a>升级gcc版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-9 bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line">gcc -v</span><br></pre></td></tr></table></figure><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br><span class="line">redis-cli --pass <span class="string">&#x27;123456&#x27;</span> shutdown</span><br></pre></td></tr></table></figure><h3 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin redis</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 1024 &gt;/proc/sys/net/core/somaxconn</span><br><span class="line">sysctl vm.overcommit_memory=1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改--session生效</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改--重启永久生效</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br></pre></td></tr></table></figure><h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 放开其他服务器登录</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment">## 端口</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="comment">## 后台运行</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"><span class="comment">## 后台运行后pidfile</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"><span class="comment">## 日志文件路径</span></span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/log/redis-6379.log&quot;</span></span><br><span class="line"><span class="comment">## 数据文件路径</span></span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/data-6379/</span><br><span class="line"><span class="comment">## 复制相关</span></span><br><span class="line">replicaof 192.168.8.199 6379</span><br><span class="line">masterauth <span class="string">&#x27;123456&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="复制相关"><a href="#复制相关" class="headerlink" title="复制相关"></a>复制相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看复制</span></span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line"><span class="comment">## slave 变 master</span></span><br><span class="line">slaveof no one</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Redis-编译安装&quot;&gt;&lt;a href=&quot;#Redis-编译安装&quot; class=&quot;headerlink&quot; title=&quot;Redis-编译安装&quot;&gt;&lt;/a&gt;Redis-编译安装&lt;/h2&gt;&lt;h3 id=&quot;升级gcc版本&quot;&gt;&lt;a href=&quot;#升级gcc版本&quot; class</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/tags/middleware/"/>
    
    <category term="redis" scheme="https://biglovewheat.gihub.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>K8s-helm-安装常用软件</title>
    <link href="https://biglovewheat.gihub.io/2022/08/18/k8s-helm-%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/"/>
    <id>https://biglovewheat.gihub.io/2022/08/18/k8s-helm-%E5%AE%89%E8%A3%85%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/</id>
    <published>2022-08-17T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-helm-安装常用软件"><a href="#K8s-helm-安装常用软件" class="headerlink" title="K8s-helm-安装常用软件"></a>K8s-helm-安装常用软件</h2><h3 id="helm安装"><a href="#helm安装" class="headerlink" title="helm安装"></a>helm安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://get.helm.sh/helm-v3.9.3-linux-amd64.tar.gz</span><br><span class="line">tar -xvf helm-v3.9.3-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">chmod</span> u+x helm</span><br><span class="line"><span class="built_in">cp</span> helm /usr/sbin</span><br></pre></td></tr></table></figure><h3 id="添加仓库"><a href="#添加仓库" class="headerlink" title="添加仓库"></a>添加仓库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo add c7n https://openchart.choerodon.com.cn/choerodon/c7n</span><br><span class="line">helm repo add apphub https://apphub.aliyuncs.com/</span><br></pre></td></tr></table></figure><h3 id="helm-nfs-subdir-external-provisioner"><a href="#helm-nfs-subdir-external-provisioner" class="headerlink" title="helm-nfs-subdir-external-provisioner"></a>helm-nfs-subdir-external-provisioner</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</span></span><br><span class="line"></span><br><span class="line">helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br><span class="line"></span><br><span class="line">helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \</span><br><span class="line">  --namespace=kube-system \</span><br><span class="line">  --<span class="built_in">set</span> image.repository=willdockerhub/nfs-subdir-external-provisioner \</span><br><span class="line">  --<span class="built_in">set</span> image.tag=v4.0.2 \</span><br><span class="line">  --<span class="built_in">set</span> replicaCount=2 \</span><br><span class="line">  --<span class="built_in">set</span> storageClass.name=sc-nfs \</span><br><span class="line">  --<span class="built_in">set</span> storageClass.defaultClass=<span class="literal">true</span> \</span><br><span class="line">  --<span class="built_in">set</span> nfs.server=192.168.8.201 \</span><br><span class="line">  --<span class="built_in">set</span> nfs.path=/nfsdata</span><br></pre></td></tr></table></figure><h3 id="helm-jenkins"><a href="#helm-jenkins" class="headerlink" title="helm-jenkins"></a>helm-jenkins</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"></span><br><span class="line">helm upgrade --install jenkins bitnami/jenkins -n tools \</span><br><span class="line">--<span class="built_in">set</span> jenkinsUser=admin \</span><br><span class="line">--<span class="built_in">set</span> jenkinsPassword=<span class="string">&#x27;admin123&#x27;</span> \</span><br><span class="line">--<span class="built_in">set</span> javaOpts=<span class="string">&#x27;-Duser.timezone=Asia/Shanghai&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="helm-mysql"><a href="#helm-mysql" class="headerlink" title="helm-mysql"></a>helm-mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### https://hub.kubeapps.com/charts/bitnami/mysql</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line"></span><br><span class="line">helm upgrade --install mysql bitnami/mysql -n tools \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> image.tag=8.0.23-debian-10-r84 \</span><br><span class="line">--<span class="built_in">set</span> auth.database=<span class="string">&quot;&quot;</span> \</span><br><span class="line">--<span class="built_in">set</span> architecture=standalone \</span><br><span class="line">--<span class="built_in">set</span> auth.rootPassword=admin123 \</span><br><span class="line">--<span class="built_in">set</span> primary.service.type=NodePort \</span><br><span class="line">--<span class="built_in">set</span> primary.service.nodePort=30036 \</span><br><span class="line">--<span class="built_in">set</span> primary.persistence.size=100Gi</span><br></pre></td></tr></table></figure><h3 id="helm-nexus"><a href="#helm-nexus" class="headerlink" title="helm-nexus"></a>helm-nexus</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade --install sonatype-nexus apphub/sonatype-nexus -n middleware \</span><br><span class="line">--<span class="built_in">set</span> ingress.tls.enabled=<span class="literal">false</span> \</span><br><span class="line">--<span class="built_in">set</span> persistence.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> nexusProxy.enabled=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; svc-nexus.yaml</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Service</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: sonatype-nexus</span></span><br><span class="line"><span class="string">  namespace: middleware</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: sonatype-nexus</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  type: NodePort</span></span><br><span class="line"><span class="string">  ports:</span></span><br><span class="line"><span class="string">    - port: 8081</span></span><br><span class="line"><span class="string">      name: http1</span></span><br><span class="line"><span class="string">      targetPort: 8081</span></span><br><span class="line"><span class="string">      nodePort: 31001</span></span><br><span class="line"><span class="string">    - port: 8082</span></span><br><span class="line"><span class="string">      name: http2</span></span><br><span class="line"><span class="string">      targetPort: 8082</span></span><br><span class="line"><span class="string">      nodePort: 31002</span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    app: sonatype-nexus</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl apply -f svc-nexus.yaml</span><br><span class="line"><span class="built_in">rm</span> -f svc-nexus.yaml</span><br></pre></td></tr></table></figure><h3 id="helm-gafana"><a href="#helm-gafana" class="headerlink" title="helm-gafana"></a>helm-gafana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm upgrade --install grafana bitnami/grafana -n tools \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> image.tag=8.1.2-debian-10-r6 \</span><br><span class="line">--<span class="built_in">set</span> admin.password=admin123</span><br></pre></td></tr></table></figure><h3 id="helm-nacos"><a href="#helm-nacos" class="headerlink" title="helm-nacos"></a>helm-nacos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## setp1. git clone https://github.com/nacos-group/nacos-k8s.git</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## setp2. wget https://github.com/alibaba/nacos/blob/develop/distribution/conf/nacos-mysql.sql</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## setp3. run sql in your mysql</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment">## setp4. sed -i s/&#x27;mysql.port: &#123;&#123; .port | default 3306&#125;&#125;&#x27;/&#x27;mysql.port: &quot;&#123;&#123; .port | default 3306&#125;&#125;&quot;&#x27;/g ./nacos-k8s/helm/templates/configmap.yaml</span></span><br><span class="line"></span><br><span class="line">helm upgrade --install nacos ./nacos-k8s/helm/ -n tools \</span><br><span class="line">--<span class="built_in">set</span> global.mode=standalone \</span><br><span class="line">--<span class="built_in">set</span> nacos.image.tag=1.4.2 \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.type=mysql \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.db.host=mysql \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.db.name=nacos_config \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.db.port=3306 \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.db.username=root \</span><br><span class="line">--<span class="built_in">set</span> nacos.storage.db.password=admin123</span><br></pre></td></tr></table></figure><h3 id="helm-redis"><a href="#helm-redis" class="headerlink" title="helm-redis"></a>helm-redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm upgrade --install redis bitnami/redis -n tools \</span><br><span class="line">--<span class="built_in">set</span> global.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> global.redis.password=admin123 \</span><br><span class="line">--<span class="built_in">set</span> image.tag=6.2.5-debian-10-r34 \</span><br><span class="line">--<span class="built_in">set</span> architecture=standalone \</span><br><span class="line">--<span class="built_in">set</span> master.service.type=NodePort  \</span><br><span class="line">--<span class="built_in">set</span> master.service.nodePort=30379</span><br></pre></td></tr></table></figure><h3 id="helm-gitlab"><a href="#helm-gitlab" class="headerlink" title="helm-gitlab"></a>helm-gitlab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm upgrade --install gitlab c7n/gitlab-ha --version 0.2.4 -n tools \</span><br><span class="line">--<span class="built_in">set</span> expose.type=clusterIP \</span><br><span class="line">--<span class="built_in">set</span> persistence.enabled=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.core.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.core.size=10Gi \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.database.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.database.size=10Gi \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.redis.storageClass=sc-nfs \</span><br><span class="line">--<span class="built_in">set</span> persistence.persistentVolumeClaim.redis.size=5Gi \</span><br><span class="line">--<span class="built_in">set</span> core.replicas=1</span><br><span class="line"><span class="comment">##--set core.image.tag=v12.3.5 \</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-helm-安装常用软件&quot;&gt;&lt;a href=&quot;#K8s-helm-安装常用软件&quot; class=&quot;headerlink&quot; title=&quot;K8s-helm-安装常用软件&quot;&gt;&lt;/a&gt;K8s-helm-安装常用软件&lt;/h2&gt;&lt;h3 id=&quot;helm安装&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ELK-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/17/elk-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/17/elk-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-16T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ELK-安装"><a href="#ELK-安装" class="headerlink" title="ELK-安装"></a>ELK-安装</h2><h3 id="ElasticSearch-安装配置"><a href="#ElasticSearch-安装配置" class="headerlink" title="ElasticSearch 安装配置"></a>ElasticSearch 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf elasticsearch-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> elasticsearch-7.13.1-linux-x86_64 /usr/local/elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建用户</span></span><br><span class="line">useradd es</span><br><span class="line">passwd es</span><br><span class="line"><span class="built_in">chown</span> -R es:es /usr/local/elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">## linux参数设置</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max=655360</span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">*        soft    <span class="built_in">nproc</span>           20480</span><br><span class="line">*        hard    <span class="built_in">nproc</span>           20480</span><br><span class="line">*        soft    nofile          65536</span><br><span class="line">*        hard    nofile          65536</span><br><span class="line">*        soft    memlock         unlimited</span><br><span class="line">*        hard    memlock         unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重新登录生效，查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="built_in">rm</span> -f /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/elasticsearch/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#cluster.name: elkbigdata</span></span><br><span class="line"><span class="comment">#node.name: server1</span></span><br><span class="line"><span class="comment">#node.master: true</span></span><br><span class="line"><span class="comment">#node.data: true</span></span><br><span class="line">path.data: /data/elasticsearch</span><br><span class="line"><span class="comment">#path.logs: /usr/local/elasticsearch/logs</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line">network.host: 192.168.8.221</span><br><span class="line"><span class="comment">#http.port: 9200</span></span><br><span class="line"><span class="comment">#discovery.zen.minimum_master_nodes: 1</span></span><br><span class="line"><span class="comment">#discovery.seed_hosts: [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span></span><br><span class="line"><span class="comment">#discovery.seed_providers: file</span></span><br><span class="line">cluster.initial_master_nodes: <span class="string">&quot;vm221&quot;</span></span><br><span class="line"><span class="comment">##discovery.zen.ping.unicast.hosts: [&quot;172.16.213.37:9300&quot;,&quot;172.16.213.78:9300&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">su - es -c <span class="string">&quot;/usr/local/elasticsearch/bin/elasticsearch -d&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ES常用命令"><a href="#ES常用命令" class="headerlink" title="ES常用命令"></a>ES常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看索引</span></span><br><span class="line">curl localhost:9200/_cat/indices?v</span><br></pre></td></tr></table></figure><h3 id="zookepper-安装配置"><a href="#zookepper-安装配置" class="headerlink" title="zookepper 安装配置"></a>zookepper 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf tar -xvf apache-zookeeper-3.6.3-bin.tar.gz</span><br><span class="line"><span class="built_in">mv</span> apache-zookeeper-3.6.3-bin /usr/local/zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/zookeeper/conf/zoo.cfg</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/data/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=192.168.8.225:2888:3888</span><br><span class="line">server.2=192.168.8.226:2888:3888</span><br><span class="line">server.3=192.168.8.227:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> myid file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt;/data/zookeeper/myid</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/zookeeper/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><h3 id="kafka-安装配置"><a href="#kafka-安装配置" class="headerlink" title="kafka 安装配置"></a>kafka 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf kafka_2.11-2.2.2.tgz</span><br><span class="line"><span class="built_in">mv</span> kafka_2.11-2.2.2 /usr/local/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件</span></span><br><span class="line">vi /usr/local/kafka/config/server.properties</span><br><span class="line"></span><br><span class="line">broker.id=0</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/usr/local/kafka/logs</span><br><span class="line">num.partitions=3</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=60</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties 1&gt;kafka.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">tail</span> -f kafka.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用操作</span></span><br><span class="line"><span class="comment"># 查看topic</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper 192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181 --list</span><br><span class="line"><span class="comment"># 创建topic</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper 192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181 --create --topic elktopic \</span><br><span class="line">&gt;         --partitions 3 --replication-factor 1</span><br><span class="line"><span class="comment"># 查看topic内容</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic elktopic --from-beginning</span><br></pre></td></tr></table></figure><h3 id="filebeat-安装配置"><a href="#filebeat-安装配置" class="headerlink" title="filebeat 安装配置"></a>filebeat 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf filebeat-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> filebeat-7.13.1-linux-x86_64 /usr/local/filebeat</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/filebeat/filebeat.yml</span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/secure</span><br><span class="line">  fields:</span><br><span class="line">    log_topic: topic1</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">  hosts: [<span class="string">&quot;192.168.8.225:9092&quot;</span>, <span class="string">&quot;192.168.8.226:9092&quot;</span>, <span class="string">&quot;192.168.8.227:9092&quot;</span>]</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  topic: <span class="string">&#x27;%&#123;[fields.log_topic]&#125;&#x27;</span></span><br><span class="line">  partition.round_robin:</span><br><span class="line">    reachable_only: <span class="literal">false</span></span><br><span class="line">  required_acks: 1</span><br><span class="line">  compression: gzip</span><br><span class="line">  max_message_bytes: 1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/filebeat/filebeat -e -c /usr/local/filebeat/filebeat.yml &gt;filebeat.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">tail</span> -f filebeat.log</span><br></pre></td></tr></table></figure><h3 id="logstash-安装配置"><a href="#logstash-安装配置" class="headerlink" title="logstash 安装配置"></a>logstash 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf logstash-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> logstash-7.13.1-linux-x86_64 /usr/local/logstash</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line"><span class="built_in">cat</span> /usr/local/logstash/config/logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">        kafka &#123;</span><br><span class="line">        bootstrap_servers =&gt; <span class="string">&quot;192.168.8.225:9092,192.168.8.226:9092,192.168.8.227:9092&quot;</span></span><br><span class="line">        topics =&gt; [<span class="string">&quot;topic1&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">        hosts =&gt; <span class="string">&quot;192.168.8.221:9200&quot;</span></span><br><span class="line">        index =&gt; <span class="string">&quot;securelog-%&#123;+YYYY-MM-dd&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/logstash/bin/logstash -f /usr/local/logstash/config/logstash.conf &gt;logstash.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h3 id="Kibana-安装配置"><a href="#Kibana-安装配置" class="headerlink" title="Kibana 安装配置"></a>Kibana 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf logstash-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> logstash-7.13.1-linux-x86_64 /usr/local/logstash</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/kibana/config/kibana.yml</span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">&quot;192.168.8.221&quot;</span></span><br><span class="line">elasticsearch.hosts: <span class="string">&quot;http://192.168.8.221:9200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/kibana/bin/kibana --allow-root &gt;kibana.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 索引设置</span></span><br><span class="line"><span class="comment">## Management--&gt;Stack Management--&gt;Kibana--&gt;Index Patterns</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ELK-安装&quot;&gt;&lt;a href=&quot;#ELK-安装&quot; class=&quot;headerlink&quot; title=&quot;ELK-安装&quot;&gt;&lt;/a&gt;ELK-安装&lt;/h2&gt;&lt;h3 id=&quot;ElasticSearch-安装配置&quot;&gt;&lt;a href=&quot;#ElasticSearch-安装配置&quot;</summary>
      
    
    
    
    <category term="日志" scheme="https://biglovewheat.gihub.io/categories/%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="日志" scheme="https://biglovewheat.gihub.io/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>Linux-Vsftp-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/15/linux-vsftp-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/15/linux-vsftp-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-14T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-Vsftp-安装"><a href="#Linux-Vsftp-安装" class="headerlink" title="Linux-Vsftp-安装"></a>Linux-Vsftp-安装</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vsftpd ftp</span><br><span class="line"></span><br><span class="line">useradd vsftp</span><br><span class="line"><span class="built_in">echo</span> vsftp@123\! |passwd vsftp --stdin</span><br><span class="line"><span class="built_in">mkdir</span> /ftp</span><br><span class="line">usermod vsftp -d /ftp</span><br><span class="line"><span class="built_in">chown</span> vsftp:vsftp /ftp</span><br><span class="line"></span><br><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line"><span class="comment">#anonymous_enable=YES</span></span><br><span class="line"></span><br><span class="line">systemctl start vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br></pre></td></tr></table></figure><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ftp -n &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string">open 192.168.1.1</span></span><br><span class="line"><span class="string">user vsftp vsftp@123!</span></span><br><span class="line"><span class="string">cd /ftp</span></span><br><span class="line"><span class="string">bin</span></span><br><span class="line"><span class="string">prompt</span></span><br><span class="line"><span class="string">mput *.log</span></span><br><span class="line"><span class="string">bye</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭匿名</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="comment">## 开放本地用户</span></span><br><span class="line">local_enable=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">## 需要开放其他用户编辑:</span></span><br><span class="line"><span class="comment">#1 /etc/vsftpd/ftpusers  --&gt;ftp黑名单,名单上的用户不能登录（与设置无关）</span></span><br><span class="line"><span class="comment">#2 /etc/vsftpd/userlist --&gt;ftp黑名单,名单上的用户不能登录（userlist_enable=YES、userlist_deny=YES；都是默认）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/vsftpd/vsftpd.conf #主配置文件 或 /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment">#/etc/vsftpd/ftpusers #不能访问FTP用户列表 或 /etc/ftpusers</span></span><br><span class="line"><span class="comment">#/etc/vsftpd/user_list #不能访问FTP用户列表</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-Vsftp-安装&quot;&gt;&lt;a href=&quot;#Linux-Vsftp-安装&quot; class=&quot;headerlink&quot; title=&quot;Linux-Vsftp-安装&quot;&gt;&lt;/a&gt;Linux-Vsftp-安装&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot;</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-主从复制配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/11/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/08/11/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</id>
    <published>2022-08-10T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-主从复制配置"><a href="#Mysql-主从复制配置" class="headerlink" title="Mysql-主从复制配置"></a>Mysql-主从复制配置</h2><h3 id="master开启binlog"><a href="#master开启binlog" class="headerlink" title="master开启binlog"></a>master开启binlog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog_format=mixed</span><br><span class="line">server-id=1</span><br><span class="line">auto_increment_increment=2</span><br><span class="line">auto_increment_offset=1</span><br><span class="line">replicate-do-db=monitor</span><br></pre></td></tr></table></figure><h3 id="master重启"><a href="#master重启" class="headerlink" title="master重启"></a>master重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="master设置复制用户"><a href="#master设置复制用户" class="headerlink" title="master设置复制用户"></a>master设置复制用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repuser&#x27;</span>@<span class="string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">mysql<span class="operator">&gt;</span>FLUSH PRIVILEGES;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> File             <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span> Executed_Gtid_Set <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span>     <span class="number">1977</span> <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--记录file和position</span></span><br></pre></td></tr></table></figure><h3 id="slave设置参数"><a href="#slave设置参数" class="headerlink" title="slave设置参数"></a>slave设置参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">server-id=2</span><br></pre></td></tr></table></figure><h3 id="slave重启"><a href="#slave重启" class="headerlink" title="slave重启"></a>slave重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="slave开启复制"><a href="#slave开启复制" class="headerlink" title="slave开启复制"></a>slave开启复制</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.8.201&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;repuser&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;2014Picc!!!&#x27;</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">612</span>;</span><br></pre></td></tr></table></figure><h3 id="slave查看状态"><a href="#slave查看状态" class="headerlink" title="slave查看状态"></a>slave查看状态</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">show</span> slave status\G</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-主从复制配置&quot;&gt;&lt;a href=&quot;#Mysql-主从复制配置&quot; class=&quot;headerlink&quot; title=&quot;Mysql-主从复制配置&quot;&gt;&lt;/a&gt;Mysql-主从复制配置&lt;/h2&gt;&lt;h3 id=&quot;master开启binlog&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-慢日志处理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/11/mysql-%E6%85%A2%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/11/mysql-%E6%85%A2%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/</id>
    <published>2022-08-10T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-慢日志处理"><a href="#Mysql-慢日志处理" class="headerlink" title="Mysql-慢日志处理"></a>Mysql-慢日志处理</h2><h3 id="查看参数"><a href="#查看参数" class="headerlink" title="查看参数"></a>查看参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">| Variable_name       | Value                         |</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">| slow_query_log      | OFF                           |</span><br><span class="line">| slow_query_log_file | /var/lib/mysql/vm201-slow.log |</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="开启慢日志"><a href="#开启慢日志" class="headerlink" title="开启慢日志"></a>开启慢日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">slow_query_log=1</span><br><span class="line">slow_query_log_file=/var/lib/mysql/vm201-slow.log</span><br><span class="line"><span class="comment">#default 10</span></span><br><span class="line">log_query_time=10</span><br></pre></td></tr></table></figure><h3 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s at -t 20  /var/lib/mysql/vm201-slow.log</span><br><span class="line"></span><br><span class="line">-s at <span class="built_in">sort</span> by query time</span><br><span class="line">-t 20 top 20</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-慢日志处理&quot;&gt;&lt;a href=&quot;#Mysql-慢日志处理&quot; class=&quot;headerlink&quot; title=&quot;Mysql-慢日志处理&quot;&gt;&lt;/a&gt;Mysql-慢日志处理&lt;/h2&gt;&lt;h3 id=&quot;查看参数&quot;&gt;&lt;a href=&quot;#查看参数&quot; class=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>AWS-Linux-Chrony-时间同步</title>
    <link href="https://biglovewheat.gihub.io/2022/08/10/aws-linux-chrony-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/10/aws-linux-chrony-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/</id>
    <published>2022-08-09T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.990Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-Linux-Chrony-时间同步"><a href="#AWS-Linux-Chrony-时间同步" class="headerlink" title="AWS-Linux-Chrony-时间同步"></a>AWS-Linux-Chrony-时间同步</h2><h3 id="配置chrony同步"><a href="#配置chrony同步" class="headerlink" title="配置chrony同步"></a>配置chrony同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置aws时间服务器</span></span><br><span class="line">vi /etc/chrony.conf </span><br><span class="line"></span><br><span class="line">server 169.254.169.123 prefer iburst minpoll 4 maxpoll 4</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启chrony</span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看同步情况</span></span><br><span class="line">chronyc sources -v</span><br><span class="line"></span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current synced, <span class="string">&#x27;+&#x27;</span> = combined , <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /   <span class="string">&#x27;?&#x27;</span> = unreachable, <span class="string">&#x27;x&#x27;</span> = time may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 169.254.169.123               3   4   377    11  -5483ns[  -10us] +/-  410us</span><br><span class="line"></span><br><span class="line"><span class="comment">## 验证 </span></span><br><span class="line">chronyc tracking</span><br><span class="line">Reference ID    : A9FEA97B (169.254.169.123)</span><br><span class="line">Stratum         : 4</span><br><span class="line">Ref time (UTC)  : Wed Aug 10 03:04:51 2022</span><br><span class="line">System time     : 0.000002134 seconds fast of NTP time</span><br><span class="line">Last offset     : +0.000002142 seconds</span><br><span class="line">RMS offset      : 0.000007061 seconds</span><br><span class="line">Frequency       : 2.554 ppm slow</span><br><span class="line">Residual freq   : +0.003 ppm</span><br><span class="line">Skew            : 0.200 ppm</span><br><span class="line">Root delay      : 0.000296080 seconds</span><br><span class="line">Root dispersion : 0.000277362 seconds</span><br><span class="line">Update interval : 16.3 seconds</span><br><span class="line">Leap status     : Normal</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-Linux-Chrony-时间同步&quot;&gt;&lt;a href=&quot;#AWS-Linux-Chrony-时间同步&quot; class=&quot;headerlink&quot; title=&quot;AWS-Linux-Chrony-时间同步&quot;&gt;&lt;/a&gt;AWS-Linux-Chrony-时间同步&lt;/</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-Gitlab-webhook配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.991Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-Gitlab-webhook配置"><a href="#Jenkins-Gitlab-webhook配置" class="headerlink" title="Jenkins-Gitlab-webhook配置"></a>Jenkins-Gitlab-webhook配置</h2><h3 id="Gitlab设置access-token"><a href="#Gitlab设置access-token" class="headerlink" title="Gitlab设置access token"></a>Gitlab设置access token</h3><p>用户头像–Preferences–访问令牌<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_01.jpg"></p><p>把key复制下来<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_02.jpg"></p><h3 id="Gitlab项目配置webhook"><a href="#Gitlab项目配置webhook" class="headerlink" title="Gitlab项目配置webhook"></a>Gitlab项目配置webhook</h3><p>项目–设置–webhook</p><p>分别填入：</p><p>网址：jenkins网址+generic-webhook-trigger&#x2F;invoke?token&#x3D;yourtoken</p><p>推送事件：可以指定分支或tag</p><p>去掉启用ssl验证<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_03.jpg"></p><h3 id="jenkins安装Generic-Webhook-Trigger插件"><a href="#jenkins安装Generic-Webhook-Trigger插件" class="headerlink" title="jenkins安装Generic Webhook Trigger插件"></a>jenkins安装Generic Webhook Trigger插件</h3><h3 id="jenkins项目配置webhook"><a href="#jenkins项目配置webhook" class="headerlink" title="jenkins项目配置webhook"></a>jenkins项目配置webhook</h3><p><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_04.jpg"></p><p>配置完成后，只要分支有推送事件，会触发jenkins构建</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-Gitlab-webhook配置&quot;&gt;&lt;a href=&quot;#Jenkins-Gitlab-webhook配置&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-Gitlab-webhook配置&quot;&gt;&lt;/a&gt;Jenkins-Gitlab</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>K8s-Evicted-Pod处理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/k8s-evicted-pod%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/k8s-evicted-pod%E5%A4%84%E7%90%86/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-Evicted-Pod处理"><a href="#K8s-Evicted-Pod处理" class="headerlink" title="K8s-Evicted-Pod处理"></a>K8s-Evicted-Pod处理</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>k8s出现很多Evicted Pod</p><h3 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pods farm-server-789ddb7b4c-5jltb -n dev-3 |grep -i message</span><br><span class="line">Message: Pod The node had condition: [DiskPressure].</span><br></pre></td></tr></table></figure><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>k8s节点磁盘达到85%触发node驱逐pod</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.降低磁盘使用率</span></span><br><span class="line"><span class="comment">## 2.修改kubelet启动参数</span></span><br><span class="line">vi /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><span class="line">Environment=<span class="string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --eviction-hard=nodefs.available&lt;5%&quot;</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除evicted的pod</span></span><br><span class="line">kubectl -n base get pods |grep Evicted |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> |xargs kubectl -n base delete pods</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-Evicted-Pod处理&quot;&gt;&lt;a href=&quot;#K8s-Evicted-Pod处理&quot; class=&quot;headerlink&quot; title=&quot;K8s-Evicted-Pod处理&quot;&gt;&lt;/a&gt;K8s-Evicted-Pod处理&lt;/h2&gt;&lt;h3 id=&quot;现象&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8s-ingress-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/k8s-ingress-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/k8s-ingress-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-09-03T06:07:51.992Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-ingress-安装"><a href="#K8s-ingress-安装" class="headerlink" title="K8s-ingress-安装"></a>K8s-ingress-安装</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm repo add nginx-stable https://helm.nginx.com/stable</span><br><span class="line"></span><br><span class="line">helm upgrade --install nginx-ingress nginx-stable/nginx-ingress -n kube-system \</span><br><span class="line">--<span class="built_in">set</span> controller.kind=daemonset \</span><br><span class="line">--<span class="built_in">set</span> ingressClass=nginx \</span><br><span class="line">--<span class="built_in">set</span> setAsDefaultIngress=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">kubectl patch daemonset nginx-ingress-nginx-ingress -n kube-system -p=<span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;template&quot;: &#123;&quot;spec&quot;:  &#123;&quot;tolerations&quot;: [&#123;&quot;key&quot;: &quot;node-role.kubernetes.io/master&quot;, &quot;effect&quot;: &quot;NoSchedule&quot;&#125;]&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## for k8s 1.18</span></span><br><span class="line">--version 0.10.4</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ing-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">app</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span>  <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">ng.biglovewheat1.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">saas-operation</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev-3</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span>  <span class="string">nginx</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-credentials:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-headers:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-methods:</span> <span class="string">PUT,</span> <span class="string">GET,</span> <span class="string">POST,</span> <span class="string">OPTIONS,</span> <span class="string">DELETE</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-origin:</span> <span class="string">http://saas-operation.abc.com</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/enable-cors:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">saas-operation.abc.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">saas-operation</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="ingress-413-错误"><a href="#ingress-413-错误" class="headerlink" title="ingress-413-错误"></a>ingress-413-错误</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ingress error</span></span><br><span class="line"><span class="comment">## 413 Request Entity Too Large</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-read-timeout:</span> <span class="string">&quot;600&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-send-timeout:</span> <span class="string">&quot;600&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-ingress-安装&quot;&gt;&lt;a href=&quot;#K8s-ingress-安装&quot; class=&quot;headerlink&quot; title=&quot;K8s-ingress-安装&quot;&gt;&lt;/a&gt;K8s-ingress-安装&lt;/h2&gt;&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
</feed>
