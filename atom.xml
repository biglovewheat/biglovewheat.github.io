<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2023-08-17T22:54:44.128Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>emqx安装</title>
    <link href="https://biglovewheat.gihub.io/2023/08/17/emqx%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2023/08/17/emqx%E5%AE%89%E8%A3%85/</id>
    <published>2023-08-16T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="emqx安装"><a href="#emqx安装" class="headerlink" title="emqx安装"></a>emqx安装</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><em>EMQX 是一款开源 (opens new window)的大规模分布式 MQTT 消息服务器，功能丰富，专为物联网和实时通信应用而设计。EMQX 5.0 单集群支持 MQTT 并发连接数高达 1 亿条，单服务器的传输与处理吞吐量可达每秒百万级 MQTT 消息，并保证延迟在亚毫秒级。</em></p><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p><em>centos7.9  emqx4.13</em></p><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p><a href="https://www.emqx.io/docs/zh/v4.3/">https://www.emqx.io/docs/zh/v4.3/</a></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 下载仓库</span></span><br><span class="line">curl -s https://assets.emqx.com/scripts/install-emqx-rpm.sh | sudo bash</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装指定版本</span></span><br><span class="line">yum list emqx --showduplicates</span><br><span class="line">yum install -y emqx.x86_64-4.3.15</span><br><span class="line"></span><br><span class="line"><span class="comment">## 开启启动和启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> emqx</span><br><span class="line">systemctl restart emqx</span><br></pre></td></tr></table></figure><h3 id="控制台和默认端口"><a href="#控制台和默认端口" class="headerlink" title="控制台和默认端口"></a>控制台和默认端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://10.77.114.178:18083/  admin/public</span><br><span class="line">mqtt:1883</span><br><span class="line">mqtts:8883</span><br></pre></td></tr></table></figure><h3 id="ssl证书生成脚本"><a href="#ssl证书生成脚本" class="headerlink" title="ssl证书生成脚本"></a>ssl证书生成脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; openssl.cnf</span></span><br><span class="line"><span class="string">[req]default_bits  = 2048</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions = req_ext</span></span><br><span class="line"><span class="string">x509_extensions = v3_req</span></span><br><span class="line"><span class="string">prompt = no</span></span><br><span class="line"><span class="string">[req_distinguished_name]</span></span><br><span class="line"><span class="string">countryName = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Zhejiang</span></span><br><span class="line"><span class="string">localityName = Hangzhou</span></span><br><span class="line"><span class="string">organizationName = EMQX</span></span><br><span class="line"><span class="string">commonName = CA</span></span><br><span class="line"><span class="string">[req_ext]</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string">[v3_req]</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">DNS.1 = *.unicultech.cn</span></span><br><span class="line"><span class="string">IP.2 = 120.224.237.21</span></span><br><span class="line"><span class="string">DNS.2 = 120.224.237.21</span></span><br><span class="line"><span class="string">IP.3 = 10.77.114.158</span></span><br><span class="line"><span class="string">DNS.3 = 10.77.114.158</span></span><br><span class="line"><span class="string">IP.4 = 10.77.114.178</span></span><br><span class="line"><span class="string">DNS.4 = 10.77.114.178</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">openssl genrsa -out ca.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key ca.key -sha256 -days 3650 -out ca.pem</span><br><span class="line">openssl genrsa -out emqx.key 2048</span><br><span class="line">openssl req -new -key ./emqx.key -config openssl.cnf -out emqx.csr</span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> ./emqx.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out emqx.pem -days 3650 -sha256 -extensions v3_req -extfile openssl.cnf</span><br><span class="line">openssl genrsa -out client.key 2048</span><br><span class="line">openssl req -new -key client.key -out client.csr -subj <span class="string">&quot;/C=CN/ST=Zhejiang/L=Hangzhou/O=EMQX/CN=client&quot;</span></span><br><span class="line">openssl x509 -req -days 3650 -<span class="keyword">in</span> client.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out client.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> ca.pem  cacert.pem</span><br><span class="line"><span class="built_in">mv</span> emqx.pem cert.pem</span><br><span class="line"><span class="built_in">mv</span> emqx.key key.pem</span><br></pre></td></tr></table></figure><h3 id="证书配置"><a href="#证书配置" class="headerlink" title="证书配置"></a>证书配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 将生成的证书替换掉/etc/emqx下的同名证书</span></span><br><span class="line">listener.ssl.external.keyfile = /etc/emqx/certs/key.pem</span><br><span class="line">listener.ssl.external.certfile = /etc/emqx/certs/cert.pem</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启emqx</span></span><br><span class="line">systemctl restart emqx</span><br><span class="line"></span><br><span class="line"><span class="comment">## 客户端配置3个证书即可链接</span></span><br><span class="line">cacert.pem</span><br><span class="line">client.pem</span><br><span class="line">client.key</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;emqx安装&quot;&gt;&lt;a href=&quot;#emqx安装&quot; class=&quot;headerlink&quot; title=&quot;emqx安装&quot;&gt;&lt;/a&gt;emqx安装&lt;/h2&gt;&lt;h3 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="中间件" scheme="https://biglovewheat.gihub.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="中间件" scheme="https://biglovewheat.gihub.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>Shell-输出多行</title>
    <link href="https://biglovewheat.gihub.io/2023/08/17/shell-cat%E8%BE%93%E5%87%BA%E5%A4%9A%E8%A1%8C/"/>
    <id>https://biglovewheat.gihub.io/2023/08/17/shell-cat%E8%BE%93%E5%87%BA%E5%A4%9A%E8%A1%8C/</id>
    <published>2023-08-16T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell-输出多行"><a href="#Shell-输出多行" class="headerlink" title="Shell-输出多行"></a>Shell-输出多行</h2><h3 id="并发执行"><a href="#并发执行" class="headerlink" title="并发执行"></a>并发执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; test.sh</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">#you Shell script writes here.</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell-输出多行&quot;&gt;&lt;a href=&quot;#Shell-输出多行&quot; class=&quot;headerlink&quot; title=&quot;Shell-输出多行&quot;&gt;&lt;/a&gt;Shell-输出多行&lt;/h2&gt;&lt;h3 id=&quot;并发执行&quot;&gt;&lt;a href=&quot;#并发执行&quot; class=&quot;head</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Prometheus-安装配置</title>
    <link href="https://biglovewheat.gihub.io/2023/08/14/prometheus-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/08/14/prometheus-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/</id>
    <published>2023-08-13T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prometheus-安装配置"><a href="#Prometheus-安装配置" class="headerlink" title="Prometheus-安装配置"></a>Prometheus-安装配置</h2><h3 id="supervisor安装"><a href="#supervisor安装" class="headerlink" title="supervisor安装"></a>supervisor安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y supervisor</span><br></pre></td></tr></table></figure><h3 id="各组件ini"><a href="#各组件ini" class="headerlink" title="各组件ini"></a>各组件ini</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; alertmanager.ini</span></span><br><span class="line"><span class="string">[program:alertmanager]</span></span><br><span class="line"><span class="string">command=/data/moni/alertmanager/alertmanager --web.listen-address=&quot;:9093&quot;</span></span><br><span class="line"><span class="string">directory=/data/moni/alertmanager        ; directory to cwd to before exec (def no cwd)</span></span><br><span class="line"><span class="string">umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="string">priority=999                  ; the relative start priority (default 999)</span></span><br><span class="line"><span class="string">autostart=true                ; start at supervisord start (default: true)</span></span><br><span class="line"><span class="string">autorestart=true              ; retstart at unexpected quit (default: true)</span></span><br><span class="line"><span class="string">startsecs=1                   ; number of secs prog must stay running (def. 1)</span></span><br><span class="line"><span class="string">startretries=3                ; max # of serial start failures (default 3)</span></span><br><span class="line"><span class="string">exitcodes=0,2                 ; &#x27;expected&#x27; exit codes for process (default 0,2)</span></span><br><span class="line"><span class="string">stopsignal=QUIT               ; signal used to kill process (default TERM)</span></span><br><span class="line"><span class="string">stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span></span><br><span class="line"><span class="string">user=root                     ; setuid to this UNIX account to run the program</span></span><br><span class="line"><span class="string">redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span></span><br><span class="line"><span class="string">stdout_logfile=/var/log/alertmanager/alertmanager.log        ; stdout log path, NONE for none; default AUTO</span></span><br><span class="line"><span class="string">stdout_logfile_maxbytes=50MB  ; max # logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line"><span class="string">stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span></span><br><span class="line"><span class="string">stdout_capture_maxbytes=1MB   ; number of bytes in &#x27;capturemode&#x27; (default 0)</span></span><br><span class="line"><span class="string">stdout_events_enabled=false   ; emit events on stdout writes (default false)</span></span><br><span class="line"><span class="string">environment=A=1,B=2           ; process environment additions (def no adds)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; consul.ini</span></span><br><span class="line"><span class="string">[program:consul]</span></span><br><span class="line"><span class="string">command=/data/moni/consul agent -dev -data-dir=/data/moni/consul-data -node=aws-base-01 -bind=10.77.114.153 -config-dir=/etc/consul.d -enable-script-checks=true -datacenter=hykj -ui -rejoin -client=0.0.0.0</span></span><br><span class="line"><span class="string">directory=/data/moni        ; directory to cwd to before exec (def no cwd)</span></span><br><span class="line"><span class="string">umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="string">priority=999                  ; the relative start priority (default 999)</span></span><br><span class="line"><span class="string">autostart=true                ; start at supervisord start (default: true)</span></span><br><span class="line"><span class="string">autorestart=true              ; retstart at unexpected quit (default: true)</span></span><br><span class="line"><span class="string">startsecs=1                   ; number of secs prog must stay running (def. 1)</span></span><br><span class="line"><span class="string">startretries=3                ; max # of serial start failures (default 3)</span></span><br><span class="line"><span class="string">exitcodes=0,2                 ; &#x27;expected&#x27; exit codes for process (default 0,2)</span></span><br><span class="line"><span class="string">stopsignal=QUIT               ; signal used to kill process (default TERM)</span></span><br><span class="line"><span class="string">stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span></span><br><span class="line"><span class="string">user=root                     ; setuid to this UNIX account to run the program</span></span><br><span class="line"><span class="string">redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span></span><br><span class="line"><span class="string">stdout_logfile=/var/log/consul/consul.log        ; stdout log path, NONE for none; default AUTO</span></span><br><span class="line"><span class="string">stdout_logfile_maxbytes=50MB  ; max # logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line"><span class="string">stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span></span><br><span class="line"><span class="string">stdout_capture_maxbytes=1MB   ; number of bytes in &#x27;capturemode&#x27; (default 0)</span></span><br><span class="line"><span class="string">stdout_events_enabled=false   ; emit events on stdout writes (default false)</span></span><br><span class="line"><span class="string">environment=A=1,B=2           ; process environment additions (def no adds)</span></span><br><span class="line"><span class="string">#serverurl=AUTO                ; override serverurl computation (childutils)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; dingtalk.ini</span></span><br><span class="line"><span class="string">[program:dingtalk]</span></span><br><span class="line"><span class="string">command=/data/moni/dingtalk/dingtalk --config.file=config.yml --web.listen-address=&quot;:8860&quot;</span></span><br><span class="line"><span class="string">directory=/data/moni/dingtalk    ; directory to cwd to before exec (def no cwd)</span></span><br><span class="line"><span class="string">umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="string">priority=999                  ; the relative start priority (default 999)</span></span><br><span class="line"><span class="string">autostart=false               ; start at supervisord start (default: true)</span></span><br><span class="line"><span class="string">autorestart=true              ; retstart at unexpected quit (default: true)</span></span><br><span class="line"><span class="string">startsecs=1                   ; number of secs prog must stay running (def. 1)</span></span><br><span class="line"><span class="string">startretries=3                ; max # of serial start failures (default 3)</span></span><br><span class="line"><span class="string">exitcodes=0,2                 ; &#x27;expected&#x27; exit codes for process (default 0,2)</span></span><br><span class="line"><span class="string">stopsignal=QUIT               ; signal used to kill process (default TERM)</span></span><br><span class="line"><span class="string">stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span></span><br><span class="line"><span class="string">user=root                     ; setuid to this UNIX account to run the program</span></span><br><span class="line"><span class="string">redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span></span><br><span class="line"><span class="string">stdout_logfile=/var/log/dingtalk/dingtalk.log ; stdout log path, NONE for none; default AUTO</span></span><br><span class="line"><span class="string">stdout_logfile_maxbytes=50MB  ; max # logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line"><span class="string">stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span></span><br><span class="line"><span class="string">stdout_capture_maxbytes=1MB   ; number of bytes in &#x27;capturemode&#x27; (default 0)</span></span><br><span class="line"><span class="string">stdout_events_enabled=false   ; emit events on stdout writes (default false)</span></span><br><span class="line"><span class="string">environment=A=1,B=2           ; process environment additions (def no adds)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; grafana.ini</span></span><br><span class="line"><span class="string">[program:grafana] </span></span><br><span class="line"><span class="string">command=/data/moni/grafana/bin/grafana-server -config /data/moni/grafana/conf/grafana.ini ; </span></span><br><span class="line"><span class="string">directory=/data/moni/grafana        ; directory to cwd to before exec (def no cwd)</span></span><br><span class="line"><span class="string">umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="string">priority=999                  ; the relative start priority (default 999)</span></span><br><span class="line"><span class="string">autostart=true                ; start at supervisord start (default: true)</span></span><br><span class="line"><span class="string">autorestart=true              ; retstart at unexpected quit (default: true)</span></span><br><span class="line"><span class="string">startsecs=1                   ; number of secs prog must stay running (def. 1)</span></span><br><span class="line"><span class="string">startretries=3                ; max # of serial start failures (default 3)</span></span><br><span class="line"><span class="string">exitcodes=0,2                 ; &#x27;expected&#x27; exit codes for process (default 0,2)</span></span><br><span class="line"><span class="string">stopsignal=QUIT               ; signal used to kill process (default TERM)</span></span><br><span class="line"><span class="string">stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span></span><br><span class="line"><span class="string">user=root                     ; setuid to this UNIX account to run the program</span></span><br><span class="line"><span class="string">redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span></span><br><span class="line"><span class="string">stdout_logfile=/var/log/grafana/grafana.log        ; stdout log path, NONE for none; default AUTO</span></span><br><span class="line"><span class="string">stdout_logfile_maxbytes=50MB  ; max # logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line"><span class="string">stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span></span><br><span class="line"><span class="string">stdout_capture_maxbytes=1MB   ; number of bytes in &#x27;capturemode&#x27; (default 0)</span></span><br><span class="line"><span class="string">stdout_events_enabled=false   ; emit events on stdout writes (default false)</span></span><br><span class="line"><span class="string">environment=A=1,B=2           ; process environment additions (def no adds)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; prometheus.ini</span></span><br><span class="line"><span class="string">[program:prometheus]</span></span><br><span class="line"><span class="string">command=/data/moni/prometheus/prometheus --storage.tsdb.retention.time=30d --storage.tsdb.path=&quot;/data/moni/prometheus/data&quot;</span></span><br><span class="line"><span class="string">directory=/data/moni/prometheus        ; directory to cwd to before exec (def no cwd)</span></span><br><span class="line"><span class="string">umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="string">priority=999                  ; the relative start priority (default 999)</span></span><br><span class="line"><span class="string">autostart=true                ; start at supervisord start (default: true)</span></span><br><span class="line"><span class="string">autorestart=true              ; retstart at unexpected quit (default: true)</span></span><br><span class="line"><span class="string">startsecs=1                   ; number of secs prog must stay running (def. 1)</span></span><br><span class="line"><span class="string">startretries=3                ; max # of serial start failures (default 3)</span></span><br><span class="line"><span class="string">exitcodes=0,2                 ; &#x27;expected&#x27; exit codes for process (default 0,2)</span></span><br><span class="line"><span class="string">stopsignal=QUIT               ; signal used to kill process (default TERM)</span></span><br><span class="line"><span class="string">stopwaitsecs=10               ; max num secs to wait b4 SIGKILL (default 10)</span></span><br><span class="line"><span class="string">user=root                     ; setuid to this UNIX account to run the program</span></span><br><span class="line"><span class="string">redirect_stderr=true          ; redirect proc stderr to stdout (default false)</span></span><br><span class="line"><span class="string">stdout_logfile=/var/log/prometheus/prometheus.log        ; stdout log path, NONE for none; default AUTO</span></span><br><span class="line"><span class="string">stdout_logfile_maxbytes=50MB  ; max # logfile bytes b4 rotation (default 50MB)</span></span><br><span class="line"><span class="string">stdout_logfile_backups=10     ; # of stdout logfile backups (default 10)</span></span><br><span class="line"><span class="string">stdout_capture_maxbytes=1MB   ; number of bytes in &#x27;capturemode&#x27; (default 0)</span></span><br><span class="line"><span class="string">stdout_events_enabled=false   ; emit events on stdout writes (default false)</span></span><br><span class="line"><span class="string">environment=A=1,B=2           ; process environment additions (def no adds)</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="supervisor启动"><a href="#supervisor启动" class="headerlink" title="supervisor启动"></a>supervisor启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /var/log/&#123;alertmanager,consul,prometheus,dingtalk,grafana&#125;</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/consul.d</span><br><span class="line"><span class="built_in">cp</span> *.ini /etc/supervisord.d/</span><br><span class="line"><span class="built_in">cp</span> supervisord.conf /etc</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> supervisord</span><br><span class="line">systemctl restart supervisord</span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 2</span><br><span class="line">supervisorctl status </span><br></pre></td></tr></table></figure><h3 id="prometheus配置"><a href="#prometheus配置" class="headerlink" title="prometheus配置"></a>prometheus配置</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  scrape_interval: 15s </span><br><span class="line">  evaluation_interval: 15s </span><br><span class="line"></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">  - static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">      - &quot;localhost:9093&quot;</span><br><span class="line"></span><br><span class="line">rule_files:</span><br><span class="line">     - &quot;/data/moni/prometheus/rules/*&quot;</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &quot;prometheus&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: <span class="section">[&quot;localhost:9090&quot;]</span></span><br><span class="line"></span><br><span class="line">  - job_name: &quot;alertmanager&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">    - targets: <span class="section">[&quot;localhost:9093&quot;]</span></span><br><span class="line"></span><br><span class="line">  - job_name: &quot;doris_job&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: <span class="section">[&#x27;hy-bigdata-01:18030&#x27;, &#x27;hy-bigdata-02:18030&#x27;, &#x27;hy-bigdata-03:18030&#x27;]</span></span><br><span class="line">        labels:</span><br><span class="line">          group: fe</span><br><span class="line"></span><br><span class="line">      - targets: <span class="section">[&#x27;hy-bigdata-01:18040&#x27;, &#x27;hy-bigdata-02:18040&#x27;, &#x27;hy-bigdata-03:18040&#x27;]</span></span><br><span class="line">        labels:</span><br><span class="line">          group: be</span><br><span class="line"></span><br><span class="line"><span class="comment">#  - job_name: &quot;pushgateway&quot;</span></span><br><span class="line"><span class="comment">#    honor_labels: true</span></span><br><span class="line"><span class="comment">#    static_configs:</span></span><br><span class="line"><span class="comment">#    - targets: [&#x27;10.9.127.245:9091&#x27;]</span></span><br><span class="line"><span class="comment">#      labels:</span></span><br><span class="line"><span class="comment">#        instance: pushgateway</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#  - job_name: &quot;java_jvm&quot;</span></span><br><span class="line"><span class="comment">#    static_configs:</span></span><br><span class="line"><span class="comment">#      - targets: [&#x27;10.9.127.245:8848&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  - job_name: &quot;java-jmx-monitor&quot;</span></span><br><span class="line"><span class="comment">#    static_configs:</span></span><br><span class="line"><span class="comment">#      - targets: [&#x27;10.249.2.51:3010&#x27;]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  - job_name: &quot;davinci_monitor&quot;</span></span><br><span class="line"><span class="comment">#    metrics_path: /prometheus </span></span><br><span class="line"><span class="comment">#    static_configs: </span></span><br><span class="line"><span class="comment">#      - targets: [&#x27;10.249.2.50:14399&#x27;]</span></span><br><span class="line"></span><br><span class="line">  - job_name: &#x27;consul_sd_node_exporter&#x27;</span><br><span class="line">    metrics_path: /metrics</span><br><span class="line">    honor_labels: false</span><br><span class="line">    consul_sd_configs:</span><br><span class="line">      - server: &#x27;localhost:8500&#x27;</span><br><span class="line">        scheme: http</span><br><span class="line">        services: <span class="section">[&#x27;node_exporter&#x27;]</span></span><br><span class="line">    relabel_configs:                        <span class="comment">#根据实际监控所需添加label，并在注册时注册</span></span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_bzl&#x27;]</span>   <span class="comment"># datacenter，会显示注册到的consul的datacenter</span></span><br><span class="line">      target_label: &#x27;bgy&#x27;</span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_service_address&#x27;]</span></span><br><span class="line">      target_label: &#x27;host&#x27;</span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_service_metadata_hostname&#x27;]</span></span><br><span class="line">      target_label: &#x27;hostname&#x27;</span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_service_metadata_business&#x27;]</span></span><br><span class="line">      target_label: &#x27;business&#x27;</span><br><span class="line"></span><br><span class="line">  - job_name: &#x27;sa_process_exporter&#x27;</span><br><span class="line">    scrape_interval: 10s</span><br><span class="line">    honor_labels: false</span><br><span class="line">    consul_sd_configs:</span><br><span class="line">      - server: &#x27;localhost:8500&#x27;</span><br><span class="line">        scheme: http</span><br><span class="line">        services: <span class="section">[&#x27;process_exporter&#x27;]</span></span><br><span class="line">    relabel_configs:</span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_service_address&#x27;]</span></span><br><span class="line">      target_label: &#x27;host&#x27;</span><br><span class="line">    - source_labels: <span class="section">[&#x27;__meta_consul_service_metadata_hostname&#x27;]</span></span><br><span class="line">      target_label: &#x27;hostname&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="告警配置"><a href="#告警配置" class="headerlink" title="告警配置"></a>告警配置</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">groups:</span><br><span class="line">- name: defaultStatsAlert</span><br><span class="line">  rules:</span><br><span class="line">  - alert: cpuUsageAlert</span><br><span class="line">    expr: (100 - (avg by (instance,hostname,hosttype,responsibility)(irate(node_cpu_seconds_total&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[<span class="number">3</span>m])) * <span class="number">100</span>)) &gt; <span class="number">95</span></span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops </span><br><span class="line"><span class="comment">#    labels:</span></span><br><span class="line"><span class="comment">#      severity: page</span></span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;&#123;&#123; $labels.host &#125;&#125; CPU usgae high&quot;</span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; CPU usage above 95% (current value: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">  - alert: cpuIOwaitAlert    </span><br><span class="line">    expr: (avg by (hostname,instance,hosttype,responsibility)(irate(node_cpu_seconds_total&#123;<span class="attr">business</span>=~<span class="string">&#x27;bzl|aws|hy&#x27;</span>,job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>,mode=<span class="string">&quot;iowait&quot;</span>&#125;[<span class="number">3</span>m])) * <span class="number">100</span>) &gt; <span class="number">45</span></span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;&#123;&#123; $labels.instance &#125;&#125; CPU iowait high&quot;</span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; CPU iowait above 45% (current value: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">  - alert: sysLoadAlert</span><br><span class="line">    expr: sum by(hostname, instance,business,hosttype,responsibility) (node_load5&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;) / count by(hostname, instance,business,hosttype,responsibility) (count by(cpu, hostname, instance,business,hosttype,responsibility) (node_cpu_seconds_total&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;)) &gt; <span class="number">3.85</span> </span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">    <span class="comment">#  summary: &quot;&#123;&#123; $labels.instance &#125;&#125; CPU usgae high&quot;</span></span><br><span class="line">      <span class="comment">#description: &quot;&#123;&#123; $labels.host &#125;&#125; CPU load1m is greater than cpu core number for 1min(current value: &#123;&#123; $value &#125;&#125;)&quot;</span></span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; CPU load5m is greater than cpu core number(current value: cpu 核数的&#123;&#123; $value &#125;&#125;倍 )&quot;</span><br><span class="line"></span><br><span class="line">  - alert: sys-time-Alert    </span><br><span class="line">    expr: time() - node_time_seconds&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125; &gt; <span class="number">125</span></span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; system time is inconsistent (current value: &#123;&#123; $value &#125;&#125;s)&quot;</span><br><span class="line">  - alert: sys-time-Alert1    </span><br><span class="line">    expr: time() - node_time_seconds&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125; &lt; -<span class="number">125</span> </span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; system time is inconsistent (current value: &#123;&#123; $value &#125;&#125;s)&quot;</span><br><span class="line"></span><br><span class="line">  - alert: memUsageAlert</span><br><span class="line">    <span class="comment">#expr: ((node_memory_MemTotal_bytes&#123;job=&quot;consul_sd_node_exporter&quot;&#125; - (node_memory_MemAvailable_bytes&#123;job=&quot;consul_sd_node_exporter&quot;&#125;))/node_memory_MemTotal_bytes&#123;job=&quot;consul_sd_node_exporter&quot;&#125;) * 100 &gt; 90</span></span><br><span class="line">    expr: ((node_memory_MemTotal_bytes&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125; - (node_memory_MemFree_bytes&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;+node_memory_Buffers_bytes&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;+node_memory_Cached_bytes&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;+node_memory_SReclaimable_bytes&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;))/node_memory_MemTotal_bytes&#123;job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;) * <span class="number">100</span> &gt; <span class="number">95</span></span><br><span class="line">    for: 15m</span><br><span class="line">    labels:</span><br><span class="line">      team: mem</span><br><span class="line">      organization: ops</span><br><span class="line"><span class="comment">#    labels:</span></span><br><span class="line"><span class="comment">#      severity: page</span></span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;&#123;&#123; $labels.host &#125;&#125; MEM usgae high&quot;</span><br><span class="line">      description: &quot;&#123;&#123; $labels.host &#125;&#125; MEM usage above 95% (current value: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line"></span><br><span class="line">  - alert: NodeDown</span><br><span class="line">    expr: up&#123;<span class="attr">job</span>=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125; == <span class="number">0</span></span><br><span class="line">    for: 5m</span><br><span class="line">    labels:</span><br><span class="line">      team: down</span><br><span class="line">      organization: ops</span><br><span class="line"><span class="comment">#    labels:   可以使用这个label在altermanager中配置match分组</span></span><br><span class="line"><span class="comment">#      team: node</span></span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123; $labels.host&#125;&#125; has been down for 5m&#x27;</span><br><span class="line"></span><br><span class="line">  - alert: disk_utilization_rate</span><br><span class="line">    expr: 100 - ((node_filesystem_avail_bytes&#123;<span class="attr">business</span>=~<span class="string">&#x27;bzl|aws|hy&#x27;</span>,fstype!~<span class="string">&quot;rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|fuse.lxcfs|iso9660&quot;</span>,mountpoint!~<span class="string">&quot;/boot&quot;</span>,job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125; * <span class="number">100</span>) / node_filesystem_size_bytes &#123;business=~<span class="string">&#x27;bzl|aws|hy&#x27;</span>,fstype!~<span class="string">&quot;rootfs|selinuxfs|autofs|rpc_pipefs|tmpfs|fuse.lxcfs|iso9660&quot;</span>,mountpoint!~<span class="string">&quot;/boot&quot;</span>,job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;) &gt; <span class="number">80</span></span><br><span class="line">    for: 10m</span><br><span class="line">    labels:</span><br><span class="line">      team: disk</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.host&#125;&#125; &#123;&#123;$labels.mountpoint&#125;&#125; excess 90% --&gt; &#123;&#123;$value&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">  - alert: network_receive_bytes</span><br><span class="line">    expr: irate(node_network_receive_bytes_total&#123;<span class="attr">business</span>=~<span class="string">&#x27;bzl|aws|hy&#x27;</span>,device!~<span class="string">&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*|eth*|eno*&#x27;</span>,job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;[<span class="number">15</span>m])*<span class="number">8</span>/<span class="number">1024</span>/<span class="number">1024</span> &gt; <span class="number">1000</span></span><br><span class="line">    for: 5m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.host&#125;&#125; network receive bytes reach to &#123;&#123;$value&#125;&#125; MB/s&#x27;</span><br><span class="line"></span><br><span class="line">  - alert: network_transmit_bytes</span><br><span class="line">    expr: irate(node_network_transmit_bytes_total&#123;<span class="attr">business</span>=~<span class="string">&#x27;bzl|aws|hy&#x27;</span>,device!~<span class="string">&#x27;tap.*|veth.*|br.*|docker.*|virbr*|lo*|eth*|eno*&#x27;</span>,job=<span class="string">&quot;consul_sd_node_exporter&quot;</span>&#125;[<span class="number">15</span>m])*<span class="number">8</span>/<span class="number">1024</span>/<span class="number">1024</span> &gt; <span class="number">1000</span></span><br><span class="line">    for: 5m</span><br><span class="line">    labels:</span><br><span class="line">      team: node</span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.host&#125;&#125; network transmit bytes reach to &#123;&#123;$value&#125;&#125; MB/s&#x27;</span><br><span class="line"></span><br><span class="line">  - alert: frame-alert</span><br><span class="line">    expr: node_network_receive_frame_total&#123;device!~&quot;tap.*|veth.*|br.*|docker.*|virbr*|lo*&quot;&#125; - min_over_time(node_network_receive_frame_total&#123;device!~&quot;tap.*|veth.*|br.*|docker.*|virbr*|lo*&quot;&#125;<span class="section">[1h]</span>) &gt;= 5 </span><br><span class="line">    for: 10s</span><br><span class="line">    labels:</span><br><span class="line">      team: node </span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.host&#125;&#125; network frame growth &#123;&#123;$value&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">  - alert: time_zone-alert</span><br><span class="line">    expr: time_zone&#123;tz!=&quot;CST&quot;&#125; == 0 </span><br><span class="line">    for: 10s</span><br><span class="line">    labels:</span><br><span class="line">      team: node </span><br><span class="line">      organization: ops</span><br><span class="line">    annotations:</span><br><span class="line">      description: &#x27;&#123;&#123;$labels.host&#125;&#125; time zone is not CST&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  - alert: doris_node-alert</span></span><br><span class="line"><span class="comment">#    expr: sum(up&#123;job=~&quot;doris_job|davinci_monitor&quot;&#125;) by (group,job,instance) &lt; 1</span></span><br><span class="line"><span class="comment">#    for: 10s</span></span><br><span class="line"><span class="comment">#    labels:</span></span><br><span class="line"><span class="comment">#      team: node</span></span><br><span class="line"><span class="comment">#      organization: bigdata</span></span><br><span class="line"><span class="comment">#    annotations:</span></span><br><span class="line"><span class="comment">#      description: &#x27;&#123;&#123;$labels.job&#125;&#125; &#123;&#123;$labels.group&#125;&#125; 的节点&#123;&#123;$labels.instance&#125;&#125; 发生异常!!!!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">groups:</span><br><span class="line">  - name: rocketmq-delay</span><br><span class="line">    rules:</span><br><span class="line">      - alert: rocketmq-delay warning1</span><br><span class="line">        expr: rocketmq_group_diff&#123;<span class="attr">topic</span>=<span class="string">&quot;machine_work_log&quot;</span>,group=<span class="string">&quot;machine_work_log_roketmq2doris&quot;</span>&#125; &gt;<span class="number">2000</span></span><br><span class="line">        for: 20s</span><br><span class="line">        labels:</span><br><span class="line">          group: bigdata</span><br><span class="line">          severity: bigdata</span><br><span class="line">        annotations:</span><br><span class="line">          description: Topic：&#123;&#123;$labels.topic&#125;&#125; , Group：&#123;&#123;$labels.group&#125;&#125; 出现积压，积压量为：&#123;&#123;$value&#125;&#125;</span><br><span class="line">      - alert: rocketmq-delay warning2</span><br><span class="line">        expr: rocketmq_group_diff&#123;<span class="attr">topic</span>=<span class="string">&quot;pro_canal_producer&quot;</span>,group=<span class="string">&quot;pro_canal_producer_roketmq2doris&quot;</span>&#125; &gt;<span class="number">10</span></span><br><span class="line">        for: 20s</span><br><span class="line">        labels:</span><br><span class="line">          group: bigdata</span><br><span class="line">          severity: bigdata</span><br><span class="line">        annotations:</span><br><span class="line">          description: Topic：&#123;&#123;$labels.topic&#125;&#125; , Group：&#123;&#123;$labels.group&#125;&#125; 出现积压，积压量为：&#123;&#123;$value&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">groups:</span><br><span class="line">  - name: doris_instance_down</span><br><span class="line">    rules:</span><br><span class="line">      - alert: Doris Backends Down</span><br><span class="line">        expr: up &#123;<span class="attr">group</span>=<span class="string">&quot;be&quot;</span>, job=<span class="string">&quot;doris_job&quot;</span>&#125; == <span class="number">0</span></span><br><span class="line">        for: 20s</span><br><span class="line">        labels:</span><br><span class="line">          user: doris</span><br><span class="line">          severity: bigdata</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;doris Instance &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class="line">          description: &quot;doris &#123;&#123; $labels.instance &#125;&#125; of job &#123;&#123; $labels.job &#125;&#125; has been down for more than 20s.&quot;</span><br><span class="line">      - alert: Doris Frontends Down</span><br><span class="line">        expr: up &#123;<span class="attr">group</span>=<span class="string">&quot;fe&quot;</span>, job=<span class="string">&quot;doris_job&quot;</span>&#125; == <span class="number">0</span></span><br><span class="line">        for: 20s</span><br><span class="line">        labels:</span><br><span class="line">          user: doris</span><br><span class="line">          severity: bigdata</span><br><span class="line">        annotations:</span><br><span class="line">          summary: &quot;doris Instance &#123;&#123; $labels.instance &#125;&#125; down&quot;</span><br><span class="line">          description: &quot;doris &#123;&#123; $labels.instance &#125;&#125; of job &#123;&#123; $labels.job &#125;&#125; has been down for more than 20s.&quot;</span><br></pre></td></tr></table></figure><h3 id="alertmanage配置"><a href="#alertmanage配置" class="headerlink" title="alertmanage配置"></a>alertmanage配置</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">global: </span><br><span class="line">  resolve_timeout: 5m <span class="comment">#处理超时时间，默认为5min</span></span><br><span class="line">  smtp_smarthost: &#x27;smtp.139.com:465&#x27; <span class="comment"># 邮箱smtp服务器代理</span></span><br><span class="line">  smtp_from: &#x27;xxxxxx@139.com&#x27; <span class="comment"># 发送邮箱名称</span></span><br><span class="line">  smtp_auth_username: &#x27;xxxxx@139.com&#x27; <span class="comment"># 邮箱名称</span></span><br><span class="line">  smtp_auth_password: &#x27;xxxxxxxxx&#x27; <span class="comment"># 邮箱密码或授权码</span></span><br><span class="line">  smtp_require_tls: false</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义模板信心</span></span><br><span class="line">templates:</span><br><span class="line">  - &#x27;/opt/alertmanager/templates/*&#x27;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义路由树信息</span></span><br><span class="line">route:</span><br><span class="line">  receiver: &#x27;ops&#x27; <span class="comment"># 发送警报的接收者的名称，以下receivers name的名称</span></span><br><span class="line">  group_by: <span class="section">[&#x27;alertname&#x27;]</span> <span class="comment"># 报警分组依据</span></span><br><span class="line">  group_wait: 1s <span class="comment"># 最初即第一次等待多久时间发送一组警报的通知</span></span><br><span class="line">  group_interval: 10s <span class="comment"># 在发送新警报前的等待时间</span></span><br><span class="line">  repeat_interval: 1h <span class="comment"># 发送重复警报的周期 对于email配置中，此项不可以设置过低，否则将会由于邮件发送太多频繁，被smtp服务器拒绝</span></span><br><span class="line">  routes:</span><br><span class="line">  - receiver: &#x27;bigdata&#x27;</span><br><span class="line">    group_wait: 10s</span><br><span class="line">    match_re:</span><br><span class="line">       severity: bigdata</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 定义警报接收者信息</span></span><br><span class="line">receivers:</span><br><span class="line">  - name: &#x27;ops&#x27; <span class="comment"># 警报</span></span><br><span class="line"><span class="comment">#    email_configs: # 邮箱配置</span></span><br><span class="line"><span class="comment">#    - to: &#x27;chenyuhua37@countrygarden.com.cn,luminfeng01@countrygarden.com.cn,liangwenjun04@countrygarden.com.cn,maiqixian@countrygarden.com.cn,15121486557@163.com&#x27;  # 接收警报的email配置</span></span><br><span class="line"><span class="comment">#      send_resolved: true</span></span><br><span class="line"><span class="comment">#      headers:</span></span><br><span class="line"><span class="comment">#        subject: &quot;AWS-Prometheus报警邮件&quot;</span></span><br><span class="line"><span class="comment">#        from : &quot;Prometheus监控告警&quot;</span></span><br><span class="line"><span class="comment">#        to: &quot;You,Please pay attention!!!&quot;</span></span><br><span class="line">    webhook_configs:</span><br><span class="line">    - url: &#x27;http://localhost:8860/dingtalk/webhook1/send&#x27; </span><br><span class="line">      send_resolved: true</span><br><span class="line">  - name: &#x27;bigdata&#x27;</span><br><span class="line">    webhook_configs:</span><br><span class="line"><span class="comment">#    - url: &#x27;http://localhost:18060/dingtalk/webhook_bigdata/send&#x27;</span></span><br><span class="line">    - url: &#x27;http://localhost:8860/dingtalk/webhook1/send&#x27; </span><br><span class="line">      send_resolved: true</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个inhibition规则是在与另一组匹配器匹配的警报存在的条件下，使匹配一组匹配器的警报失效的规则。两个警报必须具有一组相同的标签。 </span></span><br><span class="line">inhibit_rules: </span><br><span class="line">  - source_match: </span><br><span class="line">     severity: &#x27;critical&#x27; </span><br><span class="line">    target_match: </span><br><span class="line">     severity: &#x27;warning&#x27; </span><br><span class="line">    equal: <span class="section">[&#x27;alertname&#x27;, &#x27;dev&#x27;, &#x27;instance&#x27;]</span></span><br></pre></td></tr></table></figure><h3 id="钉钉配置"><a href="#钉钉配置" class="headerlink" title="钉钉配置"></a>钉钉配置</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">templates:</span><br><span class="line">   - dingding.tmpl</span><br><span class="line"></span><br><span class="line">targets:</span><br><span class="line">  webhook1:</span><br><span class="line">    url: https://oapi.dingtalk.com/robot/send?<span class="attr">access_token</span>=<span class="number">8</span>cd8f7502c148fa63a7ad9e424731f83022841eab80c81d476e8000f36d5143a</span><br><span class="line">    <span class="comment"># secret for signature</span></span><br><span class="line">    secret: SEC000000000000000000000</span><br><span class="line">  webhook2:</span><br><span class="line">          url: https://oapi.dingtalk.com/robot/send?<span class="attr">access_token</span>=<span class="number">8</span>cd8f7502c148fa63a7ad9e424731f83022841eab80c81d476e8000f36d5143a</span><br><span class="line">  webhook_legacy:</span><br><span class="line">          url: https://oapi.dingtalk.com/robot/send?<span class="attr">access_token</span>=<span class="number">8</span>cd8f7502c148fa63a7ad9e424731f83022841eab80c81d476e8000f36d5143a</span><br><span class="line">  bigdta_webhook:</span><br><span class="line">          url: https://oapi.dingtalk.com/robot/send?<span class="attr">access_token</span>=<span class="number">8</span>cd8f7502c148fa63a7ad9e424731f83022841eab80c81d476e8000f36d5143a</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Prometheus-安装配置&quot;&gt;&lt;a href=&quot;#Prometheus-安装配置&quot; class=&quot;headerlink&quot; title=&quot;Prometheus-安装配置&quot;&gt;&lt;/a&gt;Prometheus-安装配置&lt;/h2&gt;&lt;h3 id=&quot;supervisor安装&quot;</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="prometheus" scheme="https://biglovewheat.gihub.io/tags/prometheus/"/>
    
  </entry>
  
  <entry>
    <title>Linux-Centos7-升级内核</title>
    <link href="https://biglovewheat.gihub.io/2023/08/07/linux-centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/"/>
    <id>https://biglovewheat.gihub.io/2023/08/07/linux-centos7-%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8/</id>
    <published>2023-08-06T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-Centos7-升级内核"><a href="#Linux-Centos7-升级内核" class="headerlink" title="Linux-Centos7-升级内核"></a>Linux-Centos7-升级内核</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看当前内核</span></span><br><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装epel仓库</span></span><br><span class="line">yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装最新长期支持内核</span></span><br><span class="line">yum --enablerepo=elrepo-kernel install kernel-lt-devel kernel-lt -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 设置默认启动内核</span></span><br><span class="line">awk -F\<span class="string">&#x27; &#x27;</span><span class="variable">$1</span>==<span class="string">&quot;menuentry &quot;</span> &#123;<span class="built_in">print</span> i++ <span class="string">&quot; &quot;</span><span class="variable">$2</span>&#125;<span class="string">&#x27; /etc/grub2.cfg</span></span><br><span class="line"><span class="string">grub2-set-default 0</span></span><br><span class="line"><span class="string">grub2-mkconfig -o /boot/grub2/grub.cfg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 重启操作系统</span></span><br><span class="line"><span class="string">reboot</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 再次查看内核</span></span><br><span class="line"><span class="string">uname -r</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-Centos7-升级内核&quot;&gt;&lt;a href=&quot;#Linux-Centos7-升级内核&quot; class=&quot;headerlink&quot; title=&quot;Linux-Centos7-升级内核&quot;&gt;&lt;/a&gt;Linux-Centos7-升级内核&lt;/h2&gt;&lt;figure c</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux-sed替换</title>
    <link href="https://biglovewheat.gihub.io/2023/08/07/linux-sed%E6%9B%BF%E6%8D%A2/"/>
    <id>https://biglovewheat.gihub.io/2023/08/07/linux-sed%E6%9B%BF%E6%8D%A2/</id>
    <published>2023-08-06T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-sed替换"><a href="#Linux-sed替换" class="headerlink" title="Linux-sed替换"></a>Linux-sed替换</h2><h3 id="使用竖线方式替换包含特殊字符的文本"><a href="#使用竖线方式替换包含特殊字符的文本" class="headerlink" title="使用竖线方式替换包含特殊字符的文本"></a>使用竖线方式替换包含特殊字符的文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s|161.189.150.102:9876|mq.farmbgy.net:9876|g&#x27;</span> *</span><br><span class="line">sed -i <span class="string">&#x27;s|172.31.40.27:9876|mq.farmbgy.net:9876|g&#x27;</span> *</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-sed替换&quot;&gt;&lt;a href=&quot;#Linux-sed替换&quot; class=&quot;headerlink&quot; title=&quot;Linux-sed替换&quot;&gt;&lt;/a&gt;Linux-sed替换&lt;/h2&gt;&lt;h3 id=&quot;使用竖线方式替换包含特殊字符的文本&quot;&gt;&lt;a href=&quot;#</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Keepalived出现双ip问题</title>
    <link href="https://biglovewheat.gihub.io/2023/08/07/lvs-keepalived%E5%87%BA%E7%8E%B0%E5%8F%8Cip%E9%97%AE%E9%A2%98/"/>
    <id>https://biglovewheat.gihub.io/2023/08/07/lvs-keepalived%E5%87%BA%E7%8E%B0%E5%8F%8Cip%E9%97%AE%E9%A2%98/</id>
    <published>2023-08-06T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Keepalived出现双ip问题"><a href="#Keepalived出现双ip问题" class="headerlink" title="Keepalived出现双ip问题"></a>Keepalived出现双ip问题</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>可能是上联交换机禁用了arp的广播限制，造成keepalive无法通过广播通信，两台服务器抢占vip，出现同时都有vip的情况</p><h3 id="解决过程"><a href="#解决过程" class="headerlink" title="解决过程"></a>解决过程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 主机，发现向224.0.0.18发送消息</span></span><br><span class="line">tcpdump -i eth0 vrrp -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 备机，也在向224.0.0.18发送消息，正常情况下，备节点如果收到主节点的心跳消息时，优先级高于自己，就不会主动对外发送消息</span></span><br><span class="line">tcpdump -i eth0 vrrp -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 原因：上联交换机禁用了arp的广播限制，造成keepalive无法通过广播通信，两台服务器抢占vip，出现同时都有vip的情况</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 解决办法：多播改为单播，重启keepalived</span></span><br></pre></td></tr></table></figure><h3 id="主机配置"><a href="#主机配置" class="headerlink" title="主机配置"></a>主机配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">  router_id NGINX</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 17</span><br><span class="line"><span class="comment">#多播    mcast_src_ip 10.77.114.150</span></span><br><span class="line">    unicast_src_ip 10.77.114.150</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">    10.77.114.151 <span class="comment">#指向对方主机IP 如果有多个keepalived,再下面加其它节点的IP</span></span><br><span class="line">    &#125;</span><br><span class="line">    priority 150</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass hykj</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.77.114.130</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="备机配置"><a href="#备机配置" class="headerlink" title="备机配置"></a>备机配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line"></span><br><span class="line">global_defs &#123;</span><br><span class="line">   router_id NGINX</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 17</span><br><span class="line"><span class="comment">#多播    mcast_src_ip 10.77.114.151</span></span><br><span class="line">    unicast_src_ip 10.77.114.151</span><br><span class="line">    unicast_peer &#123;</span><br><span class="line">        10.77.114.150</span><br><span class="line">    &#125;</span><br><span class="line">    priority 99</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass hykj</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        10.77.114.130</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="keepalived-安装"><a href="#keepalived-安装" class="headerlink" title="keepalived 安装"></a>keepalived 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y keepalived</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Keepalived出现双ip问题&quot;&gt;&lt;a href=&quot;#Keepalived出现双ip问题&quot; class=&quot;headerlink&quot; title=&quot;Keepalived出现双ip问题&quot;&gt;&lt;/a&gt;Keepalived出现双ip问题&lt;/h2&gt;&lt;h3 id=&quot;问题&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>GitLab-修改IP</title>
    <link href="https://biglovewheat.gihub.io/2023/06/28/gitlab-%E4%BF%AE%E6%94%B9IP/"/>
    <id>https://biglovewheat.gihub.io/2023/06/28/gitlab-%E4%BF%AE%E6%94%B9IP/</id>
    <published>2023-06-27T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="GitLab-修改IP"><a href="#GitLab-修改IP" class="headerlink" title="GitLab-修改IP"></a>GitLab-修改IP</h2><p><em>机器IP变了，需要重新修改IP</em></p><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 停止gitlab</span></span><br><span class="line">gitlab-ctl stop</span><br><span class="line"></span><br><span class="line">vi /etc/gitlab/gitlab.rb</span><br><span class="line"><span class="comment">## 修改为正确的IP、域名、或端口 ##</span></span><br><span class="line">external_url <span class="string">&#x27;http://10.77.114.100:8690&#x27;</span></span><br><span class="line">nginx[<span class="string">&#x27;listen_port&#x27;</span>] = 8690</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重新配置并启动gitlab</span></span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-ctl start</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;GitLab-修改IP&quot;&gt;&lt;a href=&quot;#GitLab-修改IP&quot; class=&quot;headerlink&quot; title=&quot;GitLab-修改IP&quot;&gt;&lt;/a&gt;GitLab-修改IP&lt;/h2&gt;&lt;p&gt;&lt;em&gt;机器IP变了，需要重新修改IP&lt;/em&gt;&lt;/p&gt;
&lt;h3 i</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>GitLab-初始化root密码</title>
    <link href="https://biglovewheat.gihub.io/2023/06/28/gitlab-%E5%88%9D%E5%A7%8B%E5%8C%96root%E5%AF%86%E7%A0%81/"/>
    <id>https://biglovewheat.gihub.io/2023/06/28/gitlab-%E5%88%9D%E5%A7%8B%E5%8C%96root%E5%AF%86%E7%A0%81/</id>
    <published>2023-06-27T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="GitLab-初始化root密码"><a href="#GitLab-初始化root密码" class="headerlink" title="GitLab-初始化root密码"></a>GitLab-初始化root密码</h2><p><em>忘记gitlab root密码，但能登录gitlab主机，可以通过此方法更改root密码</em></p><h3 id="适用版本"><a href="#适用版本" class="headerlink" title="适用版本"></a>适用版本</h3><p>13.* &#x2F; 14.*</p><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/gitlab/bin</span><br><span class="line">gitlab-rails console</span><br><span class="line"></span><br><span class="line">u=User.<span class="built_in">where</span>(<span class="built_in">id</span>:1).first</span><br><span class="line">=&gt; <span class="comment">#&lt;User id:1 @root&gt;</span></span><br><span class="line">u.password=<span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">=&gt; <span class="string">&quot;12345678&quot;</span></span><br><span class="line">u.password_confirmation=<span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">=&gt; <span class="string">&quot;12345678&quot;</span></span><br><span class="line">u.save!</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改完后重启动即可</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;GitLab-初始化root密码&quot;&gt;&lt;a href=&quot;#GitLab-初始化root密码&quot; class=&quot;headerlink&quot; title=&quot;GitLab-初始化root密码&quot;&gt;&lt;/a&gt;GitLab-初始化root密码&lt;/h2&gt;&lt;p&gt;&lt;em&gt;忘记gitlab r</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>centos7安装python3.10</title>
    <link href="https://biglovewheat.gihub.io/2023/06/13/centos7%E5%AE%89%E8%A3%85python3.10/"/>
    <id>https://biglovewheat.gihub.io/2023/06/13/centos7%E5%AE%89%E8%A3%85python3.10/</id>
    <published>2023-06-12T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centos7安装python3-10"><a href="#centos7安装python3-10" class="headerlink" title="centos7安装python3.10"></a>centos7安装python3.10</h2><h3 id="遇到问题"><a href="#遇到问题" class="headerlink" title="遇到问题"></a>遇到问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING: pip is configured with locations that require TLS/SSL, however the ssl module <span class="keyword">in</span> Python is not available.</span><br></pre></td></tr></table></figure><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">由于python3.10之后版本不在支持libressl使用ssl，需要使用openssl安装来解决编译安装</span><br><span class="line">python时候遇到的ssl模块导入失败的问题，这里需要用的openssl1.1.1版本或者更高版本</span><br></pre></td></tr></table></figure><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装openssl</span></span><br><span class="line">wget https://www.openssl.org/source/openssl-1.1.1t.tar.gz --no-check-certificate</span><br><span class="line">./config --prefix=/usr/local/openssl-1.1.1t</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装python</span></span><br><span class="line">wget https://registry.npmmirror.com/-/binary/python/3.10.11/Python-3.10.11.tgz</span><br><span class="line">./configure --prefix=/usr/local/python3  --with-openssl=/usr/local/openssl-1.1.1t</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">ln</span> -sf /usr/local/python3/bin/python3 /usr/bin/python3</span><br><span class="line"><span class="built_in">ln</span> -sf /usr/local/python3/bin/pip3 /usr/bin/pip3</span><br><span class="line"></span><br><span class="line"><span class="comment">## 升级pip</span></span><br><span class="line">python3 -m pip install --upgrade pip</span><br><span class="line"></span><br><span class="line"><span class="comment">## 验证</span></span><br><span class="line">python3 -V</span><br><span class="line">Python 3.10.11</span><br><span class="line">pip3 -V</span><br><span class="line">pip 23.1.2 from /usr/local/python3/lib/python3.10/site-packages/pip (python 3.10)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;centos7安装python3-10&quot;&gt;&lt;a href=&quot;#centos7安装python3-10&quot; class=&quot;headerlink&quot; title=&quot;centos7安装python3.10&quot;&gt;&lt;/a&gt;centos7安装python3.10&lt;/h2&gt;&lt;h3 i</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>confluence手动备份恢复</title>
    <link href="https://biglovewheat.gihub.io/2023/06/13/confluence%E6%89%8B%E5%8A%A8%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    <id>https://biglovewheat.gihub.io/2023/06/13/confluence%E6%89%8B%E5%8A%A8%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/</id>
    <published>2023-06-12T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="confluence手动备份恢复"><a href="#confluence手动备份恢复" class="headerlink" title="confluence手动备份恢复"></a>confluence手动备份恢复</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p><em>confluence常规备份恢复的方法是通过控制台，站点管理，每日备份管理，由系统自动完成，只需备份备份目录下文件即可。</em></p><p><em>在某种情况下（比如没有管理员账号，或自动备份失败），可使用拷贝整个confluence文件夹，备份数据库的方式进行备份恢复，下面的例子采用此方法。</em></p><h3 id="环境和版本"><a href="#环境和版本" class="headerlink" title="环境和版本"></a>环境和版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">confluence 7.6.1</span><br><span class="line">mysql 8</span><br></pre></td></tr></table></figure><h3 id="数据库恢复"><a href="#数据库恢复" class="headerlink" title="数据库恢复"></a>数据库恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## rpm安装mysql8，安装完成后先不要启动</span></span><br><span class="line"><span class="comment">## /etc/my.cnf加入如下参数</span></span><br><span class="line">symbolic-links=0</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">max_allowed_packet = 34M</span><br><span class="line">transaction-isolation=READ-COMMITTED</span><br><span class="line">innodb_default_row_format=DYNAMIC</span><br><span class="line">innodb_log_file_size=2G</span><br><span class="line">character_set_server=utf8mb4</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"><span class="comment">### 这里先检查备份出来的sql文件，表名是大写还是小写，如果是小写，需要加lower_case_table_names=1</span></span><br><span class="line"><span class="comment">### 此参数mysql中，只能在初始化中修改，详细可搜索此参数含义和用法</span></span><br><span class="line">lower_case_table_names=1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动mysql</span></span><br><span class="line"><span class="comment">## 创建数据库</span></span><br><span class="line"><span class="comment">### 这里需注意的是，原本数据库的字符集是utf8md4还是uff8，在备份出来的sql文件中，可以找到建表语句确认</span></span><br><span class="line">CREATE SCHEMA confluence DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ;</span><br><span class="line"><span class="comment">## 将备份sql导入，正常情况应该有160个表</span></span><br><span class="line"><span class="comment">### 如数量不对或者报错，可以打开备份出来的sql文件，单独处理</span></span><br></pre></td></tr></table></figure><h3 id="文件恢复"><a href="#文件恢复" class="headerlink" title="文件恢复"></a>文件恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 默认安装confluence，默认程序位置/opt，默认用户数据/var</span></span><br><span class="line"><span class="comment">## 解压并替换程序目录/opt下</span></span><br><span class="line"><span class="comment">## 解压并替换用户数据目录/var下</span></span><br><span class="line"><span class="comment">## 创建agent目录，把agent.jar放到目录下（pojie文件）</span></span><br><span class="line"><span class="comment">## 修改配置文件里的数据库链接信息 confluence.cfg.xml</span></span><br></pre></td></tr></table></figure><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 启动confluence，如不能启动，查看日志输出</span></span><br></pre></td></tr></table></figure><h3 id="破解admin密码"><a href="#破解admin密码" class="headerlink" title="破解admin密码"></a>破解admin密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.id, u.user_name, u.active <span class="keyword">from</span> cwd_user u</span><br><span class="line"><span class="keyword">join</span> cwd_membership m <span class="keyword">on</span> u.id<span class="operator">=</span>m.child_user_id <span class="keyword">join</span> cwd_group g <span class="keyword">on</span> m.parent_id<span class="operator">=</span>g.id <span class="keyword">join</span> cwd_directory d <span class="keyword">on</span> d.id<span class="operator">=</span>g.directory_id</span><br><span class="line"><span class="keyword">where</span> g.group_name <span class="operator">=</span> <span class="string">&#x27;confluence-administrators&#x27;</span> <span class="keyword">and</span> d.directory_name<span class="operator">=</span><span class="string">&#x27;Confluence Internal Directory&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> cwd_user <span class="keyword">set</span> credential <span class="operator">=</span></span><br><span class="line"><span class="string">&#x27;x61Ey612Kl2gpFL56FT9weDnpSo4AV8j8+qx2AuTHdRyY036xxzTTrw10Wq3+4qQyB+XURPWx1ONxp3Y3pB37A==&#x27;</span></span><br><span class="line"><span class="keyword">where</span> id<span class="operator">=</span>上一条<span class="keyword">sql</span>查出来的ID;</span><br><span class="line"></span><br><span class="line"><span class="comment">--update后admin密码是admin</span></span><br></pre></td></tr></table></figure><p>完</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;confluence手动备份恢复&quot;&gt;&lt;a href=&quot;#confluence手动备份恢复&quot; class=&quot;headerlink&quot; title=&quot;confluence手动备份恢复&quot;&gt;&lt;/a&gt;confluence手动备份恢复&lt;/h2&gt;&lt;h3 id=&quot;说明&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="备份恢复" scheme="https://biglovewheat.gihub.io/categories/%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    
    
    <category term="备份恢复" scheme="https://biglovewheat.gihub.io/tags/%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>mysql-mysqldump报错</title>
    <link href="https://biglovewheat.gihub.io/2023/06/13/mysql-mysqldump%E6%8A%A5%E9%94%99/"/>
    <id>https://biglovewheat.gihub.io/2023/06/13/mysql-mysqldump%E6%8A%A5%E9%94%99/</id>
    <published>2023-06-12T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mysql-mysqldump报错"><a href="#mysql-mysqldump报错" class="headerlink" title="mysql-mysqldump报错"></a>mysql-mysqldump报错</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql 5.7.31+</span><br><span class="line">mysql 8.0.21+</span><br></pre></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump: Error: <span class="string">&#x27;Access denied; you need (at least one of) the PROCESS privilege(s) for this operation&#x27;</span> when trying to dump tablespaces</span><br></pre></td></tr></table></figure><h3 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a>错误分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The last PROCESS privilege is new as of MySQL 5.7.31 and MySQL 8.0.21 and may be the </span><br><span class="line">root <span class="built_in">source</span> of your problem. You can solve the mysqldump process privilege error <span class="keyword">in</span> </span><br><span class="line">two ways:</span><br><span class="line"></span><br><span class="line">1.Updating the privileges <span class="keyword">for</span> your database user. </span><br><span class="line">赋权</span><br><span class="line">2.Runing mysqldump with the --no-tablespaces option.</span><br><span class="line">加上--no-tablespaces选项</span><br></pre></td></tr></table></figure><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT PROCESS ON *.* TO user@localhost;</span><br><span class="line"><span class="comment">## or</span></span><br><span class="line">mysqldump -u abc db1 -p -C --no-tablespaces  |gzip &gt; db1.sql.gz</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;mysql-mysqldump报错&quot;&gt;&lt;a href=&quot;#mysql-mysqldump报错&quot; class=&quot;headerlink&quot; title=&quot;mysql-mysqldump报错&quot;&gt;&lt;/a&gt;mysql-mysqldump报错&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>SonarQube代码检测工具安装</title>
    <link href="https://biglovewheat.gihub.io/2023/05/30/SonarQube%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2023/05/30/SonarQube%E4%BB%A3%E7%A0%81%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85/</id>
    <published>2023-05-29T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SonarQube代码检测工具安装"><a href="#SonarQube代码检测工具安装" class="headerlink" title="SonarQube代码检测工具安装"></a>SonarQube代码检测工具安装</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>SonarQube是一个代码质量和安全分析工具，支持java、python、go、c等30+种语言。<br>SonarQube is a self-managed, automatic code review tool that systematically helps you deliver clean code. As a core element of our Sonar solution, SonarQube integrates into your existing workflow and detects issues in your code to help you perform continuous code inspections of your projects. The tool analyses 30+ different programming languages and integrates into your CI pipeline and DevOps platform to ensure that your code meets high-quality standards.</p><h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><p>下载链接：<br><a href="https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.1.69595.zip">https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.1.69595.zip</a><br>安装文档：<br><a href="https://docs.sonarqube.org/latest/try-out-sonarqube/">https://docs.sonarqube.org/latest/try-out-sonarqube/</a></p><p>需要java17支持，先安装java17</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 下载安装包</span></span><br><span class="line">wget https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-9.9.1.69595.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">## 解压</span></span><br><span class="line">unzip sonarqube-9.9.1.69595.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改默认web端口</span></span><br><span class="line">vim conf/sonar.properties</span><br><span class="line"></span><br><span class="line">sonar.web.port=39000</span><br><span class="line"></span><br><span class="line"><span class="comment">## 默认使用h2本地数据库，可以配置采用外部数据库，支持mysql、pg、oracle</span></span><br></pre></td></tr></table></figure><h3 id="启动和登录"><a href="#启动和登录" class="headerlink" title="启动和登录"></a>启动和登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">su - sonarqube -c <span class="string">&quot;java -version;/data/sonarqube-9.9.1.69595/bin/linux-x86-64/sonar.sh console&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动后登录，默认密码admin&#x2F;admin</p><h3 id="新建gitlab-porject"><a href="#新建gitlab-porject" class="headerlink" title="新建gitlab-porject"></a>新建gitlab-porject</h3><p><img src="/../images/sonar_01.jpg"></p><h3 id="选择分析的方式"><a href="#选择分析的方式" class="headerlink" title="选择分析的方式"></a>选择分析的方式</h3><p>目前支持jenkins&#x2F;gitlab-ci等，这里采用最简单的本地分析<br><img src="/../images/sonar_02.jpg"></p><h3 id="本地运行分析"><a href="#本地运行分析" class="headerlink" title="本地运行分析"></a>本地运行分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在代码下载到本地，并运行此命令即可（这里用的mvn的java项目）</span></span><br><span class="line"></span><br><span class="line">mvn clean verify sonar:sonar \</span><br><span class="line">  -Dsonar.projectKey=jenkins_test0627_AYhHS6JcYC282dGxCGTK \</span><br><span class="line">  -Dsonar.host.url=http://hxkj07:39000 \</span><br><span class="line">  -Dsonar.login=sqp_230323b5e2ba00a211b48cf5d857ba45287ef667</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../images/sonar_03.jpg"></p><h3 id="返回页面查看结果"><a href="#返回页面查看结果" class="headerlink" title="返回页面查看结果"></a>返回页面查看结果</h3><p>页面可以看到项目的疑似bug，安全漏洞等，点击可以定位到具体代码<br><img src="/../images/sonar_04.jpg"><br><img src="/../images/sonar_05.jpg"></p><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>配置使用外部数据库（略）</p><p>配置持续集成工具jenkins或gitlab-ci（略）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;SonarQube代码检测工具安装&quot;&gt;&lt;a href=&quot;#SonarQube代码检测工具安装&quot; class=&quot;headerlink&quot; title=&quot;SonarQube代码检测工具安装&quot;&gt;&lt;/a&gt;SonarQube代码检测工具安装&lt;/h2&gt;&lt;h3 id=&quot;简介&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="测试" scheme="https://biglovewheat.gihub.io/categories/%E6%B5%8B%E8%AF%95/"/>
    
    
    <category term="测试" scheme="https://biglovewheat.gihub.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Vscode+Python+Venv设置</title>
    <link href="https://biglovewheat.gihub.io/2023/05/30/vscode+python+venv%E8%AE%BE%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2023/05/30/vscode+python+venv%E8%AE%BE%E7%BD%AE/</id>
    <published>2023-05-29T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vscode-python-venv设置"><a href="#vscode-python-venv设置" class="headerlink" title="vscode+python+venv设置"></a>vscode+python+venv设置</h2><ul><li>windows10&#x2F;vscode&#x2F;python</li></ul><h3 id="安装python"><a href="#安装python" class="headerlink" title="安装python"></a>安装python</h3><p>下载python安装包，右击以管理员运行，记得选添加到path</p><p>pip install virtualenv</p><h3 id="安装vscode"><a href="#安装vscode" class="headerlink" title="安装vscode"></a>安装vscode</h3><p>安装vscode</p><p>安装python插件</p><p>Ctrl+Shift+P 输入 python interpreter 选择python.exe</p><p>Ctrl+Shift+P 输入 python create environment 选择venv</p><h3 id="创建并激活虚拟环境"><a href="#创建并激活虚拟环境" class="headerlink" title="创建并激活虚拟环境"></a>创建并激活虚拟环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m venv myproject\<span class="built_in">env</span></span><br><span class="line">myproject\Scripts\activate</span><br></pre></td></tr></table></figure><p>done</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;vscode-python-venv设置&quot;&gt;&lt;a href=&quot;#vscode-python-venv设置&quot; class=&quot;headerlink&quot; title=&quot;vscode+python+venv设置&quot;&gt;&lt;/a&gt;vscode+python+venv设置&lt;/h2&gt;&lt;</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Doris+Datax数据备份与恢复</title>
    <link href="https://biglovewheat.gihub.io/2023/05/04/Doris+datax%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/"/>
    <id>https://biglovewheat.gihub.io/2023/05/04/Doris+datax%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D/</id>
    <published>2023-05-03T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Doris-Datax数据备份与恢复"><a href="#Doris-Datax数据备份与恢复" class="headerlink" title="Doris+Datax数据备份与恢复"></a>Doris+Datax数据备份与恢复</h2><h3 id="datax下载"><a href="#datax下载" class="headerlink" title="datax下载"></a>datax下载</h3><p><a href="https://github.com/alibaba/DataX">https://github.com/alibaba/DataX</a></p><p>下载最新版本，本测试使用202303版本</p><p><a href="https://datax-opensource.oss-cn-hangzhou.aliyuncs.com/202303/datax.tar.gz">https://datax-opensource.oss-cn-hangzhou.aliyuncs.com/202303/datax.tar.gz</a></p><h3 id="datax使用方法"><a href="#datax使用方法" class="headerlink" title="datax使用方法"></a>datax使用方法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 datax.py aaa.json </span><br></pre></td></tr></table></figure><h3 id="Doris测试数据创建"><a href="#Doris测试数据创建" class="headerlink" title="Doris测试数据创建"></a>Doris测试数据创建</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建数据库</span></span><br><span class="line"><span class="keyword">create</span> database test1;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建测试表,以data_partition作为分区字段，并启用动态分区</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> test1.test_work_log  (</span><br><span class="line">message_deviceId <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NULL</span> ,</span><br><span class="line">message_taskId <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NULL</span> ,</span><br><span class="line">date_partition <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> COMMENT &quot;时间分区&quot;,</span><br><span class="line">message_txt string <span class="keyword">NULL</span> </span><br><span class="line">) ENGINE<span class="operator">=</span>OLAP</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY(message_deviceId,message_taskId, date_partition)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(date_partition)(</span><br><span class="line"><span class="keyword">PARTITION</span> p_other <span class="keyword">VALUES</span> LESS THAN (&quot;1&quot;),</span><br><span class="line"><span class="keyword">PARTITION</span> p_history_20220714 <span class="keyword">VALUES</span> LESS THAN (&quot;20220714&quot;),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230501 <span class="keyword">VALUES</span> [(&quot;20230501&quot;), (&quot;20230502&quot;)),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230502 <span class="keyword">VALUES</span> [(&quot;20230502&quot;), (&quot;20230503&quot;)),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230503 <span class="keyword">VALUES</span> [(&quot;20230503&quot;), (&quot;20230504&quot;)),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230504 <span class="keyword">VALUES</span> [(&quot;20230504&quot;), (&quot;20230505&quot;)),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230505 <span class="keyword">VALUES</span> [(&quot;20230505&quot;), (&quot;20230506&quot;)),</span><br><span class="line"><span class="keyword">PARTITION</span> p20230506 <span class="keyword">VALUES</span> [(&quot;20230506&quot;), (&quot;20230507&quot;))</span><br><span class="line">)</span><br><span class="line">DISTRIBUTED <span class="keyword">BY</span> HASH( message_deviceId,message_taskId) BUCKETS <span class="number">16</span></span><br><span class="line">PROPERTIES (</span><br><span class="line">&quot;replication_num&quot; <span class="operator">=</span> &quot;1&quot;,</span><br><span class="line">&quot;dynamic_partition.enable&quot; <span class="operator">=</span> &quot;true&quot;,</span><br><span class="line">&quot;dynamic_partition.time_unit&quot; <span class="operator">=</span> &quot;DAY&quot;,</span><br><span class="line">&quot;dynamic_partition.time_zone&quot; <span class="operator">=</span> &quot;Asia/Shanghai&quot;,</span><br><span class="line">&quot;dynamic_partition.start&quot; <span class="operator">=</span> &quot;-2147483648&quot;,</span><br><span class="line">&quot;dynamic_partition.end&quot; <span class="operator">=</span> &quot;3&quot;,</span><br><span class="line">&quot;dynamic_partition.prefix&quot; <span class="operator">=</span> &quot;p&quot;,</span><br><span class="line">&quot;dynamic_partition.replication_allocation&quot; <span class="operator">=</span> &quot;tag.location.default: 3&quot;,</span><br><span class="line">&quot;dynamic_partition.buckets&quot; <span class="operator">=</span> &quot;16&quot;,</span><br><span class="line">&quot;dynamic_partition.create_history_partition&quot; <span class="operator">=</span> &quot;true&quot;,</span><br><span class="line">&quot;dynamic_partition.history_partition_num&quot; <span class="operator">=</span> &quot;36&quot;,</span><br><span class="line">&quot;dynamic_partition.hot_partition_num&quot; <span class="operator">=</span> &quot;0&quot;,</span><br><span class="line">&quot;dynamic_partition.reserved_history_periods&quot; <span class="operator">=</span> &quot;NULL&quot;,</span><br><span class="line">&quot;in_memory&quot; <span class="operator">=</span> &quot;false&quot;,</span><br><span class="line">&quot;storage_format&quot; <span class="operator">=</span> &quot;V2&quot;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">--插入测试数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test1.test_work_log <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">-1</span>,<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test1.test_work_log <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">20230504</span>,<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test1.test_work_log <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="number">20230505</span>,<span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看所有数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1.test_work_log;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看分区情况</span></span><br><span class="line"><span class="keyword">show</span> partitions <span class="keyword">from</span> test1.test_work_log;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看某分区数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test1.test_work_log <span class="keyword">PARTITION</span> p20230504;</span><br></pre></td></tr></table></figure><h3 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2023-05-04 14:27:08.179 [main] ERROR Engine - </span><br><span class="line"></span><br><span class="line">经DataX智能分析,该任务最可能的错误原因是:</span><br><span class="line">com.alibaba.datax.common.exception.DataXException: Code:[Common-00], Describe:[您提供的配置文件存在错误信息，请检查您的作业配置 .] - 配置信息错误. 您提供的配置信息不是合法的JSON格式: syntax error, string . 请按照标准json格式提供配置信息. </span><br><span class="line">        at com.alibaba.datax.common.exception.DataXException.asDataXException(DataXException.java:26)</span><br><span class="line">        at com.alibaba.datax.common.util.Configuration.&lt;init&gt;(Configuration.java:1066)</span><br><span class="line">        at com.alibaba.datax.common.util.Configuration.from(Configuration.java:79)</span><br><span class="line">        at com.alibaba.datax.core.util.ConfigParser.parseJobConfig(ConfigParser.java:75)</span><br><span class="line">        at com.alibaba.datax.core.util.ConfigParser.parse(ConfigParser.java:26)</span><br><span class="line">        at com.alibaba.datax.core.Engine.entry(Engine.java:137)</span><br><span class="line">        at com.alibaba.datax.core.Engine.main(Engine.java:204)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 解决办法</span></span><br><span class="line">find /home/mqxdata/datax/plugin/reader -<span class="built_in">type</span> f -name <span class="string">&quot;._*er&quot;</span>  |xargs <span class="built_in">rm</span> -f </span><br><span class="line">find /home/mqxdata/datax/plugin/writer -<span class="built_in">type</span> f -name <span class="string">&quot;._*er&quot;</span>  |xargs <span class="built_in">rm</span> -f </span><br></pre></td></tr></table></figure><h3 id="doris导出到csv"><a href="#doris导出到csv" class="headerlink" title="doris导出到csv"></a>doris导出到csv</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysqlreader&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                                                <span class="attr">&quot;querySql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                    <span class="string">&quot;SELECT * from test1.test_work_log where date_partition=20230504;&quot;</span></span><br><span class="line">                                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;jdbcUrl&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                     <span class="string">&quot;jdbc:mysql://hxkj07:19030/test1&quot;</span></span><br><span class="line">                                <span class="punctuation">]</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;txtfilewriter&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;fileName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test_work_log.csv.gz&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;writeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;append&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;dateFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yyyy-MM-dd&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;fileFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;csv&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="导出效果"><a href="#导出效果" class="headerlink" title="导出效果"></a>导出效果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> test_work_log.csv.gz__ca303326_6445_4443_9e17_6c973ca5efa4 </span><br><span class="line">2,1,20230504,aaa</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="csv导入到doris"><a href="#csv导入到doris" class="headerlink" title="csv导入到doris"></a>csv导入到doris</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;txtfilereader&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;String&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;doriswriter&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;loadUrl&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;hxkj07:18030&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;loadProps&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;message_deviceId&quot;</span><span class="punctuation">,</span> <span class="string">&quot;message_taskId&quot;</span><span class="punctuation">,</span> <span class="string">&quot;date_partition&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_txt&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;postSql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;preSql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;flushInterval&quot;</span><span class="punctuation">:</span><span class="number">30000</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;jdbcUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jdbc:mysql://hxkj07:19030/test1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;selectedDatabase&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;test_work_log&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;loadProps&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;json&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;strip_outer_array&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="导入效果"><a href="#导入效果" class="headerlink" title="导入效果"></a>导入效果</h3><p>修改csv，把aaa改成new，再导入<br><img src="/../images/Doris+Datax%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D_01.jpg"></p><h3 id="生产环境配置-doris–-gt-hdfs"><a href="#生产环境配置-doris–-gt-hdfs" class="headerlink" title="生产环境配置(doris–&gt;hdfs)"></a>生产环境配置(doris–&gt;hdfs)</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mysqlreader&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                                                <span class="attr">&quot;querySql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                    <span class="string">&quot;SELECT message_deviceId,message_taskId,message_generateTime,date_partition,message_realSpeed,message_driverMode,message_reportTime,message_taskIndex,message_curPathNum,message_impleWorkState,message_chassisType,message_chassisInfo_chassisType,message_chassisInfo_engineSpeed,message_chassisInfo_fuelOilLevel,message_chassisInfo_remainFuel,message_chassisInfo_engineInstantaneousFuelEconomy,message_chassisInfo_ptoGearSta,message_chassisInfo_ptoRotationRate,message_chassisInfo_upgradeSysSta,message_chassisInfo_hydraulicOilLevel,message_chassisInfo_hydraulicOilTemp,message_chassisInfo_hydraulicOilPressure,message_chassisInfo_engOilTemp,message_chassisInfo_grainTankWeightKg,message_chassisInfo_grainTankFullSts,message_chassisInfo_unloadClutchSts,message_chassisInfo_grainUnloadTubLvl,message_chassisInfo_oilPressure,message_chassisInfo_coolantTemperature,message_chassisInfo_realOil,message_chassisInfo_remainingOil,message_chassisInfo_currentWheelAngle,message_chassisInfo_steerMotorState,message_chassisInfo_remainingOilPercent,message_chassisInfo_threePointPromote,message_chassisInfo_tillingDepthFb,message_positionInfo_yaw,message_positionInfo_rtkStatus,message_positionInfo_pitchAngle,message_positionInfo_rollAngle,message_positionInfo_position_longitude,message_positionInfo_position_latitude,message_positionInfo_xyPosition_longitude,message_positionInfo_xyPosition_latitude,message_positionInfo_xyImpl_longitude,message_positionInfo_xyImpl_latitude,message_positionInfo_gnssNum,message_positionInfo_networkSignal,message_controlTaskInfo_fieldId,message_controlTaskInfo_fieldName,message_controlTaskInfo_fieldCode,message_controlTaskInfo_typeName,message_controlTaskInfo_totalArea,message_controlTaskInfo_operatedArea,message_controlTaskInfo_noOperateArea,message_controlTaskInfo_totalUsedTime,message_controlTaskInfo_percent,message_controlTaskInfo_widthOfCloth,message_controlTaskInfo_totalMileage,message_controlTaskInfo_operatedMileage,message_controlTaskInfo_noOperatedMileage,message_controlTaskInfo_speedPerHour,message_controlTaskInfo_operatedOffset,message_controlTaskInfo_operatedOffsetDirection,message_controlTaskInfo_needLastTime,message_controlTaskInfo_machineName,message_controlTaskInfo_implementName,message_controlTaskInfo_startTime,message_controlTaskInfo_operateStatus,message_controlTaskInfo_segmentPercent,message_statusInfo_deviceId,message_statusInfo_taskId,message_statusInfo_connected,message_statusInfo_ready,message_statusInfo_canTask,message_statusInfo_status,gis_farmcode,gis_farmlandcode,message_gsmStatusInfo_signalRssi,message_gsmStatusInfo_optGsm,message_gsmStatusInfo_networkType,message_gsmStatusInfo_simNumber,message_gsmStatusInfo_cardStatus,gis_is_exception FROM hx_farm_sit.ods_machine_work_log_uq where date_partition=20230503;&quot;</span></span><br><span class="line">                                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;jdbcUrl&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                     <span class="string">&quot;jdbc:mysql://bigdata01:9030/hx_farm_sit&quot;</span></span><br><span class="line">                                <span class="punctuation">]</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfswriter&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                        <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_deviceId&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_taskId&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_generateTime&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bigint&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;date_partition&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_realSpeed&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_driverMode&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_reportTime&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_taskIndex&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_curPathNum&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_impleWorkState&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisType&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_chassisType&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_engineSpeed&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_fuelOilLevel&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_remainFuel&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_engineInstantaneousFuelEconomy&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_ptoGearSta&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_ptoRotationRate&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_upgradeSysSta&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_hydraulicOilLevel&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_hydraulicOilTemp&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_hydraulicOilPressure&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_engOilTemp&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_grainTankWeightKg&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_grainTankFullSts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_unloadClutchSts&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_grainUnloadTubLvl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_oilPressure&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_coolantTemperature&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_realOil&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_remainingOil&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_currentWheelAngle&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_steerMotorState&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_remainingOilPercent&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_threePointPromote&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_chassisInfo_tillingDepthFb&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_yaw&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_rtkStatus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_pitchAngle&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_rollAngle&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_position_longitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_position_latitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_xyPosition_longitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_xyPosition_latitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_xyImpl_longitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_xyImpl_latitude&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_gnssNum&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_positionInfo_networkSignal&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_fieldId&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bigint&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_fieldName&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_fieldCode&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_typeName&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_totalArea&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_operatedArea&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_noOperateArea&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_totalUsedTime&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_percent&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_widthOfCloth&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_totalMileage&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_operatedMileage&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_noOperatedMileage&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_speedPerHour&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_operatedOffset&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_operatedOffsetDirection&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_needLastTime&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_machineName&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_implementName&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_startTime&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_operateStatus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_controlTaskInfo_segmentPercent&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_deviceId&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_taskId&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_connected&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_ready&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_canTask&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_statusInfo_status&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gis_farmcode&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gis_farmlandcode&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_gsmStatusInfo_signalRssi&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_gsmStatusInfo_optGsm&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_gsmStatusInfo_networkType&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_gsmStatusInfo_simNumber&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;message_gsmStatusInfo_cardStatus&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gis_is_exception&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">                                        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;defaultFS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfs://nameservice1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;compress&quot;</span><span class="punctuation">:</span><span class="string">&quot;SNAPPY&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;fileName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ods_machine_work_log_uq.orc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;fileType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;orc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/bigdata/doris/hx_farm_sit.db/ods_machine_work_log_uq/dt=20230503/&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                        <span class="attr">&quot;writeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;append&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                         <span class="attr">&quot;hadoopConfig&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                                                                <span class="attr">&quot;dfs.nameservices&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;nameservice1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;dfs.ha.namenodes.nameservice1&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bigdata01,bigdata02&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;dfs.namenode.rpc-address.nameservice1.bigdata01&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bigdata01:8020&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;dfs.namenode.rpc-address.nameservice1.bigdata02&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bigdata02:8020&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                                <span class="attr">&quot;dfs.client.failover.proxy.provider.nameservice1&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&quot;</span></span><br><span class="line">                                                                        <span class="punctuation">&#125;</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="生产环境配置-hdfs–-gt-doris-，基于datax-202303版本"><a href="#生产环境配置-hdfs–-gt-doris-，基于datax-202303版本" class="headerlink" title="生产环境配置(hdfs–&gt;doris)，基于datax-202303版本"></a>生产环境配置(hdfs–&gt;doris)，基于datax-202303版本</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfsreader&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/tmp/test/*/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;defaultFS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hdfs://nameservice1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="attr">&quot;fileType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;orc&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="attr">&quot;hadoopConfig&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                                                                <span class="attr">&quot;dfs.nameservices&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;nameservice1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;dfs.ha.namenodes.nameservice1&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bigdata2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;dfs.namenode.rpc-address.nameservice1.bigdata2&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bigdata2:8020&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                                <span class="attr">&quot;dfs.client.failover.proxy.provider.nameservice1&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&quot;</span></span><br><span class="line">                                                                        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;9&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;12&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;14&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;16&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;17&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;19&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;21&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;22&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;24&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;25&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;26&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;28&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;29&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;32&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;33&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;34&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;35&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;36&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;37&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;38&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;39&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;40&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;41&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;42&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;43&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;44&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;45&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;46&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;47&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;48&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;49&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;50&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;51&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;52&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;53&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;54&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;55&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;56&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;57&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;58&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;59&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;60&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;61&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;62&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;63&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;64&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;65&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;66&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;67&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;68&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;69&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;70&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;71&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;72&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;73&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;74&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;75&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;76&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;77&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;78&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;79&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;80&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;81&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;82&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;83&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;doriswriter&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;database&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hx_farm_sit&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ods_machine_work_log_uq&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;message_deviceId&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_taskId&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_generateTime&quot;</span><span class="punctuation">,</span><span class="string">&quot;date_partition&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_realSpeed&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_driverMode&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_reportTime&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_taskIndex&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_curPathNum&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_impleWorkState&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisType&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_chassisType&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_engineSpeed&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_fuelOilLevel&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_remainFuel&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_engineInstantaneousFuelEconomy&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_ptoGearSta&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_ptoRotationRate&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_upgradeSysSta&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_hydraulicOilLevel&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_hydraulicOilTemp&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_hydraulicOilPressure&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_engOilTemp&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_grainTankWeightKg&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_grainTankFullSts&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_unloadClutchSts&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_grainUnloadTubLvl&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_oilPressure&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_coolantTemperature&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_realOil&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_remainingOil&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_currentWheelAngle&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_steerMotorState&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_remainingOilPercent&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_threePointPromote&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_chassisInfo_tillingDepthFb&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_yaw&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_rtkStatus&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_pitchAngle&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_rollAngle&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_position_longitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_position_latitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_xyPosition_longitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_xyPosition_latitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_xyImpl_longitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_xyImpl_latitude&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_gnssNum&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_positionInfo_networkSignal&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_fieldId&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_fieldName&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_fieldCode&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_typeName&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_totalArea&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_operatedArea&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_noOperateArea&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_totalUsedTime&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_percent&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_widthOfCloth&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_totalMileage&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_operatedMileage&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_noOperatedMileage&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_speedPerHour&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_operatedOffset&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_operatedOffsetDirection&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_needLastTime&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_machineName&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_implementName&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_startTime&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_operateStatus&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_controlTaskInfo_segmentPercent&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_deviceId&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_taskId&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_connected&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_ready&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_canTask&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_statusInfo_status&quot;</span><span class="punctuation">,</span><span class="string">&quot;gis_farmcode&quot;</span><span class="punctuation">,</span><span class="string">&quot;gis_farmlandcode&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_gsmStatusInfo_signalRssi&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_gsmStatusInfo_optGsm&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_gsmStatusInfo_networkType&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_gsmStatusInfo_simNumber&quot;</span><span class="punctuation">,</span><span class="string">&quot;message_gsmStatusInfo_cardStatus&quot;</span><span class="punctuation">,</span><span class="string">&quot;gis_is_exception&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;preSql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;postSql&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;connection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;jdbcUrl&quot;</span><span class="punctuation">:</span><span class="string">&quot;jdbc:mysql://bigdata1:19030/&quot;</span></span><br><span class="line">                            <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;ods_machine_work_log_uq&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;selectedDatabase&quot;</span><span class="punctuation">:</span><span class="string">&quot;hx_farm_sit&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                         <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;loadUrl&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;bigdata1:18030&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bigdata2:18030&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bigdata3:18030&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;loadProps&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;maxBatchRows&quot;</span><span class="punctuation">:</span> <span class="number">10000</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="attr">&quot;maxBatchByteSize&quot;</span><span class="punctuation">:</span> <span class="number">10857600</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Doris-Datax数据备份与恢复&quot;&gt;&lt;a href=&quot;#Doris-Datax数据备份与恢复&quot; class=&quot;headerlink&quot; title=&quot;Doris+Datax数据备份与恢复&quot;&gt;&lt;/a&gt;Doris+Datax数据备份与恢复&lt;/h2&gt;&lt;h3 id=&quot;d</summary>
      
    
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/categories/bigdata/"/>
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>Canal将mysql变化数据投送（同步）到MQ</title>
    <link href="https://biglovewheat.gihub.io/2023/04/25/Canal%E5%B0%86mysql%E5%8F%98%E5%8C%96%E6%95%B0%E6%8D%AE%E6%8A%95%E9%80%81%EF%BC%88%E5%90%8C%E6%AD%A5%EF%BC%89%E5%88%B0MQ/"/>
    <id>https://biglovewheat.gihub.io/2023/04/25/Canal%E5%B0%86mysql%E5%8F%98%E5%8C%96%E6%95%B0%E6%8D%AE%E6%8A%95%E9%80%81%EF%BC%88%E5%90%8C%E6%AD%A5%EF%BC%89%E5%88%B0MQ/</id>
    <published>2023-04-24T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.127Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Canal将mysql变化数据投送（同步）到MQ"><a href="#Canal将mysql变化数据投送（同步）到MQ" class="headerlink" title="Canal将mysql变化数据投送（同步）到MQ"></a>Canal将mysql变化数据投送（同步）到MQ</h2><h3 id="清单"><a href="#清单" class="headerlink" title="清单"></a>清单</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.221 bigdata1  <span class="comment">## admin,deployer</span></span><br><span class="line">192.168.8.222 bigdata2  <span class="comment">## deployer</span></span><br><span class="line">192.168.8.223 bigdata3  <span class="comment">## deployer</span></span><br><span class="line"></span><br><span class="line">canal.admin-1.1.5.tar.gz</span><br><span class="line">canal.deployer-1.1.5.tar.gz</span><br></pre></td></tr></table></figure><h3 id="集群安装前提"><a href="#集群安装前提" class="headerlink" title="集群安装前提"></a>集群安装前提</h3><p>java 1.8 （安装略）</p><p>zookeeper （安装略）</p><p>mysql（安装略）</p><h3 id="mysql配置"><a href="#mysql配置" class="headerlink" title="mysql配置"></a>mysql配置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--集群安装需要mysql存储集群数据</span></span><br><span class="line"></span><br><span class="line">mysql <span class="operator">-</span>u root <span class="operator">-</span>p  <span class="operator">&lt;</span> <span class="operator">/</span>data<span class="operator">/</span>canal<span class="operator">/</span>admin<span class="operator">/</span>conf<span class="operator">/</span>canal_manager.sql</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;Abc123!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> canal_manager.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="需复制的mysql配置"><a href="#需复制的mysql配置" class="headerlink" title="需复制的mysql配置"></a>需复制的mysql配置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">需要给canal用户赋予复制的权限</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">WITH</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;Abc123@!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="安装admin"><a href="#安装admin" class="headerlink" title="安装admin"></a>安装admin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 解压</span></span><br><span class="line">vi conf/application.yml</span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: 18089</span><br><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line">    time-zone: GMT+8</span><br><span class="line"></span><br><span class="line">spring.datasource:</span><br><span class="line">  address: 192.168.8.211:3306</span><br><span class="line">  database: canal_manager</span><br><span class="line">  username: canal</span><br><span class="line">  password: Abc123!!!</span><br><span class="line">  driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">  url: jdbc:mysql://<span class="variable">$&#123;spring.datasource.address&#125;</span>/<span class="variable">$&#123;spring.datasource.database&#125;</span>?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-8&amp;useSSL=<span class="literal">false</span>&amp;allowPublicKeyRetrieval=<span class="literal">true</span></span><br><span class="line">  hikari:</span><br><span class="line">    maximum-pool-size: 30</span><br><span class="line">    minimum-idle: 1</span><br><span class="line"></span><br><span class="line">canal:</span><br><span class="line">  adminUser: admin</span><br><span class="line">  adminPasswd: 123456</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动admin</span></span><br><span class="line">./startup_admin.sh</span><br><span class="line"><span class="comment"># 启动脚本</span></span><br><span class="line"><span class="built_in">cat</span> startup_admin.sh </span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">/data/canal/admin/bin/startup.sh</span><br></pre></td></tr></table></figure><h3 id="登录控制台"><a href="#登录控制台" class="headerlink" title="登录控制台"></a>登录控制台</h3><p><a href="http://192.168.8.211/">http://192.168.8.211</a> admin&#x2F;123456</p><p>新建一个集群</p><h3 id="配置并启动deployer"><a href="#配置并启动deployer" class="headerlink" title="配置并启动deployer"></a>配置并启动deployer</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vi deployer/conf/canal_local.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># register ip</span></span><br><span class="line">canal.register.ip = </span><br><span class="line"></span><br><span class="line"><span class="comment"># canal admin config</span></span><br><span class="line">canal.admin.manager = 192.168.8.221:18089</span><br><span class="line">canal.admin.port = 11110</span><br><span class="line">canal.admin.user = admin</span><br><span class="line">canal.admin.passwd = 6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9</span><br><span class="line"><span class="comment"># admin auto register</span></span><br><span class="line">canal.admin.register.auto = <span class="literal">true</span></span><br><span class="line">canal.admin.register.cluster = canal-cluster</span><br><span class="line">canal.admin.register.name =  </span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">/data/canal/deployer/bin/startup.sh  <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动正常的话，控制台就能看到3台server，否则请看log排错。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="控制台配置server-集群配置"><a href="#控制台配置server-集群配置" class="headerlink" title="控制台配置server(集群配置)"></a>控制台配置server(集群配置)</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment">#########               common argument         #############</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># tcp bind ip</span></span><br><span class="line"><span class="attr">canal.ip</span> =<span class="string"></span></span><br><span class="line"><span class="comment"># register ip to zookeeper</span></span><br><span class="line"><span class="attr">canal.register.ip</span> = <span class="string"></span></span><br><span class="line"><span class="attr">canal.port</span> = <span class="string">11111</span></span><br><span class="line"><span class="attr">canal.metrics.pull.port</span> = <span class="string">11112</span></span><br><span class="line"><span class="comment"># canal instance user/passwd</span></span><br><span class="line"><span class="comment"># canal.user = canal</span></span><br><span class="line"><span class="comment"># canal.passwd = E3619321C1A937C46A0D8BD1DAC39F93B27D4458</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># canal admin config</span></span><br><span class="line"><span class="attr">canal.admin.manager</span> = <span class="string">192.168.8.221:18089</span></span><br><span class="line"><span class="attr">canal.admin.port</span> = <span class="string">11110</span></span><br><span class="line"><span class="attr">canal.admin.user</span> = <span class="string">admin</span></span><br><span class="line"><span class="attr">canal.admin.passwd</span> = <span class="string">6BB4837EB74329105EE4568DDA7DC67ED2CA2AD9</span></span><br><span class="line"><span class="comment"># admin auto register</span></span><br><span class="line"><span class="attr">canal.admin.register.auto</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.admin.register.cluster</span> = <span class="string">canal-cluster</span></span><br><span class="line"><span class="comment">#canal.admin.register.name = bigdata01</span></span><br><span class="line"></span><br><span class="line"><span class="attr">canal.zkServers</span> = <span class="string">192.168.8.221:12181,192.168.8.222:12181,192.168.8.223:12181</span></span><br><span class="line"><span class="comment"># flush data to zk</span></span><br><span class="line"><span class="attr">canal.zookeeper.flush.period</span> = <span class="string">1000</span></span><br><span class="line"><span class="attr">canal.withoutNetty</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"># tcp, kafka, rocketMQ, rabbitMQ</span></span><br><span class="line"><span class="attr">canal.serverMode</span> = <span class="string">rocketMQ</span></span><br><span class="line"><span class="comment"># flush meta cursor/parse position to file</span></span><br><span class="line"><span class="attr">canal.file.data.dir</span> = <span class="string">$&#123;canal.conf.dir&#125;</span></span><br><span class="line"><span class="attr">canal.file.flush.period</span> = <span class="string">1000</span></span><br><span class="line"><span class="comment">## memory store RingBuffer size, should be Math.pow(2,n)</span></span><br><span class="line"><span class="attr">canal.instance.memory.buffer.size</span> = <span class="string">16384</span></span><br><span class="line"><span class="comment">## memory store RingBuffer used memory unit size , default 1kb</span></span><br><span class="line"><span class="attr">canal.instance.memory.buffer.memunit</span> = <span class="string">1024 </span></span><br><span class="line"><span class="comment">## meory store gets mode used MEMSIZE or ITEMSIZE</span></span><br><span class="line"><span class="attr">canal.instance.memory.batch.mode</span> = <span class="string">MEMSIZE</span></span><br><span class="line"><span class="attr">canal.instance.memory.rawEntry</span> = <span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">## detecing config</span></span><br><span class="line"><span class="attr">canal.instance.detecting.enable</span> = <span class="string">false</span></span><br><span class="line"><span class="comment">#canal.instance.detecting.sql = insert into retl.xdual values(1,now()) on duplicate key update x=now()</span></span><br><span class="line"><span class="attr">canal.instance.detecting.sql</span> = <span class="string">select 1</span></span><br><span class="line"><span class="attr">canal.instance.detecting.interval.time</span> = <span class="string">3</span></span><br><span class="line"><span class="attr">canal.instance.detecting.retry.threshold</span> = <span class="string">3</span></span><br><span class="line"><span class="attr">canal.instance.detecting.heartbeatHaEnable</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># support maximum transaction size, more than the size of the transaction will be cut into multiple transactions delivery</span></span><br><span class="line"><span class="attr">canal.instance.transaction.size</span> =  <span class="string">1024</span></span><br><span class="line"><span class="comment"># mysql fallback connected to new master should fallback times</span></span><br><span class="line"><span class="attr">canal.instance.fallbackIntervalInSeconds</span> = <span class="string">60</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># network config</span></span><br><span class="line"><span class="attr">canal.instance.network.receiveBufferSize</span> = <span class="string">16384</span></span><br><span class="line"><span class="attr">canal.instance.network.sendBufferSize</span> = <span class="string">16384</span></span><br><span class="line"><span class="attr">canal.instance.network.soTimeout</span> = <span class="string">30</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># binlog filter config</span></span><br><span class="line"><span class="attr">canal.instance.filter.druid.ddl</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.query.dcl</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.query.dml</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.query.ddl</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.table.error</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.rows</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">canal.instance.filter.transaction.entry</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.instance.filter.dml.insert</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">canal.instance.filter.dml.update</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">canal.instance.filter.dml.delete</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># binlog format/image check</span></span><br><span class="line"><span class="attr">canal.instance.binlog.format</span> = <span class="string">ROW,STATEMENT,MIXED </span></span><br><span class="line"><span class="attr">canal.instance.binlog.image</span> = <span class="string">FULL,MINIMAL,NOBLOB</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># binlog ddl isolation</span></span><br><span class="line"><span class="attr">canal.instance.get.ddl.isolation</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># parallel parser config</span></span><br><span class="line"><span class="attr">canal.instance.parser.parallel</span> = <span class="string">true</span></span><br><span class="line"><span class="comment">## concurrent thread number, default 60% available processors, suggest not to exceed Runtime.getRuntime().availableProcessors()</span></span><br><span class="line"><span class="comment">#canal.instance.parser.parallelThreadSize = 16</span></span><br><span class="line"><span class="comment">## disruptor ringbuffer size, must be power of 2</span></span><br><span class="line"><span class="attr">canal.instance.parser.parallelBufferSize</span> = <span class="string">256</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># table meta tsdb info</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.enable</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.dir</span> = <span class="string">$&#123;canal.file.data.dir:../conf&#125;/$&#123;canal.instance.destination:&#125;</span></span><br><span class="line"><span class="comment">#canal.instance.tsdb.url = jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;/h2;CACHE_SIZE=1000;MODE=MYSQL;</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.dbUsername</span> = <span class="string">canal</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.dbPassword</span> = <span class="string">canal</span></span><br><span class="line"><span class="comment"># dump snapshot interval, default 24 hour</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.snapshot.interval</span> = <span class="string">24</span></span><br><span class="line"><span class="comment"># purge snapshot expire , default 360 hour(15 days)</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.snapshot.expire</span> = <span class="string">360</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment">#########               destinations            #############</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="attr">canal.destinations</span> = <span class="string"></span></span><br><span class="line"><span class="comment"># conf root dir</span></span><br><span class="line"><span class="attr">canal.conf.dir</span> = <span class="string">../conf</span></span><br><span class="line"><span class="comment"># auto scan instance dir add/remove and start/stop instance</span></span><br><span class="line"><span class="attr">canal.auto.scan</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.auto.scan.interval</span> = <span class="string">5</span></span><br><span class="line"><span class="comment"># set this value to &#x27;true&#x27; means that when binlog pos not found, skip to latest.</span></span><br><span class="line"><span class="comment"># WARN: pls keep &#x27;false&#x27; in production env, or if you know what you want.</span></span><br><span class="line"><span class="attr">canal.auto.reset.latest.pos.mode</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#canal.instance.tsdb.spring.xml = classpath:spring/tsdb/h2-tsdb.xml</span></span><br><span class="line"><span class="attr">canal.instance.tsdb.spring.xml</span> = <span class="string">classpath:spring/tsdb/mysql-tsdb.xml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">canal.instance.global.mode</span> = <span class="string">spring</span></span><br><span class="line"><span class="attr">canal.instance.global.lazy</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">canal.instance.global.manager.address</span> = <span class="string">$&#123;canal.admin.manager&#125;</span></span><br><span class="line"><span class="comment">#canal.instance.global.spring.xml = classpath:spring/memory-instance.xml</span></span><br><span class="line"><span class="comment">#canal.instance.global.spring.xml = classpath:spring/file-instance.xml</span></span><br><span class="line"><span class="attr">canal.instance.global.spring.xml</span> = <span class="string">classpath:spring/default-instance.xml</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">#########             MQ Properties      #############</span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment"># aliyun ak/sk , support rds/mq</span></span><br><span class="line"><span class="attr">canal.aliyun.accessKey</span> =<span class="string"></span></span><br><span class="line"><span class="attr">canal.aliyun.secretKey</span> =<span class="string"></span></span><br><span class="line"><span class="attr">canal.aliyun.uid</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="attr">canal.mq.flatMessage</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.mq.canalBatchSize</span> = <span class="string">50</span></span><br><span class="line"><span class="attr">canal.mq.canalGetTimeout</span> = <span class="string">100</span></span><br><span class="line"><span class="comment"># Set this value to &quot;cloud&quot;, if you want open message trace feature in aliyun.</span></span><br><span class="line"><span class="attr">canal.mq.accessChannel</span> = <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">canal.mq.database.hash</span> = <span class="string">true</span></span><br><span class="line"><span class="attr">canal.mq.send.thread.size</span> = <span class="string">30</span></span><br><span class="line"><span class="attr">canal.mq.build.thread.size</span> = <span class="string">8</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="comment">#########                   RocketMQ         #############</span></span><br><span class="line"><span class="comment">##################################################</span></span><br><span class="line"><span class="attr">rocketmq.producer.group</span> = <span class="string">mysql-canal-mq</span></span><br><span class="line"><span class="attr">rocketmq.enable.message.trace</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">rocketmq.customized.trace.topic</span> =<span class="string"></span></span><br><span class="line"><span class="attr">rocketmq.namespace</span> =<span class="string"></span></span><br><span class="line"><span class="attr">rocketmq.namesrv.addr</span> = <span class="string">hxkj07:9876</span></span><br><span class="line"><span class="attr">rocketmq.retry.times.when.send.failed</span> = <span class="string">0</span></span><br><span class="line"><span class="attr">rocketmq.vip.channel.enabled</span> = <span class="string">false</span></span><br><span class="line"><span class="attr">rocketmq.tag</span> = <span class="string"></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="创建并配置instance"><a href="#创建并配置instance" class="headerlink" title="创建并配置instance"></a>创建并配置instance</h3><p>控制台新建一个instance，配置如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#################################################</span><br><span class="line">## mysql serverId , v1.0.26+ will autoGen</span><br><span class="line"># canal.instance.mysql.slaveId=0</span><br><span class="line"></span><br><span class="line"># enable gtid use true/false</span><br><span class="line">canal.instance.gtidon=false</span><br><span class="line"></span><br><span class="line"># position info</span><br><span class="line">canal.instance.master.address=hxkj07:3306</span><br><span class="line">canal.instance.master.journal.name=</span><br><span class="line">canal.instance.master.position=</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br><span class="line"></span><br><span class="line"># rds oss binlog</span><br><span class="line">canal.instance.rds.accesskey=</span><br><span class="line">canal.instance.rds.secretkey=</span><br><span class="line">canal.instance.rds.instanceId=</span><br><span class="line"></span><br><span class="line"># table meta tsdb info</span><br><span class="line">canal.instance.tsdb.enable=false</span><br><span class="line">#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb</span><br><span class="line">#canal.instance.tsdb.dbUsername=canal</span><br><span class="line">#canal.instance.tsdb.dbPassword=canal</span><br><span class="line"></span><br><span class="line">#canal.instance.standby.address =</span><br><span class="line">#canal.instance.standby.journal.name =</span><br><span class="line">#canal.instance.standby.position =</span><br><span class="line">#canal.instance.standby.timestamp =</span><br><span class="line">#canal.instance.standby.gtid=</span><br><span class="line"></span><br><span class="line"># username/password</span><br><span class="line">canal.instance.dbUsername=canal</span><br><span class="line">canal.instance.dbPassword=Hxkj2022!!!</span><br><span class="line">canal.instance.connectionCharset = UTF-8</span><br><span class="line"># enable druid Decrypt database password</span><br><span class="line">canal.instance.enableDruid=false</span><br><span class="line">#canal.instance.pwdPublicKey=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5/zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2/JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ==</span><br><span class="line"></span><br><span class="line"># table regex</span><br><span class="line">canal.instance.filter.regex=front_telematics.machinery_implement_combination_record,baseinfo.t_implement_sku,baseinfo.t_device_sku,iot.t_device,front_telematics.t_bg_agronomy_operate,baseinfo.t_fault_definittion_description</span><br><span class="line"># table black regex</span><br><span class="line">canal.instance.filter.black.regex=</span><br><span class="line"># table field filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)</span><br><span class="line">#canal.instance.filter.field=test1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch</span><br><span class="line"># table field black filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)</span><br><span class="line">#canal.instance.filter.black.field=test1.t_product:subject/product_image,test2.t_company:id/name/contact/ch</span><br><span class="line"></span><br><span class="line"># mq config</span><br><span class="line">canal.mq.topic=mysql_canal_mq</span><br><span class="line"># dynamic topic route by schema or table regex</span><br><span class="line">#canal.mq.dynamicTopic=</span><br><span class="line">canal.mq.partition=0</span><br><span class="line"># hash partition config</span><br><span class="line">canal.mq.partitionsNum=4</span><br><span class="line">canal.mq.partitionHash=.*\\..*:$pk$,.*\\..*:id</span><br><span class="line">#canal.mq.partitionHash=test.table:id^name,.*\\..*</span><br><span class="line">#################################################</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="检查mq"><a href="#检查mq" class="headerlink" title="检查mq"></a>检查mq</h3><p>所有配置正常情况下，修改目标mysql，就能在rocketmq看到相应的message</p><h3 id="错误解决"><a href="#错误解决" class="headerlink" title="错误解决"></a>错误解决</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.io.IOException: caching_sha2_password Auth failed</span><br><span class="line">alter user <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified with mysql_native_password by <span class="string">&#x27;Abc123!!!&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Canal将mysql变化数据投送（同步）到MQ&quot;&gt;&lt;a href=&quot;#Canal将mysql变化数据投送（同步）到MQ&quot; class=&quot;headerlink&quot; title=&quot;Canal将mysql变化数据投送（同步）到MQ&quot;&gt;&lt;/a&gt;Canal将mysql变化数</summary>
      
    
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/categories/bigdata/"/>
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>Cloudera-CM+CDH6安装</title>
    <link href="https://biglovewheat.gihub.io/2023/04/13/Cloudera-CM+CDH6%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2023/04/13/Cloudera-CM+CDH6%E5%AE%89%E8%A3%85/</id>
    <published>2023-04-12T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cloudera-CM-CDH6-安装"><a href="#Cloudera-CM-CDH6-安装" class="headerlink" title="Cloudera CM+CDH6 安装"></a>Cloudera CM+CDH6 安装</h2><h3 id="环境清单"><a href="#环境清单" class="headerlink" title="环境清单"></a>环境清单</h3><p>192.168.8.221 bigdata1<br>192.168.8.221 bigdata2<br>192.168.8.221 bigdata3</p><h3 id="服务器设置"><a href="#服务器设置" class="headerlink" title="服务器设置"></a>服务器设置</h3><p>关闭firewall，关闭selinux，设置ssh互信（略）</p><h3 id="禁止透明大页"><a href="#禁止透明大页" class="headerlink" title="禁止透明大页"></a>禁止透明大页</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br></pre></td></tr></table></figure><h3 id="mysql5-7安装"><a href="#mysql5-7安装" class="headerlink" title="mysql5.7安装"></a>mysql5.7安装</h3><p>（略）</p><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database scm <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> scm.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;scm&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database amon <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> amon.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;amon&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database rman <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> rman.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;rman&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database hue <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> hue.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;hue&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database metastore <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> metastore.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;hive&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database sentry <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> sentry.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;sentry&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database nav <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> nav.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;nav&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> database oozie <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">default</span> <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">on</span> oozie.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;oozie&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Hxkj2022!!!&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="本地yum仓库搭建"><a href="#本地yum仓库搭建" class="headerlink" title="本地yum仓库搭建"></a>本地yum仓库搭建</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@hy-base-01 bigdata_repo]<span class="comment"># tree </span></span><br><span class="line">.</span><br><span class="line">├── CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel</span><br><span class="line">├── CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha1</span><br><span class="line">├── CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha256</span><br><span class="line">├── manifest.json</span><br><span class="line">├── allkeys.asc</span><br><span class="line">├── cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm</span><br><span class="line">├── cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm</span><br><span class="line">├── cloudera-manager-server-6.3.1-1466458.el7.x86_64.rpm</span><br><span class="line">├── cloudera-manager-server-db-2-6.3.1-1466458.el7.x86_64.rpm</span><br><span class="line">├── enterprise-debuginfo-6.3.1-1466458.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">yum install -y createrepo</span><br><span class="line"><span class="built_in">cd</span> bigdata_repo</span><br><span class="line">createrepo .</span><br><span class="line"></span><br><span class="line"><span class="comment">## nginx 配置</span></span><br><span class="line">server &#123;</span><br><span class="line">        listen     80;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root  /data/bigdata_repo;</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## yum仓库配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cat /etc/yum.repos.d/local.repo </span></span><br><span class="line">[bigdata]</span><br><span class="line">name=bigdata</span><br><span class="line">baseurl=http://bigdata1/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="java设置"><a href="#java设置" class="headerlink" title="java设置"></a>java设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## mysql链接驱动</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/share/java </span><br><span class="line"><span class="built_in">cp</span> mysql-connector-java-8.0.21.jar /usr/share/java/mysql-connector-java.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">## 默认java</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /usr/java/</span><br><span class="line"><span class="built_in">ln</span> -s /data/soft/jdk1.8.0_301/  /usr/java/default</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置java环境</span></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br></pre></td></tr></table></figure><h3 id="安装-服务器"><a href="#安装-服务器" class="headerlink" title="安装(服务器)"></a>安装(服务器)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum install -y cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化数据库</span></span><br><span class="line"><span class="comment"># mysql在本地</span></span><br><span class="line">/opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm</span><br><span class="line"><span class="comment"># mysql不在本地</span></span><br><span class="line">/opt/cloudera/cm/schema/scm_prepare_database.sh mysql -h &lt;mysql-host-ip&gt; --scm-host &lt;cm-server-ip&gt; scm scm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 数据库初始化成功后启动server</span></span><br><span class="line">systemctl start cloudera-scm-server</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> cloudera-manager-agent cloudera-manager-server</span><br><span class="line">systemctl start cloudera-manager-agent cloudera-manager-server</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/cloudera-scm-server/cloudera-scm-server.log</span><br></pre></td></tr></table></figure><h3 id="登录界面，在界面完成其他节点安装和配置"><a href="#登录界面，在界面完成其他节点安装和配置" class="headerlink" title="登录界面，在界面完成其他节点安装和配置"></a>登录界面，在界面完成其他节点安装和配置</h3><p><a href="http://bigdata-01:7180/cmf/login">http://bigdata-01:7180/cmf/login</a>   admin&#x2F;admin</p><h3 id="按照图形界面向导安装即可"><a href="#按照图形界面向导安装即可" class="headerlink" title="按照图形界面向导安装即可"></a>按照图形界面向导安装即可</h3><p><img src="/../images/cdh_01.jpg"><br><img src="/../images/cdh_02.jpg"><br><img src="/../images/cdh_03.jpg"><br><img src="/../images/cdh_04.jpg"><br><img src="/../images/cdh_05.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Cloudera-CM-CDH6-安装&quot;&gt;&lt;a href=&quot;#Cloudera-CM-CDH6-安装&quot; class=&quot;headerlink&quot; title=&quot;Cloudera CM+CDH6 安装&quot;&gt;&lt;/a&gt;Cloudera CM+CDH6 安装&lt;/h2&gt;&lt;h3 i</summary>
      
    
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/categories/bigdata/"/>
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>Doris集群搭建</title>
    <link href="https://biglovewheat.gihub.io/2023/04/11/Doris%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"/>
    <id>https://biglovewheat.gihub.io/2023/04/11/Doris%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</id>
    <published>2023-04-10T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Doris集群搭建"><a href="#Doris集群搭建" class="headerlink" title="Doris集群搭建"></a>Doris集群搭建</h2><h3 id="清单"><a href="#清单" class="headerlink" title="清单"></a>清单</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.221 bigdata1  <span class="comment">## fe,be</span></span><br><span class="line">192.168.8.222 bigdata2  <span class="comment">## fe,be</span></span><br><span class="line">192.168.8.223 bigdata3  <span class="comment">## fe,be</span></span><br></pre></td></tr></table></figure><h3 id="检查CPU是否支持AVX2指令集"><a href="#检查CPU是否支持AVX2指令集" class="headerlink" title="检查CPU是否支持AVX2指令集"></a>检查CPU是否支持AVX2指令集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/cpuinfo |grep -i avx2</span><br><span class="line"></span><br><span class="line"><span class="comment">## cpu是否支持avx2命令集决定下载对应的doris版本，版本不对be可能启动不了，/var/log/message 会产生类似错误</span></span><br><span class="line">kernel: traps: palo_be[18318] <span class="built_in">trap</span> invalid opcode ip:1222ed6</span><br></pre></td></tr></table></figure><h3 id="下载安装文件"><a href="#下载安装文件" class="headerlink" title="下载安装文件"></a>下载安装文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 编译好的</span></span><br><span class="line">http://palo.baidu.com/docs/%E4%B8%8B%E8%BD%BD%E4%B8%93%E5%8C%BA/%E9%A2%84%E7%BC%96%E8%AF%91%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 或官网下载对应版本</span></span><br><span class="line">https://doris.apache.org/zh-CN/download</span><br></pre></td></tr></table></figure><h3 id="chrony时间同步"><a href="#chrony时间同步" class="headerlink" title="chrony时间同步"></a>chrony时间同步</h3><p>时间不同步会导致doris集群出问题<br>无法访问外网的话，内网拿一台作为chrony服务端，配置如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 服务端</span></span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line"></span><br><span class="line">server 0.centos.pool.ntp.org iburst</span><br><span class="line">server 1.centos.pool.ntp.org iburst</span><br><span class="line">server 2.centos.pool.ntp.org iburst</span><br><span class="line">server 3.centos.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow NTP client access from local network.</span></span><br><span class="line">allow 192.168.8.0/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># Serve time even if not synchronized to a time source.</span></span><br><span class="line"><span class="built_in">local</span> stratum 10</span><br><span class="line"></span><br><span class="line"><span class="comment">#其他默认</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## client端，把服务器改成上面的地址，其他默认，配置如下：</span></span><br><span class="line"></span><br><span class="line">server hy-base-01 iburst</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd;systemctl restart chronyd</span><br></pre></td></tr></table></figure><h3 id="关掉swap"><a href="#关掉swap" class="headerlink" title="关掉swap"></a>关掉swap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## swap开启会影响doris性能，需要关闭</span></span><br><span class="line">swapoff -a</span><br><span class="line">vi /etc/fstab</span><br><span class="line"><span class="comment">## 注释掉swap的一行</span></span><br></pre></td></tr></table></figure><h3 id="修改系统最大文件打开数"><a href="#修改系统最大文件打开数" class="headerlink" title="修改系统最大文件打开数"></a>修改系统最大文件打开数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新登录看是否生效 </span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br></pre></td></tr></table></figure><h3 id="端口规划"><a href="#端口规划" class="headerlink" title="端口规划"></a>端口规划</h3><p>由于doris默认端口都是常用的端口，很容易造成冲突，建议更改所有默认端口，这里把所有默认端口前面都加1</p><h3 id="doris配置"><a href="#doris配置" class="headerlink" title="doris配置"></a>doris配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如本机有多个IP（比如装了docker），be和fe都需要配置使用网段</span></span><br><span class="line">priority_networks = 192.168.8.0/24</span><br></pre></td></tr></table></figure><h3 id="启动第一台fe"><a href="#启动第一台fe" class="headerlink" title="启动第一台fe"></a>启动第一台fe</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一次启动最好清空元元素文件件</span></span><br><span class="line"><span class="built_in">rm</span> rf fe/doris-meta/*</span><br><span class="line"><span class="comment">#启动  </span></span><br><span class="line">fe/bin/start_fe.sh</span><br></pre></td></tr></table></figure><h3 id="启动三台be"><a href="#启动三台be" class="headerlink" title="启动三台be"></a>启动三台be</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动</span></span><br><span class="line">be/bin/start_be.sh</span><br></pre></td></tr></table></figure><h3 id="登录第一台fe，并把3台be，2台fe注册上去，初始密码为空"><a href="#登录第一台fe，并把3台be，2台fe注册上去，初始密码为空" class="headerlink" title="登录第一台fe，并把3台be，2台fe注册上去，初始密码为空"></a>登录第一台fe，并把3台be，2台fe注册上去，初始密码为空</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 192.168.8.221 -u root -P 19030 -p</span><br><span class="line"></span><br><span class="line">ALTER SYSTEM ADD BACKEND <span class="string">&quot;192.168.8.221:19050&quot;</span>;</span><br><span class="line">ALTER SYSTEM ADD BACKEND <span class="string">&quot;192.168.8.222:19050&quot;</span>;</span><br><span class="line">ALTER SYSTEM ADD BACKEND <span class="string">&quot;192.168.8.223:19050&quot;</span>;</span><br><span class="line">ALTER SYSTEM ADD FOLLOWER <span class="string">&quot;192.168.8.222:19010&quot;</span>;</span><br><span class="line">ALTER SYSTEM ADD FOLLOWER <span class="string">&quot;192.168.8.223:19010&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="启动剩余两台fe"><a href="#启动剩余两台fe" class="headerlink" title="启动剩余两台fe"></a>启动剩余两台fe</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> rf fe/doris-meta/*</span><br><span class="line"><span class="comment">#第一次启动：</span></span><br><span class="line">fe/bin/start_fe.sh  --helper 192.168.8.221:19010  --daemon</span><br><span class="line"><span class="comment">#以后可以去掉helper参数</span></span><br><span class="line">fe/bin/start_fe.sh  192.168.8.221:19010  --daemon</span><br></pre></td></tr></table></figure><h3 id="查询fe、be状态-alive均为true则为正常"><a href="#查询fe、be状态-alive均为true则为正常" class="headerlink" title="查询fe、be状态,alive均为true则为正常"></a>查询fe、be状态,alive均为true则为正常</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> PROC <span class="string">&#x27;/backends&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> PROC <span class="string">&#x27;/frontends&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;root&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;root&#x27;</span>); </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Doris集群搭建&quot;&gt;&lt;a href=&quot;#Doris集群搭建&quot; class=&quot;headerlink&quot; title=&quot;Doris集群搭建&quot;&gt;&lt;/a&gt;Doris集群搭建&lt;/h2&gt;&lt;h3 id=&quot;清单&quot;&gt;&lt;a href=&quot;#清单&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/categories/bigdata/"/>
    
    
    <category term="bigdata" scheme="https://biglovewheat.gihub.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-忘记root密码处理</title>
    <link href="https://biglovewheat.gihub.io/2023/03/27/mysql-%E5%BF%98%E8%AE%B0root%E5%AF%86%E7%A0%81%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2023/03/27/mysql-%E5%BF%98%E8%AE%B0root%E5%AF%86%E7%A0%81%E5%A4%84%E7%90%86/</id>
    <published>2023-03-26T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-忘记root密码处理"><a href="#Mysql-忘记root密码处理" class="headerlink" title="Mysql-忘记root密码处理"></a>Mysql-忘记root密码处理</h2><p>原理：修改配置文件&#x2F;etc&#x2F;my.cnf，在mysqld项增加skip-grant-tables，重启后跳过权限验证，登录成功后，清除root密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br><span class="line"><span class="comment">## 重启mysql</span></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 登录并清除root密码</span></span><br><span class="line">mysql -u root</span><br><span class="line"><span class="comment">### 直接回车，登录成功后清空root密码</span></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> authentication_string=<span class="string">&#x27;&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">mysql&gt; quit;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件去掉skip-grant-tables，并重启动mysql</span></span><br><span class="line">systemctl restart mysqld</span><br><span class="line"><span class="comment">### 登录并修改密码</span></span><br><span class="line">mysql&gt; alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;2dcP2$LWpcc1&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-忘记root密码处理&quot;&gt;&lt;a href=&quot;#Mysql-忘记root密码处理&quot; class=&quot;headerlink&quot; title=&quot;Mysql-忘记root密码处理&quot;&gt;&lt;/a&gt;Mysql-忘记root密码处理&lt;/h2&gt;&lt;p&gt;原理：修改配置文件&amp;#x2F</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Linux-日志相关</title>
    <link href="https://biglovewheat.gihub.io/2023/03/03/linux-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/"/>
    <id>https://biglovewheat.gihub.io/2023/03/03/linux-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/</id>
    <published>2023-03-02T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-日志相关"><a href="#Linux-日志相关" class="headerlink" title="Linux-日志相关"></a>Linux-日志相关</h2><h3 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h3><p>centos7系统中有两个日志服务，分别是传统的rsyslog和新添加的systemd-journal</p><h3 id="图"><a href="#图" class="headerlink" title="图"></a>图</h3><p><img src="/../images/linux%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F_01.jpg"></p><h3 id="rsyslog"><a href="#rsyslog" class="headerlink" title="rsyslog"></a>rsyslog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 系统日志</span></span><br><span class="line">/var/log/message          //绝大多数的系统日志都记录到文件</span><br><span class="line">/var/log/secure           //所有跟安全和认知授权等日志都会记录到此文件中  *****</span><br><span class="line">/var/log/maillog          //邮件服务日志</span><br><span class="line">/var/log/cron             //计划任务日志                             *****</span><br><span class="line">/var/log/boot.log         //系统启动相关的日志</span><br><span class="line">/var/log/demsg            //系统引导日志，dmesg命令查看</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 程序日志</span></span><br><span class="line">/var/log/mysql.log        //mysql日志                               *****</span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line"><span class="comment">## 特殊日志，二进制文件，不能直接查看</span></span><br><span class="line">/var/log/wtmp             //登录用户信息，使用last命令                     *****</span><br><span class="line">/var/log/btmp             //最近登录用户信息，使用lastb命令               ***</span><br><span class="line">/var/log/lastlog          //所有用户登录信息，使用lastlog命令</span><br></pre></td></tr></table></figure><h3 id="systemd-journal"><a href="#systemd-journal" class="headerlink" title="systemd-journal"></a>systemd-journal</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 显示最后10条</span></span><br><span class="line">journalctl -n 100</span><br><span class="line"></span><br><span class="line"><span class="comment">## 显示err以及以上级别的系统信息</span></span><br><span class="line">journalctl -p err</span><br><span class="line"></span><br><span class="line"><span class="comment">## 滚动输出</span></span><br><span class="line">journalctl -f</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看某个服务的日志</span></span><br><span class="line">journalctl -u mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 某段时间的日志</span></span><br><span class="line">journalctl --since=<span class="string">&quot;2022-07-06 09:00&quot;</span> --until=<span class="string">&quot;2022-07-06 10:00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## journald配置文件</span></span><br><span class="line"><span class="built_in">cat</span> /etc/systemd/journald.conf </span><br><span class="line"></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment">#Storage=auto</span></span><br><span class="line"><span class="comment">#Compress=yes</span></span><br><span class="line"><span class="comment">#Seal=yes</span></span><br><span class="line"><span class="comment">#SplitMode=uid</span></span><br><span class="line"><span class="comment">#SyncIntervalSec=5m</span></span><br><span class="line"><span class="comment">#RateLimitInterval=30s</span></span><br><span class="line"><span class="comment">#RateLimitBurst=1000</span></span><br><span class="line"><span class="comment">#SystemMaxUse=</span></span><br><span class="line"><span class="comment">#SystemKeepFree=</span></span><br><span class="line"><span class="comment">#SystemMaxFileSize=</span></span><br><span class="line"><span class="comment">#RuntimeMaxUse=</span></span><br><span class="line"><span class="comment">#RuntimeKeepFree=</span></span><br><span class="line"><span class="comment">#RuntimeMaxFileSize=</span></span><br><span class="line"><span class="comment">#MaxRetentionSec=</span></span><br><span class="line"><span class="comment">#MaxFileSec=1month</span></span><br><span class="line"><span class="comment">#ForwardToSyslog=yes</span></span><br><span class="line"><span class="comment">#ForwardToKMsg=no</span></span><br><span class="line"><span class="comment">#ForwardToConsole=no</span></span><br><span class="line"><span class="comment">#ForwardToWall=yes</span></span><br><span class="line"><span class="comment">#TTYPath=/dev/console</span></span><br><span class="line"><span class="comment">#MaxLevelStore=debug</span></span><br><span class="line"><span class="comment">#MaxLevelSyslog=debug</span></span><br><span class="line"><span class="comment">#MaxLevelKMsg=notice</span></span><br><span class="line"><span class="comment">#MaxLevelConsole=info</span></span><br><span class="line"><span class="comment">#MaxLevelWall=emerg</span></span><br><span class="line"><span class="comment">#LineMax=48K</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-日志相关&quot;&gt;&lt;a href=&quot;#Linux-日志相关&quot; class=&quot;headerlink&quot; title=&quot;Linux-日志相关&quot;&gt;&lt;/a&gt;Linux-日志相关&lt;/h2&gt;&lt;h3 id=&quot;综述&quot;&gt;&lt;a href=&quot;#综述&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-新装系统初始化</title>
    <link href="https://biglovewheat.gihub.io/2022/12/16/ansible-%E6%96%B0%E8%A3%85%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
    <id>https://biglovewheat.gihub.io/2022/12/16/ansible-%E6%96%B0%E8%A3%85%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96/</id>
    <published>2022-12-15T16:00:00.000Z</published>
    <updated>2023-08-17T22:54:44.127Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-新装系统初始化"><a href="#Ansible-新装系统初始化" class="headerlink" title="Ansible-新装系统初始化"></a>Ansible-新装系统初始化</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><em>ansible是一个自动化运维工具，基于Python开发，集合了众多运维工具（puppet、cfengine、chef、func、fabric）的优点，实现了批量系统配置、批量程序部署、批量运行命令等功能。Ansible架构相对比较简单，无需agnet，仅需通过SSH连接客户机即可执行任务。</em></p><p><em>简单任务可以直接使用命令行方式运行，较复杂任务可以通过编写playbook方式运行，以下例子通过编写palybook方式，使用角色区分，简单初始化centos7。</em></p><p>语法参考：<a href="https://docs.ansible.com/ansible/latest/modules/modules_by_category.htm">https://docs.ansible.com/ansible/latest/modules/modules_by_category.htm</a><br>Ansible Galaxy命令，用于安装指定的角色或集合：<a href="https://galaxy.ansible.com/">https://galaxy.ansible.com/</a></p><h3 id="初始化文件夹"><a href="#初始化文件夹" class="headerlink" title="初始化文件夹"></a>初始化文件夹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 创建整个项目文件夹</span></span><br><span class="line"><span class="built_in">mkdir</span> ansible-init</span><br><span class="line"><span class="built_in">cd</span> ansible-init</span><br><span class="line"><span class="built_in">mkdir</span> roles</span><br><span class="line"><span class="built_in">touch</span> ansible-host.lst</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化roles</span></span><br><span class="line"><span class="built_in">cd</span> roles</span><br><span class="line">ansible-galaxy init common</span><br><span class="line"></span><br><span class="line">ansible-init/</span><br><span class="line">├── ansible-host.lst</span><br><span class="line">└── roles</span><br><span class="line">    └── common</span><br><span class="line">        ├── defaults</span><br><span class="line">        │   └── main.yml</span><br><span class="line">        ├── files</span><br><span class="line">        ├── handlers</span><br><span class="line">        │   └── main.yml</span><br><span class="line">        ├── meta</span><br><span class="line">        │   └── main.yml</span><br><span class="line">        ├── README.md</span><br><span class="line">        ├── tasks</span><br><span class="line">        │   └── main.yml</span><br><span class="line">        ├── templates</span><br><span class="line">        ├── tests</span><br><span class="line">        │   ├── inventory</span><br><span class="line">        │   └── test.yml</span><br><span class="line">        └── vars</span><br><span class="line">            └── main.yml</span><br><span class="line"></span><br><span class="line">10 directories, 9 files</span><br></pre></td></tr></table></figure><h3 id="配置主机清单-ansible-x2F-ansible-host-lst"><a href="#配置主机清单-ansible-x2F-ansible-host-lst" class="headerlink" title="配置主机清单 ansible&#x2F;ansible-host.lst"></a>配置主机清单 ansible&#x2F;ansible-host.lst</h3><p>将主机分组，并定义变量，指定运行的用户或明文密码</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">all</span>]</span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.252</span>  <span class="string">hostname=vm252</span>  <span class="string">server_type=app</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.253</span>  <span class="string">hostname=vm252</span>  <span class="string">server_type=db</span></span><br><span class="line"></span><br><span class="line">[<span class="string">db</span>]</span><br><span class="line"><span class="number">192.168</span><span class="number">.8</span><span class="number">.253</span>  <span class="string">hostname=vm252</span>  <span class="string">server_type=db</span></span><br><span class="line"></span><br><span class="line">[<span class="string">all:vars</span>]</span><br><span class="line"><span class="string">ansible_user=root</span></span><br><span class="line"><span class="string">ansible_password=12341234</span></span><br></pre></td></tr></table></figure><h3 id="入口脚本-ansible-x2F-init-yml"><a href="#入口脚本-ansible-x2F-init-yml" class="headerlink" title="入口脚本 ansible&#x2F;init.yml"></a>入口脚本 ansible&#x2F;init.yml</h3><p>这个是整个playbook入口，可以按不同主机组运行不同角色（roles）</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">## 全部运行common角色</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">common</span></span><br><span class="line"><span class="comment">## db组运行db1角色、db2角色</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">db</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">gather_facts:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">roles:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db2</span></span><br></pre></td></tr></table></figure><h3 id="配置主脚本-ansible-x2F-roles-x2F-common-x2F-task-x2F-main-yml"><a href="#配置主脚本-ansible-x2F-roles-x2F-common-x2F-task-x2F-main-yml" class="headerlink" title="配置主脚本 ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;main.yml"></a>配置主脚本 ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;main.yml</h3><p>主脚本默认为main.yml，里面可以包含各种子任务</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">set-hosts.yml</span>   </span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">set-yum-repo-cdrom.yml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">set-centos7.yml</span></span><br><span class="line"><span class="comment">#- include_tasks: set-yum-repo-local.yml</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">include_tasks:</span> <span class="string">install-base-tools.yml</span></span><br><span class="line"><span class="comment">#- include_tasks: set-hy.yml</span></span><br></pre></td></tr></table></figure><h3 id="子任务1，ansible-x2F-roles-x2F-common-x2F-task-x2F-set-hosts-yml"><a href="#子任务1，ansible-x2F-roles-x2F-common-x2F-task-x2F-set-hosts-yml" class="headerlink" title="子任务1，ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;set-hosts.yml"></a>子任务1，ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;set-hosts.yml</h3><p>这里用到copy，表示会在当前roles的files文件夹里查找hosts文件，并复制到目标主机</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">set</span> <span class="string">/etc/hosts</span></span><br><span class="line">  <span class="attr">copy:</span> <span class="string">src=hosts</span> <span class="string">dest=/etc/hosts</span></span><br></pre></td></tr></table></figure><h3 id="子任务2，ansible-x2F-roles-x2F-common-x2F-task-x2F-set-yum-repo-local-yml"><a href="#子任务2，ansible-x2F-roles-x2F-common-x2F-task-x2F-set-yum-repo-local-yml" class="headerlink" title="子任务2，ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;set-yum-repo-local.yml"></a>子任务2，ansible&#x2F;roles&#x2F;common&#x2F;task&#x2F;set-yum-repo-local.yml</h3><p>这里用到template，表示会将当前roles的templates文件夹查找local.repo.j2文件，并替换里面的变量后，复制到目标主机。需要修改为变量的场景，适合使用template模块。template使用jinja2语法。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#125;&#125; ：用来装载表达式，比如变量、运算表达式、比较表达式等。</span><br><span class="line">&#123;% %&#125; ：用来装载控制语句，比如 if 控制结构，for循环控制结构。</span><br><span class="line">&#123;# #&#125; ：用来装载注释，模板文件被渲染后，注释不会包含在最终生成的文件中。</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">backup</span> <span class="string">yum</span> <span class="string">repo</span> <span class="string">files</span></span><br><span class="line">  <span class="attr">shell:</span> <span class="string">&#x27;find /etc/yum.repos.d/ -name &quot;*.repo&quot; -exec mv &#123;&#125; &#123;&#125;.$(date +&quot;%Y%m%d%H%M&quot;) \;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">set</span> <span class="string">yum</span> <span class="string">repo</span></span><br><span class="line">  <span class="attr">template:</span> <span class="string">src=local.repo.j2</span> <span class="string">dest=/etc/yum.repos.d/local.repo</span></span><br></pre></td></tr></table></figure><p>用到的变量在vars&#x2F;main.yml里定义</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">prometheus:</span></span><br><span class="line">  <span class="attr">base_path:</span> <span class="string">/data/moni</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.201</span><span class="string">:9090</span></span><br><span class="line">  <span class="attr">consul:</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.201</span><span class="string">:18500</span></span><br><span class="line"><span class="attr">chrony:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.201</span></span><br><span class="line">  <span class="attr">priority_networks:</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.0</span><span class="string">/24</span></span><br><span class="line"><span class="attr">yum:</span></span><br><span class="line">  <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.8</span><span class="number">.251</span><span class="string">:18001</span></span><br></pre></td></tr></table></figure><p>template放在templates文件夹里，上面用到的是local.repo.j2</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">base</span>]</span><br><span class="line"><span class="string">name=local</span></span><br><span class="line"><span class="string">baseurl=http://&#123;&#123;</span> <span class="string">yum.server</span> <span class="string">&#125;&#125;/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1</span></span><br></pre></td></tr></table></figure><h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 测试</span></span><br><span class="line">ansible-playbook -i ansible_host.lst -C init.yml</span><br><span class="line"><span class="comment">## 运行</span></span><br><span class="line">ansible-playbook -i ansible_host.lst init.yml</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>整个初始化脚本框架搭建完毕</p><p>接下来需要添加各种子脚本，然后在主脚本main.yml引入即可</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Ansible-新装系统初始化&quot;&gt;&lt;a href=&quot;#Ansible-新装系统初始化&quot; class=&quot;headerlink&quot; title=&quot;Ansible-新装系统初始化&quot;&gt;&lt;/a&gt;Ansible-新装系统初始化&lt;/h2&gt;&lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="ansible" scheme="https://biglovewheat.gihub.io/tags/ansible/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
  </entry>
  
</feed>
