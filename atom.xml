<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-08-02T01:20:00.000Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Shell-获取Mysql查询返回值</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/</id>
    <published>2022-08-02T06:07:37.355Z</published>
    <updated>2022-08-02T01:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell-获取Mysql查询返回值"><a href="#Shell-获取Mysql查询返回值" class="headerlink" title="Shell-获取Mysql查询返回值"></a>Shell-获取Mysql查询返回值</h2><h3 id="获取单个值"><a href="#获取单个值" class="headerlink" title="获取单个值"></a>获取单个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MYSQL_PWD=123abc!!!</span><br><span class="line">aa=$(mysql -h192.168.8.240 -uroot -Ddatacut -e <span class="string">&quot;select apppath from sys_d_code&quot;</span> --skip-column-names)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$aa</span></span><br><span class="line"></span><br><span class="line">user=root</span><br><span class="line">pass=yfgzSap123</span><br><span class="line">port=9901</span><br><span class="line">db=datacut</span><br><span class="line">table=sys_d_code</span><br><span class="line"><span class="built_in">set</span> `mysql -u<span class="variable">$user</span> -p<span class="variable">$pass</span> -D<span class="variable">$db</span> -P <span class="variable">$port</span> -e <span class="string">&quot;select outpath from <span class="variable">$table</span>&quot;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure><h3 id="获取多个值"><a href="#获取多个值" class="headerlink" title="获取多个值"></a>获取多个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pmysqlroot -Dmmmtest -e <span class="string">&quot;select &#x27;aa&#x27;,count(1) from aa&quot;</span> --skip-column-names|<span class="keyword">while</span> <span class="built_in">read</span> a b</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;a href=&quot;#Shell-获取Mysql查询返回值&quot; class=&quot;headerlink&quot; title=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;/a&gt;Shell-获取Mysql查询返回值&lt;/h2&gt;&lt;h3 id=&quot;获</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql备份恢复</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/</id>
    <published>2022-08-02T06:07:36.950Z</published>
    <updated>2022-08-02T01:19:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql备份恢复"><a href="#Mysql备份恢复" class="headerlink" title="Mysql备份恢复"></a>Mysql备份恢复</h2><h3 id="mysqldump备份恢复"><a href="#mysqldump备份恢复" class="headerlink" title="mysqldump备份恢复"></a>mysqldump备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/mysqldata_backup</span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"></span><br><span class="line">passwd=$(grep password /etc/my.cnf |awk  <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> |<span class="built_in">head</span> -1)</span><br><span class="line">mysqldump -uroot -p<span class="variable">$passwd</span> --all-databases --set-gtid-purged=OFF |gzip &gt;<span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 上传到aws s3</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz s3://aaa/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 清理过期</span></span><br><span class="line">find <span class="variable">$ROOT_PATH</span> -mtime +1 -<span class="built_in">type</span> f -name <span class="string">&quot;*.sql.gz&quot;</span> | xargs <span class="built_in">rm</span> -vf</span><br><span class="line"></span><br><span class="line"><span class="comment">##恢复</span></span><br><span class="line"><span class="comment">#gunzip &lt; test.tar.gz |mysql -hlocalhost -uroot -pxxxxx</span></span><br></pre></td></tr></table></figure><h3 id="xtrabackup备份恢复"><a href="#xtrabackup备份恢复" class="headerlink" title="xtrabackup备份恢复"></a>xtrabackup备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##全量备份</span></span><br><span class="line">$ xtrabackup --backup --target-dir=/data/backups/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复1-修改root密码为备份数据库密码</span></span><br><span class="line">use mysql；</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复2-新建目录，修改my.cnf指向目录，并修改目录权限mysql:mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复3-准备步骤</span></span><br><span class="line">$ xtrabackup --prepare --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复4-拷贝文件</span></span><br><span class="line">$ xtrabackup --copy-back --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复5-修改目录权限mysql:mysql</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">##启动数据库</span></span><br><span class="line">systemctl start mysql</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql备份恢复&quot;&gt;&lt;a href=&quot;#Mysql备份恢复&quot; class=&quot;headerlink&quot; title=&quot;Mysql备份恢复&quot;&gt;&lt;/a&gt;Mysql备份恢复&lt;/h2&gt;&lt;h3 id=&quot;mysqldump备份恢复&quot;&gt;&lt;a href=&quot;#mysqldump备份恢</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-too-many-connections错误</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/</id>
    <published>2022-08-02T06:07:36.549Z</published>
    <updated>2022-08-02T01:19:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-too-many-connections错误"><a href="#Mysql-too-many-connections错误" class="headerlink" title="Mysql-too-many-connections错误"></a>Mysql-too-many-connections错误</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## 查看最大连接数</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> processlist;  </span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;Threads%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 查看timeout</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%timeout&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 设置timeout</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> wait_timeout<span class="operator">=</span><span class="number">300</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> interactive_timeout<span class="operator">=</span><span class="number">500</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;a href=&quot;#Mysql-too-many-connections错误&quot; class=&quot;headerlink&quot; title=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;/a&gt;My</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-RPM-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-02T06:07:36.144Z</published>
    <updated>2022-08-02T01:20:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-RPM-安装"><a href="#Mysql-RPM-安装" class="headerlink" title="Mysql-RPM-安装"></a>Mysql-RPM-安装</h2><h3 id="mysql5-7-centos7"><a href="#mysql5-7-centos7" class="headerlink" title="mysql5.7+centos7"></a>mysql5.7+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mysql-libs</span></span><br><span class="line">rpm -qa |grep mysql</span><br><span class="line">rpm -e mysql-libs-5.1.73-8.el6_8.x86_64 --nodeps</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-compat-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-5.7.24-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mysql8-centos7"><a href="#mysql8-centos7" class="headerlink" title="mysql8+centos7"></a>mysql8+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mariadb</span></span><br><span class="line">rpm -e $(rpm -qa |grep maria) --nodeps</span><br><span class="line">yum install -y net-tools.x86_64 libaio.x86_64 perl.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-plugins-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-server-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-RPM-安装&quot;&gt;&lt;a href=&quot;#Mysql-RPM-安装&quot; class=&quot;headerlink&quot; title=&quot;Mysql-RPM-安装&quot;&gt;&lt;/a&gt;Mysql-RPM-安装&lt;/h2&gt;&lt;h3 id=&quot;mysql5-7-centos7&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Linux设置最大文件打开数</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/</id>
    <published>2022-08-02T06:07:35.739Z</published>
    <updated>2022-08-02T01:36:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux设置最大文件打开数"><a href="#Linux设置最大文件打开数" class="headerlink" title="Linux设置最大文件打开数"></a>Linux设置最大文件打开数</h2><h3 id="系统级"><a href="#系统级" class="headerlink" title="系统级"></a>系统级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file-max一般为内存大小（KB）的10%来计算，一般我们不需要主动设置这个值，除非这个值确实较小</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/fs/file-max</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改方法</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max = 2000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="用户级"><a href="#用户级" class="headerlink" title="用户级"></a>用户级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line">或</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（session生效）</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（永久）</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux设置最大文件打开数&quot;&gt;&lt;a href=&quot;#Linux设置最大文件打开数&quot; class=&quot;headerlink&quot; title=&quot;Linux设置最大文件打开数&quot;&gt;&lt;/a&gt;Linux设置最大文件打开数&lt;/h2&gt;&lt;h3 id=&quot;系统级&quot;&gt;&lt;a href=&quot;#系统</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>shell循环例子</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/</id>
    <published>2022-08-01T07:19:52.825Z</published>
    <updated>2022-08-01T07:19:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell循环例子"><a href="#shell循环例子" class="headerlink" title="shell循环例子"></a>shell循环例子</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> aa.txt);<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$row</span> ;<span class="built_in">sleep</span> 2; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 3</span></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=100; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> <span class="built_in">date</span>; <span class="built_in">uptime</span>; <span class="built_in">sleep</span> 5; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 2</span></span><br><span class="line"><span class="built_in">cat</span> a.txt | <span class="keyword">while</span> <span class="built_in">read</span> row</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell循环例子&quot;&gt;&lt;a href=&quot;#shell循环例子&quot; class=&quot;headerlink&quot; title=&quot;shell循环例子&quot;&gt;&lt;/a&gt;shell循环例子&lt;/h2&gt;&lt;h3 id=&quot;for循环&quot;&gt;&lt;a href=&quot;#for循环&quot; class=&quot;header</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Oracle用户管理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</id>
    <published>2022-08-01T07:19:52.339Z</published>
    <updated>2022-08-01T07:18:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle用户管理"><a href="#Oracle用户管理" class="headerlink" title="Oracle用户管理"></a>Oracle用户管理</h2><h3 id="创建只读用户"><a href="#创建只读用户" class="headerlink" title="创建只读用户"></a>创建只读用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> query identified <span class="keyword">by</span> query <span class="keyword">default</span> tablespace cc;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">connect</span> <span class="keyword">to</span> query ;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">to</span> query;</span><br><span class="line"><span class="comment">--grant select on  aaa to query;</span></span><br><span class="line"><span class="comment">--数据字典权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">any</span> dictionary <span class="keyword">to</span> query;</span><br></pre></td></tr></table></figure><h3 id="创建sysdba权限用户"><a href="#创建sysdba权限用户" class="headerlink" title="创建sysdba权限用户"></a>创建sysdba权限用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> zdbackup identified <span class="keyword">by</span> zdbackup ;</span><br><span class="line"><span class="keyword">grant</span> sysdba <span class="keyword">to</span> zdbackup;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> session, <span class="keyword">connect</span>, resource <span class="keyword">to</span> zdbackup ;</span><br></pre></td></tr></table></figure><h3 id="用户解锁"><a href="#用户解锁" class="headerlink" title="用户解锁"></a>用户解锁</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott account unlock;</span><br></pre></td></tr></table></figure><h3 id="用户更改密码"><a href="#用户更改密码" class="headerlink" title="用户更改密码"></a>用户更改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> user01 identified <span class="keyword">by</span> user10;</span><br></pre></td></tr></table></figure><h3 id="不知道密码的情况下，修改新密码等于旧密码"><a href="#不知道密码的情况下，修改新密码等于旧密码" class="headerlink" title="不知道密码的情况下，修改新密码等于旧密码"></a>不知道密码的情况下，修改新密码等于旧密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_users;</span><br><span class="line">FSSC_LINK                      <span class="number">737</span>A7F19A6C8315B</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> FSSC_LINK identified <span class="keyword">by</span> <span class="keyword">values</span> <span class="string">&#x27;737A7F19A6C8315B&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> xxxDROP <span class="keyword">USER</span> XXx CASCADE</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle用户管理&quot;&gt;&lt;a href=&quot;#Oracle用户管理&quot; class=&quot;headerlink&quot; title=&quot;Oracle用户管理&quot;&gt;&lt;/a&gt;Oracle用户管理&lt;/h2&gt;&lt;h3 id=&quot;创建只读用户&quot;&gt;&lt;a href=&quot;#创建只读用户&quot; class=&quot;</summary>
      
    
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/categories/oracle/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Mysql数据导入导出</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</id>
    <published>2022-08-01T07:19:51.917Z</published>
    <updated>2022-08-01T07:18:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql数据导入导出"><a href="#Mysql数据导入导出" class="headerlink" title="Mysql数据导入导出"></a>Mysql数据导入导出</h2><h3 id="导出到文本"><a href="#导出到文本" class="headerlink" title="导出到文本"></a>导出到文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">select tablename,keymap from cut_table <span class="built_in">where</span> iskeymap=1</span><br><span class="line">into outfile <span class="string">&quot;<span class="variable">$OUTFILE</span>&quot;</span></span><br><span class="line">FIELDS TERMINATED BY <span class="string">&#x27;|&#x27;</span> ;</span><br><span class="line">!</span><br></pre></td></tr></table></figure><h3 id="导入文本"><a href="#导入文本" class="headerlink" title="导入文本"></a>导入文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">load data infile <span class="string">&#x27;$OUTFILE&#x27;</span> into table cut_pkey fields terminated by <span class="string">&#x27;|&#x27;</span></span><br><span class="line">(dbname,list_code,pkeyname,pkeyvalue,status);</span><br><span class="line">!</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql数据导入导出&quot;&gt;&lt;a href=&quot;#Mysql数据导入导出&quot; class=&quot;headerlink&quot; title=&quot;Mysql数据导入导出&quot;&gt;&lt;/a&gt;Mysql数据导入导出&lt;/h2&gt;&lt;h3 id=&quot;导出到文本&quot;&gt;&lt;a href=&quot;#导出到文本&quot; class</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql实现dblink</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E5%AE%9E%E7%8E%B0dblink/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E5%AE%9E%E7%8E%B0dblink/</id>
    <published>2022-08-01T07:19:51.021Z</published>
    <updated>2022-08-01T07:18:58.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql实现dblink"><a href="#Mysql实现dblink" class="headerlink" title="Mysql实现dblink"></a>Mysql实现dblink</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server version: 8.0.23 MySQL Community Server - GPL</span><br></pre></td></tr></table></figure><h3 id="查看引擎"><a href="#查看引擎" class="headerlink" title="查看引擎"></a>查看引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">show engines;</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |</span><br><span class="line">| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |</span><br><span class="line">| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored <span class="keyword">in</span> memory, useful <span class="keyword">for</span> temporary tables      | NO           | NO   | NO         |</span><br><span class="line">| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#federated 有安装但没有开启</span></span><br></pre></td></tr></table></figure><h3 id="设置参数并重启数据库"><a href="#设置参数并重启数据库" class="headerlink" title="设置参数并重启数据库"></a>设置参数并重启数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;federated&quot;</span> &gt;&gt;/etc/my.cnf</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_tasks_operate` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `tasks_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;调度任务id&#x27;</span>,</span><br><span class="line">  KEY `tasks_id_index` (`tasks_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>FEDERATED <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_general_ci ROW_FORMAT<span class="operator">=</span>COMPACT CONNECTION<span class="operator">=</span><span class="string">&#x27;mysql://root:123456@192.168.1.1:3306/farm_test/t_tasks_operate&#x27;</span> ;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql实现dblink&quot;&gt;&lt;a href=&quot;#Mysql实现dblink&quot; class=&quot;headerlink&quot; title=&quot;Mysql实现dblink&quot;&gt;&lt;/a&gt;Mysql实现dblink&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; cla</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql数据同步脚本</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E8%84%9A%E6%9C%AC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E8%84%9A%E6%9C%AC/</id>
    <published>2022-08-01T07:10:30.586Z</published>
    <updated>2022-08-01T06:36:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql数据同步脚本"><a href="#Mysql数据同步脚本" class="headerlink" title="Mysql数据同步脚本"></a>Mysql数据同步脚本</h2><p><em>用mysqldump同步两个数据库</em></p><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├── db.lst                   <span class="comment">## 数据库对照表</span></span><br><span class="line">├── ignore-table.lst         <span class="comment">## 只同步结构，不同步数据的表</span></span><br><span class="line">├── mysql_sync.sh            <span class="comment">## 主程序</span></span><br><span class="line">├── source.lst               <span class="comment">## 源数据库的配置信息</span></span><br><span class="line">└── target.lst               <span class="comment">## 目标数据库的配置信息</span></span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat db.lst</span></span><br><span class="line"><span class="comment">##sourcedb|targetdb</span></span><br><span class="line">telematics|telematics</span><br><span class="line">iot_sit|iot</span><br><span class="line">baseinfo_sit|base_info</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat ignore-table.lst </span></span><br><span class="line"><span class="comment">#sourcedb.table</span></span><br><span class="line">farm_sit.t_task_machinery_msg_log_20220511</span><br><span class="line">smart_farm_test.t_ag_machinery_work_log</span><br><span class="line">farm_sit.t_task_machinery_msg_log</span><br><span class="line">smart_farm_test.um_user_action_log</span><br><span class="line">farm_sit.t_synergy_task_realtime_info</span><br><span class="line">smart_farm_test.t_drainirrigate_eq_log</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat source.lst</span></span><br><span class="line">[client]</span><br><span class="line">user=super</span><br><span class="line">password=123456</span><br><span class="line">host=172.31.40.125</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># cat target.lst </span></span><br><span class="line">[client]</span><br><span class="line">user=root</span><br><span class="line">password=123456</span><br><span class="line">host=localhost</span><br><span class="line">port=3306</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> db <span class="keyword">in</span> $(<span class="built_in">cat</span> db.lst|grep -v ^<span class="comment">#)</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">sdb=$(<span class="built_in">echo</span> <span class="variable">$db</span>|awk -F\| <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">tdb=$(<span class="built_in">echo</span> <span class="variable">$db</span>|awk -F\| <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sync <span class="variable">$sdb</span> --&gt; <span class="variable">$tdb</span> &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;drop database if exists \`<span class="variable">$tdb</span>\`;&quot;</span>|mysql --defaults-extra-file=target.lst</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;create database \`<span class="variable">$tdb</span>\`;&quot;</span>|mysql --defaults-extra-file=target.lst</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> grep -q <span class="variable">$x</span> ^<span class="variable">$sdb</span> ignore-table.lst</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(grep ^<span class="variable">$sdb</span> ignore-table.lst)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">row1=$(<span class="built_in">echo</span> row |awk -F\. <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">row2=<span class="variable">$row</span></span><br><span class="line">str1=<span class="variable">$str1</span><span class="string">&quot; &quot;</span><span class="variable">$row1</span></span><br><span class="line">str2=<span class="variable">$str2</span><span class="string">&quot; --ignore-table &quot;</span><span class="variable">$row2</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str1</span> <span class="variable">$str2</span></span><br><span class="line">mysqldump --defaults-extra-file=source.lst --opt <span class="variable">$sdb</span> --tables <span class="variable">$str1</span> --no-data| mysql --defaults-extra-file=target.lst -C <span class="variable">$tdb</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">mysqldump --defaults-extra-file=source.lst --opt <span class="variable">$sdb</span> <span class="variable">$str2</span> | mysql --defaults-extra-file=target.lst -C <span class="variable">$tdb</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## no data</span></span><br><span class="line"><span class="comment">#mysqldump --defaults-extra-file=source.lst --opt $sdb $str2 --no-data | mysql --defaults-extra-file=target.lst -C $tdb</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql数据同步脚本&quot;&gt;&lt;a href=&quot;#Mysql数据同步脚本&quot; class=&quot;headerlink&quot; title=&quot;Mysql数据同步脚本&quot;&gt;&lt;/a&gt;Mysql数据同步脚本&lt;/h2&gt;&lt;p&gt;&lt;em&gt;用mysqldump同步两个数据库&lt;/em&gt;&lt;/p&gt;
&lt;h3</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>rsync同步</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/rsync%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/rsync%E5%90%8C%E6%AD%A5/</id>
    <published>2022-07-27T05:58:10.731Z</published>
    <updated>2022-07-27T00:30:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="rsync同步"><a href="#rsync同步" class="headerlink" title="rsync同步"></a>rsync同步</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y rsync</span><br></pre></td></tr></table></figure><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-a 归档模式</span><br><span class="line">-v 详细模式</span><br><span class="line">-z 传输过程中压缩</span><br><span class="line">-u 更新模式</span><br><span class="line">-t 保持文件时间</span><br><span class="line">-P 显示进度</span><br><span class="line">--progress 显示过程中的状态</span><br><span class="line">--delete 实现无差异数据同步，删掉dst的文件</span><br><span class="line">--exclude 排除,目录相对于src目录</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rsync -avzut -P --progress /data/aaa/ root@10.9.127.33:/data/bbb/</span><br><span class="line"></span><br><span class="line">rsync -avzut -P --progress /var/lib/jenkins/ ops_root@172.31.51.65:/data/backup/jenkins/  --exclude workspace  --exclude .cache --exclude .npm</span><br></pre></td></tr></table></figure><h3 id="排除列表脚本"><a href="#排除列表脚本" class="headerlink" title="排除列表脚本"></a>排除列表脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 排除列表</span></span><br><span class="line"><span class="built_in">cat</span> sync_gis.exclude.lst</span><br><span class="line">geoserver/8083/</span><br><span class="line">geoserver/8084/logs/</span><br><span class="line">geoserver/8084/temp/</span><br><span class="line">geoserver/6066/logs/</span><br><span class="line">geoserver/6066/temp/</span><br><span class="line">geoserver/data/data_8083/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">geoserver/data/data_6066/data/test0903</span><br><span class="line">geoserver/data/data_6066/logs/</span><br><span class="line">geoserver/data/data_6066/gwc/</span><br><span class="line">geoserver/data/data_8084/logs/</span><br><span class="line">geoserver/data/data_8084/gwc/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"></span><br><span class="line">CMDSTR=<span class="string">&#x27;cd /home/gis/server;rsync -avzut geoserver /s3mnt/gis_data/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> sync_gis.exclude.lst |grep -v ^<span class="comment"># |grep -v ^$);do</span></span><br><span class="line">    CMDSTR=<span class="variable">$CMDSTR</span><span class="string">&quot; --exclude &quot;</span><span class="variable">$row</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CMDSTR</span> |sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;rsync同步&quot;&gt;&lt;a href=&quot;#rsync同步&quot; class=&quot;headerlink&quot; title=&quot;rsync同步&quot;&gt;&lt;/a&gt;rsync同步&lt;/h2&gt;&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="backup" scheme="https://biglovewheat.gihub.io/tags/backup/"/>
    
  </entry>
  
  <entry>
    <title>Python-查数据库-邮件告警</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/python-%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/python-%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%BA%93-%E9%82%AE%E4%BB%B6%E5%91%8A%E8%AD%A6/</id>
    <published>2022-07-27T05:58:10.255Z</published>
    <updated>2022-07-27T00:39:35.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-查数据库-邮件告警"><a href="#Python-查数据库-邮件告警" class="headerlink" title="Python-查数据库-邮件告警"></a>Python-查数据库-邮件告警</h2><p><em>一个python写的简单的查数据库脚本，配合crontab和邮件实现定时监控和告警。</em></p><h3 id="监控脚本"><a href="#监控脚本" class="headerlink" title="监控脚本"></a>监控脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/python3/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">dd=(datetime.datetime.now()+datetime.timedelta(days=-<span class="number">1</span>)).strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> (dd)</span><br><span class="line"></span><br><span class="line">db = pymysql.Connect(host=<span class="string">&#x27;10.0.0.1&#x27;</span>,port=<span class="number">3306</span>,user=<span class="string">&#x27;root&#x27;</span>,passwd=<span class="string">&#x27;123456&#x27;</span>,db=<span class="string">&#x27;testdb&#x27;</span>,charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;select * from t_farm where time=&#x27;&quot;</span>+dd+<span class="string">&quot;&#x27;;&quot;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">row=cursor.rowcount</span><br><span class="line"><span class="comment">#print (row)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> row == <span class="number">0</span> :</span><br><span class="line">    msg = MIMEText(dd+<span class="string">&#x27;的条目数是: &#x27;</span>+<span class="built_in">str</span>(row)+<span class="string">&#x27; ,请检查。&#x27;</span>,<span class="string">&#x27;plain&#x27;</span>,<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    from_addr = <span class="string">&#x27;biglovewheat@126.com&#x27;</span></span><br><span class="line">    password = <span class="string">&#x27;GQYRFCDKEXEIHQGH&#x27;</span>   <span class="comment">## 邮箱的授权密码，非用户密码</span></span><br><span class="line">    to_addr = [<span class="string">&#x27;biglovewheat@126.com&#x27;</span>,<span class="string">&#x27;aa@126.com&#x27;</span>]</span><br><span class="line">    smtp_server = <span class="string">&#x27;smtp.126.com&#x27;</span></span><br><span class="line">    msg[<span class="string">&#x27;From&#x27;</span>] = from_addr</span><br><span class="line">    msg[<span class="string">&#x27;To&#x27;</span>] = <span class="string">&#x27;,&#x27;</span>.join(to_addr)</span><br><span class="line">    msg[<span class="string">&#x27;Subject&#x27;</span>] = <span class="string">&#x27;Python脚本告警&#x27;</span></span><br><span class="line">    server = smtplib.SMTP_SSL(smtp_server,<span class="number">465</span>)</span><br><span class="line">    server.login(from_addr,password)</span><br><span class="line">    server.sendmail(from_addr,to_addr,msg.as_string())</span><br><span class="line">    server.quit()</span><br></pre></td></tr></table></figure><h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">31 4 * * * /data/app/moni.py &gt;&gt; /data/app/moni.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-查数据库-邮件告警&quot;&gt;&lt;a href=&quot;#Python-查数据库-邮件告警&quot; class=&quot;headerlink&quot; title=&quot;Python-查数据库-邮件告警&quot;&gt;&lt;/a&gt;Python-查数据库-邮件告警&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个python写的</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="Python" scheme="https://biglovewheat.gihub.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>prometheus-mysql-监控</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/prometheus-mysql-%E7%9B%91%E6%8E%A7/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/prometheus-mysql-%E7%9B%91%E6%8E%A7/</id>
    <published>2022-07-27T05:58:09.755Z</published>
    <updated>2022-07-27T02:10:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="prometheus-mysql-监控"><a href="#prometheus-mysql-监控" class="headerlink" title="prometheus-mysql-监控"></a>prometheus-mysql-监控</h2><h3 id="mysql创建用户并授权"><a href="#mysql创建用户并授权" class="headerlink" title="mysql创建用户并授权"></a>mysql创建用户并授权</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>; </span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION CLIENT,PROCESS,<span class="keyword">SELECT</span>  <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;exporter&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> ; </span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="mysql-exporter配置"><a href="#mysql-exporter配置" class="headerlink" title="mysql-exporter配置"></a>mysql-exporter配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># client.cnf</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;/opt/mysqld_exporter/.client.cnf</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">user=exporter</span></span><br><span class="line"><span class="string">password=123456</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl配置</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;/usr/lib/systemd/system/mysqld_exporter.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description= Prometheus MySQL Exporter</span></span><br><span class="line"><span class="string">Wants=network-online.target</span></span><br><span class="line"><span class="string">After=network-online.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">Group=root</span></span><br><span class="line"><span class="string">Type=simple</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"><span class="string">ExecStart=/opt/mysqld_exporter/mysqld_exporter \</span></span><br><span class="line"><span class="string">--config.my-cnf /opt/mysqld_exporter/.client.cnf \</span></span><br><span class="line"><span class="string">--web.listen-address=0.0.0.0:51235</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="prometheus配置"><a href="#prometheus配置" class="headerlink" title="prometheus配置"></a>prometheus配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增加配置并重启prometheus</span></span><br><span class="line">prometheus 配置</span><br><span class="line">  - job_name: mysql</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&#x27;172.31.40.125:51235&#x27;</span>, <span class="string">&#x27;172.31.36.28:51235&#x27;</span>]</span><br></pre></td></tr></table></figure><h3 id="grafana配置"><a href="#grafana配置" class="headerlink" title="grafana配置"></a>grafana配置</h3><p><a href="https://grafana.com/grafana/dashboards/7362">grafana.com&#x2F;grafana&#x2F;dashboards&#x2F;</a></p><h3 id="alert-manager告警配置"><a href="#alert-manager告警配置" class="headerlink" title="alert-manager告警配置"></a>alert-manager告警配置</h3><p>待补充</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;prometheus-mysql-监控&quot;&gt;&lt;a href=&quot;#prometheus-mysql-监控&quot; class=&quot;headerlink&quot; title=&quot;prometheus-mysql-监控&quot;&gt;&lt;/a&gt;prometheus-mysql-监控&lt;/h2&gt;&lt;h3 i</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="prometheus" scheme="https://biglovewheat.gihub.io/tags/prometheus/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>MinIO集群安装</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/minio%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/minio%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/</id>
    <published>2022-07-27T05:58:09.261Z</published>
    <updated>2022-07-27T01:34:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MinIO集群安装"><a href="#MinIO集群安装" class="headerlink" title="MinIO集群安装"></a>MinIO集群安装</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p><a href="https://docs.min.io/minio/baremetal/installation/deploy-minio-distributed.html#deploy-minio-distributed">https://docs.min.io/minio/baremetal/installation/deploy-minio-distributed.html#deploy-minio-distributed</a></p><h3 id="集群信息"><a href="#集群信息" class="headerlink" title="集群信息"></a>集群信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 集群至少需要4个文件系统，可用空间为4台空间之和的一半，&gt;=2台，数据可读，&gt;=3台，数据可读写</span></span><br><span class="line">http://172.31.62.161/data/minio/cluster_data</span><br><span class="line">http://172.31.56.16/data/minio/cluster_data</span><br><span class="line">http://172.31.57.206/data/minio/cluster_data</span><br><span class="line">http://172.31.36.28/data/minio/cluster_data</span><br></pre></td></tr></table></figure><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.min.io/server/minio/release/linux-amd64/minio</span><br><span class="line"><span class="built_in">chmod</span> +x minio</span><br><span class="line">wget https://dl.min.io/client/mc/release/linux-amd64/mc</span><br><span class="line"><span class="built_in">chmod</span> +x mc</span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; startup.sh</span></span><br><span class="line"><span class="string">export MINIO_ROOT_USER=&#x27;minioadmin&#x27;</span></span><br><span class="line"><span class="string">export MINIO_ROOT_PASSWORD=&#x27;minioadmin&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nohup /data/minio/minio server --address &quot;:29000&quot; --console-address &quot;:29001&quot; \</span></span><br><span class="line"><span class="string">http://172.31.62.161/data/minio/cluster_data http://172.31.56.16/data/minio/cluster_data \</span></span><br><span class="line"><span class="string">http://172.31.57.206/data/minio/cluster_data http://172.31.36.28/data/minio/cluster_data \</span></span><br><span class="line"><span class="string">&gt;&gt; /data/minio/minio.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> u+x startup.sh</span><br></pre></td></tr></table></figure><h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 导入信息（别名）</span></span><br><span class="line">./mc <span class="built_in">alias</span> <span class="built_in">set</span> minio-cluster http://172.31.62.161:29000 minioadmin minioadmin</span><br><span class="line">./mc <span class="built_in">alias</span> <span class="built_in">set</span> XXXX http://XXXX.s3.cn-northwest-1.amazonaws.com.cn/  AXXXXXXX</span><br><span class="line"></span><br><span class="line"><span class="comment">## 列出别名</span></span><br><span class="line">./mc <span class="built_in">alias</span> list</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看集群信息</span></span><br><span class="line">./mc admin info hxs3</span><br><span class="line">./mc admin info minio-cluster</span><br><span class="line"></span><br><span class="line"><span class="comment">## 对拷</span></span><br><span class="line">./mc mirror minio-prod minio-cluster</span><br><span class="line">./mc mirror minio-prod minio-cluster  --overwrite</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;MinIO集群安装&quot;&gt;&lt;a href=&quot;#MinIO集群安装&quot; class=&quot;headerlink&quot; title=&quot;MinIO集群安装&quot;&gt;&lt;/a&gt;MinIO集群安装&lt;/h2&gt;&lt;h3 id=&quot;官方文档&quot;&gt;&lt;a href=&quot;#官方文档&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="FS" scheme="https://biglovewheat.gihub.io/tags/FS/"/>
    
  </entry>
  
  <entry>
    <title>AWS-EBS-磁盘管理</title>
    <link href="https://biglovewheat.gihub.io/2022/07/27/aws-ebs-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/07/27/aws-ebs-%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/</id>
    <published>2022-07-27T05:58:08.735Z</published>
    <updated>2022-07-27T01:02:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-EBS-磁盘管理"><a href="#AWS-EBS-磁盘管理" class="headerlink" title="AWS-EBS-磁盘管理"></a>AWS-EBS-磁盘管理</h2><h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><p>控制台–&gt;EBS–&gt;volumes–&gt;select ebs–&gt;modify volume，修改后等待卷状态变为正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看块设备情况</span></span><br><span class="line">[root@ip-172-31-40-27 ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">nvme0n1     259:0    0  100G  0 disk</span><br><span class="line">├─nvme0n1p1 259:1    0    1M  0 part</span><br><span class="line">└─nvme0n1p2 259:2    0   40G  0 part /</span><br><span class="line"></span><br><span class="line"><span class="comment">## 如果是有分区的，把空间分配到对应分区，如disk没有分区，这一步省略</span></span><br><span class="line">sudo growpart /dev/nvme0n1 2</span><br><span class="line"></span><br><span class="line"><span class="comment">## 再增加到对应的文件系统</span></span><br><span class="line"><span class="comment"># xfs</span></span><br><span class="line">sudo xfs_growfs -d  /</span><br><span class="line"><span class="comment"># ext4</span></span><br><span class="line">sudo resize2fs /dev/nvme0n1p2</span><br></pre></td></tr></table></figure><h3 id="新曾磁盘"><a href="#新曾磁盘" class="headerlink" title="新曾磁盘"></a>新曾磁盘</h3><p>控制台–&gt;EBS–&gt;卷–&gt;创建卷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看块设备情况</span></span><br><span class="line">lsblk</span><br><span class="line"><span class="comment">## 创建挂载点目录</span></span><br><span class="line"><span class="built_in">mkdir</span> /data</span><br><span class="line"><span class="comment">## 格式化（xfs）</span></span><br><span class="line">mkfs -t xfs /dev/nvme1n1</span><br><span class="line"><span class="comment">## 查看uuid</span></span><br><span class="line">blkid</span><br><span class="line"><span class="comment">## 启动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">UUID=0cbb74bd-9c5c-4789-8d59-cb6bb2d1038e /data xfs defaults 0 0</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1</span></span><br><span class="line">xfs_growfs</span><br><span class="line"><span class="comment"># 错误：</span></span><br><span class="line">unexpected output <span class="keyword">in</span> sfdisk --version</span><br><span class="line"><span class="comment"># 解决</span></span><br><span class="line"><span class="built_in">export</span>  LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2</span></span><br><span class="line"><span class="comment"># 相关工具包</span></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">sudo yum install xfsprogs</span><br><span class="line"><span class="comment"># ubuntu</span></span><br><span class="line">apt install cloud-guest-utils</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-EBS-磁盘管理&quot;&gt;&lt;a href=&quot;#AWS-EBS-磁盘管理&quot; class=&quot;headerlink&quot; title=&quot;AWS-EBS-磁盘管理&quot;&gt;&lt;/a&gt;AWS-EBS-磁盘管理&lt;/h2&gt;&lt;h3 id=&quot;扩容&quot;&gt;&lt;a href=&quot;#扩容&quot; class=&quot;</summary>
      
    
    
    
    <category term="AWS" scheme="https://biglovewheat.gihub.io/categories/AWS/"/>
    
    
    <category term="AWS" scheme="https://biglovewheat.gihub.io/tags/AWS/"/>
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>shell并发执行</title>
    <link href="https://biglovewheat.gihub.io/2022/07/26/shell-%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/07/26/shell-%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86/</id>
    <published>2022-07-26T08:12:30.719Z</published>
    <updated>2022-07-26T07:25:21.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell并发处理"><a href="#shell并发处理" class="headerlink" title="shell并发处理"></a>shell并发处理</h2><h3 id="并发执行"><a href="#并发执行" class="headerlink" title="并发执行"></a>并发执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@std_centos <span class="built_in">test</span>]<span class="comment"># cat aa.sh</span></span><br><span class="line"><span class="function"><span class="title">f1</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">tail</span> -f 1.txt</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">f2</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">tail</span> -f 2.txt</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">f3</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">tail</span> -f 3.txt</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">f4</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;finished&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">f1 &amp; <span class="comment">#f1-f3 并发执行</span></span><br><span class="line">f2 &amp;</span><br><span class="line">f3 &amp;</span><br><span class="line"><span class="built_in">wait</span> <span class="comment">#wait的作用：等待前面的函数执行完成</span></span><br><span class="line">f4 <span class="comment">#最后执行f4</span></span><br></pre></td></tr></table></figure><h3 id="控制并发进程数"><a href="#控制并发进程数" class="headerlink" title="控制并发进程数"></a>控制并发进程数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@std_centos <span class="built_in">test</span>]<span class="comment"># cat cc.sh</span></span><br><span class="line">tempfifo=/tmp/$$.fifo <span class="comment">##获取当前程序的pid，以pid作为文件名，防止重复。</span></span><br><span class="line"><span class="built_in">mkfifo</span> <span class="variable">$tempfifo</span> <span class="comment">##创建有名管道文件</span></span><br><span class="line"><span class="built_in">exec</span> 1000&lt;&gt;<span class="variable">$tempfifo</span> <span class="comment">##将文件描述符1000与管道文件关联</span></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$tempfifo</span> <span class="comment">##删除管道文件，只保留文件描述符</span></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=3; i++)) <span class="comment">##写入3行（空行）到文件描述符1000</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;1000</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> ((j=1;j&lt;=10;j++)) <span class="comment">##队列总共10个</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -u1000 <span class="comment">##读取1个空行（读取后，文件描述符减少1个空行，如没空行则hold住等待，知道有新增空行，以达到进程数控制的效果）</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">tail</span> -f <span class="variable">$j</span>.txt</span><br><span class="line"><span class="built_in">echo</span> &gt;&amp;1000 <span class="comment">##写入1个空行（写入后，文件描述符又增加1个空行）</span></span><br><span class="line">&#125;&amp;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;running:&quot;</span><span class="variable">$j</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">exec</span> 1000&lt;&amp;- <span class="comment">#关闭文件描述符的读</span></span><br><span class="line"><span class="built_in">exec</span> 1000&gt;&amp;-</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;--finished--&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell并发处理&quot;&gt;&lt;a href=&quot;#shell并发处理&quot; class=&quot;headerlink&quot; title=&quot;shell并发处理&quot;&gt;&lt;/a&gt;shell并发处理&lt;/h2&gt;&lt;h3 id=&quot;并发执行&quot;&gt;&lt;a href=&quot;#并发执行&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Rocketmq-DLeger-集群安装</title>
    <link href="https://biglovewheat.gihub.io/2022/07/26/rocketmq-dleger-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/07/26/rocketmq-dleger-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85/</id>
    <published>2022-07-26T08:12:30.286Z</published>
    <updated>2022-07-26T06:39:33.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Rocketmq-DLeger-集群安装"><a href="#Rocketmq-DLeger-集群安装" class="headerlink" title="Rocketmq-DLeger-集群安装"></a>Rocketmq-DLeger-集群安装</h2><h3 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h3><p>More Info: <a href="https://github.com/apache/rocketmq/blob/master/docs/cn/dledger/deploy_guide.md">官方文档</a> </p><p>More Info: <a href="https://github.com/apache/rocketmq-dashboard">rocketmq-dashbord</a></p><h3 id="部署主机"><a href="#部署主机" class="headerlink" title="部署主机"></a>部署主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.31.34.25   aws-sit-app-01  </span><br><span class="line">172.31.43.98   aws-sit-app-03</span><br><span class="line">172.31.43.45   aws-sit-app-04</span><br></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/data/rocketmq/conf/dledger/broker-n*.conf</span><br><span class="line"></span><br><span class="line">brokerClusterName = RaftCluster</span><br><span class="line">brokerName=RaftNode00</span><br><span class="line">listenPort=30911</span><br><span class="line">namesrvAddr=172.31.34.25:9876;172.31.43.98:9876;172.31.43.45:9876</span><br><span class="line">storePathRootDir=/tmp/rmqstore/node00</span><br><span class="line">storePathCommitLog=/tmp/rmqstore/node00/commitlog</span><br><span class="line">enableDLegerCommitLog=<span class="literal">true</span></span><br><span class="line">dLegerGroup=RaftNode00</span><br><span class="line">dLegerPeers=n0-172.31.34.25:40911;n1-172.31.43.98:40911;n2-172.31.43.45:40911</span><br><span class="line"><span class="comment">##每个节点更改n0、n1、n2</span></span><br><span class="line">dLegerSelfId=n0</span><br><span class="line">sendMessageThreadPoolNums=4</span><br><span class="line"><span class="comment">##自动创建topic</span></span><br><span class="line">autoCreateTopicEnable = <span class="literal">true</span></span><br><span class="line"><span class="comment">## 执行broker ip（多网卡适用）</span></span><br><span class="line"><span class="comment">#brokerIP1=10.19.73.64</span></span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/data/rocketmq</span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> sh <span class="variable">$ROOT_PATH</span>/bin/mqnamesrv &gt; <span class="variable">$ROOT_PATH</span>/startup.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">nohup</span> sh <span class="variable">$ROOT_PATH</span>/bin/mqbroker -c <span class="variable">$ROOT_PATH</span>/conf/dledger/broker-n0.conf  &gt;&gt; <span class="variable">$ROOT_PATH</span>/startup.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment">## mq console</span></span><br><span class="line"><span class="built_in">nohup</span> java -jar <span class="variable">$ROOT_PATH</span>/rocketmq-dashboard-1.0.1-SNAPSHOT.jar --server.port=9801 \</span><br><span class="line">--rocketmq.config.namesrvAddr=tcp.farmbgy.net:29876 &gt; <span class="variable">$ROOT_PATH</span>/startDashboard.<span class="built_in">log</span> 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; /usr/lib/systemd/system/rocketmq.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=rocketmq</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExecStart=/data/rocketmq/startup.sh</span></span><br><span class="line"><span class="string">ExecStop=/data/rocketmq/stop.sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> rocketmq</span><br><span class="line">systemctl start rocketmq</span><br><span class="line">systemctl stop rocketmq</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Rocketmq-DLeger-集群安装&quot;&gt;&lt;a href=&quot;#Rocketmq-DLeger-集群安装&quot; class=&quot;headerlink&quot; title=&quot;Rocketmq-DLeger-集群安装&quot;&gt;&lt;/a&gt;Rocketmq-DLeger-集群安装&lt;/h2&gt;&lt;</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/tags/middleware/"/>
    
    <category term="mq" scheme="https://biglovewheat.gihub.io/tags/mq/"/>
    
  </entry>
  
  <entry>
    <title>Python-端口监控-钉钉告警</title>
    <link href="https://biglovewheat.gihub.io/2022/07/26/python-%E7%AB%AF%E5%8F%A3%E7%9B%91%E6%8E%A7-%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/"/>
    <id>https://biglovewheat.gihub.io/2022/07/26/python-%E7%AB%AF%E5%8F%A3%E7%9B%91%E6%8E%A7-%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/</id>
    <published>2022-07-26T08:12:29.861Z</published>
    <updated>2022-07-26T08:00:19.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-端口监控-钉钉告警"><a href="#Python-端口监控-钉钉告警" class="headerlink" title="Python-端口监控-钉钉告警"></a>Python-端口监控-钉钉告警</h2><p><em>一个python写的简单的端口监控例子，配合crontab和钉钉实现定时监控和告警。</em></p><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@aws-sit-server-dev-01 moni]<span class="comment"># cat moni_port.lst</span></span><br><span class="line">gis|172.31.45.42|6066</span><br><span class="line">gis|172.31.45.42|8083</span><br><span class="line">gis|172.31.45.42|8084</span><br><span class="line">sit-mq|172.31.40.27|9876</span><br><span class="line">sit-gitlab|172.31.40.27|8090</span><br><span class="line">sit-jenkins|172.31.40.27|8089</span><br><span class="line">sit-nacos|172.31.40.27|8848</span><br><span class="line">sit-redis|172.31.40.125|6379</span><br><span class="line">sit-mysql|172.31.40.125|3306</span><br><span class="line">sit-nexus|172.31.45.187|8081</span><br><span class="line">show-mq|172.31.73.65|9876</span><br><span class="line">show-mysql|172.31.73.65|3306</span><br><span class="line">show-nacos|172.31.73.65|8848</span><br><span class="line">show-redis|172.31.73.65|6379</span><br><span class="line">jx-mq|172.31.71.117|9876</span><br><span class="line">jx-mysql|172.31.71.117|3306</span><br><span class="line">jx-nacos|172.31.71.117|8848</span><br><span class="line">jx-redis|172.31.71.117|6378</span><br></pre></td></tr></table></figure><h3 id="监控脚本"><a href="#监控脚本" class="headerlink" title="监控脚本"></a>监控脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/python3/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> socket,sys</span><br><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_dingding</span>(<span class="params">url, msg</span>):</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;msgtype&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: msg</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    r = requests.post(url, headers=headers, data=json.dumps(data))</span><br><span class="line">    <span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url_dingding = <span class="string">&#x27;https://oapi.dingtalk.com/robot/send?access_token=abcd&#x27;</span></span><br><span class="line">    msg=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;/data/moni/moni_port.lst&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> f.readlines():</span><br><span class="line">        <span class="comment">#    print(row.strip())</span></span><br><span class="line">            r1,r2,r3=row.strip().split(<span class="string">&#x27;|&#x27;</span>,<span class="number">2</span>)</span><br><span class="line">            moni_host=r1</span><br><span class="line">            moni_ip=r2</span><br><span class="line">            moni_port=r3</span><br><span class="line">            port_state=socket.socket(socket.AF_INET,socket.SOCK_STREAM).connect_ex((moni_ip,<span class="built_in">int</span>(moni_port)))</span><br><span class="line">            <span class="keyword">if</span> port_state != <span class="number">0</span> :</span><br><span class="line">                msg=msg+moni_host+<span class="string">&quot; &quot;</span>+moni_ip+<span class="string">&quot;:&quot;</span>+moni_port+<span class="string">&quot; has been down. Please check.\n&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(msg) &gt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(datetime.datetime.now())</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        send_dingding(url_dingding,msg)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-端口监控-钉钉告警&quot;&gt;&lt;a href=&quot;#Python-端口监控-钉钉告警&quot; class=&quot;headerlink&quot; title=&quot;Python-端口监控-钉钉告警&quot;&gt;&lt;/a&gt;Python-端口监控-钉钉告警&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个python写的</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>Nacos集群配置</title>
    <link href="https://biglovewheat.gihub.io/2022/07/26/nacos-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/07/26/nacos-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/</id>
    <published>2022-07-26T08:12:29.437Z</published>
    <updated>2022-07-26T07:50:53.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nacos集群配置"><a href="#Nacos集群配置" class="headerlink" title="Nacos集群配置"></a>Nacos集群配置</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p>v1.4.1</p><h3 id="cluster-conf配置"><a href="#cluster-conf配置" class="headerlink" title="cluster.conf配置"></a>cluster.conf配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.8.111:8848</span><br><span class="line">192.168.8.112:8848</span><br><span class="line">192.168.8.113:8848</span><br></pre></td></tr></table></figure><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p &lt; /data/nacos/conf/nacos-mysql.sql</span><br></pre></td></tr></table></figure><h3 id="application-properties配置，集群必须用外部存储，这里用mysql"><a href="#application-properties配置，集群必须用外部存储，这里用mysql" class="headerlink" title="application.properties配置，集群必须用外部存储，这里用mysql"></a>application.properties配置，集群必须用外部存储，这里用mysql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line">db.num=1</span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line">db.url.0=jdbc:mysql://192.168.8.111:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=<span class="literal">true</span>&amp;useUnicode=<span class="literal">true</span>&amp;useSSL=<span class="literal">false</span>&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=<span class="literal">true</span></span><br><span class="line">db.user.0=root</span><br><span class="line">db.password.0=123456</span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk-11.0.11</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="comment">## 单机</span></span><br><span class="line">sh /data/nacos/bin/startup.sh -m standalone</span><br><span class="line"><span class="comment">## 集群</span></span><br><span class="line">sh /data/nacos/bin/startup.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nacos集群配置&quot;&gt;&lt;a href=&quot;#Nacos集群配置&quot; class=&quot;headerlink&quot; title=&quot;Nacos集群配置&quot;&gt;&lt;/a&gt;Nacos集群配置&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/tags/middleware/"/>
    
    <category term="nacos" scheme="https://biglovewheat.gihub.io/tags/nacos/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-Systemd-发布脚本</title>
    <link href="https://biglovewheat.gihub.io/2022/07/26/jenkins-systemd-%E5%8F%91%E5%B8%83%E8%84%9A%E6%9C%AC/"/>
    <id>https://biglovewheat.gihub.io/2022/07/26/jenkins-systemd-%E5%8F%91%E5%B8%83%E8%84%9A%E6%9C%AC/</id>
    <published>2022-07-26T08:12:29.011Z</published>
    <updated>2022-07-26T06:39:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-Systemd-发布脚本"><a href="#Jenkins-Systemd-发布脚本" class="headerlink" title="Jenkins-Systemd-发布脚本"></a>Jenkins-Systemd-发布脚本</h2><h3 id="发布脚本"><a href="#发布脚本" class="headerlink" title="发布脚本"></a>发布脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">## /data/publish.sh  update js hx-basic 5 4 &quot;www-test/&quot;</span></span><br><span class="line">action=<span class="variable">$1</span></span><br><span class="line">apptype=<span class="variable">$2</span></span><br><span class="line">svc=<span class="variable">$3</span></span><br><span class="line">ver=<span class="variable">$4</span></span><br><span class="line">webpath=<span class="variable">$6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## env</span></span><br><span class="line">ROOT=/data</span><br><span class="line"><span class="comment">#TEMP_HOME=$ROOT/tmp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$apptype</span> <span class="keyword">in</span></span><br><span class="line"><span class="comment">## java</span></span><br><span class="line"><span class="string">&#x27;java&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>  [ ! -f /usr/lib/systemd/system/<span class="variable">$svc</span>.service ];<span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ ! -f <span class="variable">$ROOT</span>/java_demo.service ];<span class="keyword">then</span>  <span class="built_in">echo</span> <span class="string">&quot;java_demo.service not found&quot;</span>; <span class="built_in">exit</span> ; <span class="keyword">fi</span></span><br><span class="line">        sed <span class="string">&quot;s/__SVC__/<span class="variable">$&#123;svc&#125;</span>/g&quot;</span> <span class="variable">$ROOT</span>/java_demo.service &gt; /usr/lib/systemd/system/<span class="variable">$svc</span>.service</span><br><span class="line">        systemctl daemon-reload</span><br><span class="line">        systemctl <span class="built_in">enable</span> <span class="variable">$svc</span>.service</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$action</span> <span class="keyword">in</span></span><br><span class="line">    <span class="string">&#x27;restart&#x27;</span>)</span><br><span class="line">        systemctl restart <span class="variable">$svc</span>.service</span><br><span class="line">    ;;</span><br><span class="line">    <span class="string">&#x27;update&#x27;</span>)</span><br><span class="line">        <span class="built_in">ln</span> -snf  <span class="variable">$ROOT</span>/temp/<span class="variable">$&#123;svc&#125;</span>-<span class="variable">$&#123;ver&#125;</span>.jar <span class="variable">$ROOT</span>/app/<span class="variable">$&#123;svc&#125;</span>.jar</span><br><span class="line">        systemctl restart <span class="variable">$svc</span>.service</span><br><span class="line">    ;;</span><br><span class="line">    <span class="string">&#x27;stop&#x27;</span>)</span><br><span class="line">        systemctl stop <span class="variable">$svc</span>.service</span><br><span class="line">    ;;</span><br><span class="line">    <span class="string">&#x27;restore&#x27;</span>)</span><br><span class="line">        ver=<span class="variable">$5</span></span><br><span class="line">        <span class="built_in">ln</span> -snf  <span class="variable">$ROOT</span>/temp/<span class="variable">$&#123;svc&#125;</span>-<span class="variable">$&#123;ver&#125;</span>.jar <span class="variable">$ROOT</span>/app/<span class="variable">$&#123;svc&#125;</span>.jar</span><br><span class="line">        systemctl restart <span class="variable">$svc</span>.service</span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">;;</span><br><span class="line"><span class="comment">## js</span></span><br><span class="line"><span class="string">&#x27;js&#x27;</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$action</span> <span class="keyword">in</span></span><br><span class="line">    update)</span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$ROOT</span>/webapp/<span class="variable">$webpath</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="variable">$ROOT</span>/webapp/<span class="variable">$webpath</span></span><br><span class="line">        tar -xf <span class="variable">$ROOT</span>/temp/<span class="variable">$svc</span>-<span class="variable">$ver</span>.tgz -C  <span class="variable">$ROOT</span>/webapp/<span class="variable">$webpath</span></span><br><span class="line">    ;;</span><br><span class="line">    restore)</span><br><span class="line">        ver=<span class="variable">$5</span></span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">$ROOT</span>/webapp/<span class="variable">$&#123;webpath&#125;</span></span><br><span class="line">        <span class="built_in">mkdir</span> -p <span class="variable">$ROOT</span>/webapp/<span class="variable">$webpath</span></span><br><span class="line">        tar -xf <span class="variable">$ROOT</span>/temp/<span class="variable">$svc</span>-<span class="variable">$ver</span>.tgz -C  <span class="variable">$ROOT</span>/webapp/<span class="variable">$webpath</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">;;</span><br><span class="line"><span class="comment">## other</span></span><br><span class="line">*)</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Service-java-demo-service"><a href="#Service-java-demo-service" class="headerlink" title="Service java_demo.service"></a>Service java_demo.service</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; java_demo.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=__SVC__</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string">Environment=&quot;SVC=__SVC__&quot;</span></span><br><span class="line"><span class="string">ExecStart=/data/start_jar.sh start $&#123;SVC&#125;</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT $MAINPID</span></span><br><span class="line"><span class="string">#Restart=always</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">svc=<span class="variable">$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## dir</span></span><br><span class="line">APP_HOME=/data/app</span><br><span class="line">LOG_HOME=/data/logs</span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc ]; <span class="keyword">then</span> <span class="built_in">mkdir</span> -p <span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nacos</span></span><br><span class="line"><span class="built_in">export</span> nacos_address=<span class="string">&quot;172.31.71.117&quot;</span></span><br><span class="line"><span class="built_in">export</span> nacos_port=<span class="string">&quot;8848&quot;</span></span><br><span class="line"><span class="built_in">export</span> nacos_namespace=<span class="string">&#x27;c876967c-d8dd-4318-9bf1-e7e72eb47d13&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## java</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk-11.0.11</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line"><span class="comment">## app env</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$svc</span> <span class="keyword">in</span></span><br><span class="line"><span class="string">&#x27;hx-schedule-algorithm&#x27;</span>)</span><br><span class="line">JAVA_OPS=<span class="string">&quot;-Xms512m -Xmx4g -Xmn1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/ -XX:+PrintGCDetails -verbosegc -Xloggc:<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/gc.<span class="variable">$&#123;svc&#125;</span>.log&quot;</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">JAVA_OPS=<span class="string">&quot;-Xms512m -Xmx2g -Xmn1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/ -XX:+PrintGCDetails -verbosegc -Xloggc:<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/gc.<span class="variable">$&#123;svc&#125;</span>.log&quot;</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$svc</span> <span class="keyword">in</span></span><br><span class="line"><span class="comment">#&#x27;hx-thirdparty&#x27;|&#x27;hx-sensordata&#x27;)</span></span><br><span class="line"><span class="string">&#x27;hx-thirdparty&#x27;</span>)</span><br><span class="line">SPRING_ENV=prod  <span class="comment">## prod,sit,local</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">SPRING_ENV=<span class="built_in">local</span>  <span class="comment">## prod,sit,local</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">   <span class="built_in">nohup</span> java <span class="variable">$&#123;JAVA_OPS&#125;</span> -jar <span class="variable">$&#123;APP_HOME&#125;</span>/<span class="variable">$&#123;svc&#125;</span>.jar  --spring.profiles.active=<span class="variable">$&#123;SPRING_ENV&#125;</span> &gt;&gt; <span class="variable">$&#123;APP_HOME&#125;</span>/<span class="variable">$&#123;svc&#125;</span>.<span class="built_in">log</span> 2&gt;&amp;1 &amp;</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">   <span class="variable">$0</span> stop <span class="variable">$svc</span></span><br><span class="line">   <span class="built_in">sleep</span> 2</span><br><span class="line">   <span class="variable">$0</span> start <span class="variable">$svc</span></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">    PID=`jps |grep <span class="variable">$&#123;svc&#125;</span>|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">    <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;no pid found. <span class="variable">$0</span> no start&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">kill</span> -9 <span class="variable">$PID</span>  &amp;&amp;  <span class="built_in">echo</span> <span class="string">&quot;kill pid <span class="variable">$PID</span> success.&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;kill pid <span class="variable">$PID</span> failed.&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> [start|restart|update|stop|restore|log|check]&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-Systemd-发布脚本&quot;&gt;&lt;a href=&quot;#Jenkins-Systemd-发布脚本&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-Systemd-发布脚本&quot;&gt;&lt;/a&gt;Jenkins-Systemd-发布脚本&lt;/h2&gt;&lt;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
</feed>
