<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-09-22T14:08:07.792Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Seata-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/09/21/seata-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/09/21/seata-%E5%AE%89%E8%A3%85/</id>
    <published>2022-09-20T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.792Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Seata-安装"><a href="#Seata-安装" class="headerlink" title="Seata-安装"></a>Seata-安装</h2><p><em>Seata 是一款开源的分布式事务解决方案</em></p><p><em><a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></em></p><p><em>版本v1.4.2</em></p><h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>创建seata数据库，然后运行以下建表语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--https://github.com/seata/seata/tree/develop/script/server/db</span></span><br><span class="line"><span class="comment">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class="line"><span class="comment">-- the table to store GlobalSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `global_table`</span><br><span class="line">(</span><br><span class="line">    `xid`                       <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`            <span class="type">BIGINT</span>,</span><br><span class="line">    `status`                    TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `application_id`            <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_service_group` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_name`          <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `timeout`                   <span class="type">INT</span>,</span><br><span class="line">    `begin_time`                <span class="type">BIGINT</span>,</span><br><span class="line">    `application_data`          <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`                DATETIME,</span><br><span class="line">    `gmt_modified`              DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`xid`),</span><br><span class="line">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class="line">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store BranchSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `branch_table`</span><br><span class="line">(</span><br><span class="line">    `branch_id`         <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`               <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`    <span class="type">BIGINT</span>,</span><br><span class="line">    `resource_group_id` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `resource_id`       <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `branch_type`       <span class="type">VARCHAR</span>(<span class="number">8</span>),</span><br><span class="line">    `status`            TINYINT,</span><br><span class="line">    `client_id`         <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">    `application_data`  <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`        DATETIME(<span class="number">6</span>),</span><br><span class="line">    `gmt_modified`      DATETIME(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`branch_id`),</span><br><span class="line">    KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store lock data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `lock_table`</span><br><span class="line">(</span><br><span class="line">    `row_key`        <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`            <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `transaction_id` <span class="type">BIGINT</span>,</span><br><span class="line">    `branch_id`      <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource_id`    <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `table_name`     <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `pk`             <span class="type">VARCHAR</span>(<span class="number">36</span>),</span><br><span class="line">    `status`         TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;0:locked ,1:rollbacking&#x27;</span>,</span><br><span class="line">    `gmt_create`     DATETIME,</span><br><span class="line">    `gmt_modified`   DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`row_key`),</span><br><span class="line">    KEY `idx_status` (`status`),</span><br><span class="line">    KEY `idx_branch_id` (`branch_id`),</span><br><span class="line">    KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `distributed_lock`</span><br><span class="line">(</span><br><span class="line">    `lock_key`       <span class="type">CHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `lock_value`     <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `expire`         <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="keyword">primary</span> key (`lock_key`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;AsyncCommitting&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;RetryCommitting&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;RetryRollbacking&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;TxTimeoutCheck&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="nacos配置"><a href="#nacos配置" class="headerlink" title="nacos配置"></a>nacos配置</h3><p>新建配置seataServer.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span></span><br><span class="line"><span class="comment">#Transport configuration, for client and server</span></span><br><span class="line"><span class="attr">transport.type</span>=<span class="string">TCP</span></span><br><span class="line"><span class="attr">transport.server</span>=<span class="string">NIO</span></span><br><span class="line"><span class="attr">transport.heartbeat</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">transport.enableTmClientBatchSendRequest</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.enableRmClientBatchSendRequest</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">transport.enableTcServerBatchSendResponse</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.rpcRmRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.rpcTmRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.rpcTcRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadPrefix</span>=<span class="string">NettyBoss</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadPrefix</span>=<span class="string">NettyServerNIOWorker</span></span><br><span class="line"><span class="attr">transport.threadFactory.serverExecutorThreadPrefix</span>=<span class="string">NettyServerBizHandler</span></span><br><span class="line"><span class="attr">transport.threadFactory.shareBossWorker</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadPrefix</span>=<span class="string">NettyClientSelector</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientWorkerThreadPrefix</span>=<span class="string">NettyClientWorkerThread</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadSize</span>=<span class="string">default</span></span><br><span class="line"><span class="attr">transport.shutdown.wait</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">transport.serialization</span>=<span class="string">seata</span></span><br><span class="line"><span class="attr">transport.compressor</span>=<span class="string">none</span></span><br><span class="line"><span class="comment">#Transaction routing rules configuration, only for the client</span></span><br><span class="line"><span class="comment"># 默认的事务分组</span></span><br><span class="line"><span class="attr">service.vgroupMapping.default_tx_group</span>=<span class="string">default</span></span><br><span class="line"><span class="comment">#If you use a registry, you can ignore it</span></span><br><span class="line"><span class="attr">service.default.grouplist</span>=<span class="string">172.31.43.98:8491</span></span><br><span class="line"><span class="attr">service.enableDegrade</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">service.disableGlobalTransaction</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the client</span></span><br><span class="line"><span class="attr">client.rm.asyncCommitBufferLimit</span>=<span class="string">10000</span></span><br><span class="line"><span class="attr">client.rm.lock.retryInterval</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.rm.lock.retryTimes</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.rm.reportRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckEnable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckerInterval</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.rm.sqlParserType</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">client.rm.reportSuccessEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.sagaBranchRegisterEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.sagaJsonParser</span>=<span class="string">fastjson</span></span><br><span class="line"><span class="attr">client.rm.tccActionInterceptorOrder</span>=<span class="string">-2147482648</span></span><br><span class="line"><span class="attr">client.tm.commitRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.rollbackRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.defaultGlobalTransactionTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.tm.degradeCheck</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckAllowTimes</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckPeriod</span>=<span class="string">2000</span></span><br><span class="line"><span class="attr">client.tm.interceptorOrder</span>=<span class="string">-2147482648</span></span><br><span class="line"><span class="attr">client.undo.dataValidation</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.logSerialization</span>=<span class="string">jackson</span></span><br><span class="line"><span class="attr">client.undo.onlyCareUpdateColumns</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">server.undo.logSaveDays</span>=<span class="string">7</span></span><br><span class="line"><span class="attr">server.undo.logDeletePeriod</span>=<span class="string">86400000</span></span><br><span class="line"><span class="attr">client.undo.logTable</span>=<span class="string">undo_log</span></span><br><span class="line"><span class="attr">client.undo.compress.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.compress.type</span>=<span class="string">zip</span></span><br><span class="line"><span class="attr">client.undo.compress.threshold</span>=<span class="string">64k</span></span><br><span class="line"><span class="comment">#For TCC transaction mode</span></span><br><span class="line"><span class="attr">tcc.fence.logTableName</span>=<span class="string">tcc_fence_log</span></span><br><span class="line"><span class="attr">tcc.fence.cleanPeriod</span>=<span class="string">1h</span></span><br><span class="line"><span class="comment">#Log rule configuration, for client and server</span></span><br><span class="line"><span class="attr">log.exceptionRate</span>=<span class="string">100</span></span><br><span class="line"><span class="comment">#Transaction storage configuration, only for the server. The file, DB, and redis configuration values are optional.</span></span><br><span class="line"><span class="comment"># Seata服务器的数据存储方式设置为数据库存储</span></span><br><span class="line"><span class="attr">store.mode</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">store.lock.mode</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">store.session.mode</span>=<span class="string">file</span></span><br><span class="line"><span class="comment">#Used for password encryption</span></span><br><span class="line"><span class="attr">store.publicKey</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span></span><br><span class="line"><span class="attr">store.file.dir</span>=<span class="string">file_store/data</span></span><br><span class="line"><span class="attr">store.file.maxBranchSessionSize</span>=<span class="string">16384</span></span><br><span class="line"><span class="attr">store.file.maxGlobalSessionSize</span>=<span class="string">512</span></span><br><span class="line"><span class="attr">store.file.fileWriteBufferCacheSize</span>=<span class="string">16384</span></span><br><span class="line"><span class="attr">store.file.flushDiskMode</span>=<span class="string">async</span></span><br><span class="line"><span class="attr">store.file.sessionReloadReadSize</span>=<span class="string">100</span></span><br><span class="line"><span class="comment">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span></span><br><span class="line"><span class="attr">store.db.datasource</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">store.db.dbType</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">store.db.driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">### 设置数据库得连接信息</span></span><br><span class="line"><span class="attr">store.db.url</span>=<span class="string">jdbc:mysql://192.168.8.1:3306/seata?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">store.db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">store.db.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">store.db.minConn</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">store.db.maxConn</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">store.db.globalTable</span>=<span class="string">global_table</span></span><br><span class="line"><span class="attr">store.db.branchTable</span>=<span class="string">branch_table</span></span><br><span class="line"><span class="attr">store.db.distributedLockTable</span>=<span class="string">distributed_lock</span></span><br><span class="line"><span class="attr">store.db.queryLimit</span>=<span class="string">100</span></span><br><span class="line"><span class="attr">store.db.lockTable</span>=<span class="string">lock_table</span></span><br><span class="line"><span class="attr">store.db.maxWait</span>=<span class="string">5000</span></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the server</span></span><br><span class="line"><span class="attr">server.recovery.committingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.rollbackingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.timeoutRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.maxCommitRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.maxRollbackRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">server.distributedLockExpireTime</span>=<span class="string">10000</span></span><br><span class="line"><span class="attr">server.xaerNotaRetryTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">server.session.branchAsyncQueueSize</span>=<span class="string">5000</span></span><br><span class="line"><span class="attr">server.session.enableBranchAsyncRemove</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#Metrics configuration, only for the server</span></span><br><span class="line"><span class="attr">metrics.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">metrics.registryType</span>=<span class="string">compact</span></span><br><span class="line"><span class="attr">metrics.exporterList</span>=<span class="string">prometheus</span></span><br><span class="line"><span class="attr">metrics.exporterPrometheusPort</span>=<span class="string">9898</span></span><br></pre></td></tr></table></figure><h3 id="seata配置文件"><a href="#seata配置文件" class="headerlink" title="seata配置文件"></a>seata配置文件</h3><p>主要修改nacos部分</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vi registry.conf</span></span><br><span class="line"></span><br><span class="line">registry &#123;</span><br><span class="line">  <span class="comment"># file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    application = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;192.168.8.1:8848&quot;</span></span><br><span class="line">    group = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;da7aaaa2-7505-4c1d-98c6-9e2e7778ef55&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="string">&quot;http://localhost:8761/eureka&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:6379&quot;</span></span><br><span class="line">    db = 0</span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    <span class="built_in">timeout</span> = 0</span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    sessionTimeout = 6000</span><br><span class="line">    connectTimeout = 2000</span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">    aclToken = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  sofa &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:9603&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    region = <span class="string">&quot;DEFAULT_ZONE&quot;</span></span><br><span class="line">    datacenter = <span class="string">&quot;DefaultDataCenter&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    group = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    addressWaitTime = <span class="string">&quot;3000&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  <span class="comment"># file、nacos 、apollo、zk、consul、etcd3</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;192.168.8.1:8848&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    group = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    dataId = <span class="string">&quot;seataServer.properties&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">    aclToken = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  apollo &#123;</span><br><span class="line">    appId = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    <span class="comment">## apolloConfigService will cover apolloMeta</span></span><br><span class="line">    apolloMeta = <span class="string">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">    apolloConfigService = <span class="string">&quot;http://192.168.1.204:8080&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;application&quot;</span></span><br><span class="line">    apolloAccesskeySecret = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;seata&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    sessionTimeout = 6000</span><br><span class="line">    connectTimeout = 2000</span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    nodePath = <span class="string">&quot;/seata/seata.properties&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /data/seata/startup.sh</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export JAVA_HOME=/data/soft/jdk-11.0.11</span></span><br><span class="line"><span class="string">export PATH=$JAVA_HOME/bin:$PATH</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nohup /data/seata/seata-server-1.4.2/bin/seata-server.sh  -p 8491 &gt;&gt;  /data/seata/seata.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="做成service方便管理"><a href="#做成service方便管理" class="headerlink" title="做成service方便管理"></a>做成service方便管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;/usr/lib/systemd/system/seata.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=seata</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExecStart=/data/seata/startup.sh</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT $MAINPID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl <span class="built_in">enable</span> seata</span><br><span class="line">systemctl restart seata</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Seata-安装&quot;&gt;&lt;a href=&quot;#Seata-安装&quot; class=&quot;headerlink&quot; title=&quot;Seata-安装&quot;&gt;&lt;/a&gt;Seata-安装&lt;/h2&gt;&lt;p&gt;&lt;em&gt;Seata 是一款开源的分布式事务解决方案&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a h</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="seata" scheme="https://biglovewheat.gihub.io/tags/seata/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-CI</title>
    <link href="https://biglovewheat.gihub.io/2022/09/14/gitlab-cl/"/>
    <id>https://biglovewheat.gihub.io/2022/09/14/gitlab-cl/</id>
    <published>2022-09-13T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.770Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-CI"><a href="#Gitlab-CI" class="headerlink" title="Gitlab-CI"></a>Gitlab-CI</h2><h3 id="安装配置runner"><a href="#安装配置runner" class="headerlink" title="安装配置runner"></a>安装配置runner</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Download the binary for your system</span></span><br><span class="line">sudo curl -L --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="comment"># Give it permissions to execute</span></span><br><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/gitlab-runner</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a GitLab CI user</span></span><br><span class="line">sudo useradd --comment <span class="string">&#x27;GitLab Runner&#x27;</span> --create-home gitlab-runner --shell /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install and run as service</span></span><br><span class="line">sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner</span><br><span class="line">sudo gitlab-runner start</span><br></pre></td></tr></table></figure><h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## ip 和token 在“设置--cicd”页面上获取</span><br><span class="line">sudo gitlab-runner register --url http://10.249.2.40:8690/ --registration-token $REGISTRATION_TOKEN</span><br></pre></td></tr></table></figure><h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 定义pipeline流程：verify-&gt;build-&gt;dockerpush-&gt;deploy</span></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">verify</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dockerpush</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#单元测试</span></span><br><span class="line"><span class="attr">unit-test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">verify</span> <span class="comment"># 属于哪个流程</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cicd</span> <span class="comment"># 在哪个runner上面执行，在注册runner可以自定义</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">unit-test</span> <span class="comment"># 执行脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#java编译</span></span><br><span class="line"><span class="attr">java-package:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cicd</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">build</span> <span class="string">&gt;./aa.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#push镜像</span></span><br><span class="line"><span class="attr">docker-push:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">dockerpush</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cicd</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">touch</span> <span class="string">./bb.txt</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#deploy</span></span><br><span class="line"><span class="attr">service-1:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">deploy</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cicd</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-CI&quot;&gt;&lt;a href=&quot;#Gitlab-CI&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-CI&quot;&gt;&lt;/a&gt;Gitlab-CI&lt;/h2&gt;&lt;h3 id=&quot;安装配置runner&quot;&gt;&lt;a href=&quot;#安装配置runner&quot; cla</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-npm-构建报错</title>
    <link href="https://biglovewheat.gihub.io/2022/09/13/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99/"/>
    <id>https://biglovewheat.gihub.io/2022/09/13/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99/</id>
    <published>2022-09-12T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.774Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-npm-构建报错"><a href="#Jenkins-npm-构建报错" class="headerlink" title="Jenkins-npm-构建报错"></a>Jenkins-npm-构建报错</h2><p><em>jenkins npm 编译报错，手工构建成功</em></p><h3 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h3><p><img src="/../images/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99_01.jpg"></p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 构建脚本加上CI=false</span></span><br><span class="line">     <span class="built_in">export</span> CI=<span class="literal">false</span></span><br><span class="line">     yarn install</span><br><span class="line">     npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment">## 或者代码加上CI=false</span></span><br><span class="line"><span class="comment"># package.json</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;craco start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;CI=false &amp;&amp; craco build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;craco test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-scripts eject&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint .&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint:fix&quot;</span>: <span class="string">&quot;eslint --fix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;format&quot;</span>: <span class="string">&quot;prettier --write &#x27;./**/*.&#123;js,jsx,ts,tsx,css,md,json&#125;&#x27; --config ./.prettierrc&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-npm-构建报错&quot;&gt;&lt;a href=&quot;#Jenkins-npm-构建报错&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-npm-构建报错&quot;&gt;&lt;/a&gt;Jenkins-npm-构建报错&lt;/h2&gt;&lt;p&gt;&lt;em&gt;jenkins np</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
    <category term="nodejs" scheme="https://biglovewheat.gihub.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-修改hosts</title>
    <link href="https://biglovewheat.gihub.io/2022/09/08/ansible-%E4%BF%AE%E6%94%B9hosts/"/>
    <id>https://biglovewheat.gihub.io/2022/09/08/ansible-%E4%BF%AE%E6%94%B9hosts/</id>
    <published>2022-09-07T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.761Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-修改hosts"><a href="#Ansible-修改hosts" class="headerlink" title="Ansible-修改hosts"></a>Ansible-修改hosts</h2><h3 id="ansible命令"><a href="#ansible命令" class="headerlink" title="ansible命令"></a>ansible命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible all -i all.lst -m script -a <span class="string">&quot;script_hosts.sh&quot;</span> -u ops_root -k</span><br><span class="line"></span><br><span class="line"><span class="comment">## -i 指定清单文件</span></span><br><span class="line"><span class="comment">## -m 模块</span></span><br></pre></td></tr></table></figure><h3 id="设置-x2F-etc-x2F-hosts命令"><a href="#设置-x2F-etc-x2F-hosts命令" class="headerlink" title="设置&#x2F;etc&#x2F;hosts命令"></a>设置&#x2F;etc&#x2F;hosts命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sudo /bin/bash -c <span class="string">&quot;cat &gt; /etc/hosts &quot;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## prod</span></span><br><span class="line"><span class="string">172.31.62.90            aws-prod-app-01</span></span><br><span class="line"><span class="string">172.31.51.65            aws-prod-app-02</span></span><br><span class="line"><span class="string">172.31.58.171           aws-prod-app-03</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Ansible-修改hosts&quot;&gt;&lt;a href=&quot;#Ansible-修改hosts&quot; class=&quot;headerlink&quot; title=&quot;Ansible-修改hosts&quot;&gt;&lt;/a&gt;Ansible-修改hosts&lt;/h2&gt;&lt;h3 id=&quot;ansible命令&quot;&gt;&lt;a</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="ansible" scheme="https://biglovewheat.gihub.io/tags/ansible/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-undo</title>
    <link href="https://biglovewheat.gihub.io/2022/09/07/oracle-undo/"/>
    <id>https://biglovewheat.gihub.io/2022/09/07/oracle-undo/</id>
    <published>2022-09-06T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.788Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-undo"><a href="#Oracle-undo" class="headerlink" title="Oracle-undo"></a>Oracle-undo</h2><h3 id="查看磁盘空间"><a href="#查看磁盘空间" class="headerlink" title="查看磁盘空间"></a>查看磁盘空间</h3><h3 id="undo表空间使用率"><a href="#undo表空间使用率" class="headerlink" title="undo表空间使用率"></a>undo表空间使用率</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">e.tablespace_name,</span><br><span class="line"><span class="built_in">max</span>(total) total,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;ACTIVE&#x27;</span>,G,<span class="number">0</span>)) active,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;UNEXPIRED&#x27;</span>,G,<span class="number">0</span>)) unexpired,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;EXPIRED&#x27;</span>,G,<span class="number">0</span>)) expired,</span><br><span class="line">round((<span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;ACTIVE&#x27;</span>,G,<span class="number">0</span>))<span class="operator">+</span><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;UNEXPIRED&#x27;</span>,G,<span class="number">0</span>)))<span class="operator">/</span><span class="built_in">max</span>(total)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) real_use_pct</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> tablespace_name,round(<span class="built_in">sum</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>) total</span><br><span class="line"><span class="keyword">from</span> dba_data_files</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) f,</span><br><span class="line">(<span class="keyword">SELECT</span> tablespace_name,status,round(<span class="built_in">SUM</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>) G</span><br><span class="line"><span class="keyword">from</span> dba_undo_extents</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tablespace_name,status) e</span><br><span class="line"><span class="keyword">where</span> f.tablespace_name<span class="operator">=</span>e.tablespace_name</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.tablespace_name;</span><br></pre></td></tr></table></figure><h3 id="undo-retention-参数修改"><a href="#undo-retention-参数修改" class="headerlink" title="undo_retention 参数修改"></a>undo_retention 参数修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; show parameter undo</span><br><span class="line"></span><br><span class="line">NAME TYPE VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">_in_memory_undo boolean FALSE</span><br><span class="line">undo_management string AUTO</span><br><span class="line">undo_retention <span class="built_in">integer</span> 14400</span><br><span class="line">undo_tablespace string PSAPUNDO</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system <span class="built_in">set</span> undo_retention=10800 scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure><h3 id="undo占用语句查询"><a href="#undo占用语句查询" class="headerlink" title="undo占用语句查询"></a>undo占用语句查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>  s.machine,s.program,s.sid,round(t.used_ublk<span class="operator">*</span><span class="number">8</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>)  undo_GB,used_urec undo_records,s.status,l.sql_text</span><br><span class="line"><span class="keyword">from</span> v$transaction t,gv$session s,v$sqlstats l</span><br><span class="line"><span class="keyword">where</span> t.ses_addr<span class="operator">=</span>s.saddr</span><br><span class="line"><span class="keyword">and</span> s.sql_id<span class="operator">=</span>l.sql_id(<span class="operator">+</span>)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> undo_GB <span class="keyword">desc</span> ;</span><br></pre></td></tr></table></figure><h3 id="undo表空间扩容"><a href="#undo表空间扩容" class="headerlink" title="undo表空间扩容"></a>undo表空间扩容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlplus -S / as sysdba &gt;undo.log  &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data27&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data28&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data29&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data30&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data31&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data32&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data33&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data34&#x27; size 30G ;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="undo隐藏参数调整"><a href="#undo隐藏参数调整" class="headerlink" title="undo隐藏参数调整"></a>undo隐藏参数调整</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select a.ksppinm name,b.ksppstvl value,a.ksppdesc description</span><br><span class="line">from x<span class="variable">$ksppi</span> a,x<span class="variable">$ksppcv</span> b</span><br><span class="line"><span class="built_in">where</span> a.indx = b.indx</span><br><span class="line">and a.ksppinm like <span class="string">&#x27;%_undo_autotune%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">VALUE</span><br><span class="line">----------------------------------------------------------------------------------------------------</span><br><span class="line">DESCRIPTION</span><br><span class="line">----------------------------------------------------------------------------------------------------</span><br><span class="line">_undo_autotune</span><br><span class="line">TRUE</span><br><span class="line"><span class="built_in">enable</span> auto tuning of undo_retention</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system <span class="built_in">set</span> <span class="string">&quot;_undo_autotune&quot;</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h3 id="创建undo表空间"><a href="#创建undo表空间" class="headerlink" title="创建undo表空间"></a>创建undo表空间</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> undo tablespace UNDOTBS1 datafile <span class="string">&#x27;/opt/oracle/oradata/CMCCWAP/undotbs01.dbf&#x27;</span> size <span class="number">200</span>m autoextend <span class="keyword">on</span>;</span><br></pre></td></tr></table></figure><h3 id="undo相关视图"><a href="#undo相关视图" class="headerlink" title="undo相关视图"></a>undo相关视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$undostat;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_hist_undostat;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-undo&quot;&gt;&lt;a href=&quot;#Oracle-undo&quot; class=&quot;headerlink&quot; title=&quot;Oracle-undo&quot;&gt;&lt;/a&gt;Oracle-undo&lt;/h2&gt;&lt;h3 id=&quot;查看磁盘空间&quot;&gt;&lt;a href=&quot;#查看磁盘空间&quot; cla</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Docker-Dockerfile</title>
    <link href="https://biglovewheat.gihub.io/2022/09/06/docker-dockerfile/"/>
    <id>https://biglovewheat.gihub.io/2022/09/06/docker-dockerfile/</id>
    <published>2022-09-05T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.768Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker-Dockerfile"><a href="#Docker-Dockerfile" class="headerlink" title="Docker-Dockerfile"></a>Docker-Dockerfile</h2><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">From</span> nginx:<span class="number">1.20</span>-alpine</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cp</span> -a /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./dist /dist</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./nginx.conf  /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Docker-Dockerfile&quot;&gt;&lt;a href=&quot;#Docker-Dockerfile&quot; class=&quot;headerlink&quot; title=&quot;Docker-Dockerfile&quot;&gt;&lt;/a&gt;Docker-Dockerfile&lt;/h2&gt;&lt;h3 id=&quot;nginx</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="docker" scheme="https://biglovewheat.gihub.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-sqluldr2-导出数据</title>
    <link href="https://biglovewheat.gihub.io/2022/09/06/oracle-sqluldr2-%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/09/06/oracle-sqluldr2-%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE/</id>
    <published>2022-09-05T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.788Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-sqluldr2-导出数据"><a href="#Oracle-sqluldr2-导出数据" class="headerlink" title="Oracle-sqluldr2-导出数据"></a>Oracle-sqluldr2-导出数据</h2><h3 id="命令行执行"><a href="#命令行执行" class="headerlink" title="命令行执行"></a>命令行执行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## user=oradds/oradds --登录用户名、密码</span></span><br><span class="line"><span class="comment">## sql=ts.sql --提数sql</span></span><br><span class="line"><span class="comment">## file=ts.csv --输出文件</span></span><br><span class="line"><span class="comment">## head=yes  --是否保留表头</span></span><br><span class="line"><span class="comment">## log=ts.log  --日志</span></span><br><span class="line">sqluldr2.bin user=oradds/oradds sql=ts.sql file=ts.csv <span class="built_in">head</span>=<span class="built_in">yes</span> <span class="built_in">log</span>=ts.log array=500</span><br></pre></td></tr></table></figure><h3 id="每100w行分割成一个文件（batch-x3D-yes，row-x3D-1000000，file加上变量-b）"><a href="#每100w行分割成一个文件（batch-x3D-yes，row-x3D-1000000，file加上变量-b）" class="headerlink" title="每100w行分割成一个文件（batch&#x3D;yes，row&#x3D;1000000，file加上变量%b）"></a>每100w行分割成一个文件（batch&#x3D;yes，row&#x3D;1000000，file加上变量%b）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqluldr2.bin user=oradds/oradds sql=ts.sql file=ts_%b.csv <span class="built_in">head</span>=<span class="built_in">yes</span> <span class="built_in">log</span>=ts.log array=500 batch=<span class="built_in">yes</span> row=1000000</span><br></pre></td></tr></table></figure><h3 id="以竖线（“-”）为分隔符"><a href="#以竖线（“-”）为分隔符" class="headerlink" title="以竖线（“|”）为分隔符"></a>以竖线（“|”）为分隔符</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqluldr2.bin user=oradds/oradds sql=ts.sql file=ts.csv <span class="built_in">head</span>=<span class="built_in">yes</span> <span class="built_in">log</span>=ts.log array=500 field=0x7c</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-sqluldr2-导出数据&quot;&gt;&lt;a href=&quot;#Oracle-sqluldr2-导出数据&quot; class=&quot;headerlink&quot; title=&quot;Oracle-sqluldr2-导出数据&quot;&gt;&lt;/a&gt;Oracle-sqluldr2-导出数据&lt;/h2&gt;&lt;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-表空间扩容</title>
    <link href="https://biglovewheat.gihub.io/2022/09/06/oracle-%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%89%A9%E5%AE%B9/"/>
    <id>https://biglovewheat.gihub.io/2022/09/06/oracle-%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%89%A9%E5%AE%B9/</id>
    <published>2022-09-05T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.788Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-表空间扩容"><a href="#Oracle-表空间扩容" class="headerlink" title="Oracle-表空间扩容"></a>Oracle-表空间扩容</h2><h3 id="查看磁盘空间"><a href="#查看磁盘空间" class="headerlink" title="查看磁盘空间"></a>查看磁盘空间</h3><h3 id="查看表空间使用率"><a href="#查看表空间使用率" class="headerlink" title="查看表空间使用率"></a>查看表空间使用率</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> ts.tablespace_name, ts.status, ts.contents, ts.extent_management, ts.bigfile,   </span><br><span class="line">       size_info.megs_alloc, size_info.megs_free, size_info.megs_used,   </span><br><span class="line">       size_info.pct_free, size_info.pct_used, size_info.max  </span><br><span class="line"><span class="keyword">From</span>  </span><br><span class="line">      (   </span><br><span class="line">      <span class="keyword">select</span>  a.tablespace_name,   </span><br><span class="line">             round(a.bytes_alloc <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>) megs_alloc,   </span><br><span class="line">             round(nvl(b.bytes_free, <span class="number">0</span>) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>) megs_free,   </span><br><span class="line">             round((a.bytes_alloc <span class="operator">-</span> nvl(b.bytes_free, <span class="number">0</span>)) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>) megs_used,   </span><br><span class="line">             round((nvl(b.bytes_free, <span class="number">0</span>) <span class="operator">/</span> a.bytes_alloc) <span class="operator">*</span> <span class="number">100</span>) Pct_Free,   </span><br><span class="line">            <span class="number">100</span> <span class="operator">-</span> round((nvl(b.bytes_free, <span class="number">0</span>) <span class="operator">/</span> a.bytes_alloc) <span class="operator">*</span> <span class="number">100</span>) Pct_used,   </span><br><span class="line">             round(maxbytes<span class="operator">/</span><span class="number">1048576</span>) Max  </span><br><span class="line">      <span class="keyword">from</span>  ( <span class="keyword">select</span>  f.tablespace_name,   </span><br><span class="line">                     <span class="built_in">sum</span>(f.bytes) bytes_alloc,   </span><br><span class="line">                     <span class="built_in">sum</span>(decode(f.autoextensible, <span class="string">&#x27;YES&#x27;</span>,f.maxbytes,<span class="string">&#x27;NO&#x27;</span>, f.bytes)) maxbytes   </span><br><span class="line">              <span class="keyword">from</span> dba_data_files f   </span><br><span class="line">              <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) a,   </span><br><span class="line">            ( <span class="keyword">select</span>  f.tablespace_name,   </span><br><span class="line">                     <span class="built_in">sum</span>(f.bytes)  bytes_free   </span><br><span class="line">              <span class="keyword">from</span> dba_free_space f   </span><br><span class="line">              <span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) b   </span><br><span class="line">      <span class="keyword">where</span> a.tablespace_name <span class="operator">=</span> b.tablespace_name (<span class="operator">+</span>)   </span><br><span class="line">      <span class="keyword">union</span> <span class="keyword">all</span>  </span><br><span class="line">      <span class="keyword">select</span> h.tablespace_name,   </span><br><span class="line">             round(<span class="built_in">sum</span>(h.bytes_free <span class="operator">+</span> h.bytes_used) <span class="operator">/</span> <span class="number">1048576</span>) megs_alloc,   </span><br><span class="line">             round(<span class="built_in">sum</span>((h.bytes_free <span class="operator">+</span> h.bytes_used) <span class="operator">-</span> nvl(p.bytes_used, <span class="number">0</span>)) <span class="operator">/</span> <span class="number">1048576</span>) megs_free,   </span><br><span class="line">             round(<span class="built_in">sum</span>(nvl(p.bytes_used, <span class="number">0</span>))<span class="operator">/</span> <span class="number">1048576</span>) megs_used,   </span><br><span class="line">             round((<span class="built_in">sum</span>((h.bytes_free <span class="operator">+</span> h.bytes_used) <span class="operator">-</span> nvl(p.bytes_used, <span class="number">0</span>)) <span class="operator">/</span> <span class="built_in">sum</span>(h.bytes_used <span class="operator">+</span> h.bytes_free)) <span class="operator">*</span> <span class="number">100</span>) Pct_Free,   </span><br><span class="line">             <span class="number">100</span> <span class="operator">-</span> round((<span class="built_in">sum</span>((h.bytes_free <span class="operator">+</span> h.bytes_used) <span class="operator">-</span> nvl(p.bytes_used, <span class="number">0</span>)) <span class="operator">/</span> <span class="built_in">sum</span>(h.bytes_used <span class="operator">+</span> h.bytes_free)) <span class="operator">*</span> <span class="number">100</span>) pct_used,   </span><br><span class="line">             round(<span class="built_in">sum</span>(decode(f.autoextensible, <span class="string">&#x27;YES&#x27;</span>, f.maxbytes, <span class="string">&#x27;NO&#x27;</span>, f.bytes) <span class="operator">/</span> <span class="number">1048576</span>)) max  </span><br><span class="line">      <span class="keyword">from</span>   sys.v_$TEMP_SPACE_HEADER h, sys.v_$Temp_extent_pool p, dba_temp_files f   </span><br><span class="line">      <span class="keyword">where</span>  p.file_id(<span class="operator">+</span>) <span class="operator">=</span> h.file_id   </span><br><span class="line">      <span class="keyword">and</span>    p.tablespace_name(<span class="operator">+</span>) <span class="operator">=</span> h.tablespace_name   </span><br><span class="line">      <span class="keyword">and</span>    f.file_id <span class="operator">=</span> h.file_id   </span><br><span class="line">      <span class="keyword">and</span>    f.tablespace_name <span class="operator">=</span> h.tablespace_name   </span><br><span class="line">      <span class="keyword">group</span> <span class="keyword">by</span> h.tablespace_name   </span><br><span class="line">      ) size_info,   </span><br><span class="line">      sys.dba_tablespaces ts   </span><br><span class="line"><span class="keyword">where</span> ts.tablespace_name <span class="operator">=</span> size_info.tablespace_name;</span><br></pre></td></tr></table></figure><h3 id="表空间扩容"><a href="#表空间扩容" class="headerlink" title="表空间扩容"></a>表空间扩容</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--数据文件一般按序号添加，所以首先要找到最大一个数据文件的编号，再按顺序增加</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span>space PSAPSR3 <span class="keyword">add</span> datafile <span class="string">&#x27;/dataQF/qfdata/oradata/qfdata3/PSAPSR780.DBF&#x27;</span> size <span class="number">30</span>G;  </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-表空间扩容&quot;&gt;&lt;a href=&quot;#Oracle-表空间扩容&quot; class=&quot;headerlink&quot; title=&quot;Oracle-表空间扩容&quot;&gt;&lt;/a&gt;Oracle-表空间扩容&lt;/h2&gt;&lt;h3 id=&quot;查看磁盘空间&quot;&gt;&lt;a href=&quot;#查看磁盘空间&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Postgresql-dblink使用</title>
    <link href="https://biglovewheat.gihub.io/2022/09/06/postgresql-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%20copy/"/>
    <id>https://biglovewheat.gihub.io/2022/09/06/postgresql-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%20copy/</id>
    <published>2022-09-05T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.788Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Postgresql-dblink使用"><a href="#Postgresql-dblink使用" class="headerlink" title="Postgresql-dblink使用"></a>Postgresql-dblink使用</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 开启dblink</span></span><br><span class="line"><span class="keyword">create</span> EXTENSION dblink if <span class="keyword">not</span> <span class="keyword">EXISTS</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 新建dblink</span></span><br><span class="line"><span class="keyword">select</span> dblink_connect(<span class="string">&#x27;dblinktest&#x27;</span>,<span class="string">&#x27;host=192.168.8.201 dbname=hxtest user=postgres password=654321&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询现有dblink</span></span><br><span class="line"><span class="keyword">select</span> dblink_get_connections();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过dblink查询表</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dblink(<span class="string">&#x27;dblinktest&#x27;</span>,<span class="string">&#x27;select gid,code from d_farmland;&#x27;</span>)</span><br><span class="line"><span class="keyword">as</span> t_d_farmland(gid <span class="type">int</span>,d_farmland <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 断开dblink</span></span><br><span class="line"><span class="keyword">select</span> dblink_disconnect(<span class="string">&#x27;dblinktest&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 断开所有</span></span><br><span class="line"><span class="keyword">select</span> dblink_disconnect();</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Postgresql-dblink使用&quot;&gt;&lt;a href=&quot;#Postgresql-dblink使用&quot; class=&quot;headerlink&quot; title=&quot;Postgresql-dblink使用&quot;&gt;&lt;/a&gt;Postgresql-dblink使用&lt;/h2&gt;&lt;figu</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="postgresql" scheme="https://biglovewheat.gihub.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Python-Nacos-备份</title>
    <link href="https://biglovewheat.gihub.io/2022/09/02/python-nacos-%E5%A4%87%E4%BB%BD/"/>
    <id>https://biglovewheat.gihub.io/2022/09/02/python-nacos-%E5%A4%87%E4%BB%BD/</id>
    <published>2022-09-01T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.790Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-Nacos-备份"><a href="#Python-Nacos-备份" class="headerlink" title="Python-Nacos-备份"></a>Python-Nacos-备份</h2><p><em>一个python写的nacos配置备份，并上传到s3的脚本</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"><span class="keyword">from</span> fileinput <span class="keyword">import</span> filename</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> boto3.session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line"><span class="comment">## s3 config</span></span><br><span class="line">aws_key = <span class="string">&quot;XXXX&quot;</span></span><br><span class="line">aws_secret = <span class="string">&quot;XXXX&quot;</span></span><br><span class="line">region_name = <span class="string">&quot;cn-northwest-1&quot;</span></span><br><span class="line">session = Session(aws_access_key_id=aws_key,</span><br><span class="line">aws_secret_access_key=aws_secret,</span><br><span class="line">region_name=region_name)</span><br><span class="line"></span><br><span class="line">s3 = session.resource(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">client = session.client(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">bucket = <span class="string">&quot;hxs3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nacos</span></span><br><span class="line">nacos_list=[</span><br><span class="line">    <span class="string">&#x27;http://10.9.127.244:8848|c23a1b4c-e97f-45ae-a5c0-1e7f1a8d22e9|nacos|nacos|nacos-dev&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://10.9.127.245:8848|da7aaaa2-7505-4c1d-98c6-9e2e7778ef55|nacos|nacos|nacos-prod&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> nacos_list:</span><br><span class="line">    url,namespace,username,password,filename = row.strip().split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    login_url = url+<span class="string">&#x27;/nacos/v1/auth/users/login&#x27;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;username&#x27;</span>:username,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:password&#125;</span><br><span class="line">    s = requests.session()</span><br><span class="line">    resp = s.post(login_url,data)</span><br><span class="line">    token = json.loads(resp.text)[<span class="string">&#x27;accessToken&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    backup_url = url+<span class="string">&#x27;/nacos/v1/cs/configs?export=true&amp;tenant=&#x27;</span>+namespace+<span class="string">&#x27;&amp;group=&amp;appName=&amp;dataId=&amp;ids=&amp;accessToken=&#x27;</span>+token</span><br><span class="line">    </span><br><span class="line">    filename = os.path.abspath(os.path.dirname(__file__))+<span class="string">&#x27;/&#x27;</span>+filename+<span class="string">&#x27;-&#x27;</span>+datetime.datetime.now().strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>)+<span class="string">&#x27;.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">    r = requests.get(backup_url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> code:</span><br><span class="line">        code.write(r.content)</span><br><span class="line"></span><br><span class="line">    upload_data = <span class="built_in">open</span>(filename,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    upload_key = <span class="string">&quot;backup/&quot;</span>+os.path.basename(filename)</span><br><span class="line">    file_obj = s3.Bucket(bucket).put_object(Key=upload_key, Body=upload_data)</span><br><span class="line">    <span class="built_in">print</span>(file_obj)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-Nacos-备份&quot;&gt;&lt;a href=&quot;#Python-Nacos-备份&quot; class=&quot;headerlink&quot; title=&quot;Python-Nacos-备份&quot;&gt;&lt;/a&gt;Python-Nacos-备份&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个python写的naco</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
    <category term="nacos" scheme="https://biglovewheat.gihub.io/tags/nacos/"/>
    
  </entry>
  
  <entry>
    <title>Java程序占用cpu高排查</title>
    <link href="https://biglovewheat.gihub.io/2022/09/01/java%E7%A8%8B%E5%BA%8F%E5%8D%A0%E7%94%A8cpu%E9%AB%98%E6%8E%92%E6%9F%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/09/01/java%E7%A8%8B%E5%BA%8F%E5%8D%A0%E7%94%A8cpu%E9%AB%98%E6%8E%92%E6%9F%A5/</id>
    <published>2022-08-31T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.773Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Java程序占用cpu高排查"><a href="#Java程序占用cpu高排查" class="headerlink" title="Java程序占用cpu高排查"></a>Java程序占用cpu高排查</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## top + 大写C  用cpu占用率排序，记录进程</span></span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment">## top -Hp ，记录该进程中的线程号</span></span><br><span class="line">top -Hp 26750</span><br><span class="line"></span><br><span class="line"><span class="comment">## 找到占用最高的线程，将pid换算成16进制</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%x\n&#x27;</span> 26751</span><br><span class="line"></span><br><span class="line"><span class="comment">## 通过jstack找到线程信息</span></span><br><span class="line">jstack 26750 |grep xxxxx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Java程序占用cpu高排查&quot;&gt;&lt;a href=&quot;#Java程序占用cpu高排查&quot; class=&quot;headerlink&quot; title=&quot;Java程序占用cpu高排查&quot;&gt;&lt;/a&gt;Java程序占用cpu高排查&lt;/h2&gt;&lt;figure class=&quot;highlight </summary>
      
    
    
    
    <category term="故障排查" scheme="https://biglovewheat.gihub.io/categories/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    
    <category term="java" scheme="https://biglovewheat.gihub.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>K8s-crontabjob</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/k8s-crontabjob/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/k8s-crontabjob/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.777Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-crontabjob"><a href="#K8s-crontabjob" class="headerlink" title="K8s-crontabjob"></a>K8s-crontabjob</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Cronjob的时区和kube-controller-manager服务的时区一致,默认为0时区,需-8小时</span></span><br><span class="line"><span class="comment">## 或修改kube-controller-manager时区</span></span><br><span class="line">apiVersion: batch/v1beta1</span><br><span class="line">kind: CronJob</span><br><span class="line">metadata:</span><br><span class="line">  name: hx-python-jiage</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  schedule: <span class="string">&quot;2 16 * * *&quot;</span></span><br><span class="line">  jobTemplate:</span><br><span class="line">    spec:</span><br><span class="line">      template:</span><br><span class="line">        spec:</span><br><span class="line">          containers:</span><br><span class="line">          - name: hx-python-jiage</span><br><span class="line">            image: 10.9.127.243:30002/library/hx-python-jiage:1.0</span><br><span class="line">            imagePullPolicy: IfNotPresent</span><br><span class="line">          restartPolicy: OnFailure</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-crontabjob&quot;&gt;&lt;a href=&quot;#K8s-crontabjob&quot; class=&quot;headerlink&quot; title=&quot;K8s-crontabjob&quot;&gt;&lt;/a&gt;K8s-crontabjob&lt;/h2&gt;&lt;figure class=&quot;highlight </summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8s-组件安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/k8s-%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/k8s-%E7%BB%84%E4%BB%B6%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.778Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-组件安装"><a href="#K8s-组件安装" class="headerlink" title="K8s-组件安装"></a>K8s-组件安装</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## metrics</span></span><br><span class="line">kubectl apply -f https://download.osichina.net/tools/kubernetes/metrics-server/components.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## deshboard</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">## calico</span></span><br><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.19/manifests/calico.yaml</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-组件安装&quot;&gt;&lt;a href=&quot;#K8s-组件安装&quot; class=&quot;headerlink&quot; title=&quot;K8s-组件安装&quot;&gt;&lt;/a&gt;K8s-组件安装&lt;/h2&gt;&lt;h3 id=&quot;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;headerlink&quot; title=&quot;&quot;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Lvs+keepalived安装配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/lvs-keepalive%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/lvs-keepalive%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.781Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Lvs-keepalived安装配置"><a href="#Lvs-keepalived安装配置" class="headerlink" title="Lvs+keepalived安装配置"></a>Lvs+keepalived安装配置</h2><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><table><thead><tr><th>主机</th><th>软件</th><th>IP</th></tr></thead><tbody><tr><td></td><td>vip</td><td>192.168.8.209</td></tr><tr><td>lvs1</td><td>lvs+keepalived</td><td>192.168.8.201</td></tr><tr><td>lvs2</td><td>lvs+keepalived</td><td>192.168.8.202</td></tr><tr><td>nginx1</td><td>nginx</td><td>192.168.8.203</td></tr><tr><td>nginx2</td><td>nginx</td><td>192.168.8.204</td></tr></tbody></table><h3 id="lvs和keepalived安装"><a href="#lvs和keepalived安装" class="headerlink" title="lvs和keepalived安装"></a>lvs和keepalived安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装lvs管理工具ipvsadm</span></span><br><span class="line">yum install -y gcc openssl openssl-devel ipvsadm</span><br><span class="line"></span><br><span class="line"><span class="comment">## keepalived 编译安装</span></span><br><span class="line">./configure  --prefix=/usr/local/keepalived</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">## keepalived 注册服务 &amp; 开机启动</span></span><br><span class="line"><span class="built_in">cp</span> /soft/keepalived-2.0.20/keepalived/etc/init.d/keepalived /etc/init.d/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/</span><br><span class="line"><span class="built_in">mkdir</span> -p /etc/keepalived/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/etc/keepalived/keepalived.conf  /etc/keepalived/</span><br><span class="line"><span class="built_in">cp</span> /usr/local/keepalived/sbin/keepalived /usr/sbin</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> keepalived</span><br><span class="line">systemctl restart keepalived</span><br></pre></td></tr></table></figure><h3 id="lvs1-主机-配置"><a href="#lvs1-主机-配置" class="headerlink" title="lvs1(主机)配置"></a>lvs1(主机)配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;</span><br><span class="line">   <span class="comment">#xxxx@itcast.com                                   # 发生故障时发送的邮箱</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#notification_email_from xxxx@itcast.com             # 使用哪个邮箱发送</span></span><br><span class="line">  <span class="comment">#smtp_server xxx.com                                  # 发件服务器</span></span><br><span class="line">  smtp_connect_timeout 30</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state MASTER             <span class="comment"># 标示为主lvs</span></span><br><span class="line">   interface ens33           <span class="comment"># HA检测端口</span></span><br><span class="line">   virtual_router_id 66     <span class="comment"># 主备的virtual_router_id 必须相同</span></span><br><span class="line">   priority 100             <span class="comment"># 优先级,备lvs要比主lvs稍小</span></span><br><span class="line">   advert_int 1             <span class="comment"># VRRP Multicast 广播周期秒数</span></span><br><span class="line">   authentication &#123;         <span class="comment"># 定义认证</span></span><br><span class="line">       auth_type PASS       <span class="comment"># 认证方式为口令认证</span></span><br><span class="line">       auth_pass 6666       <span class="comment"># 定义口令</span></span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;      <span class="comment"># 定义vip</span></span><br><span class="line">       192.168.3.209      <span class="comment"># 多个vip可换行添加</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.209 80 &#123;</span><br><span class="line">   delay_loop 6       <span class="comment"># 每隔6秒查看realserver状态</span></span><br><span class="line">   lb_algo wlc        <span class="comment"># 调度算法为加权最小连接数</span></span><br><span class="line">   lb_kind DR         <span class="comment"># lvs工作模式为DR(直接路由)模式</span></span><br><span class="line">   nat_mask 255.255.255.0</span><br><span class="line">   persistence_timeout 50  <span class="comment"># 同一IP 的连接50秒内被分配到同一台realserver(测试时建议改为0)</span></span><br><span class="line">   protocol TCP            <span class="comment"># 用TCP监测realserver的状态</span></span><br><span class="line">   real_server 192.168.3.203 80 &#123;       <span class="comment"># 定义realserver</span></span><br><span class="line">       weight 3                       <span class="comment"># 定义权重</span></span><br><span class="line">       TCP_CHECK &#123;  <span class="comment"># 注意TCP_CHECK和&#123;之间的空格,如果没有的话只会添加第一个realserver</span></span><br><span class="line">           connect_timeout 3          <span class="comment"># 三秒无响应超时</span></span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   real_server 192.168.3.204 80 &#123;</span><br><span class="line">       weight 3</span><br><span class="line">       TCP_CHECK &#123;</span><br><span class="line">           connect_timeout 3</span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lvs2-备机-配置"><a href="#lvs2-备机-配置" class="headerlink" title="lvs2(备机)配置"></a>lvs2(备机)配置</h3><p>配置和主机相同，唯一区别是priority的值要少于主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived</span><br><span class="line">global_defs &#123;</span><br><span class="line">  notification_email &#123;</span><br><span class="line">   <span class="comment">#xxxx@itcast.com                                   # 发生故障时发送的邮箱</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#notification_email_from xxxx@itcast.com             # 使用哪个邮箱发送</span></span><br><span class="line">  <span class="comment">#smtp_server xxx.com                                  # 发件服务器</span></span><br><span class="line">  smtp_connect_timeout 30</span><br><span class="line">  router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">   state BACKUP             <span class="comment"># 标示为主lvs</span></span><br><span class="line">   interface ens33           <span class="comment"># HA检测端口</span></span><br><span class="line">   virtual_router_id 66     <span class="comment"># 主备的virtual_router_id 必须相同</span></span><br><span class="line">   priority 99             <span class="comment"># 优先级,备lvs要比主lvs稍小</span></span><br><span class="line">   advert_int 1             <span class="comment"># VRRP Multicast 广播周期秒数</span></span><br><span class="line">   authentication &#123;         <span class="comment"># 定义认证</span></span><br><span class="line">       auth_type PASS       <span class="comment"># 认证方式为口令认证</span></span><br><span class="line">       auth_pass 6666       <span class="comment"># 定义口令</span></span><br><span class="line">   &#125;</span><br><span class="line">   virtual_ipaddress &#123;      <span class="comment"># 定义vip</span></span><br><span class="line">       192.168.3.209      <span class="comment"># 多个vip可换行添加</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">virtual_server 192.168.3.209 80 &#123;</span><br><span class="line">   delay_loop 6       <span class="comment"># 每隔6秒查看realserver状态</span></span><br><span class="line">   lb_algo wlc        <span class="comment"># 调度算法为加权最小连接数</span></span><br><span class="line">   lb_kind DR         <span class="comment"># lvs工作模式为DR(直接路由)模式</span></span><br><span class="line">   nat_mask 255.255.255.0</span><br><span class="line">   persistence_timeout 50  <span class="comment"># 同一IP 的连接50秒内被分配到同一台realserver(测试时建议改为0)</span></span><br><span class="line">   protocol TCP            <span class="comment"># 用TCP监测realserver的状态</span></span><br><span class="line">   real_server 192.168.3.203 80 &#123;       <span class="comment"># 定义realserver</span></span><br><span class="line">       weight 3                       <span class="comment"># 定义权重</span></span><br><span class="line">       TCP_CHECK &#123;  <span class="comment"># 注意TCP_CHECK和&#123;之间的空格,如果没有的话只会添加第一个realserver</span></span><br><span class="line">           connect_timeout 3          <span class="comment"># 三秒无响应超时</span></span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   real_server 192.168.3.204 80 &#123;</span><br><span class="line">       weight 3</span><br><span class="line">       TCP_CHECK &#123;</span><br><span class="line">           connect_timeout 3</span><br><span class="line">           nb_get_retry 3</span><br><span class="line">           delay_before_retry 3</span><br><span class="line">           connect_port 80</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lvs配置"><a href="#lvs配置" class="headerlink" title="lvs配置"></a>lvs配置</h3><p>将lvs启动配置成服务，随开机启动（lvs1、lvs2都需配置）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/init.d/lvs_dr_rs</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment">#chkconfig:345 85 15</span></span><br><span class="line"><span class="comment">#description:lvs_dr_rs</span></span><br><span class="line">VIP=192.168.3.209</span><br><span class="line">. /etc/rc.d/init.d/functions</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;lo:0 port starting&quot;</span></span><br><span class="line">        ifconfig lo:0 <span class="variable">$VIP</span> broadcast <span class="variable">$VIP</span> netmask 255.255.255.255 up</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;2&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;;</span><br><span class="line">        stop)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;lo:0 port closing&quot;</span></span><br><span class="line">        ifconfig lo:0 down</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/lo/arp_announce</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_ignore</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;0&quot;</span> &gt; /proc/sys/net/ipv4/conf/all/arp_announce</span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> &#123;start ¦ stop&#125;&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">chmod</span> u+x /etc/init.d/lvs_dr_rs</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> lvs_dr_rs</span><br><span class="line">systemctl start lvs_dr_rs</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Lvs-keepalived安装配置&quot;&gt;&lt;a href=&quot;#Lvs-keepalived安装配置&quot; class=&quot;headerlink&quot; title=&quot;Lvs+keepalived安装配置&quot;&gt;&lt;/a&gt;Lvs+keepalived安装配置&lt;/h2&gt;&lt;h3 id=&quot;实</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="lvs" scheme="https://biglovewheat.gihub.io/tags/lvs/"/>
    
    <category term="keepalived" scheme="https://biglovewheat.gihub.io/tags/keepalived/"/>
    
  </entry>
  
  <entry>
    <title>ssl证书类型和价格</title>
    <link href="https://biglovewheat.gihub.io/2022/08/30/ssl%E8%AF%81%E4%B9%A6%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BB%B7%E6%A0%BC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/30/ssl%E8%AF%81%E4%B9%A6%E7%B1%BB%E5%9E%8B%E5%92%8C%E4%BB%B7%E6%A0%BC/</id>
    <published>2022-08-29T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.795Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ssl证书类型和价格"><a href="#ssl证书类型和价格" class="headerlink" title="ssl证书类型和价格"></a>ssl证书类型和价格</h2><h3 id="ssl证书简介"><a href="#ssl证书简介" class="headerlink" title="ssl证书简介"></a>ssl证书简介</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_01.jpg"></p><h3 id="ssl证书类型"><a href="#ssl证书类型" class="headerlink" title="ssl证书类型"></a>ssl证书类型</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_02.jpg"></p><h3 id="ssl证书价格"><a href="#ssl证书价格" class="headerlink" title="ssl证书价格"></a>ssl证书价格</h3><p><img src="/./../images/ssl%E8%AF%81%E4%B9%A6_03.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ssl证书类型和价格&quot;&gt;&lt;a href=&quot;#ssl证书类型和价格&quot; class=&quot;headerlink&quot; title=&quot;ssl证书类型和价格&quot;&gt;&lt;/a&gt;ssl证书类型和价格&lt;/h2&gt;&lt;h3 id=&quot;ssl证书简介&quot;&gt;&lt;a href=&quot;#ssl证书简介&quot; class</summary>
      
    
    
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="ssl" scheme="https://biglovewheat.gihub.io/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>AWS-S3</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/aws-s3/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/aws-s3/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.766Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-S3"><a href="#AWS-S3" class="headerlink" title="AWS-S3"></a>AWS-S3</h2><h3 id="中国区价格"><a href="#中国区价格" class="headerlink" title="中国区价格"></a>中国区价格</h3><p><a href="https://www.amazonaws.cn/s3/pricing/">https://www.amazonaws.cn/s3/pricing/</a></p><h3 id="存储类别"><a href="#存储类别" class="headerlink" title="存储类别"></a>存储类别</h3><p><img src="/../images/aws-s3_01.png"></p><h3 id="client安装配置"><a href="#client安装配置" class="headerlink" title="client安装配置"></a>client安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">curl <span class="string">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span> -o <span class="string">&quot;awscliv2.zip&quot;</span></span><br><span class="line">unzip awscliv2.zip</span><br><span class="line">./aws/install</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">## 帮助</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">/usr/local/bin/aws configure</span><br><span class="line">AWS Access Key ID [None]: AKIAUPGCAPWX4FXXXXXX</span><br><span class="line">AWS Secret Access Key [None]: SsOupysZ4ZBptxGCxPm+aLWq+dTfShrgsdXXXXXX</span><br><span class="line">Default region name [None]: cn-northwest-1</span><br><span class="line">Default output format [None]:</span><br></pre></td></tr></table></figure><h3 id="上传下载"><a href="#上传下载" class="headerlink" title="上传下载"></a>上传下载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> mysqlbackup_all_202109280515.tar.gz s3://aas3</span><br><span class="line"><span class="comment">## 复制和排除文件夹</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> miniodata s3://aas3/permanent_backup/minio_backup/  --exclude sensordata/*  --exclude .minio.sys/*  --recursive</span><br><span class="line"></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> s3://aas3/AWSLogs/307497041326/vpcflowlogs/cn-northwest-1/2021/11/19/ . --recursive</span><br></pre></td></tr></table></figure><h3 id="挂载S3为文件系统"><a href="#挂载S3为文件系统" class="headerlink" title="挂载S3为文件系统"></a>挂载S3为文件系统</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1.参考文档</span></span><br><span class="line"><span class="comment">## https://aws.amazon.com/cn/blogs/china/s3fs-amazon-ec2-linux/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.安装elep</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line"></span><br><span class="line"><span class="comment">## 3.安装s3fs-fuse</span></span><br><span class="line">yum install s3fs-fuse -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 4.配置登录信息</span></span><br><span class="line">    <span class="built_in">echo</span> AKIAUPGCAPWX4FD5N2CO:SsOupysZ4ZBptxGCxPm+aLWq+dTfShrgsdITVib2 &gt; /etc/passwd-s3fs</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/passwd-s3fs</span><br><span class="line"></span><br><span class="line"><span class="comment">## 5.手工挂载</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /s3mnt</span><br><span class="line">s3fs hxs3 /s3mnt -o passwd_file=/etc/passwd-s3fs -o url=http://s3.cn-northwest-1.amazonaws.com.cn -o endpoint=cn-northwest-1</span><br><span class="line"></span><br><span class="line"><span class="comment">## 6.自动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">s3fs<span class="comment">#hxs3 /s3mnt fuse allow_other,url=http://s3.cn-northwest-1.amazonaws.com.cn,endpoint=cn-northwest-1 0  0</span></span><br><span class="line">mount -a</span><br><span class="line"></span><br><span class="line"><span class="comment">## 7.卸载</span></span><br><span class="line">umount /s3mnt</span><br><span class="line">umount -l /s3mnt</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-S3&quot;&gt;&lt;a href=&quot;#AWS-S3&quot; class=&quot;headerlink&quot; title=&quot;AWS-S3&quot;&gt;&lt;/a&gt;AWS-S3&lt;/h2&gt;&lt;h3 id=&quot;中国区价格&quot;&gt;&lt;a href=&quot;#中国区价格&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="s3" scheme="https://biglovewheat.gihub.io/tags/s3/"/>
    
  </entry>
  
  <entry>
    <title>AWS-阿里云对比</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/aws-%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E6%AF%94/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/aws-%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E6%AF%94/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.766Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-阿里云对比"><a href="#AWS-阿里云对比" class="headerlink" title="AWS-阿里云对比"></a>AWS-阿里云对比</h2><p><em>AWS为中国区价格</em></p><h3 id="云服务器"><a href="#云服务器" class="headerlink" title="云服务器"></a>云服务器</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>阿里云</th><th>AWS</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>ecs.g7.xlarge</td><td>ecs.r7.xlarge</td><td>m5.xlarge</td><td>r5.xlarge</td></tr><tr><td>类型</td><td>通用型</td><td>内存型</td><td>通用型</td><td>内存型</td></tr><tr><td>规格</td><td>4c16g</td><td>4c32g</td><td>4c16g</td><td>4c32g</td></tr><tr><td>小时价</td><td>1.0465</td><td>1.392442</td><td>2.026</td><td>2.437</td></tr><tr><td>小时-月</td><td>753.48</td><td>1002.55824</td><td>1458.72</td><td>1754.64</td></tr><tr><td>包月价</td><td>502.32</td><td>668.37</td><td>303.12</td><td>396</td></tr><tr><td>包年-月</td><td>426.97</td><td>568.12</td><td>282.96</td><td>369.36</td></tr></tbody></table><h3 id="块存储"><a href="#块存储" class="headerlink" title="块存储"></a>块存储</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>阿里云</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>PL0</td><td>PL1</td><td>GP3</td></tr><tr><td>性能指标</td><td>10000IOPS&#x2F;180MB</td><td>50000IOPS&#x2F;350MB</td><td>3000IOPS&#x2F;125MB</td></tr><tr><td>计价方式</td><td>按量-小时&#x2F;GiB</td><td>按量-小时&#x2F;GiB</td><td>按量-小时&#x2F;GiB</td></tr><tr><td>单价</td><td>0.00105</td><td>0.0021</td><td></td></tr><tr><td>折算</td><td>0.756</td><td>1.512</td><td>0.5312</td></tr><tr><td>计价方式</td><td>包月-月&#x2F;GiB</td><td>包月-月&#x2F;GiB</td><td></td></tr><tr><td>单价</td><td>0.5</td><td>1</td><td></td></tr></tbody></table><h3 id="对象存储"><a href="#对象存储" class="headerlink" title="对象存储"></a>对象存储</h3><table><thead><tr><th>厂商</th><th>阿里云</th><th>AWS</th></tr></thead><tbody><tr><td>型号</td><td>oss标准型单价</td><td>S3标准存储</td></tr><tr><td>单价</td><td>0.12</td><td>0.1755</td></tr><tr><td>流量费用</td><td>0.25gb(闲时)&#x2F;0.5gb（忙时）</td><td>0.933&#x2F;gb</td></tr><tr><td>请求费用</td><td>PUT:0.01元&#x2F;万次</td><td>PUT:0.0405&#x2F;万次，GET:0.0135&#x2F;万次</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-阿里云对比&quot;&gt;&lt;a href=&quot;#AWS-阿里云对比&quot; class=&quot;headerlink&quot; title=&quot;AWS-阿里云对比&quot;&gt;&lt;/a&gt;AWS-阿里云对比&lt;/h2&gt;&lt;p&gt;&lt;em&gt;AWS为中国区价格&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&quot;云服务器&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="云原生" scheme="https://biglovewheat.gihub.io/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="阿里云" scheme="https://biglovewheat.gihub.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
  </entry>
  
  <entry>
    <title>Nexus减肥</title>
    <link href="https://biglovewheat.gihub.io/2022/08/29/nexus-%E5%87%8F%E8%82%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/29/nexus-%E5%87%8F%E8%82%A5/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.785Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nexus减肥"><a href="#Nexus减肥" class="headerlink" title="Nexus减肥"></a>Nexus减肥</h2><p><em>nexus默认安装时，没有开启清理的任务，时间一长，容易占用大量磁盘空间</em></p><h3 id="清理maven-snapshot库"><a href="#清理maven-snapshot库" class="headerlink" title="清理maven-snapshot库"></a>清理maven-snapshot库</h3><p>system–task–create task–Maven - Delete SNAPSHOT Task</p><p>默认策略，只保留一个，多于1个且超过30天将删除</p><p><img src="/../images/nexus%E5%87%8F%E8%82%A5_01.jpg"></p><h3 id="释放blob-store空间"><a href="#释放blob-store空间" class="headerlink" title="释放blob store空间"></a>释放blob store空间</h3><p>清理完成后，不会马上释放空间，需要运行另外一个任务释放</p><p>system–task–create task–Create Admin - Compact blob store Task</p><p><img src="/../images/nexus%E5%87%8F%E8%82%A5_02.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nexus减肥&quot;&gt;&lt;a href=&quot;#Nexus减肥&quot; class=&quot;headerlink&quot; title=&quot;Nexus减肥&quot;&gt;&lt;/a&gt;Nexus减肥&lt;/h2&gt;&lt;p&gt;&lt;em&gt;nexus默认安装时，没有开启清理的任务，时间一长，容易占用大量磁盘空间&lt;/em&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="nexus" scheme="https://biglovewheat.gihub.io/tags/nexus/"/>
    
  </entry>
  
  <entry>
    <title>正则表达式</title>
    <link href="https://biglovewheat.gihub.io/2022/08/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>https://biglovewheat.gihub.io/2022/08/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</id>
    <published>2022-08-23T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.795Z</updated>
    
    <content type="html"><![CDATA[<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><h3 id="身份证校验"><a href="#身份证校验" class="headerlink" title="身份证校验"></a>身份证校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 前六位，地区</span></span><br><span class="line">([1-6][1-9]|50)\d&#123;4&#125;</span><br><span class="line"><span class="comment">## 7-8位置，年份前两位，1800-2099</span></span><br><span class="line">(18|19|20)</span><br><span class="line"><span class="comment">## 9-10位置，年份后两位</span></span><br><span class="line">\d&#123;2&#125;</span><br><span class="line"><span class="comment">## 11-12，月份</span></span><br><span class="line">((0[1-9])|10|11|12)</span><br><span class="line"><span class="comment">## 13-14，日期</span></span><br><span class="line">(([0-2][1-9])|10|20|30|31) </span><br><span class="line"><span class="comment">## 15-17，顺序码</span></span><br><span class="line">\d&#123;3&#125;</span><br><span class="line"><span class="comment">## 校验码： </span></span><br><span class="line">[0-9Xx]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 校验18位的身份证</span></span><br><span class="line">^([1-6][1-9]|50)\d&#123;4&#125;(18|19|20)\d&#123;2&#125;((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]$</span><br></pre></td></tr></table></figure><h3 id="email校验"><a href="#email校验" class="headerlink" title="email校验"></a>email校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;</span><br></pre></td></tr></table></figure><h3 id="ip校验"><a href="#ip校验" class="headerlink" title="ip校验"></a>ip校验</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1-255).(0-255).(0-255).(0-255)</span><br></pre></td></tr></table></figure><h3 id="python使用正则"><a href="#python使用正则" class="headerlink" title="python使用正则"></a>python使用正则</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">idlist=[<span class="string">&#x27;440107199808180637&#x27;</span>,<span class="string">&#x27;100107199808180637&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pat=<span class="string">r&#x27;^([1-6][1-9]|50)\d&#123;4&#125;(18|19|20)\d&#123;2&#125;((0[1-9])|10|11|12)(([0-2][1-9])|10|20|30|31)\d&#123;3&#125;[0-9Xx]$&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> idlist:</span><br><span class="line">    <span class="keyword">if</span> re.search(pat,<span class="built_in">id</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;NO&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;正则表达式&quot;&gt;&lt;a href=&quot;#正则表达式&quot; class=&quot;headerlink&quot; title=&quot;正则表达式&quot;&gt;&lt;/a&gt;正则表达式&lt;/h2&gt;&lt;h3 id=&quot;身份证校验&quot;&gt;&lt;a href=&quot;#身份证校验&quot; class=&quot;headerlink&quot; title=&quot;身份证</summary>
      
    
    
    
    <category term="基础概念" scheme="https://biglovewheat.gihub.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    
    
    <category term="正则表达式" scheme="https://biglovewheat.gihub.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Redis-编译安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/23/redis-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/23/redis-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-22T16:00:00.000Z</published>
    <updated>2022-09-22T14:08:07.792Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Redis-编译安装"><a href="#Redis-编译安装" class="headerlink" title="Redis-编译安装"></a>Redis-编译安装</h2><h3 id="升级gcc版本"><a href="#升级gcc版本" class="headerlink" title="升级gcc版本"></a>升级gcc版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install centos-release-scl</span><br><span class="line">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-9 bash</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source /opt/rh/devtoolset-9/enable&quot;</span> &gt;&gt; /etc/profile</span><br><span class="line">gcc -v</span><br></pre></td></tr></table></figure><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br><span class="line">redis-cli --pass <span class="string">&#x27;123456&#x27;</span> shutdown</span><br></pre></td></tr></table></figure><h3 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin redis</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 1024 &gt;/proc/sys/net/core/somaxconn</span><br><span class="line">sysctl vm.overcommit_memory=1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/enabled; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f /sys/kernel/mm/transparent_hugepage/defrag; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改--session生效</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改--重启永久生效</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br></pre></td></tr></table></figure><h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 放开其他服务器登录</span></span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"><span class="comment">## 端口</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="comment">## 后台运行</span></span><br><span class="line">daemonize <span class="built_in">yes</span></span><br><span class="line"><span class="comment">## 后台运行后pidfile</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"><span class="comment">## 日志文件路径</span></span><br><span class="line">logfile <span class="string">&quot;/usr/local/redis/log/redis-6379.log&quot;</span></span><br><span class="line"><span class="comment">## 数据文件路径</span></span><br><span class="line"><span class="built_in">dir</span> /usr/local/redis/data-6379/</span><br><span class="line"><span class="comment">## 复制相关</span></span><br><span class="line">replicaof 192.168.8.199 6379</span><br><span class="line">masterauth <span class="string">&#x27;123456&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="复制相关"><a href="#复制相关" class="headerlink" title="复制相关"></a>复制相关</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看复制</span></span><br><span class="line">info replication</span><br><span class="line"></span><br><span class="line"><span class="comment">## slave 变 master</span></span><br><span class="line">slaveof no one</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Redis-编译安装&quot;&gt;&lt;a href=&quot;#Redis-编译安装&quot; class=&quot;headerlink&quot; title=&quot;Redis-编译安装&quot;&gt;&lt;/a&gt;Redis-编译安装&lt;/h2&gt;&lt;h3 id=&quot;升级gcc版本&quot;&gt;&lt;a href=&quot;#升级gcc版本&quot; class</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/tags/middleware/"/>
    
    <category term="redis" scheme="https://biglovewheat.gihub.io/tags/redis/"/>
    
  </entry>
  
</feed>
