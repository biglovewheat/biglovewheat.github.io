<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-08-08T06:59:56.000Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HTTPS握手流程</title>
    <link href="https://biglovewheat.gihub.io/2022/08/08/%E6%B5%8B%E8%AF%95/"/>
    <id>https://biglovewheat.gihub.io/2022/08/08/%E6%B5%8B%E8%AF%95/</id>
    <published>2022-08-08T07:02:42.962Z</published>
    <updated>2022-08-08T06:59:56.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HTTPS握手流程"><a href="#HTTPS握手流程" class="headerlink" title="HTTPS握手流程"></a>HTTPS握手流程</h2><p>1、客户端向服务器端发起https通信请求</p><p>2、服务器端响应并发送公钥</p><p>3、客户端验证公钥</p><p>4、客户端生成通信秘钥（随机数）</p><p>5、客户端用公钥加密通信秘钥并发送到服务器端</p><p>6、服务器端用私钥解密获取通信秘钥</p><p>7、服务器端和客户端利用通信秘钥对数据进行加密通讯</p><p><img src="/../images/1.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HTTPS握手流程&quot;&gt;&lt;a href=&quot;#HTTPS握手流程&quot; class=&quot;headerlink&quot; title=&quot;HTTPS握手流程&quot;&gt;&lt;/a&gt;HTTPS握手流程&lt;/h2&gt;&lt;p&gt;1、客户端向服务器端发起https通信请求&lt;/p&gt;
&lt;p&gt;2、服务器端响应并发送公钥</summary>
      
    
    
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="http" scheme="https://biglovewheat.gihub.io/tags/http/"/>
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/tags/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Postgresql导入导出</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/postgresql%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/postgresql%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</id>
    <published>2022-08-05T02:53:09.762Z</published>
    <updated>2022-08-05T02:50:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx编译安装"><a href="#Nginx编译安装" class="headerlink" title="Nginx编译安装"></a>Nginx编译安装</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p><em>centos 7</em></p><p><em>nginx 1.2x</em></p><h3 id="备份脚本"><a href="#备份脚本" class="headerlink" title="备份脚本"></a>备份脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /pgdata_backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#pg_dumpall -p 5083 &gt; all.sql</span></span><br><span class="line">pg_dumpall --exclude-database=common -p 5083 -c --if-exists |gzip &gt; part1-all-exclude-common.sql.gz</span><br><span class="line">pg_dump --dbname=common --exclude-schema=offline_map -p 5083 -c --if-exists|gzip &gt; part2-common-excluede-offline_map.sql.gz</span><br><span class="line"></span><br><span class="line">tar -cvf pgbackup_all_<span class="variable">$&#123;DATETIME&#125;</span>.tar part*.sql.gz --remove-files</span><br><span class="line"></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> pgbackup_all_<span class="variable">$&#123;DATETIME&#125;</span>.gz s3://aaa/backup/</span><br><span class="line"></span><br><span class="line">find /pgdata_backup -mtime +30 -<span class="built_in">type</span> f -name <span class="string">&quot;*.gz&quot;</span> | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pg_dumpall -p 5083 -c --if-exists |gzip &gt; all.sql.gz</span><br><span class="line">pg_dump --dbname=testdb -p 5083 -c --if-exists|gzip &gt; testdb.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 只导结构</span></span><br><span class="line">pg_dump --dbname=testdb -p 5083 -c --if-exists -s | &gt; testdb.sql.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 整库</span></span><br><span class="line">psql -f alldb.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 单个数据库</span></span><br><span class="line">create database testdb;</span><br><span class="line">psql -f testdb.sql -d testdb </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx编译安装&quot;&gt;&lt;a href=&quot;#Nginx编译安装&quot; class=&quot;headerlink&quot; title=&quot;Nginx编译安装&quot;&gt;&lt;/a&gt;Nginx编译安装&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="PG" scheme="https://biglovewheat.gihub.io/tags/PG/"/>
    
  </entry>
  
  <entry>
    <title>Nginx安装配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/nginx%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/nginx%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-05T02:53:09.390Z</published>
    <updated>2022-08-05T02:52:04.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx安装配置"><a href="#Nginx安装配置" class="headerlink" title="Nginx安装配置"></a>Nginx安装配置</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p><em>centos 7</em></p><p><em>nginx 1.2x</em></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ make automake autoconf pcre \</span><br><span class="line">pcre-devel zlib zlib-devel openssl openssl-devel libtool</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-pcre --with-stream</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">user root;</span><br><span class="line">worker_processes auto;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">use epoll;</span><br><span class="line">worker_connections 65535;</span><br><span class="line"><span class="comment">#worker工作方式：串行</span></span><br><span class="line">multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#stream &#123;</span></span><br><span class="line"><span class="comment"># log_format proxy &#x27;$remote_addr [$time_local] &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;$protocol $status $bytes_sent $bytes_received &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;$session_time &quot;$upstream_addr&quot; &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#x27;;</span></span><br><span class="line"><span class="comment"># access_log /var/log/nginx/tcp-access.log proxy ;</span></span><br><span class="line"><span class="comment"># open_log_file_cache off;</span></span><br><span class="line"><span class="comment"># include /etc/nginx/conf.d/*.stream;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">include mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">sendfile on;</span><br><span class="line">tcp_nopush on;</span><br><span class="line"></span><br><span class="line"><span class="comment">## upload</span></span><br><span class="line">client_max_body_size 2g;</span><br><span class="line"></span><br><span class="line"><span class="comment">#keepalive_timeout 0;</span></span><br><span class="line">keepalive_timeout 65;</span><br><span class="line"></span><br><span class="line"><span class="comment">#### gzip module begin ###</span></span><br><span class="line"><span class="comment">#gzip on;</span></span><br><span class="line"><span class="comment">#gzip_comp_level 4;</span></span><br><span class="line"><span class="comment">#gzip_buffers 4 16k;</span></span><br><span class="line"><span class="comment">#gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span></span><br><span class="line"><span class="comment">#gzip_min_length 5k;</span></span><br><span class="line"><span class="comment">#gzip_vary on;</span></span><br><span class="line"><span class="comment">#gzip_proxied any</span></span><br><span class="line"><span class="comment">#### gzip module end ###</span></span><br><span class="line"></span><br><span class="line">include /usr/local/nginx/conf/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">root html;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="stream模块"><a href="#stream模块" class="headerlink" title="stream模块"></a>stream模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nginx从1.9.0开始，新增加了一个stream模块，用来实现四层协议的转发、代理或者负载均衡等</span></span><br><span class="line"><span class="comment">## stream模块的用法和http模块差不多，语法基本一致，支持server，hash， listen， proxy_pass等指令</span></span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream cloudsocket &#123;</span><br><span class="line">       <span class="built_in">hash</span> <span class="variable">$remote_addr</span> consistent;</span><br><span class="line">      <span class="comment"># $binary_remote_addr;</span></span><br><span class="line">       server 172.19.20.7:3306 weight=5 max_fails=3 fail_timeout=300s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">       listen 3306;<span class="comment">#数据库服务器监听端口</span></span><br><span class="line">       server_name mysql1.tools.hrtop.net;</span><br><span class="line">       proxy_connect_timeout 120s;</span><br><span class="line">       proxy_send_timeout 120;</span><br><span class="line">       proxy_read_timeout 120;</span><br><span class="line">       proxy_buffer_size 256k;</span><br><span class="line">       proxy_buffers 8 128k;</span><br><span class="line">       proxy_pass cloudsocket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ssl配置"><a href="#ssl配置" class="headerlink" title="ssl配置"></a>ssl配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  sit.biglovewheat.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      certs/ssl.crt;</span><br><span class="line">        ssl_certificate_key  certs/ssl.key;</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /nfsdata/dist;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">upstream websocket&#123;</span><br><span class="line">server hx-app-01:8100 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 8100;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">client_max_body_size 100M;</span><br><span class="line">proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">proxy_set_header Upgrade <span class="variable">$http_upgrade</span>; <span class="comment">#支持wss</span></span><br><span class="line">proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>; <span class="comment">#支持wss</span></span><br><span class="line">proxy_pass http://websocket;</span><br><span class="line">&#125;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重定向问题"><a href="#重定向问题" class="headerlink" title="重定向问题"></a>重定向问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## https://blog.csdn.net/weixin_34186128/article/details/91742483</span></span><br><span class="line"><span class="keyword">if</span> (-d <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">rewrite [^/]$ <span class="variable">$scheme</span>://$http_host<span class="variable">$uri</span>/ permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span> always;</span><br><span class="line">    root /opt/nginx/dist-saas-operation-new;</span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx安装配置&quot;&gt;&lt;a href=&quot;#Nginx安装配置&quot; class=&quot;headerlink&quot; title=&quot;Nginx安装配置&quot;&gt;&lt;/a&gt;Nginx安装配置&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="nginx" scheme="https://biglovewheat.gihub.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginx-too-many-open-files</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/nginx-too-many-open-files/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/nginx-too-many-open-files/</id>
    <published>2022-08-05T02:53:08.855Z</published>
    <updated>2022-08-05T02:07:23.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-too-many-open-files"><a href="#Nginx-too-many-open-files" class="headerlink" title="Nginx-too-many-open-files"></a>Nginx-too-many-open-files</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p><em>Too many open files</em></p><h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改-session生效</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改-永久生效-需重启</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改配置文件</span></span><br><span class="line">events &#123;</span><br><span class="line">worker_connections 4096;</span><br><span class="line">use epoll;</span><br><span class="line">multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改service参数</span></span><br><span class="line">systemctl status nginx</span><br><span class="line">vi /usr/lib/systemd/system/nginx.service</span><br><span class="line">[Service]增加</span><br><span class="line">LimitNOFILE=65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启nginx</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查</span></span><br><span class="line">ps -ef |grep nginx</span><br><span class="line"><span class="built_in">cat</span> /proc/31668/limits</span><br><span class="line">Max open files 65535 65535 files</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx-too-many-open-files&quot;&gt;&lt;a href=&quot;#Nginx-too-many-open-files&quot; class=&quot;headerlink&quot; title=&quot;Nginx-too-many-open-files&quot;&gt;&lt;/a&gt;Nginx-too-m</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="nginx" scheme="https://biglovewheat.gihub.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>HTTPS握手流程</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/https%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/https%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/</id>
    <published>2022-08-05T02:53:08.457Z</published>
    <updated>2022-08-05T02:11:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HTTPS握手流程"><a href="#HTTPS握手流程" class="headerlink" title="HTTPS握手流程"></a>HTTPS握手流程</h2><p>1、客户端向服务器端发起https通信请求</p><p>2、服务器端响应并发送公钥</p><p>3、客户端验证公钥</p><p>4、客户端生成通信秘钥（随机数）</p><p>5、客户端用公钥加密通信秘钥并发送到服务器端</p><p>6、服务器端用私钥解密获取通信秘钥</p><p>7、服务器端和客户端利用通信秘钥对数据进行加密通讯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HTTPS握手流程&quot;&gt;&lt;a href=&quot;#HTTPS握手流程&quot; class=&quot;headerlink&quot; title=&quot;HTTPS握手流程&quot;&gt;&lt;/a&gt;HTTPS握手流程&lt;/h2&gt;&lt;p&gt;1、客户端向服务器端发起https通信请求&lt;/p&gt;
&lt;p&gt;2、服务器端响应并发送公钥</summary>
      
    
    
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="http" scheme="https://biglovewheat.gihub.io/tags/http/"/>
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/tags/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Linux-swap扩容</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/</id>
    <published>2022-08-04T03:25:27.206Z</published>
    <updated>2022-08-04T03:24:18.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-swap扩容"><a href="#Linux-swap扩容" class="headerlink" title="Linux-swap扩容"></a>Linux-swap扩容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=4096000</span><br><span class="line"><span class="comment">#8G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=8192000</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分区类型为swap</span></span><br><span class="line">/sbin/mkswap /swapfile01</span><br><span class="line"><span class="built_in">chmod</span> 0600 /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#激活swap分区</span></span><br><span class="line">/sbin/swapon /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置自动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/swapfile01 swap swap defaults 0 0</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-swap扩容&quot;&gt;&lt;a href=&quot;#Linux-swap扩容&quot; class=&quot;headerlink&quot; title=&quot;Linux-swap扩容&quot;&gt;&lt;/a&gt;Linux-swap扩容&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-Centos7-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-04T03:25:26.799Z</published>
    <updated>2022-08-04T03:24:20.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kubernetes-Centos7-安装"><a href="#Kubernetes-Centos7-安装" class="headerlink" title="Kubernetes-Centos7-安装"></a>Kubernetes-Centos7-安装</h2><h2 id="关闭swap-x2F-selinux-x2F-firewalld"><a href="#关闭swap-x2F-selinux-x2F-firewalld" class="headerlink" title="关闭swap&#x2F;selinux&#x2F;firewalld"></a>关闭swap&#x2F;selinux&#x2F;firewalld</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭swap</span></span><br><span class="line">swapoff -a</span><br><span class="line">vi /etc/fstab</span><br><span class="line">注释掉swap的一行</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭selinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum install -y bash-completion</span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum install -y docker-ce-20.10.8</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h2 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://nn5bgten.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="修改docker-cgroup驱动为systemd"><a href="#修改docker-cgroup驱动为systemd" class="headerlink" title="修改docker cgroup驱动为systemd"></a>修改docker cgroup驱动为systemd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s|ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock|ExecStart=/usr/bin/dockerd --exec-opt native.cgroupdriver=systemd|g&quot;</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker info | grep -i cgroup</span><br></pre></td></tr></table></figure><h2 id="添加k8s仓库"><a href="#添加k8s仓库" class="headerlink" title="添加k8s仓库"></a>添加k8s仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="安装kubeadm"><a href="#安装kubeadm" class="headerlink" title="安装kubeadm"></a>安装kubeadm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum list kubeadm --showduplicates</span><br><span class="line">yum install -y kubeadm-1.20.9 kubectl-1.20.9 kubelet-1.20.9</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure><h2 id="修改网络参数（centos7）"><a href="#修改网络参数（centos7）" class="headerlink" title="修改网络参数（centos7）"></a>修改网络参数（centos7）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><h2 id="kubeadm初始化"><a href="#kubeadm初始化" class="headerlink" title="kubeadm初始化"></a>kubeadm初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=127.0.0.1 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.20.9 --pod-network-cidr=10.133.0.0/16 \</span><br><span class="line">--image-repository=registry.aliyuncs.com/google_containers</span><br><span class="line"></span><br><span class="line"><span class="comment">## kubeadm 初始化清理（如果失败，可以reset进行清理）</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><h2 id="安装calico（指定版本）"><a href="#安装calico（指定版本）" class="headerlink" title="安装calico（指定版本）"></a>安装calico（指定版本）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.19/manifests/calico.yaml</span><br></pre></td></tr></table></figure><h2 id="节点加入"><a href="#节点加入" class="headerlink" title="节点加入"></a>节点加入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##节点执行到安装完kubeadm</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token 74kuf2.6f1pv9lbrkxw5n0k \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47</span><br><span class="line"></span><br><span class="line"><span class="comment">## master节点加入</span></span><br><span class="line"><span class="comment"># 主节点运行获取证书</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token lb45cr.d5s17hnbgsj6sf5b   \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47 \</span><br><span class="line">--control-plane   --certificate-key f3657ba47289c8994771aaf2ebd2a90ee335f0fff41b9c1470ad15d21e185094</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误：</span></span><br><span class="line"><span class="comment"># unable to add a new control plane instance a cluster that doesn&#x27;t have a stable controlPlaneEndpoint address</span></span><br><span class="line"><span class="comment"># 解决办法：加上controlPlaneEndpoint</span></span><br><span class="line">kubectl edit configmap -n kube-system   kubeadm-config</span><br><span class="line">    clusterName: kubernetes</span><br><span class="line">    controlPlaneEndpoint: 192.168.8.112:6443</span><br></pre></td></tr></table></figure><h2 id="kubectl自动补全"><a href="#kubectl自动补全" class="headerlink" title="kubectl自动补全"></a>kubectl自动补全</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; /etc/profile; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="kubeadm安装后scheduler状态为unhealthy"><a href="#kubeadm安装后scheduler状态为unhealthy" class="headerlink" title="kubeadm安装后scheduler状态为unhealthy"></a>kubeadm安装后scheduler状态为unhealthy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cs</span><br><span class="line"><span class="comment">#备份修改两个文件</span></span><br><span class="line">vi /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class="line">vi /etc/kubernetes/manifests/kube-scheduler.yaml</span><br><span class="line"></span><br><span class="line">去掉 --port=0</span><br><span class="line"><span class="comment">## 重启kubelet</span></span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;a href=&quot;#Kubernetes-Centos7-安装&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;/a&gt;Kubernetes-Centos7-安装&lt;/</summary>
      
    
    
    
    <category term="K8S" scheme="https://biglovewheat.gihub.io/categories/K8S/"/>
    
    
    <category term="K8S" scheme="https://biglovewheat.gihub.io/tags/K8S/"/>
    
  </entry>
  
  <entry>
    <title>iftop流量监控</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/iftop%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/iftop%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/</id>
    <published>2022-08-04T03:25:26.332Z</published>
    <updated>2022-08-04T03:24:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="iftop流量监控"><a href="#iftop流量监控" class="headerlink" title="iftop流量监控"></a>iftop流量监控</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y iftop</span><br><span class="line"></span><br><span class="line"><span class="comment">## 参数</span></span><br><span class="line">-i 指定网卡</span><br><span class="line">-n 直接显示IP</span><br><span class="line">-N 直接显示端口号</span><br><span class="line">-P 同时显示IP和端口号</span><br><span class="line"></span><br><span class="line">iftop -i eth0  -PNn</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;iftop流量监控&quot;&gt;&lt;a href=&quot;#iftop流量监控&quot; class=&quot;headerlink&quot; title=&quot;iftop流量监控&quot;&gt;&lt;/a&gt;iftop流量监控&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>Python-Jira-自动受理工单</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/python-jira-%E8%87%AA%E5%8A%A8%E5%8F%97%E7%90%86%E5%B7%A5%E5%8D%95/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/python-jira-%E8%87%AA%E5%8A%A8%E5%8F%97%E7%90%86%E5%B7%A5%E5%8D%95/</id>
    <published>2022-08-03T07:55:02.728Z</published>
    <updated>2022-08-03T07:51:34.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python-Jira-自动受理工单"><a href="#Python-Jira-自动受理工单" class="headerlink" title="Python-Jira-自动受理工单"></a>Python-Jira-自动受理工单</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding( <span class="string">&quot;utf-8&quot;</span> )</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> bs4</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> commands <span class="keyword">as</span> cmd</span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&#x27;http://10.8.17.24:8080&#x27;</span></span><br><span class="line"></span><br><span class="line">log = <span class="built_in">open</span>(<span class="string">&#x27;/home/piccism/sapchk/jira_zdsl_gdzc.log&#x27;</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">now_time = datetime.datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> &gt;&gt;log,now_time</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;os_username&#x27;</span>:<span class="string">&#x27;yangwenwei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os_password&#x27;</span>:<span class="string">&#x27;1111&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;os_cookie&#x27;</span>:<span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">login_url = base_url+<span class="string">&#x27;/rest/gadget/1.0/login&#x27;</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">resp = session.post(login_url, data)</span><br><span class="line"></span><br><span class="line">query_url = base_url+<span class="string">&#x27;/secure/IssueNavigator!executeAdvanced.jspa&#x27;</span></span><br><span class="line">query_str = <span class="string">&quot;project = GDZC AND (assignee = aaa or assignee = bbb ) AND status=open&quot;</span></span><br><span class="line">query_data = &#123;<span class="string">&#x27;jqlQuery&#x27;</span>:query_str,</span><br><span class="line">              <span class="string">&#x27;runQuery&#x27;</span>:<span class="string">&#x27;true&#x27;</span>&#125;</span><br><span class="line">resp_query = session.post(query_url, query_data)</span><br><span class="line"></span><br><span class="line">htmlpage = resp_query.content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">soup = BeautifulSoup(htmlpage,<span class="string">&#x27;lxml&#x27;</span>)  </span><br><span class="line"></span><br><span class="line">trs = soup.find_all(<span class="string">&#x27;tr&#x27;</span>,&#123;<span class="string">&quot;rel&quot;</span>:<span class="literal">True</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> tr <span class="keyword">in</span> trs:</span><br><span class="line">    rel = tr[<span class="string">&#x27;rel&#x27;</span>]        </span><br><span class="line">    tds = tr.find_all(<span class="string">&#x27;td&#x27;</span>)</span><br><span class="line">    issuekey = tds[<span class="number">1</span>].find(<span class="string">&#x27;a&#x27;</span>).string</span><br><span class="line">    assignee = tds[<span class="number">3</span>].find(<span class="string">&#x27;a&#x27;</span>).string</span><br><span class="line">    status = tds[<span class="number">5</span>].contents[<span class="number">2</span>].strip()</span><br><span class="line">    logstr = <span class="string">&#x27;new job &#x27;</span> +rel+<span class="string">&#x27; &#x27;</span>+issuekey+<span class="string">&#x27; &#x27;</span>+assignee+<span class="string">&#x27; &#x27;</span>+status</span><br><span class="line">    <span class="built_in">print</span> &gt;&gt;log,logstr</span><br><span class="line">    <span class="keyword">if</span> assignee != <span class="string">&#x27;zvb&#x27;</span>:</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/AssignIssue.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;assignee=yangwenwei&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/WorkflowUIDispatcher.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;action=4&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      get_url = base_url+<span class="string">&#x27;/secure/WorkflowUIDispatcher.jspa?id=&#x27;</span>+rel+<span class="string">&#x27;&amp;action=4&#x27;</span></span><br><span class="line">      session.get(get_url)</span><br><span class="line"></span><br><span class="line">log.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Python-Jira-自动受理工单&quot;&gt;&lt;a href=&quot;#Python-Jira-自动受理工单&quot; class=&quot;headerlink&quot; title=&quot;Python-Jira-自动受理工单&quot;&gt;&lt;/a&gt;Python-Jira-自动受理工单&lt;/h2&gt;&lt;figure c</summary>
      
    
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/categories/python/"/>
    
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-异库同步</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/</id>
    <published>2022-08-03T07:55:02.327Z</published>
    <updated>2022-08-03T07:51:30.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-异库同步"><a href="#Gitlab-异库同步" class="headerlink" title="Gitlab-异库同步"></a>Gitlab-异库同步</h2><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── gitlab_sync_ignore.lst      <span class="comment"># 不同步的库</span></span><br><span class="line">├── gitlab_sync_lib.py          <span class="comment"># 计算本次需同步的库，分全量和增量</span></span><br><span class="line">├── gitlab_sync.sh              <span class="comment"># 同步脚本</span></span><br><span class="line">├── gitlab_sync_old.lst</span><br><span class="line">├── gitlab_sync_to_full.lst     <span class="comment"># 全同步列表，脚本生成</span></span><br><span class="line">├── gitlab_sync_to_inc.lst      <span class="comment"># 增量同步列表，脚本生成</span></span><br></pre></td></tr></table></figure><h3 id="gitlab-sync-sh"><a href="#gitlab-sync-sh" class="headerlink" title="gitlab_sync.sh"></a>gitlab_sync.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/home/gitlab_sync</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">git_url1=<span class="string">&quot;192.168.8.1:8090&quot;</span></span><br><span class="line">git_user1=jenkins</span><br><span class="line">git_key1=xxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_url2=<span class="string">&quot;10.249.2.40:8690&quot;</span></span><br><span class="line">git_user2=abc</span><br><span class="line">git_key2=xxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_group2=<span class="string">&#x27;aa/bb/10/operations&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_full</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_inc</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst</span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst</span><br><span class="line"></span><br><span class="line"><span class="variable">$ROOT_PATH</span>/gitlab_sync_lib.py <span class="variable">$git_url1</span> <span class="variable">$git_key1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start full sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> --bare http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git push --mirror http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span> &gt;&gt; <span class="variable">$ROOT_PATH</span>/gitlab_sync_old.lst</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start inc sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br><span class="line">  git fetch --all</span><br><span class="line">  git branch -r  |grep -v HEAD |awk -F<span class="string">&quot;origin/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> repo; <span class="keyword">do</span> git checkout <span class="variable">$repo</span>;git pull --rebase; <span class="keyword">done</span></span><br><span class="line">  git pull --all --rebase</span><br><span class="line">  git push --all http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="gitlab-sync-lib-py"><a href="#gitlab-sync-lib-py" class="headerlink" title="gitlab_sync_lib.py"></a>gitlab_sync_lib.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> gitlab</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">repo_url = <span class="string">&quot;http://&quot;</span> + sys.argv[<span class="number">1</span>]</span><br><span class="line">token = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(columns=[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">g1 = gitlab.Gitlab(repo_url, private_token=token)</span><br><span class="line">projects = g1.projects.<span class="built_in">list</span>(<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> project <span class="keyword">in</span> projects:</span><br><span class="line">     df1 = df1.append(&#123;<span class="string">&#x27;url&#x27;</span>:project.http_url_to_repo&#125;, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>):</span><br><span class="line">  df2 = pd.read_csv(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df2.rename(columns=&#123;df2.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df1-df2</span></span><br><span class="line">  df3 = pd.concat([df1, df2, df2]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df3 = df1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>):</span><br><span class="line">  df4 = pd.read_csv(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df4.rename(columns=&#123;df4.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df5=df3-df4,df4=df3-df5</span></span><br><span class="line">  df5 = pd.concat([df3, df4, df4]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4 = pd.concat([df3, df5, df5]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4.to_csv(<span class="string">&quot;gitlab_sync_to_inc.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df5 = df3</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-异库同步&quot;&gt;&lt;a href=&quot;#Gitlab-异库同步&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-异库同步&quot;&gt;&lt;/a&gt;Gitlab-异库同步&lt;/h2&gt;&lt;h3 id=&quot;结构&quot;&gt;&lt;a href=&quot;#结构&quot; class=&quot;head</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-批量操作</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/gitlab-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/gitlab-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C/</id>
    <published>2022-08-03T07:55:01.872Z</published>
    <updated>2022-08-03T07:51:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-批量操作"><a href="#Gitlab-批量操作" class="headerlink" title="Gitlab-批量操作"></a>Gitlab-批量操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/python3/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> gitlab</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">repo_url = <span class="string">&quot;http://192.168.8.1:8090&quot;</span></span><br><span class="line">token = <span class="string">&quot;xxxxxxxxxxx&quot;</span></span><br><span class="line"></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;PRIVATE-TOKEN&quot;</span> : token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session=requests.Session()</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(columns=[<span class="string">&#x27;pid&#x27;</span>,<span class="string">&#x27;url&#x27;</span>,<span class="string">&#x27;uid&#x27;</span>,<span class="string">&#x27;uname&#x27;</span>,<span class="string">&#x27;role&#x27;</span>])</span><br><span class="line"></span><br><span class="line">gl = gitlab.Gitlab(repo_url, private_token=token)</span><br><span class="line">projects = gl.projects.<span class="built_in">list</span>(<span class="built_in">all</span>=<span class="literal">True</span>)    <span class="comment">## 获取所有project</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> projects:</span><br><span class="line"><span class="comment">#    print(p.id)</span></span><br><span class="line"><span class="comment">#    if p.id==370:</span></span><br><span class="line">        url=repo_url+<span class="string">&quot;/api/v4/projects/&quot;</span>+<span class="built_in">str</span>(p.<span class="built_in">id</span>)+<span class="string">&quot;/members&quot;</span>    <span class="comment">## 获取project下所有member</span></span><br><span class="line">        resp=session.get(url,headers=headers)</span><br><span class="line">        j_member=json.loads(resp.text)</span><br><span class="line">        df_member=pd.json_normalize(j_member)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(df_member)):</span><br><span class="line">           df1 = df1.append(&#123;<span class="string">&#x27;pid&#x27;</span>:p.<span class="built_in">id</span>,<span class="string">&#x27;url&#x27;</span>:p.http_url_to_repo,<span class="string">&#x27;uid&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;id&#x27;</span>],<span class="string">&#x27;uname&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;username&#x27;</span>],<span class="string">&#x27;role&#x27;</span>:df_member.iloc[i][<span class="string">&#x27;access_level&#x27;</span>]&#125;, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (df1)</span><br><span class="line">df1.to_csv(<span class="string">&#x27;project_member.csv&#x27;</span>,index = <span class="literal">False</span>)    <span class="comment">## 导出csv</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#for i in range(len(df1)):</span></span><br><span class="line"><span class="comment">#    if df1.iloc[i][&#x27;uname&#x27;]==&quot;maiqixian&quot;:</span></span><br><span class="line"><span class="comment">#        url=repo_url+&quot;/api/v4/projects/&quot;+str(df1.iloc[i][&#x27;pid&#x27;])+&quot;/members/&quot;+str(df1.iloc[i][&#x27;uid&#x27;])    ## 按条件更新member的access_level</span></span><br><span class="line"><span class="comment">#        print(url)</span></span><br><span class="line"><span class="comment">#        data=&#123;&quot;access_level&quot;:30&#125;</span></span><br><span class="line"><span class="comment">#        resp=session.put(url,headers=headers,data=data)</span></span><br><span class="line"><span class="comment">#        print(resp)</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-批量操作&quot;&gt;&lt;a href=&quot;#Gitlab-批量操作&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-批量操作&quot;&gt;&lt;/a&gt;Gitlab-批量操作&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;tab</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Geoserver安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/03/geoserver%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/03/geoserver%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-03T07:55:01.468Z</published>
    <updated>2022-08-03T07:51:27.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Geoserver安装"><a href="#Geoserver安装" class="headerlink" title="Geoserver安装"></a>Geoserver安装</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">jdk-1.8</span><br><span class="line">geoserver-2.14</span><br><span class="line">tomcat-9</span><br><span class="line">postgresql-13.2</span><br><span class="line">postgis-3.1.1</span><br><span class="line">pgrouting-3.3.0</span><br></pre></td></tr></table></figure><h3 id="安装postgresql"><a href="#安装postgresql" class="headerlink" title="安装postgresql"></a>安装postgresql</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装仓库</span></span><br><span class="line">yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装postgresql</span></span><br><span class="line">yum install -y postgresql13-server</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line">/usr/pgsql-13/bin/postgresql-13-setup initdb</span><br><span class="line"></span><br><span class="line"><span class="comment">## 放开访问，其中 trust--信任，不用输密码; md5--密码认证</span></span><br><span class="line">sed -i <span class="string">&#x27;s|host    all             all             127.0.0.1/32            scram-sha-256|host  all  all  0.0.0.0/0  md5|g&#x27;</span>  /var/lib/pgsql/13/data/pg_hba.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改监听网段</span></span><br><span class="line">sed -i <span class="string">&quot;s|#listen_addresses = &#x27;localhost&#x27;|listen_addresses = &#x27;*&#x27;|g&quot;</span>  /var/lib/pgsql/13/data/postgresql.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改监听端口</span></span><br><span class="line">sed -i <span class="string">&quot;s|#port = 5432|port = 5083|g&quot;</span>  /var/lib/pgsql/13/data/postgresql.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启数据库</span></span><br><span class="line">systemctl <span class="built_in">enable</span> postgresql-13</span><br><span class="line">systemctl restart postgresql-13</span><br></pre></td></tr></table></figure><h3 id="安装postgis和pgrouting"><a href="#安装postgis和pgrouting" class="headerlink" title="安装postgis和pgrouting"></a>安装postgis和pgrouting</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y postgis32_13.x86_64</span><br><span class="line">yum install -y postgis32_13-utils</span><br><span class="line">yum install -y postgis32_13-client</span><br><span class="line">yum install -y pgrouting_13.x86_64</span><br></pre></td></tr></table></figure><h3 id="数据库设置"><a href="#数据库设置" class="headerlink" title="数据库设置"></a>数据库设置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> extension postgis;</span><br><span class="line"><span class="keyword">create</span> extension postgis_topology;</span><br><span class="line"><span class="keyword">create</span> extension fuzzystrmatch;</span><br><span class="line"><span class="keyword">create</span> extension address_standardizer;</span><br><span class="line"><span class="keyword">create</span> extension address_standardizer_data_us;</span><br><span class="line"><span class="keyword">create</span> extension postgis_tiger_geocoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> extension pgrouting;</span><br></pre></td></tr></table></figure><h3 id="安装tomcat和geoserver"><a href="#安装tomcat和geoserver" class="headerlink" title="安装tomcat和geoserver"></a>安装tomcat和geoserver</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">## 下载tomcat9和gerserver.war包，把war包放到tomcat的webapps目录下</span></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/data/soft/jdk1.8.0_301</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">/data/geoserver/apache-tomcat-9.0.64/bin/startup.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Geoserver安装&quot;&gt;&lt;a href=&quot;#Geoserver安装&quot; class=&quot;headerlink&quot; title=&quot;Geoserver安装&quot;&gt;&lt;/a&gt;Geoserver安装&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;head</summary>
      
    
    
    
    <category term="GIS" scheme="https://biglovewheat.gihub.io/categories/GIS/"/>
    
    
    <category term="GIS" scheme="https://biglovewheat.gihub.io/tags/GIS/"/>
    
    <category term="Postgresql" scheme="https://biglovewheat.gihub.io/tags/Postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Shell-获取Mysql查询返回值</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/shell-%E8%8E%B7%E5%8F%96mysql%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E5%80%BC/</id>
    <published>2022-08-02T06:07:37.355Z</published>
    <updated>2022-08-02T01:20:00.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell-获取Mysql查询返回值"><a href="#Shell-获取Mysql查询返回值" class="headerlink" title="Shell-获取Mysql查询返回值"></a>Shell-获取Mysql查询返回值</h2><h3 id="获取单个值"><a href="#获取单个值" class="headerlink" title="获取单个值"></a>获取单个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> MYSQL_PWD=123abc!!!</span><br><span class="line">aa=$(mysql -h192.168.8.240 -uroot -Ddatacut -e <span class="string">&quot;select apppath from sys_d_code&quot;</span> --skip-column-names)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$aa</span></span><br><span class="line"></span><br><span class="line">user=root</span><br><span class="line">pass=yfgzSap123</span><br><span class="line">port=9901</span><br><span class="line">db=datacut</span><br><span class="line">table=sys_d_code</span><br><span class="line"><span class="built_in">set</span> `mysql -u<span class="variable">$user</span> -p<span class="variable">$pass</span> -D<span class="variable">$db</span> -P <span class="variable">$port</span> -e <span class="string">&quot;select outpath from <span class="variable">$table</span>&quot;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$2</span></span><br></pre></td></tr></table></figure><h3 id="获取多个值"><a href="#获取多个值" class="headerlink" title="获取多个值"></a>获取多个值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pmysqlroot -Dmmmtest -e <span class="string">&quot;select &#x27;aa&#x27;,count(1) from aa&quot;</span> --skip-column-names|<span class="keyword">while</span> <span class="built_in">read</span> a b</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$a</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$b</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;a href=&quot;#Shell-获取Mysql查询返回值&quot; class=&quot;headerlink&quot; title=&quot;Shell-获取Mysql查询返回值&quot;&gt;&lt;/a&gt;Shell-获取Mysql查询返回值&lt;/h2&gt;&lt;h3 id=&quot;获</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql备份恢复</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D/</id>
    <published>2022-08-02T06:07:36.950Z</published>
    <updated>2022-08-02T01:19:52.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql备份恢复"><a href="#Mysql备份恢复" class="headerlink" title="Mysql备份恢复"></a>Mysql备份恢复</h2><h3 id="mysqldump备份恢复"><a href="#mysqldump备份恢复" class="headerlink" title="mysqldump备份恢复"></a>mysqldump备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/mysqldata_backup</span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"></span><br><span class="line">passwd=$(grep password /etc/my.cnf |awk  <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> |<span class="built_in">head</span> -1)</span><br><span class="line">mysqldump -uroot -p<span class="variable">$passwd</span> --all-databases --set-gtid-purged=OFF |gzip &gt;<span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 上传到aws s3</span></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$ROOT_PATH</span>/mysqlbackup_all_show_<span class="variable">$DATETIME</span>.sql.gz s3://aaa/backup/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 清理过期</span></span><br><span class="line">find <span class="variable">$ROOT_PATH</span> -mtime +1 -<span class="built_in">type</span> f -name <span class="string">&quot;*.sql.gz&quot;</span> | xargs <span class="built_in">rm</span> -vf</span><br><span class="line"></span><br><span class="line"><span class="comment">##恢复</span></span><br><span class="line"><span class="comment">#gunzip &lt; test.tar.gz |mysql -hlocalhost -uroot -pxxxxx</span></span><br></pre></td></tr></table></figure><h3 id="xtrabackup备份恢复"><a href="#xtrabackup备份恢复" class="headerlink" title="xtrabackup备份恢复"></a>xtrabackup备份恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##全量备份</span></span><br><span class="line">$ xtrabackup --backup --target-dir=/data/backups/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复1-修改root密码为备份数据库密码</span></span><br><span class="line">use mysql；</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED WITH mysql_native_password BY <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复2-新建目录，修改my.cnf指向目录，并修改目录权限mysql:mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复3-准备步骤</span></span><br><span class="line">$ xtrabackup --prepare --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复4-拷贝文件</span></span><br><span class="line">$ xtrabackup --copy-back --target-dir=/&lt;备份文件所在目录&gt;/</span><br><span class="line"></span><br><span class="line"><span class="comment">##异地恢复5-修改目录权限mysql:mysql</span></span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">##启动数据库</span></span><br><span class="line">systemctl start mysql</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql备份恢复&quot;&gt;&lt;a href=&quot;#Mysql备份恢复&quot; class=&quot;headerlink&quot; title=&quot;Mysql备份恢复&quot;&gt;&lt;/a&gt;Mysql备份恢复&lt;/h2&gt;&lt;h3 id=&quot;mysqldump备份恢复&quot;&gt;&lt;a href=&quot;#mysqldump备份恢</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-too-many-connections错误</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-too-many-connections%E9%94%99%E8%AF%AF/</id>
    <published>2022-08-02T06:07:36.549Z</published>
    <updated>2022-08-02T01:19:49.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-too-many-connections错误"><a href="#Mysql-too-many-connections错误" class="headerlink" title="Mysql-too-many-connections错误"></a>Mysql-too-many-connections错误</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## 查看最大连接数</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%max_connections%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> max_connections <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> processlist;  </span><br><span class="line"><span class="keyword">show</span> status <span class="keyword">like</span> <span class="string">&#x27;Threads%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 查看timeout</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%timeout&#x27;</span>;</span><br><span class="line"></span><br><span class="line">## 设置timeout</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> wait_timeout<span class="operator">=</span><span class="number">300</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> interactive_timeout<span class="operator">=</span><span class="number">500</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;a href=&quot;#Mysql-too-many-connections错误&quot; class=&quot;headerlink&quot; title=&quot;Mysql-too-many-connections错误&quot;&gt;&lt;/a&gt;My</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-RPM-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/mysql-rpm-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-02T06:07:36.144Z</published>
    <updated>2022-08-02T01:20:02.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-RPM-安装"><a href="#Mysql-RPM-安装" class="headerlink" title="Mysql-RPM-安装"></a>Mysql-RPM-安装</h2><h3 id="mysql5-7-centos7"><a href="#mysql5-7-centos7" class="headerlink" title="mysql5.7+centos7"></a>mysql5.7+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mysql-libs</span></span><br><span class="line">rpm -qa |grep mysql</span><br><span class="line">rpm -e mysql-libs-5.1.73-8.el6_8.x86_64 --nodeps</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-compat-5.7.24-1.el7.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-5.7.24-1.el6.x86_64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-5.7.24-1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mysql8-centos7"><a href="#mysql8-centos7" class="headerlink" title="mysql8+centos7"></a>mysql8+centos7</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 卸载mariadb</span></span><br><span class="line">rpm -e $(rpm -qa |grep maria) --nodeps</span><br><span class="line">yum install -y net-tools.x86_64 libaio.x86_64 perl.x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装rpm包</span></span><br><span class="line">rpm -ivh mysql-community-common-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-plugins-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-client-8*.rpm</span><br><span class="line">rpm -ivh mysql-community-server-8*.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动</span></span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment">## 初始化</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/mysqld.log |grep password</span><br><span class="line">mysql_secure_installation</span><br><span class="line"></span><br><span class="line">mysql&gt;use mysql</span><br><span class="line">mysql&gt;create user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123abc!!!&#x27;</span>;</span><br><span class="line">mysql&gt;GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">mysql&gt;flush privileges;</span><br><span class="line">mysql&gt;quit</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-RPM-安装&quot;&gt;&lt;a href=&quot;#Mysql-RPM-安装&quot; class=&quot;headerlink&quot; title=&quot;Mysql-RPM-安装&quot;&gt;&lt;/a&gt;Mysql-RPM-安装&lt;/h2&gt;&lt;h3 id=&quot;mysql5-7-centos7&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Linux设置最大文件打开数</title>
    <link href="https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/"/>
    <id>https://biglovewheat.gihub.io/2022/08/02/linux%E8%AE%BE%E7%BD%AE%E6%9C%80%E5%A4%A7%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0/</id>
    <published>2022-08-02T06:07:35.739Z</published>
    <updated>2022-08-02T01:36:05.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux设置最大文件打开数"><a href="#Linux设置最大文件打开数" class="headerlink" title="Linux设置最大文件打开数"></a>Linux设置最大文件打开数</h2><h3 id="系统级"><a href="#系统级" class="headerlink" title="系统级"></a>系统级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#file-max一般为内存大小（KB）的10%来计算，一般我们不需要主动设置这个值，除非这个值确实较小</span></span><br><span class="line"><span class="built_in">cat</span> /proc/sys/fs/file-max</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改方法</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max = 2000000</span><br><span class="line"></span><br><span class="line"><span class="comment">#生效</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="用户级"><a href="#用户级" class="headerlink" title="用户级"></a>用户级</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line">或</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（session生效）</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改（永久）</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux设置最大文件打开数&quot;&gt;&lt;a href=&quot;#Linux设置最大文件打开数&quot; class=&quot;headerlink&quot; title=&quot;Linux设置最大文件打开数&quot;&gt;&lt;/a&gt;Linux设置最大文件打开数&lt;/h2&gt;&lt;h3 id=&quot;系统级&quot;&gt;&lt;a href=&quot;#系统</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>shell循环例子</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/shell%E5%BE%AA%E7%8E%AF%E4%BE%8B%E5%AD%90/</id>
    <published>2022-08-01T07:19:52.825Z</published>
    <updated>2022-08-01T07:19:01.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell循环例子"><a href="#shell循环例子" class="headerlink" title="shell循环例子"></a>shell循环例子</h2><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> aa.txt);<span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$row</span> ;<span class="built_in">sleep</span> 2; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 3</span></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=100; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exmple 1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> <span class="built_in">date</span>; <span class="built_in">uptime</span>; <span class="built_in">sleep</span> 5; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exmple 2</span></span><br><span class="line"><span class="built_in">cat</span> a.txt | <span class="keyword">while</span> <span class="built_in">read</span> row</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell循环例子&quot;&gt;&lt;a href=&quot;#shell循环例子&quot; class=&quot;headerlink&quot; title=&quot;shell循环例子&quot;&gt;&lt;/a&gt;shell循环例子&lt;/h2&gt;&lt;h3 id=&quot;for循环&quot;&gt;&lt;a href=&quot;#for循环&quot; class=&quot;header</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Oracle用户管理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/oracle%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</id>
    <published>2022-08-01T07:19:52.339Z</published>
    <updated>2022-08-01T07:18:51.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle用户管理"><a href="#Oracle用户管理" class="headerlink" title="Oracle用户管理"></a>Oracle用户管理</h2><h3 id="创建只读用户"><a href="#创建只读用户" class="headerlink" title="创建只读用户"></a>创建只读用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> query identified <span class="keyword">by</span> query <span class="keyword">default</span> tablespace cc;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">connect</span> <span class="keyword">to</span> query ;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">SELECT</span> <span class="keyword">ANY</span> <span class="keyword">TABLE</span> <span class="keyword">to</span> query;</span><br><span class="line"><span class="comment">--grant select on  aaa to query;</span></span><br><span class="line"><span class="comment">--数据字典权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">any</span> dictionary <span class="keyword">to</span> query;</span><br></pre></td></tr></table></figure><h3 id="创建sysdba权限用户"><a href="#创建sysdba权限用户" class="headerlink" title="创建sysdba权限用户"></a>创建sysdba权限用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> zdbackup identified <span class="keyword">by</span> zdbackup ;</span><br><span class="line"><span class="keyword">grant</span> sysdba <span class="keyword">to</span> zdbackup;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">create</span> session, <span class="keyword">connect</span>, resource <span class="keyword">to</span> zdbackup ;</span><br></pre></td></tr></table></figure><h3 id="用户解锁"><a href="#用户解锁" class="headerlink" title="用户解锁"></a>用户解锁</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> scott account unlock;</span><br></pre></td></tr></table></figure><h3 id="用户更改密码"><a href="#用户更改密码" class="headerlink" title="用户更改密码"></a>用户更改密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> user01 identified <span class="keyword">by</span> user10;</span><br></pre></td></tr></table></figure><h3 id="不知道密码的情况下，修改新密码等于旧密码"><a href="#不知道密码的情况下，修改新密码等于旧密码" class="headerlink" title="不知道密码的情况下，修改新密码等于旧密码"></a>不知道密码的情况下，修改新密码等于旧密码</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_users;</span><br><span class="line">FSSC_LINK                      <span class="number">737</span>A7F19A6C8315B</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> FSSC_LINK identified <span class="keyword">by</span> <span class="keyword">values</span> <span class="string">&#x27;737A7F19A6C8315B&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> xxxDROP <span class="keyword">USER</span> XXx CASCADE</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle用户管理&quot;&gt;&lt;a href=&quot;#Oracle用户管理&quot; class=&quot;headerlink&quot; title=&quot;Oracle用户管理&quot;&gt;&lt;/a&gt;Oracle用户管理&lt;/h2&gt;&lt;h3 id=&quot;创建只读用户&quot;&gt;&lt;a href=&quot;#创建只读用户&quot; class=&quot;</summary>
      
    
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/categories/oracle/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Mysql数据导入导出</title>
    <link href="https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
    <id>https://biglovewheat.gihub.io/2022/08/01/mysql%E6%96%87%E6%9C%AC%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</id>
    <published>2022-08-01T07:19:51.917Z</published>
    <updated>2022-08-01T07:18:54.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql数据导入导出"><a href="#Mysql数据导入导出" class="headerlink" title="Mysql数据导入导出"></a>Mysql数据导入导出</h2><h3 id="导出到文本"><a href="#导出到文本" class="headerlink" title="导出到文本"></a>导出到文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">select tablename,keymap from cut_table <span class="built_in">where</span> iskeymap=1</span><br><span class="line">into outfile <span class="string">&quot;<span class="variable">$OUTFILE</span>&quot;</span></span><br><span class="line">FIELDS TERMINATED BY <span class="string">&#x27;|&#x27;</span> ;</span><br><span class="line">!</span><br></pre></td></tr></table></figure><h3 id="导入文本"><a href="#导入文本" class="headerlink" title="导入文本"></a>导入文本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SOURCE_USER=root</span><br><span class="line">SOURCE_DB=aa</span><br><span class="line">OUTFILE=aa.txt</span><br><span class="line">LoG=aa.log</span><br><span class="line"><span class="comment">#分隔符|</span></span><br><span class="line"></span><br><span class="line">mysql -u<span class="variable">$SOURCE_USER</span> -D<span class="variable">$SOURCE_DB</span> &lt;&lt;! 2&gt;&gt; <span class="variable">$LOG</span> 1&gt;&amp;2</span><br><span class="line">load data infile <span class="string">&#x27;$OUTFILE&#x27;</span> into table cut_pkey fields terminated by <span class="string">&#x27;|&#x27;</span></span><br><span class="line">(dbname,list_code,pkeyname,pkeyvalue,status);</span><br><span class="line">!</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql数据导入导出&quot;&gt;&lt;a href=&quot;#Mysql数据导入导出&quot; class=&quot;headerlink&quot; title=&quot;Mysql数据导入导出&quot;&gt;&lt;/a&gt;Mysql数据导入导出&lt;/h2&gt;&lt;h3 id=&quot;导出到文本&quot;&gt;&lt;a href=&quot;#导出到文本&quot; class</summary>
      
    
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/categories/mysql/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
</feed>
