<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-12-15T13:31:34.535Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nginx-ssl双向认证</title>
    <link href="https://biglovewheat.gihub.io/2022/12/15/nginx-ssl%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/"/>
    <id>https://biglovewheat.gihub.io/2022/12/15/nginx-ssl%E5%8F%8C%E5%90%91%E8%AE%A4%E8%AF%81/</id>
    <published>2022-12-14T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-ssl双向认证"><a href="#Nginx-ssl双向认证" class="headerlink" title="Nginx-ssl双向认证"></a>Nginx-ssl双向认证</h2><h3 id="脚本-生成ca-x2F-server-x2F-client证书"><a href="#脚本-生成ca-x2F-server-x2F-client证书" class="headerlink" title="脚本-生成ca&#x2F;server&#x2F;client证书"></a>脚本-生成ca&#x2F;server&#x2F;client证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">DOMAIN=<span class="string">&quot;biglovewheat.cn&quot;</span></span><br><span class="line">IP=<span class="string">&quot;192.168.0.23&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WORK_DIR=./temp</span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$WORK_DIR</span></span><br><span class="line"><span class="built_in">mkdir</span> ./temp</span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$DOMAIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## CA</span></span><br><span class="line">openssl genrsa -out <span class="variable">$WORK_DIR</span>/ca.key 4096</span><br><span class="line"> </span><br><span class="line">openssl req -x509 -new -nodes -sha512 -days 3650 \</span><br><span class="line">  -subj <span class="string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=<span class="variable">$DOMAIN</span>&quot;</span> \</span><br><span class="line">  -key <span class="variable">$WORK_DIR</span>/ca.key \</span><br><span class="line">  -out <span class="variable">$WORK_DIR</span>/ca.crt</span><br><span class="line"></span><br><span class="line"><span class="comment">## server</span></span><br><span class="line">openssl genrsa -out <span class="variable">$WORK_DIR</span>/server.key 4096</span><br><span class="line"> </span><br><span class="line">openssl req -sha512 -new \</span><br><span class="line">  -subj <span class="string">&quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=<span class="variable">$DOMAIN</span>&quot;</span> \</span><br><span class="line">  -key <span class="variable">$WORK_DIR</span>/server.key \</span><br><span class="line">  -out <span class="variable">$WORK_DIR</span>/server.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$WORK_DIR</span>/server.ext &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid,issuer</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">DNS.1=$DOMAIN</span></span><br><span class="line"><span class="string">DNS.2=*.$DOMAIN</span></span><br><span class="line"><span class="string">IP.1=$IP</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">## server visa</span></span><br><span class="line">openssl x509 -req -sha512 -days 3650 \</span><br><span class="line">  -extfile <span class="variable">$WORK_DIR</span>/server.ext \</span><br><span class="line">  -CA <span class="variable">$WORK_DIR</span>/ca.crt -CAkey <span class="variable">$WORK_DIR</span>/ca.key -CAcreateserial \</span><br><span class="line">  -<span class="keyword">in</span> <span class="variable">$WORK_DIR</span>/server.csr \</span><br><span class="line">  -out <span class="variable">$WORK_DIR</span>/server.crt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## client</span></span><br><span class="line">openssl genrsa -out <span class="variable">$WORK_DIR</span>/client-ca.key 2048</span><br><span class="line">openssl req -x509 -new -nodes -key <span class="variable">$WORK_DIR</span>/client-ca.key -subj <span class="string">&quot;/CN=ca.client&quot;</span> -days 3650 -out <span class="variable">$WORK_DIR</span>/client-ca.crt</span><br><span class="line">openssl genrsa -out <span class="variable">$WORK_DIR</span>/client.key 2048</span><br><span class="line">openssl req -new -key <span class="variable">$WORK_DIR</span>/client.key -subj <span class="string">&quot;/CN=client&quot;</span> -out <span class="variable">$WORK_DIR</span>/client.csr</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$WORK_DIR</span>/client.ext &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">extendedKeyUsage=clientAuth</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> <span class="variable">$WORK_DIR</span>/client.csr -CA <span class="variable">$WORK_DIR</span>/client-ca.crt -CAkey <span class="variable">$WORK_DIR</span>/client-ca.key -CAcreateserial \</span><br><span class="line"> -extfile <span class="variable">$WORK_DIR</span>/client.ext -out <span class="variable">$WORK_DIR</span>/client.crt -days 3650</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">## output </span></span><br><span class="line"><span class="built_in">mkdir</span> -p ./<span class="variable">$DOMAIN</span></span><br><span class="line"><span class="built_in">cp</span> <span class="variable">$WORK_DIR</span>/*.crt  <span class="variable">$WORK_DIR</span>/*.key ./<span class="variable">$DOMAIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## convert to pfx</span></span><br><span class="line"></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -inkey ./<span class="variable">$DOMAIN</span>/client.key -<span class="keyword">in</span> ./<span class="variable">$DOMAIN</span>/client.crt -out ./<span class="variable">$DOMAIN</span>/client.pfx</span><br></pre></td></tr></table></figure><h3 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen     80;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line"></span><br><span class="line">    ssl_certificate      /data/openssl-test/biglovewheat.cn/server.crt;</span><br><span class="line">    ssl_certificate_key  /data/openssl-test/biglovewheat.cn/server.key;</span><br><span class="line"></span><br><span class="line">    ssl_client_certificate /data/openssl-test/biglovewheat.cn/client-ca.crt;</span><br><span class="line">    ssl_verify_client on;</span><br><span class="line"></span><br><span class="line">    ssl_verify_depth 3;</span><br><span class="line"></span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">            root  /data/webapp/www;</span><br><span class="line">    <span class="keyword">if</span> (!-e <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">        rewrite ^(.*)$ /<span class="variable">$1</span>.html last;</span><br><span class="line">        <span class="built_in">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#        try_files $uri $uri/ /index.html;</span></span><br><span class="line">        index index.html;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>不带clinet证书，报400-No required SSL certificate was sent</p><p>带client证书和key，正常访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@hw-gz-1 biglovewheat.cn]<span class="comment"># curl  https://www.biglovewheat.cn -k </span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;&lt;title&gt;400 No required SSL certificate was sent&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;center&gt;No required SSL certificate was sent&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.20.1&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@hw-gz-1 biglovewheat.cn]<span class="comment"># curl --cert ./client.crt --key ./client.key https://www.biglovewheat.cn -k </span></span><br><span class="line">www</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="windows浏览器访问"><a href="#windows浏览器访问" class="headerlink" title="windows浏览器访问"></a>windows浏览器访问</h3><p>导出pfx格式，可加密码，双击安装后，重启浏览器即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 脚本最后一步，转成pfx格式</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -inkey ./<span class="variable">$DOMAIN</span>/client.key -<span class="keyword">in</span> ./<span class="variable">$DOMAIN</span>/client.crt -out ./<span class="variable">$DOMAIN</span>/client.pfx</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx-ssl双向认证&quot;&gt;&lt;a href=&quot;#Nginx-ssl双向认证&quot; class=&quot;headerlink&quot; title=&quot;Nginx-ssl双向认证&quot;&gt;&lt;/a&gt;Nginx-ssl双向认证&lt;/h2&gt;&lt;h3 id=&quot;脚本-生成ca-x2F-server-x2</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="nginx" scheme="https://biglovewheat.gihub.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Consul-启动失败排查</title>
    <link href="https://biglovewheat.gihub.io/2022/12/13/consul-%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E6%8E%92%E6%9F%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/12/13/consul-%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E6%8E%92%E6%9F%A5/</id>
    <published>2022-12-12T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.520Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Consul-不能启动问题排查"><a href="#Consul-不能启动问题排查" class="headerlink" title="Consul-不能启动问题排查"></a>Consul-不能启动问题排查</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl status</span><br><span class="line"></span><br><span class="line">alertmanager                     RUNNING   pid 2910405, <span class="built_in">uptime</span> 1 day, 22:39:07</span><br><span class="line">consul                           FATAL     Exited too quickly (process <span class="built_in">log</span> may have details)</span><br><span class="line">prometheus                       RUNNING   pid 1842, <span class="built_in">uptime</span> 1299 days, 16:51:21</span><br><span class="line">prometheus-webhook-dingtalk      STOPPED   Jul 04 03:47 PM</span><br></pre></td></tr></table></figure><h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f supervisord.log-20220704 </span><br><span class="line">2022-07-04 15:50:43,730 INFO gave up: consul entered FATAL state, too many start retries too quickly</span><br><span class="line">2022-07-06 14:27:46,651 INFO spawned: <span class="string">&#x27;consul&#x27;</span> with pid 1248136</span><br><span class="line">2022-07-06 14:27:46,854 INFO exited: consul (<span class="built_in">exit</span> status 1; not expected)</span><br><span class="line">2022-07-06 14:27:47,855 INFO spawned: <span class="string">&#x27;consul&#x27;</span> with pid 1248446</span><br><span class="line">2022-07-06 14:27:48,043 INFO exited: consul (<span class="built_in">exit</span> status 1; not expected)</span><br><span class="line">2022-07-06 14:27:50,046 INFO spawned: <span class="string">&#x27;consul&#x27;</span> with pid 1248797</span><br><span class="line">2022-07-06 14:27:50,599 INFO exited: consul (<span class="built_in">exit</span> status 1; not expected)</span><br><span class="line">2022-07-06 14:27:53,602 INFO spawned: <span class="string">&#x27;consul&#x27;</span> with pid 1249389</span><br><span class="line">2022-07-06 14:27:53,847 INFO exited: consul (<span class="built_in">exit</span> status 1; not expected)</span><br><span class="line">2022-07-06 14:27:54,847 INFO gave up: consul entered FATAL state, too many start retries too quickly</span><br></pre></td></tr></table></figure><h3 id="再次排查"><a href="#再次排查" class="headerlink" title="再次排查"></a>再次排查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl  <span class="built_in">tail</span> consul stdout</span><br><span class="line">.245:8301: <span class="built_in">bind</span>: address already <span class="keyword">in</span> use</span><br><span class="line">bootstrap_expect = 2: A cluster with 2 servers will provide no failure tolerance. See https://www.consul.io/docs/internals/consensus.html<span class="comment">#deployment-table</span></span><br><span class="line">bootstrap_expect &gt; 0: expecting 2 servers</span><br><span class="line">==&gt; Starting Consul agent...</span><br><span class="line">==&gt; Error starting agent: Failed to start Consul server: Failed to start LAN Serf: Failed to create memberlist: Could not <span class="built_in">set</span> up network transport: failed to obtain an address: Failed to start TCP listener on <span class="string">&quot;10.9.127.245&quot;</span> port 8301: listen tcp 10.9.127.245:8301: <span class="built_in">bind</span>: address already <span class="keyword">in</span> use</span><br><span class="line">bootstrap_expect = 2: A cluster with 2 servers will provide no failure tolerance. See https://www.consul.io/docs/internals/consensus.html<span class="comment">#deployment-table</span></span><br><span class="line">bootstrap_expect &gt; 0: expecting 2 servers</span><br><span class="line">==&gt; Starting Consul agent...</span><br><span class="line">==&gt; Error starting agent: Failed to start Consul server: Failed to start LAN Serf: Failed to create memberlist: Could not <span class="built_in">set</span> up network transport: failed to obtain an address: Failed to start TCP listener on <span class="string">&quot;10.9.127.245&quot;</span> port 8301: listen tcp 10.9.127.245:8301: <span class="built_in">bind</span>: address already <span class="keyword">in</span> use</span><br><span class="line">bootstrap_expect = 2: A cluster with 2 servers will provide no failure tolerance. See https://www.consul.io/docs/internals/consensus.html<span class="comment">#deployment-table</span></span><br><span class="line">bootstrap_expect &gt; 0: expecting 2 servers</span><br><span class="line">==&gt; Starting Consul agent...</span><br><span class="line">==&gt; Error starting agent: Failed to start Consul server: Failed to start LAN Serf: Failed to create memberlist: Could not <span class="built_in">set</span> up network transport: failed to obtain an address: Failed to start TCP listener on <span class="string">&quot;10.9.127.245&quot;</span> port 8301: listen tcp 10.9.127.245:8301: <span class="built_in">bind</span>: address already <span class="keyword">in</span> use</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## address already in use --&gt; 端口被占用，清理端口后重新启动即可</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Consul-不能启动问题排查&quot;&gt;&lt;a href=&quot;#Consul-不能启动问题排查&quot; class=&quot;headerlink&quot; title=&quot;Consul-不能启动问题排查&quot;&gt;&lt;/a&gt;Consul-不能启动问题排查&lt;/h2&gt;&lt;h3 id=&quot;现象&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="故障排查" scheme="https://biglovewheat.gihub.io/categories/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/"/>
    
    
    <category term="consul" scheme="https://biglovewheat.gihub.io/tags/consul/"/>
    
    <category term="supervisor" scheme="https://biglovewheat.gihub.io/tags/supervisor/"/>
    
  </entry>
  
  <entry>
    <title>Java-启动参数修改</title>
    <link href="https://biglovewheat.gihub.io/2022/12/13/java-%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BF%AE%E6%94%B9/"/>
    <id>https://biglovewheat.gihub.io/2022/12/13/java-%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0%E4%BF%AE%E6%94%B9/</id>
    <published>2022-12-12T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.528Z</updated>
    
    <content type="html"><![CDATA[<h2 id="java启动参数修改"><a href="#java启动参数修改" class="headerlink" title="java启动参数修改"></a>java启动参数修改</h2><h3 id="java8转换成java11参数修改"><a href="#java8转换成java11参数修改" class="headerlink" title="java8转换成java11参数修改"></a>java8转换成java11参数修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## java8</span></span><br><span class="line">JAVA_OPS=<span class="string">&quot;-Xms512m -Xmx2g -Xmn1g -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/ -XX:+PrintGCDetails -verbosegc -Xloggc:<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/gc.<span class="variable">$&#123;svc&#125;</span>.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动报warning</span></span><br><span class="line">[0.001s][warning][gc] -Xloggc is deprecated. Will use -Xlog:gc:/data/logs/analyzeGc/gc.hx-task.log instead.</span><br><span class="line">[0.002s][warning][gc] -XX:+PrintGCDetails is deprecated. Will use -Xlog:gc* instead.</span><br><span class="line"></span><br><span class="line"><span class="comment">## java11</span></span><br><span class="line">JAVA_OPS=<span class="string">&quot;-Xms512m -Xmx1g -Xmn512m -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/ -Xlog:gc*  -verbosegc -Xlog:gc:<span class="variable">$&#123;LOG_HOME&#125;</span>/analyzeGc/gc.<span class="variable">$&#123;svc&#125;</span>.log&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;java启动参数修改&quot;&gt;&lt;a href=&quot;#java启动参数修改&quot; class=&quot;headerlink&quot; title=&quot;java启动参数修改&quot;&gt;&lt;/a&gt;java启动参数修改&lt;/h2&gt;&lt;h3 id=&quot;java8转换成java11参数修改&quot;&gt;&lt;a href=&quot;#jav</summary>
      
    
    
    
    <category term="java" scheme="https://biglovewheat.gihub.io/categories/java/"/>
    
    
    <category term="java" scheme="https://biglovewheat.gihub.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>数据库隔离级别</title>
    <link href="https://biglovewheat.gihub.io/2022/12/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/"/>
    <id>https://biglovewheat.gihub.io/2022/12/06/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</id>
    <published>2022-12-05T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.543Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数据库隔离级别"><a href="#数据库隔离级别" class="headerlink" title="数据库隔离级别"></a>数据库隔离级别</h2><p><img src="/../images/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB_01.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;数据库隔离级别&quot;&gt;&lt;a href=&quot;#数据库隔离级别&quot; class=&quot;headerlink&quot; title=&quot;数据库隔离级别&quot;&gt;&lt;/a&gt;数据库隔离级别&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/../images/%E6%95%B0%E6%8D%AE%E5%BA%93%E</summary>
      
    
    
    
    <category term="基础概念" scheme="https://biglovewheat.gihub.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    
    
    <category term="database" scheme="https://biglovewheat.gihub.io/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>Arthas-java性能分析工具</title>
    <link href="https://biglovewheat.gihub.io/2022/12/05/arthas-java%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/"/>
    <id>https://biglovewheat.gihub.io/2022/12/05/arthas-java%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/</id>
    <published>2022-12-04T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.518Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Arthas-java性能分析工具"><a href="#Arthas-java性能分析工具" class="headerlink" title="Arthas-java性能分析工具"></a>Arthas-java性能分析工具</h2><h3 id="Arthas简介"><a href="#Arthas简介" class="headerlink" title="Arthas简介"></a>Arthas简介</h3><p><em>Arthas 是阿里开源的 Java 诊断工具</em></p><p><a href="https://arthas.aliyun.com/doc/">https://arthas.aliyun.com/doc/</a></p><h3 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## github下载</span></span><br><span class="line"></span><br><span class="line">wget https://github.com/alibaba/arthas/releases/download/arthas-all-3.6.7/arthas-bin.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">## 解压</span></span><br><span class="line">unzip arthas-all-3.6.7/arthas-bin.zip</span><br><span class="line"></span><br><span class="line"><span class="comment">## 运行</span></span><br><span class="line">./as.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">## 选择需要监控的java进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用命令</span></span><br><span class="line">dashboard</span><br><span class="line"></span><br><span class="line"><span class="comment">## 更多详见帮助</span></span><br><span class="line"><span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Arthas-java性能分析工具&quot;&gt;&lt;a href=&quot;#Arthas-java性能分析工具&quot; class=&quot;headerlink&quot; title=&quot;Arthas-java性能分析工具&quot;&gt;&lt;/a&gt;Arthas-java性能分析工具&lt;/h2&gt;&lt;h3 id=&quot;Artha</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="java" scheme="https://biglovewheat.gihub.io/tags/java/"/>
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>K8s-允许master节点参与调度</title>
    <link href="https://biglovewheat.gihub.io/2022/12/05/k8s-%E5%85%81%E8%AE%B8master%E8%8A%82%E7%82%B9%E5%8F%82%E4%B8%8E%E8%B0%83%E5%BA%A6/"/>
    <id>https://biglovewheat.gihub.io/2022/12/05/k8s-%E5%85%81%E8%AE%B8master%E8%8A%82%E7%82%B9%E5%8F%82%E4%B8%8E%E8%B0%83%E5%BA%A6/</id>
    <published>2022-12-04T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.531Z</updated>
    
    <content type="html"><![CDATA[<h2 id="k8s-允许master节点参与调度"><a href="#k8s-允许master节点参与调度" class="headerlink" title="k8s-允许master节点参与调度"></a>k8s-允许master节点参与调度</h2><p>默认情况下，master由于有node-role.kubernetes.io&#x2F;master:NoSchedule污点，不参与任务调度。想让master节点参与任务调度，需去除此污点</p><h3 id="去除污点"><a href="#去除污点" class="headerlink" title="去除污点"></a>去除污点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">出去污点</span><br><span class="line"><span class="comment"># 查看node</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"><span class="comment"># 查看污点</span></span><br><span class="line">kubectl describe node k8s-master |grep Taints </span><br><span class="line">Taints:    node-role.kubernetes.io/master:NoSchedule  </span><br><span class="line"><span class="comment"># 去除污点 </span></span><br><span class="line">kubectl taint nodes --all node-role.kubernetes.io/master-</span><br><span class="line"></span><br><span class="line">添加master为worker角色(可选)</span><br><span class="line"><span class="comment"># 让master节点参与调度，#如果想删除，把=换成-</span></span><br><span class="line">kubectl label nodes k8s-master node-role.kubernetes.io/worker=</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;k8s-允许master节点参与调度&quot;&gt;&lt;a href=&quot;#k8s-允许master节点参与调度&quot; class=&quot;headerlink&quot; title=&quot;k8s-允许master节点参与调度&quot;&gt;&lt;/a&gt;k8s-允许master节点参与调度&lt;/h2&gt;&lt;p&gt;默认情况下，</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Linux-时区操作</title>
    <link href="https://biglovewheat.gihub.io/2022/12/05/linux-%E6%97%B6%E5%8C%BA%E6%93%8D%E4%BD%9C/"/>
    <id>https://biglovewheat.gihub.io/2022/12/05/linux-%E6%97%B6%E5%8C%BA%E6%93%8D%E4%BD%9C/</id>
    <published>2022-12-04T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.532Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux-时区操作"><a href="#linux-时区操作" class="headerlink" title="linux-时区操作"></a>linux-时区操作</h2><h3 id="ubuntu-x2F-centos-更改时区"><a href="#ubuntu-x2F-centos-更改时区" class="headerlink" title="ubuntu&#x2F;centos 更改时区"></a>ubuntu&#x2F;centos 更改时区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl list-timezones |grep -i shanghai</span><br><span class="line">timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></table></figure><h3 id="alpine-更改时区"><a href="#alpine-更改时区" class="headerlink" title="alpine 更改时区"></a>alpine 更改时区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -a /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;linux-时区操作&quot;&gt;&lt;a href=&quot;#linux-时区操作&quot; class=&quot;headerlink&quot; title=&quot;linux-时区操作&quot;&gt;&lt;/a&gt;linux-时区操作&lt;/h2&gt;&lt;h3 id=&quot;ubuntu-x2F-centos-更改时区&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Postgresql-创建只读用户</title>
    <link href="https://biglovewheat.gihub.io/2022/12/05/postgresql-%E5%88%9B%E5%BB%BA%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/"/>
    <id>https://biglovewheat.gihub.io/2022/12/05/postgresql-%E5%88%9B%E5%BB%BA%E5%8F%AA%E8%AF%BB%E7%94%A8%E6%88%B7/</id>
    <published>2022-12-04T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.538Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Postgresql-创建只读用户"><a href="#Postgresql-创建只读用户" class="headerlink" title="Postgresql-创建只读用户"></a>Postgresql-创建只读用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> bigdata <span class="keyword">with</span> password <span class="string">&#x27;ch2)x7jzReZN&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> bigdata <span class="keyword">set</span> default_transaction_read_only<span class="operator">=</span><span class="keyword">on</span>;</span><br><span class="line"><span class="keyword">GRANT</span> USAGE <span class="keyword">ON</span> SCHEMA public <span class="keyword">to</span> bigdata;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> <span class="keyword">all</span> tables <span class="keyword">in</span> schema public <span class="keyword">to</span> bigdata;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Postgresql-创建只读用户&quot;&gt;&lt;a href=&quot;#Postgresql-创建只读用户&quot; class=&quot;headerlink&quot; title=&quot;Postgresql-创建只读用户&quot;&gt;&lt;/a&gt;Postgresql-创建只读用户&lt;/h2&gt;&lt;figure class</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="postgresql" scheme="https://biglovewheat.gihub.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Shell-备份工具</title>
    <link href="https://biglovewheat.gihub.io/2022/12/05/shell-%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7/"/>
    <id>https://biglovewheat.gihub.io/2022/12/05/shell-%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7/</id>
    <published>2022-12-04T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.541Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shell-备份工具"><a href="#shell-备份工具" class="headerlink" title="shell-备份工具"></a>shell-备份工具</h2><p><em>一个自己写的shell脚本备份工具</em></p><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 主配置文件</span></span><br><span class="line"><span class="built_in">cat</span> backup.lst </span><br><span class="line"><span class="comment">#1pg|2gis_sit|3IP|4Port|5user|6password|7cycle|</span></span><br><span class="line">pg|gis_sit|172.31.34.25|5083|postgres|abc123!!!|days|</span><br><span class="line">pg|gis_prod|172.31.56.16|5083|postgres|abc123!!!|days|</span><br><span class="line">pg|gis_jx|172.31.71.117|5083|postgres|abc123!!!|days|</span><br><span class="line">pg|gis_old_lite|172.31.45.42|5083|postgres|abc123!!!|days|</span><br><span class="line">pg|gis_old|172.31.45.42|5083|postgres|abc123!!!|weeks|</span><br><span class="line">mysql|jx|3|4|5|6|days|</span><br><span class="line">mysql|sit|3|4|5|6|days|</span><br><span class="line">mysql|show|3|4|5|6|days|</span><br><span class="line">mysql|prod|3|4|5|6|days|</span><br><span class="line">mysql|wiki|3|4|5|6|days|</span><br><span class="line">mysql|bigdata|3|4|5|6|days|</span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql-client配置文件</span></span><br><span class="line"><span class="built_in">cat</span> ./mysql_cnf/jx.lst </span><br><span class="line">[client]</span><br><span class="line">user=root</span><br><span class="line">password=abc123!!!</span><br><span class="line">host=172.31.71.117</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment">## ansible配置</span></span><br><span class="line"><span class="built_in">cat</span> ansible_host.lst</span><br><span class="line">[nginx_default]</span><br><span class="line">aws-prod-app-01</span><br><span class="line">aws-prod-app-02</span><br><span class="line">aws-prod-app-03</span><br><span class="line">aws-prod-app-04</span><br><span class="line">aws-prod-app-05</span><br><span class="line">aws-sit-app-01</span><br><span class="line">aws-sit-app-02</span><br><span class="line">aws-sit-app-04</span><br><span class="line">aws-show-app-01</span><br><span class="line"></span><br><span class="line">[nginx_data]</span><br><span class="line">aws-jx-app-01</span><br><span class="line">aws-jx-app-02</span><br><span class="line"></span><br><span class="line">[nginx_default:vars]</span><br><span class="line">ansible_user=ops_root</span><br><span class="line">ansible_password=dNqzrKHu8UQsuxcX</span><br><span class="line"></span><br><span class="line">[nginx_data:vars]</span><br><span class="line">ansible_user=ops_root</span><br><span class="line">ansible_password=dNqzrKHu8UQsuxcX</span><br></pre></td></tr></table></figure><h3 id="主脚本"><a href="#主脚本" class="headerlink" title="主脚本"></a>主脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line">ROOT=/data/backup</span><br><span class="line">v_backuplist=<span class="variable">$ROOT</span>/backup.lst</span><br><span class="line">v_weekday=$(<span class="built_in">date</span> +%w)</span><br><span class="line">v_day=$(<span class="built_in">date</span> +%d)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;***********************************************************************&quot;</span></span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">date</span>) <span class="string">&quot; -- backup bgein&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;***********************************************************************&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## backup</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> $(<span class="built_in">cat</span> <span class="variable">$v_backuplist</span>|grep -v ^$|grep -v ^<span class="comment">#)</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment">#pg|gis-sit|172.31.34.25|5083|postgres|Hxkj2022!!!|</span></span><br><span class="line">    v_type=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    v_name=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">    v_ip=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">    v_port=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>)</span><br><span class="line">    v_user=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $5&#125;&#x27;</span>)</span><br><span class="line">    v_pass=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F\| <span class="string">&#x27;&#123;print $6&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$v_type</span> <span class="keyword">in</span></span><br><span class="line">    pg)</span><br><span class="line">        <span class="built_in">export</span> PGPASSWORD=<span class="variable">$v_pass</span></span><br><span class="line">        <span class="keyword">case</span> <span class="variable">$v_name</span> <span class="keyword">in</span></span><br><span class="line">        gis_old_lite)</span><br><span class="line">            v_backupfile=<span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.tar</span><br><span class="line">            pg_dumpall -h <span class="variable">$v_ip</span> -U <span class="variable">$v_user</span> -p <span class="variable">$v_port</span> --exclude-database=common -c --if-exists |gzip &gt; <span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.1.sql.gz</span><br><span class="line">            pg_dump -h <span class="variable">$v_ip</span> -U <span class="variable">$v_user</span> -p <span class="variable">$v_port</span> --dbname=common --exclude-schema=offline_map -c --if-exists|gzip &gt; <span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.2.sql.gz</span><br><span class="line">            tar -cvf <span class="variable">$v_backupfile</span> <span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.*.sql.gz --remove-files</span><br><span class="line">            /usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$v_backupfile</span> s3://hxs3/backup/</span><br><span class="line"><span class="comment">#            if [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v01&quot; ]] || [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v15&quot; ]]; then /usr/local/bin/aws s3 cp $v_backupfile s3://hxs3/backup/ s3://hxarchive/永久备份/; fi</span></span><br><span class="line">        ;;</span><br><span class="line">        gis_old)</span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;v<span class="variable">$&#123;v_weekday&#125;</span>&quot;</span> == <span class="string">&quot;v6&quot;</span> ]]</span><br><span class="line">            <span class="keyword">then</span></span><br><span class="line">                v_backupfile=<span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.sql.gz</span><br><span class="line">                pg_dumpall -h <span class="variable">$v_ip</span> -U <span class="variable">$v_user</span> -p <span class="variable">$v_port</span> -c --if-exists |gzip &gt; <span class="variable">$v_backupfile</span></span><br><span class="line">                /usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$v_backupfile</span> s3://hxs3/backup/</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        ;;</span><br><span class="line">        *)</span><br><span class="line">            v_backupfile=<span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.sql.gz</span><br><span class="line">            pg_dumpall -h <span class="variable">$v_ip</span> -U <span class="variable">$v_user</span> -p <span class="variable">$v_port</span> -c --if-exists |gzip &gt; <span class="variable">$v_backupfile</span></span><br><span class="line">            /usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$v_backupfile</span> s3://hxs3/backup/</span><br><span class="line"><span class="comment">#            if [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v01&quot; ]] || [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v15&quot; ]]; then /usr/local/bin/aws s3 cp $v_backupfile s3://hxs3/backup/ s3://hxarchive/永久备份/; fi</span></span><br><span class="line">        ;;</span><br><span class="line">        <span class="keyword">esac</span></span><br><span class="line">    ;;</span><br><span class="line">    mysql)</span><br><span class="line">        v_mysqllst=./mysql_cnf/<span class="variable">$&#123;v_name&#125;</span>.lst</span><br><span class="line">        v_backupfile=<span class="variable">$&#123;v_type&#125;</span>_<span class="variable">$&#123;v_name&#125;</span>_<span class="variable">$&#123;DATETIME&#125;</span>.sql.gz</span><br><span class="line">        <span class="keyword">if</span> [[ <span class="string">&quot;v<span class="variable">$&#123;v_name&#125;</span>&quot;</span> == <span class="string">&quot;vbigdata&quot;</span> ]]; <span class="keyword">then</span> mysql_ops=<span class="string">&#x27; --skip-column-statistics&#x27;</span> ; <span class="keyword">fi</span></span><br><span class="line">        mysqldump --defaults-extra-file=<span class="variable">$v_mysqllst</span> --all-databases --set-gtid-purged=OFF  <span class="variable">$mysql_ops</span> -C |  gzip &gt; <span class="variable">$v_backupfile</span></span><br><span class="line">        /usr/local/bin/aws s3 <span class="built_in">cp</span> <span class="variable">$v_backupfile</span> s3://hxs3/backup/</span><br><span class="line"><span class="comment">#        if [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v01&quot; ]] || [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v15&quot; ]]; then /usr/local/bin/aws s3 cp $v_backupfile s3://hxs3/backup/ s3://hxarchive/永久备份/; fi</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">    ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nacos backup</span></span><br><span class="line">./nacos_backup.py</span><br><span class="line"></span><br><span class="line"><span class="comment">## nginx backup</span></span><br><span class="line">/data/anaconda3/bin/ansible nginx_default -i ansible_hosts.lst -m synchronize -a  <span class="string">&quot;src=/etc/nginx/conf.d dest=nginx_&#123;&#123;inventory_hostname&#125;&#125;  mode=pull&quot;</span></span><br><span class="line">/data/anaconda3/bin/ansible nginx_data -i ansible_hosts.lst -m synchronize -a  <span class="string">&quot;src=/data/nginx/conf/conf.d dest=nginx_&#123;&#123;inventory_hostname&#125;&#125;  mode=pull&quot;</span></span><br><span class="line">tar -czvf nginx_<span class="variable">$&#123;DATETIME&#125;</span>.tgz nginx_aws*  --remove</span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> nginx_<span class="variable">$&#123;DATETIME&#125;</span>.tgz s3://hxs3/backup/</span><br><span class="line"><span class="comment">#if [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v01&quot; ]] || [[ &quot;v$&#123;v_day&#125;&quot; == &quot;v15&quot; ]]; then /usr/local/bin/aws s3 cp nginx_$&#123;DATETIME&#125;.tgz s3://hxarchive/永久备份/; fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## clenaup</span></span><br><span class="line">find <span class="variable">$ROOT</span> -mtime +3 -<span class="built_in">type</span> f -name <span class="string">&quot;*.gz&quot;</span> | xargs <span class="built_in">rm</span> -fv</span><br><span class="line">find <span class="variable">$ROOT</span> -mtime +3 -<span class="built_in">type</span> f -name <span class="string">&quot;*.zip&quot;</span> | xargs <span class="built_in">rm</span> -fv</span><br><span class="line">find <span class="variable">$ROOT</span> -mtime +3 -<span class="built_in">type</span> f -name <span class="string">&quot;*.tgz&quot;</span> | xargs <span class="built_in">rm</span> -fv</span><br><span class="line">find <span class="variable">$ROOT</span> -mtime +3 -<span class="built_in">type</span> f -name <span class="string">&quot;*.tar&quot;</span> | xargs <span class="built_in">rm</span> -fv</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;***********************************************************************&quot;</span></span><br><span class="line"><span class="built_in">echo</span> $(<span class="built_in">date</span>) <span class="string">&quot; -- backup end&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;***********************************************************************&quot;</span></span><br></pre></td></tr></table></figure><h3 id="nacos-备份脚本"><a href="#nacos-备份脚本" class="headerlink" title="nacos 备份脚本"></a>nacos 备份脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/data/anaconda3/bin/python3.9</span></span><br><span class="line"><span class="keyword">from</span> fileinput <span class="keyword">import</span> filename</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> boto3.session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line"><span class="comment">## s3 config</span></span><br><span class="line">aws_key = <span class="string">&quot;AKIAUPGCAPWX4FD5N2CO&quot;</span></span><br><span class="line">aws_secret = <span class="string">&quot;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&quot;</span></span><br><span class="line">region_name = <span class="string">&quot;cn-northwest-1&quot;</span></span><br><span class="line">session = Session(aws_access_key_id=aws_key,</span><br><span class="line">aws_secret_access_key=aws_secret,</span><br><span class="line">region_name=region_name)</span><br><span class="line"></span><br><span class="line">s3 = session.resource(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">client = session.client(<span class="string">&quot;s3&quot;</span>)</span><br><span class="line">bucket = <span class="string">&quot;hxs3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nacos</span></span><br><span class="line">nacos_list=[</span><br><span class="line"><span class="comment">#    &#x27;http://10.9.127.244:8848|c23a1b4c-e97f-45ae-a5c0-1e7f1a8d22e9|nacos|nacos|nacos-dev&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;http://nacos.farmbgy.net:8848|da7aaaa2-7505-4c1d-98c6-9e2e7778ef55|nacos|abc123!!!|nacos-prod&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://aws-sit-code-pro-01:8848|09a89c03-8f14-40a7-a44b-2be7e9f87e14|nacos|abc123!!!|nacos-sit&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://aws-jx-middle-01:8848|c876967c-d8dd-4318-9bf1-e7e72eb47d13|nacos|abc123!!!|nacos-jx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://aws-show-middle-01:8848|da7aaaa2-7505-4c1d-98c6-9e2e7778ef55|nacos|abc123!!!|nacos-show&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> nacos_list:</span><br><span class="line">    url,namespace,username,password,filename = row.strip().split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    login_url = url+<span class="string">&#x27;/nacos/v1/auth/users/login&#x27;</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;username&#x27;</span>:username,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:password&#125;</span><br><span class="line">    s = requests.session()</span><br><span class="line">    resp = s.post(login_url,data)</span><br><span class="line">    token = json.loads(resp.text)[<span class="string">&#x27;accessToken&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    backup_url = url+<span class="string">&#x27;/nacos/v1/cs/configs?export=true&amp;tenant=&#x27;</span>+namespace+<span class="string">&#x27;&amp;group=&amp;appName=&amp;dataId=&amp;ids=&amp;accessToken=&#x27;</span>+token</span><br><span class="line">    </span><br><span class="line">    filename = os.path.abspath(os.path.dirname(__file__))+<span class="string">&#x27;/&#x27;</span>+filename+<span class="string">&#x27;-&#x27;</span>+datetime.datetime.now().strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>)+<span class="string">&#x27;.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">    r = requests.get(backup_url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> code:</span><br><span class="line">        code.write(r.content)</span><br><span class="line"></span><br><span class="line">    upload_data = <span class="built_in">open</span>(filename,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    upload_key = <span class="string">&quot;backup/&quot;</span>+os.path.basename(filename)</span><br><span class="line">    file_obj = s3.Bucket(bucket).put_object(Key=upload_key, Body=upload_data)</span><br><span class="line">    <span class="built_in">print</span>(file_obj)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;shell-备份工具&quot;&gt;&lt;a href=&quot;#shell-备份工具&quot; class=&quot;headerlink&quot; title=&quot;shell-备份工具&quot;&gt;&lt;/a&gt;shell-备份工具&lt;/h2&gt;&lt;p&gt;&lt;em&gt;一个自己写的shell脚本备份工具&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Docker-基本操作</title>
    <link href="https://biglovewheat.gihub.io/2022/11/28/docker-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <id>https://biglovewheat.gihub.io/2022/11/28/docker-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</id>
    <published>2022-11-27T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.526Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker-基本操作"><a href="#Docker-基本操作" class="headerlink" title="Docker-基本操作"></a>Docker-基本操作</h2><h3 id="Docker镜像导入导出"><a href="#Docker镜像导入导出" class="headerlink" title="Docker镜像导入导出"></a>Docker镜像导入导出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker save 605c77e624dd &gt;nginx.tar</span><br><span class="line">docker load &lt; nginx.tar</span><br><span class="line"></span><br><span class="line"><span class="comment">## 多个镜像打一个包</span></span><br><span class="line">docker save nginx:latest  rocketmq-exporter:latest -o aa.tar</span><br><span class="line">docker load -i aa.tar</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Docker-基本操作&quot;&gt;&lt;a href=&quot;#Docker-基本操作&quot; class=&quot;headerlink&quot; title=&quot;Docker-基本操作&quot;&gt;&lt;/a&gt;Docker-基本操作&lt;/h2&gt;&lt;h3 id=&quot;Docker镜像导入导出&quot;&gt;&lt;a href=&quot;#Docke</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="docker" scheme="https://biglovewheat.gihub.io/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Skywalking-链路跟踪部署</title>
    <link href="https://biglovewheat.gihub.io/2022/11/24/skywalking-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E9%83%A8%E7%BD%B2/"/>
    <id>https://biglovewheat.gihub.io/2022/11/24/skywalking-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E9%83%A8%E7%BD%B2/</id>
    <published>2022-11-23T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.542Z</updated>
    
    <content type="html"><![CDATA[<h2 id="skywalking链路跟踪部署"><a href="#skywalking链路跟踪部署" class="headerlink" title="skywalking链路跟踪部署"></a>skywalking链路跟踪部署</h2><h3 id="Skywalking介绍"><a href="#Skywalking介绍" class="headerlink" title="Skywalking介绍"></a>Skywalking介绍</h3><p>Skywalking是分布式系统的应用程序性能监视工具，专为微服务，云原生架构和基于容器（Docker，K8S,Mesos）架构而设计，它是一款优秀的APM（Application Performance Management）工具，包括了分布式追踪，性能指标分析和服务依赖分析等。</p><h3 id="skywalking架构图"><a href="#skywalking架构图" class="headerlink" title="skywalking架构图"></a>skywalking架构图</h3><p><img src="/./../images/skywalking%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA%E9%83%A8%E7%BD%B2_01.jpg"></p><p>Skywalking agent 和业务端绑定在一起，负责收集各种监控数据</p><p>Skywalking oapservice 是负责处理监控数据，接受agent的数据并存储在数据库中，接受来自UI的请求，查询监控数据。</p><p>Skywalking UI提供给用户，展现各种监控数据和告警。</p><h3 id="skywalking安装部署-ES"><a href="#skywalking安装部署-ES" class="headerlink" title="skywalking安装部署-ES"></a>skywalking安装部署-ES</h3><p>elasticsearch安装（略）</p><h3 id="skywalking安装部署-obs-server端"><a href="#skywalking安装部署-obs-server端" class="headerlink" title="skywalking安装部署-obs(server端)"></a>skywalking安装部署-obs(server端)</h3><p>官网下载，解压压缩包</p><p>修改配置文件</p><p>vi skywalking&#x2F;config&#x2F;application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 修改配置文件，使用nacos作为注册中心</span></span><br><span class="line"><span class="attr">cluster:</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="string">$&#123;SW_CLUSTER:nacos&#125;</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">serviceName:</span> <span class="string">$&#123;SW_SERVICE_NAME:&quot;SkyWalking_OAP_Cluster&quot;&#125;</span></span><br><span class="line">    <span class="attr">hostPort:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_HOST_PORT:192.168.8.101:8848&#125;</span></span><br><span class="line">    <span class="comment"># Nacos Configuration namespace</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_NAMESPACE:&quot;c23a1b4c-e97f-45ae-a5c0-1e7f1a8d22e9&quot;&#125;</span></span><br><span class="line">    <span class="comment"># Nacos auth username</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_USERNAME:&quot;&quot;&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_PASSWORD:&quot;&quot;&#125;</span></span><br><span class="line">    <span class="comment"># Nacos auth accessKey</span></span><br><span class="line">    <span class="attr">accessKey:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_ACCESSKEY:&quot;&quot;&#125;</span></span><br><span class="line">    <span class="attr">secretKey:</span> <span class="string">$&#123;SW_CLUSTER_NACOS_SECRETKEY:&quot;&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## es作为后端存储</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="string">$&#123;SW_STORAGE:elasticsearch&#125;</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">$&#123;SW_NAMESPACE:&quot;&quot;&#125;</span></span><br><span class="line">    <span class="attr">clusterNodes:</span> <span class="string">$&#123;SW_STORAGE_ES_CLUSTER_NODES:10.9.127.36:9200&#125;</span></span><br></pre></td></tr></table></figure><p>修改UI配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 主要修改端口</span></span><br><span class="line"><span class="string">skywalking/webapp/webapp.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">12080</span></span><br></pre></td></tr></table></figure><p>同时启动oap和UI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skywalking/bin/startup.sh</span><br></pre></td></tr></table></figure><p>启动成功后，可以在nacos上看到SkyWalking_OAP_Cluster</p><h3 id="skywalking安装部署-agent-spring-boot"><a href="#skywalking安装部署-agent-spring-boot" class="headerlink" title="skywalking安装部署-agent(spring boot)"></a>skywalking安装部署-agent(spring boot)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 下载agent</span></span><br><span class="line">wget https://www.apache.org/dyn/closer.cgi/skywalking/java-agent/8.13.0/apache-skywalking-java-agent-8.13.0.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改配置</span></span><br><span class="line">vi ./config/agent.config</span><br><span class="line"><span class="comment">#主要修改oap的IP，多个IP可用逗号隔开</span></span><br><span class="line">collector.backend_service=<span class="variable">$&#123;SW_AGENT_COLLECTOR_BACKEND_SERVICES:192.168.8.101:11800&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## sprintboot增加启动参数</span></span><br><span class="line"><span class="built_in">nohup</span> java -javaagent:/data/skywalking/skywalking-agent/skywalking-agent.jar \</span><br><span class="line">           -Dskywalking.agent.service_name=<span class="variable">$&#123;svc&#125;</span> \</span><br><span class="line">           <span class="variable">$&#123;JAVA_OPS&#125;</span> -jar <span class="variable">$&#123;APP_HOME&#125;</span>/<span class="variable">$&#123;svc&#125;</span>.jar  --spring.profiles.active=$ \&#123;SPRING_ENV&#125; &gt;&gt; <span class="variable">$&#123;APP_HOME&#125;</span>/<span class="variable">$&#123;svc&#125;</span>.<span class="built_in">log</span> 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h3 id="登录UI，可以查看到监控情况"><a href="#登录UI，可以查看到监控情况" class="headerlink" title="登录UI，可以查看到监控情况"></a>登录UI，可以查看到监控情况</h3><h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>默认是没有开启日志监控，需要修改java程序（自行百度）</p><h3 id="告警"><a href="#告警" class="headerlink" title="告警"></a>告警</h3><p>&lt;待补充&gt;</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;skywalking链路跟踪部署&quot;&gt;&lt;a href=&quot;#skywalking链路跟踪部署&quot; class=&quot;headerlink&quot; title=&quot;skywalking链路跟踪部署&quot;&gt;&lt;/a&gt;skywalking链路跟踪部署&lt;/h2&gt;&lt;h3 id=&quot;Skywalkin</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="skywalking" scheme="https://biglovewheat.gihub.io/tags/skywalking/"/>
    
  </entry>
  
  <entry>
    <title>Softether-vpn搭建vpn</title>
    <link href="https://biglovewheat.gihub.io/2022/11/04/gitlab-cl/"/>
    <id>https://biglovewheat.gihub.io/2022/11/04/gitlab-cl/</id>
    <published>2022-11-03T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.527Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Softether-vpn搭建vpn"><a href="#Softether-vpn搭建vpn" class="headerlink" title="Softether-vpn搭建vpn"></a>Softether-vpn搭建vpn</h2><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>官网下载<a href="http://softether.fishinfo.cn/cn.aspx">http://softether.fishinfo.cn/cn.aspx</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 解压后安装</span></span><br><span class="line">./.install.sh</span><br><span class="line"><span class="comment">## 运行</span></span><br><span class="line">vpnserver start</span><br></pre></td></tr></table></figure><h3 id="windows-服务器端管理"><a href="#windows-服务器端管理" class="headerlink" title="windows 服务器端管理"></a>windows 服务器端管理</h3><p>官网下载Manager for Windows</p><p>1、新建链接，输入IP，确定。<br>2、第一次链接需输入管密码。<br>3、链接server</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Softether-vpn搭建vpn&quot;&gt;&lt;a href=&quot;#Softether-vpn搭建vpn&quot; class=&quot;headerlink&quot; title=&quot;Softether-vpn搭建vpn&quot;&gt;&lt;/a&gt;Softether-vpn搭建vpn&lt;/h2&gt;&lt;h3 id=&quot;服</summary>
      
    
    
    
    <category term="network" scheme="https://biglovewheat.gihub.io/categories/network/"/>
    
    
    <category term="network" scheme="https://biglovewheat.gihub.io/tags/network/"/>
    
    <category term="vpn" scheme="https://biglovewheat.gihub.io/tags/vpn/"/>
    
  </entry>
  
  <entry>
    <title>将域名绑定到非80端口</title>
    <link href="https://biglovewheat.gihub.io/2022/10/26/%E5%B0%86%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E5%88%B0%E9%9D%9E80%E7%AB%AF%E5%8F%A3/"/>
    <id>https://biglovewheat.gihub.io/2022/10/26/%E5%B0%86%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A%E5%88%B0%E9%9D%9E80%E7%AB%AF%E5%8F%A3/</id>
    <published>2022-10-25T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.543Z</updated>
    
    <content type="html"><![CDATA[<h2 id="将域名绑定到非80端口"><a href="#将域名绑定到非80端口" class="headerlink" title="将域名绑定到非80端口"></a>将域名绑定到非80端口</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p><em>将域名绑定到主机非80&#x2F;443端口</em></p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>域名：abc.com</p><p>主机：123.123.123.123:8080</p><ol><li><p>a记录:xxx.abc.com 绑定到 123.123.123.123</p></li><li><p>隐性URL:<a href="http://www.abc.com/">www.abc.com</a> 绑定到 <a href="http://xxx.abc.com:8080/">http://xxx.abc.com:8080</a></p></li></ol><p>完成后，访问<a href="http://www.abc.com/">www.abc.com</a> 解析到 123.123.123.123:8080</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;将域名绑定到非80端口&quot;&gt;&lt;a href=&quot;#将域名绑定到非80端口&quot; class=&quot;headerlink&quot; title=&quot;将域名绑定到非80端口&quot;&gt;&lt;/a&gt;将域名绑定到非80端口&lt;/h2&gt;&lt;h3 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;head</summary>
      
    
    
    
    <category term="基础概念" scheme="https://biglovewheat.gihub.io/categories/%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
    
    
    <category term="http" scheme="https://biglovewheat.gihub.io/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-按视图批量复制项目</title>
    <link href="https://biglovewheat.gihub.io/2022/10/12/jenkins-%E6%8C%89%E8%A7%86%E5%9B%BE%E6%89%B9%E9%87%8F%E5%A4%8D%E5%88%B6%E9%A1%B9%E7%9B%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/10/12/jenkins-%E6%8C%89%E8%A7%86%E5%9B%BE%E6%89%B9%E9%87%8F%E5%A4%8D%E5%88%B6%E9%A1%B9%E7%9B%AE/</id>
    <published>2022-10-11T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.529Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-按视图批量复制项目"><a href="#Jenkins-按视图批量复制项目" class="headerlink" title="Jenkins-按视图批量复制项目"></a>Jenkins-按视图批量复制项目</h2><h3 id="新建一个视图"><a href="#新建一个视图" class="headerlink" title="新建一个视图"></a>新建一个视图</h3><h3 id="jenkins–Manage-Jenkins–Script-Console"><a href="#jenkins–Manage-Jenkins–Script-Console" class="headerlink" title="jenkins–Manage Jenkins–Script Console"></a>jenkins–Manage Jenkins–Script Console</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hudson.model.*</span><br><span class="line"><span class="comment">//源view</span></span><br><span class="line"><span class="keyword">def</span> str_view = <span class="string">&quot;2dev前端&quot;</span></span><br><span class="line"><span class="comment">//目标view</span></span><br><span class="line"><span class="keyword">def</span> str_new_view = <span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="comment">//源job名称(模糊匹配)</span></span><br><span class="line"><span class="keyword">def</span> str_search = <span class="string">&quot;-dev&quot;</span></span><br><span class="line"><span class="comment">//目标job名称(模糊匹配后替换)</span></span><br><span class="line"><span class="keyword">def</span> str_replace = <span class="string">&quot;-dev-copy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> view = Hudson.instance.getView(str_view)</span><br><span class="line"></span><br><span class="line">Hudson.instance.addView(<span class="keyword">new</span> ListView(str_new_view))</span><br><span class="line">    <span class="comment">//copy all projects of a view</span></span><br><span class="line"><span class="keyword">for</span>(item <span class="keyword">in</span> view.getItems())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//跳过未模糊匹配到的构建 任务</span></span><br><span class="line">      <span class="keyword">if</span> (!item.getName().contains(str_search)) &#123;</span><br><span class="line">      <span class="comment">// 说明文字，表示跳过未匹配到的job，可加可不加</span></span><br><span class="line"><span class="comment">//   println(&quot;but $item.name ignore &quot;)</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//create the new project name</span></span><br><span class="line">  newName = item.getName().replace(str_search, str_replace)</span><br><span class="line">  <span class="comment">// copy the job, disable and save it</span></span><br><span class="line">  <span class="keyword">def</span> job</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">  job = Hudson.instance.copy(item, newName)</span><br><span class="line">  &#125; <span class="keyword">catch</span>(IllegalArgumentException e) &#123;</span><br><span class="line">     println(<span class="string">&quot;$newName job is exists&quot;</span>)</span><br><span class="line">     <span class="keyword">continue</span></span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">    println(e.toString())</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  job.disabled = true</span></span><br><span class="line">  job.save() </span><br><span class="line">  </span><br><span class="line">  println(<span class="string">&quot; $item.name copied as $newName is success&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-按视图批量复制项目&quot;&gt;&lt;a href=&quot;#Jenkins-按视图批量复制项目&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-按视图批量复制项目&quot;&gt;&lt;/a&gt;Jenkins-按视图批量复制项目&lt;/h2&gt;&lt;h3 id=&quot;新建一个视</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Centos7安装gcc8</title>
    <link href="https://biglovewheat.gihub.io/2022/09/28/centos7%E5%AE%89%E8%A3%85gcc8/"/>
    <id>https://biglovewheat.gihub.io/2022/09/28/centos7%E5%AE%89%E8%A3%85gcc8/</id>
    <published>2022-09-27T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.519Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Centos7安装gcc8"><a href="#Centos7安装gcc8" class="headerlink" title="Centos7安装gcc8"></a>Centos7安装gcc8</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## centos7</span></span><br><span class="line"><span class="comment">#安装scl源</span></span><br><span class="line">yum install centos-release-scl scl-utils-build</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装工具链8</span></span><br><span class="line">yum install -y devtoolset-8-toolchain</span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-8 bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#确认版本</span></span><br><span class="line">gcc --version</span><br><span class="line"></span><br><span class="line">strings /usr/lib64/libstdc++.so.6 | grep GLIBC</span><br><span class="line"><span class="built_in">cd</span> /usr/lib64/; <span class="built_in">ls</span> -l libstdc++.so.6*</span><br><span class="line">libstdc++.so.6.0.26</span><br><span class="line"></span><br><span class="line"><span class="built_in">ln</span> -sf libstdc++.so.6.0.26  libstdc++.so.6</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Centos7安装gcc8&quot;&gt;&lt;a href=&quot;#Centos7安装gcc8&quot; class=&quot;headerlink&quot; title=&quot;Centos7安装gcc8&quot;&gt;&lt;/a&gt;Centos7安装gcc8&lt;/h2&gt;&lt;figure class=&quot;highlight bash</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Seata-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/09/21/seata-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/09/21/seata-%E5%AE%89%E8%A3%85/</id>
    <published>2022-09-20T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.541Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Seata-安装"><a href="#Seata-安装" class="headerlink" title="Seata-安装"></a>Seata-安装</h2><p><em>Seata 是一款开源的分布式事务解决方案</em></p><p><em><a href="http://seata.io/zh-cn/">http://seata.io/zh-cn/</a></em></p><p><em>版本v1.4.2</em></p><h3 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h3><p>创建seata数据库，然后运行以下建表语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--https://github.com/seata/seata/tree/develop/script/server/db</span></span><br><span class="line"><span class="comment">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class="line"><span class="comment">-- the table to store GlobalSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `global_table`</span><br><span class="line">(</span><br><span class="line">    `xid`                       <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`            <span class="type">BIGINT</span>,</span><br><span class="line">    `status`                    TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `application_id`            <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_service_group` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_name`          <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `timeout`                   <span class="type">INT</span>,</span><br><span class="line">    `begin_time`                <span class="type">BIGINT</span>,</span><br><span class="line">    `application_data`          <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`                DATETIME,</span><br><span class="line">    `gmt_modified`              DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`xid`),</span><br><span class="line">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class="line">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store BranchSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `branch_table`</span><br><span class="line">(</span><br><span class="line">    `branch_id`         <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`               <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`    <span class="type">BIGINT</span>,</span><br><span class="line">    `resource_group_id` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `resource_id`       <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `branch_type`       <span class="type">VARCHAR</span>(<span class="number">8</span>),</span><br><span class="line">    `status`            TINYINT,</span><br><span class="line">    `client_id`         <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">    `application_data`  <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`        DATETIME(<span class="number">6</span>),</span><br><span class="line">    `gmt_modified`      DATETIME(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`branch_id`),</span><br><span class="line">    KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store lock data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `lock_table`</span><br><span class="line">(</span><br><span class="line">    `row_key`        <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`            <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `transaction_id` <span class="type">BIGINT</span>,</span><br><span class="line">    `branch_id`      <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource_id`    <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `table_name`     <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `pk`             <span class="type">VARCHAR</span>(<span class="number">36</span>),</span><br><span class="line">    `status`         TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;0:locked ,1:rollbacking&#x27;</span>,</span><br><span class="line">    `gmt_create`     DATETIME,</span><br><span class="line">    `gmt_modified`   DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`row_key`),</span><br><span class="line">    KEY `idx_status` (`status`),</span><br><span class="line">    KEY `idx_branch_id` (`branch_id`),</span><br><span class="line">    KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `distributed_lock`</span><br><span class="line">(</span><br><span class="line">    `lock_key`       <span class="type">CHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `lock_value`     <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `expire`         <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="keyword">primary</span> key (`lock_key`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;AsyncCommitting&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;RetryCommitting&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;RetryRollbacking&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;TxTimeoutCheck&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="nacos配置"><a href="#nacos配置" class="headerlink" title="nacos配置"></a>nacos配置</h3><p>新建配置seataServer.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#For details about configuration items, see https://seata.io/zh-cn/docs/user/configurations.html</span></span><br><span class="line"><span class="comment">#Transport configuration, for client and server</span></span><br><span class="line"><span class="attr">transport.type</span>=<span class="string">TCP</span></span><br><span class="line"><span class="attr">transport.server</span>=<span class="string">NIO</span></span><br><span class="line"><span class="attr">transport.heartbeat</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">transport.enableTmClientBatchSendRequest</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.enableRmClientBatchSendRequest</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">transport.enableTcServerBatchSendResponse</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.rpcRmRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.rpcTmRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.rpcTcRequestTimeout</span>=<span class="string">30000</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadPrefix</span>=<span class="string">NettyBoss</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadPrefix</span>=<span class="string">NettyServerNIOWorker</span></span><br><span class="line"><span class="attr">transport.threadFactory.serverExecutorThreadPrefix</span>=<span class="string">NettyServerBizHandler</span></span><br><span class="line"><span class="attr">transport.threadFactory.shareBossWorker</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadPrefix</span>=<span class="string">NettyClientSelector</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientSelectorThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.clientWorkerThreadPrefix</span>=<span class="string">NettyClientWorkerThread</span></span><br><span class="line"><span class="attr">transport.threadFactory.bossThreadSize</span>=<span class="string">1</span></span><br><span class="line"><span class="attr">transport.threadFactory.workerThreadSize</span>=<span class="string">default</span></span><br><span class="line"><span class="attr">transport.shutdown.wait</span>=<span class="string">3</span></span><br><span class="line"><span class="attr">transport.serialization</span>=<span class="string">seata</span></span><br><span class="line"><span class="attr">transport.compressor</span>=<span class="string">none</span></span><br><span class="line"><span class="comment">#Transaction routing rules configuration, only for the client</span></span><br><span class="line"><span class="comment"># 默认的事务分组</span></span><br><span class="line"><span class="attr">service.vgroupMapping.default_tx_group</span>=<span class="string">default</span></span><br><span class="line"><span class="comment">#If you use a registry, you can ignore it</span></span><br><span class="line"><span class="attr">service.default.grouplist</span>=<span class="string">172.31.43.98:8491</span></span><br><span class="line"><span class="attr">service.enableDegrade</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">service.disableGlobalTransaction</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the client</span></span><br><span class="line"><span class="attr">client.rm.asyncCommitBufferLimit</span>=<span class="string">10000</span></span><br><span class="line"><span class="attr">client.rm.lock.retryInterval</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.rm.lock.retryTimes</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">client.rm.lock.retryPolicyBranchRollbackOnConflict</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.rm.reportRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckEnable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.rm.tableMetaCheckerInterval</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.rm.sqlParserType</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">client.rm.reportSuccessEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.sagaBranchRegisterEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.rm.sagaJsonParser</span>=<span class="string">fastjson</span></span><br><span class="line"><span class="attr">client.rm.tccActionInterceptorOrder</span>=<span class="string">-2147482648</span></span><br><span class="line"><span class="attr">client.tm.commitRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.rollbackRetryCount</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">client.tm.defaultGlobalTransactionTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">client.tm.degradeCheck</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckAllowTimes</span>=<span class="string">10</span></span><br><span class="line"><span class="attr">client.tm.degradeCheckPeriod</span>=<span class="string">2000</span></span><br><span class="line"><span class="attr">client.tm.interceptorOrder</span>=<span class="string">-2147482648</span></span><br><span class="line"><span class="attr">client.undo.dataValidation</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.logSerialization</span>=<span class="string">jackson</span></span><br><span class="line"><span class="attr">client.undo.onlyCareUpdateColumns</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">server.undo.logSaveDays</span>=<span class="string">7</span></span><br><span class="line"><span class="attr">server.undo.logDeletePeriod</span>=<span class="string">86400000</span></span><br><span class="line"><span class="attr">client.undo.logTable</span>=<span class="string">undo_log</span></span><br><span class="line"><span class="attr">client.undo.compress.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">client.undo.compress.type</span>=<span class="string">zip</span></span><br><span class="line"><span class="attr">client.undo.compress.threshold</span>=<span class="string">64k</span></span><br><span class="line"><span class="comment">#For TCC transaction mode</span></span><br><span class="line"><span class="attr">tcc.fence.logTableName</span>=<span class="string">tcc_fence_log</span></span><br><span class="line"><span class="attr">tcc.fence.cleanPeriod</span>=<span class="string">1h</span></span><br><span class="line"><span class="comment">#Log rule configuration, for client and server</span></span><br><span class="line"><span class="attr">log.exceptionRate</span>=<span class="string">100</span></span><br><span class="line"><span class="comment">#Transaction storage configuration, only for the server. The file, DB, and redis configuration values are optional.</span></span><br><span class="line"><span class="comment"># Seata服务器的数据存储方式设置为数据库存储</span></span><br><span class="line"><span class="attr">store.mode</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">store.lock.mode</span>=<span class="string">db</span></span><br><span class="line"><span class="attr">store.session.mode</span>=<span class="string">file</span></span><br><span class="line"><span class="comment">#Used for password encryption</span></span><br><span class="line"><span class="attr">store.publicKey</span>=<span class="string"></span></span><br><span class="line"><span class="comment">#If `store.mode,store.lock.mode,store.session.mode` are not equal to `file`, you can remove the configuration block.</span></span><br><span class="line"><span class="attr">store.file.dir</span>=<span class="string">file_store/data</span></span><br><span class="line"><span class="attr">store.file.maxBranchSessionSize</span>=<span class="string">16384</span></span><br><span class="line"><span class="attr">store.file.maxGlobalSessionSize</span>=<span class="string">512</span></span><br><span class="line"><span class="attr">store.file.fileWriteBufferCacheSize</span>=<span class="string">16384</span></span><br><span class="line"><span class="attr">store.file.flushDiskMode</span>=<span class="string">async</span></span><br><span class="line"><span class="attr">store.file.sessionReloadReadSize</span>=<span class="string">100</span></span><br><span class="line"><span class="comment">#These configurations are required if the `store mode` is `db`. If `store.mode,store.lock.mode,store.session.mode` are not equal to `db`, you can remove the configuration block.</span></span><br><span class="line"><span class="attr">store.db.datasource</span>=<span class="string">druid</span></span><br><span class="line"><span class="attr">store.db.dbType</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">store.db.driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">### 设置数据库得连接信息</span></span><br><span class="line"><span class="attr">store.db.url</span>=<span class="string">jdbc:mysql://192.168.8.1:3306/seata?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">store.db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">store.db.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">store.db.minConn</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">store.db.maxConn</span>=<span class="string">30</span></span><br><span class="line"><span class="attr">store.db.globalTable</span>=<span class="string">global_table</span></span><br><span class="line"><span class="attr">store.db.branchTable</span>=<span class="string">branch_table</span></span><br><span class="line"><span class="attr">store.db.distributedLockTable</span>=<span class="string">distributed_lock</span></span><br><span class="line"><span class="attr">store.db.queryLimit</span>=<span class="string">100</span></span><br><span class="line"><span class="attr">store.db.lockTable</span>=<span class="string">lock_table</span></span><br><span class="line"><span class="attr">store.db.maxWait</span>=<span class="string">5000</span></span><br><span class="line"><span class="comment">#Transaction rule configuration, only for the server</span></span><br><span class="line"><span class="attr">server.recovery.committingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.asynCommittingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.rollbackingRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.recovery.timeoutRetryPeriod</span>=<span class="string">1000</span></span><br><span class="line"><span class="attr">server.maxCommitRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.maxRollbackRetryTimeout</span>=<span class="string">-1</span></span><br><span class="line"><span class="attr">server.rollbackRetryTimeoutUnlockEnable</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">server.distributedLockExpireTime</span>=<span class="string">10000</span></span><br><span class="line"><span class="attr">server.xaerNotaRetryTimeout</span>=<span class="string">60000</span></span><br><span class="line"><span class="attr">server.session.branchAsyncQueueSize</span>=<span class="string">5000</span></span><br><span class="line"><span class="attr">server.session.enableBranchAsyncRemove</span>=<span class="string">false</span></span><br><span class="line"><span class="comment">#Metrics configuration, only for the server</span></span><br><span class="line"><span class="attr">metrics.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">metrics.registryType</span>=<span class="string">compact</span></span><br><span class="line"><span class="attr">metrics.exporterList</span>=<span class="string">prometheus</span></span><br><span class="line"><span class="attr">metrics.exporterPrometheusPort</span>=<span class="string">9898</span></span><br></pre></td></tr></table></figure><h3 id="seata配置文件"><a href="#seata配置文件" class="headerlink" title="seata配置文件"></a>seata配置文件</h3><p>主要修改nacos部分</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## vi registry.conf</span></span><br><span class="line"></span><br><span class="line">registry &#123;</span><br><span class="line">  <span class="comment"># file 、nacos 、eureka、redis、zk、consul、etcd3、sofa</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    application = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;192.168.8.1:8848&quot;</span></span><br><span class="line">    group = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;da7aaaa2-7505-4c1d-98c6-9e2e7778ef55&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  eureka &#123;</span><br><span class="line">    serviceUrl = <span class="string">&quot;http://localhost:8761/eureka&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    weight = <span class="string">&quot;1&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  redis &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;localhost:6379&quot;</span></span><br><span class="line">    db = 0</span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    <span class="built_in">timeout</span> = 0</span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    sessionTimeout = 6000</span><br><span class="line">    connectTimeout = 2000</span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">    aclToken = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  sofa &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:9603&quot;</span></span><br><span class="line">    application = <span class="string">&quot;default&quot;</span></span><br><span class="line">    region = <span class="string">&quot;DEFAULT_ZONE&quot;</span></span><br><span class="line">    datacenter = <span class="string">&quot;DefaultDataCenter&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;default&quot;</span></span><br><span class="line">    group = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    addressWaitTime = <span class="string">&quot;3000&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">config &#123;</span><br><span class="line">  <span class="comment"># file、nacos 、apollo、zk、consul、etcd3</span></span><br><span class="line">  <span class="built_in">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  nacos &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;192.168.8.1:8848&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;&quot;</span></span><br><span class="line">    group = <span class="string">&quot;DEFAULT_GROUP&quot;</span></span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    dataId = <span class="string">&quot;seataServer.properties&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  consul &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:8500&quot;</span></span><br><span class="line">    aclToken = <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  apollo &#123;</span><br><span class="line">    appId = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line">    <span class="comment">## apolloConfigService will cover apolloMeta</span></span><br><span class="line">    apolloMeta = <span class="string">&quot;http://192.168.1.204:8801&quot;</span></span><br><span class="line">    apolloConfigService = <span class="string">&quot;http://192.168.1.204:8080&quot;</span></span><br><span class="line">    namespace = <span class="string">&quot;application&quot;</span></span><br><span class="line">    apolloAccesskeySecret = <span class="string">&quot;&quot;</span></span><br><span class="line">    cluster = <span class="string">&quot;seata&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  zk &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;127.0.0.1:2181&quot;</span></span><br><span class="line">    sessionTimeout = 6000</span><br><span class="line">    connectTimeout = 2000</span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    nodePath = <span class="string">&quot;/seata/seata.properties&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  etcd3 &#123;</span><br><span class="line">    serverAddr = <span class="string">&quot;http://localhost:2379&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  file &#123;</span><br><span class="line">    name = <span class="string">&quot;file.conf&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="启动脚本"><a href="#启动脚本" class="headerlink" title="启动脚本"></a>启动脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /data/seata/startup.sh</span></span><br><span class="line"><span class="string">#!/bin/sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export JAVA_HOME=/data/soft/jdk-11.0.11</span></span><br><span class="line"><span class="string">export PATH=$JAVA_HOME/bin:$PATH</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nohup /data/seata/bin/seata-server.sh  -p 8491 &gt;&gt;  /data/seata/seata.log 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> u+x /data/seata/startup.sh</span><br></pre></td></tr></table></figure><h3 id="做成service方便管理"><a href="#做成service方便管理" class="headerlink" title="做成service方便管理"></a>做成service方便管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt;/usr/lib/systemd/system/seata.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=seata</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">Type=forking</span></span><br><span class="line"><span class="string">User=root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ExecStart=/data/seata/startup.sh</span></span><br><span class="line"><span class="string">ExecReload=/bin/kill -s HUP $MAINPID</span></span><br><span class="line"><span class="string">ExecStop=/bin/kill -s QUIT $MAINPID</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl <span class="built_in">enable</span> seata</span><br><span class="line">systemctl restart seata</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Seata-安装&quot;&gt;&lt;a href=&quot;#Seata-安装&quot; class=&quot;headerlink&quot; title=&quot;Seata-安装&quot;&gt;&lt;/a&gt;Seata-安装&lt;/h2&gt;&lt;p&gt;&lt;em&gt;Seata 是一款开源的分布式事务解决方案&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a h</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="seata" scheme="https://biglovewheat.gihub.io/tags/seata/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-npm-构建报错</title>
    <link href="https://biglovewheat.gihub.io/2022/09/13/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99/"/>
    <id>https://biglovewheat.gihub.io/2022/09/13/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99/</id>
    <published>2022-09-12T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.529Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-npm-构建报错"><a href="#Jenkins-npm-构建报错" class="headerlink" title="Jenkins-npm-构建报错"></a>Jenkins-npm-构建报错</h2><p><em>jenkins npm 编译报错，手工构建成功</em></p><h3 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h3><p><img src="/../images/jenkins-npm-%E6%9E%84%E5%BB%BA%E6%8A%A5%E9%94%99_01.jpg"></p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 构建脚本加上CI=false</span></span><br><span class="line">     <span class="built_in">export</span> CI=<span class="literal">false</span></span><br><span class="line">     yarn install</span><br><span class="line">     npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment">## 或者代码加上CI=false</span></span><br><span class="line"><span class="comment"># package.json</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;craco start&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;CI=false &amp;&amp; craco build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;craco test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eject&quot;</span>: <span class="string">&quot;react-scripts eject&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint .&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint:fix&quot;</span>: <span class="string">&quot;eslint --fix&quot;</span>,</span><br><span class="line">    <span class="string">&quot;format&quot;</span>: <span class="string">&quot;prettier --write &#x27;./**/*.&#123;js,jsx,ts,tsx,css,md,json&#125;&#x27; --config ./.prettierrc&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-npm-构建报错&quot;&gt;&lt;a href=&quot;#Jenkins-npm-构建报错&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-npm-构建报错&quot;&gt;&lt;/a&gt;Jenkins-npm-构建报错&lt;/h2&gt;&lt;p&gt;&lt;em&gt;jenkins np</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
    <category term="nodejs" scheme="https://biglovewheat.gihub.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>Ansible-修改hosts</title>
    <link href="https://biglovewheat.gihub.io/2022/09/08/ansible-%E4%BF%AE%E6%94%B9hosts/"/>
    <id>https://biglovewheat.gihub.io/2022/09/08/ansible-%E4%BF%AE%E6%94%B9hosts/</id>
    <published>2022-09-07T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.518Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Ansible-修改hosts"><a href="#Ansible-修改hosts" class="headerlink" title="Ansible-修改hosts"></a>Ansible-修改hosts</h2><h3 id="ansible命令"><a href="#ansible命令" class="headerlink" title="ansible命令"></a>ansible命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible all -i all.lst -m script -a <span class="string">&quot;script_hosts.sh&quot;</span> -u ops_root -k</span><br><span class="line"></span><br><span class="line"><span class="comment">## -i 指定清单文件</span></span><br><span class="line"><span class="comment">## -m 模块</span></span><br></pre></td></tr></table></figure><h3 id="设置-x2F-etc-x2F-hosts命令"><a href="#设置-x2F-etc-x2F-hosts命令" class="headerlink" title="设置&#x2F;etc&#x2F;hosts命令"></a>设置&#x2F;etc&#x2F;hosts命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">sudo /bin/bash -c <span class="string">&quot;cat &gt; /etc/hosts &quot;</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## prod</span></span><br><span class="line"><span class="string">172.31.62.90            aws-prod-app-01</span></span><br><span class="line"><span class="string">172.31.51.65            aws-prod-app-02</span></span><br><span class="line"><span class="string">172.31.58.171           aws-prod-app-03</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Ansible-修改hosts&quot;&gt;&lt;a href=&quot;#Ansible-修改hosts&quot; class=&quot;headerlink&quot; title=&quot;Ansible-修改hosts&quot;&gt;&lt;/a&gt;Ansible-修改hosts&lt;/h2&gt;&lt;h3 id=&quot;ansible命令&quot;&gt;&lt;a</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="ansible" scheme="https://biglovewheat.gihub.io/tags/ansible/"/>
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
  </entry>
  
  <entry>
    <title>Oracle-undo</title>
    <link href="https://biglovewheat.gihub.io/2022/09/07/oracle-undo/"/>
    <id>https://biglovewheat.gihub.io/2022/09/07/oracle-undo/</id>
    <published>2022-09-06T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.537Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Oracle-undo"><a href="#Oracle-undo" class="headerlink" title="Oracle-undo"></a>Oracle-undo</h2><h3 id="查看磁盘空间"><a href="#查看磁盘空间" class="headerlink" title="查看磁盘空间"></a>查看磁盘空间</h3><h3 id="undo表空间使用率"><a href="#undo表空间使用率" class="headerlink" title="undo表空间使用率"></a>undo表空间使用率</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">e.tablespace_name,</span><br><span class="line"><span class="built_in">max</span>(total) total,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;ACTIVE&#x27;</span>,G,<span class="number">0</span>)) active,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;UNEXPIRED&#x27;</span>,G,<span class="number">0</span>)) unexpired,</span><br><span class="line"><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;EXPIRED&#x27;</span>,G,<span class="number">0</span>)) expired,</span><br><span class="line">round((<span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;ACTIVE&#x27;</span>,G,<span class="number">0</span>))<span class="operator">+</span><span class="built_in">sum</span>(decode(e.status,<span class="string">&#x27;UNEXPIRED&#x27;</span>,G,<span class="number">0</span>)))<span class="operator">/</span><span class="built_in">max</span>(total)<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) real_use_pct</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> tablespace_name,round(<span class="built_in">sum</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>) total</span><br><span class="line"><span class="keyword">from</span> dba_data_files</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tablespace_name) f,</span><br><span class="line">(<span class="keyword">SELECT</span> tablespace_name,status,round(<span class="built_in">SUM</span>(bytes)<span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>) G</span><br><span class="line"><span class="keyword">from</span> dba_undo_extents</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tablespace_name,status) e</span><br><span class="line"><span class="keyword">where</span> f.tablespace_name<span class="operator">=</span>e.tablespace_name</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.tablespace_name;</span><br></pre></td></tr></table></figure><h3 id="undo-retention-参数修改"><a href="#undo-retention-参数修改" class="headerlink" title="undo_retention 参数修改"></a>undo_retention 参数修改</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; show parameter undo</span><br><span class="line"></span><br><span class="line">NAME TYPE VALUE</span><br><span class="line">------------------------------------ ----------- ------------------------------</span><br><span class="line">_in_memory_undo boolean FALSE</span><br><span class="line">undo_management string AUTO</span><br><span class="line">undo_retention <span class="built_in">integer</span> 14400</span><br><span class="line">undo_tablespace string PSAPUNDO</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system <span class="built_in">set</span> undo_retention=10800 scope=both;</span><br><span class="line"></span><br><span class="line">System altered.</span><br></pre></td></tr></table></figure><h3 id="undo占用语句查询"><a href="#undo占用语句查询" class="headerlink" title="undo占用语句查询"></a>undo占用语句查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>  s.machine,s.program,s.sid,round(t.used_ublk<span class="operator">*</span><span class="number">8</span><span class="operator">/</span><span class="number">1024</span><span class="operator">/</span><span class="number">1024</span>,<span class="number">2</span>)  undo_GB,used_urec undo_records,s.status,l.sql_text</span><br><span class="line"><span class="keyword">from</span> v$transaction t,gv$session s,v$sqlstats l</span><br><span class="line"><span class="keyword">where</span> t.ses_addr<span class="operator">=</span>s.saddr</span><br><span class="line"><span class="keyword">and</span> s.sql_id<span class="operator">=</span>l.sql_id(<span class="operator">+</span>)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> undo_GB <span class="keyword">desc</span> ;</span><br></pre></td></tr></table></figure><h3 id="undo表空间扩容"><a href="#undo表空间扩容" class="headerlink" title="undo表空间扩容"></a>undo表空间扩容</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlplus -S / as sysdba &gt;undo.log  &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data27&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data28&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data29&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data30&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data31&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data32&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data33&#x27; size 30G ;</span></span><br><span class="line"><span class="string">alter tablespace PSAPUNDO add datafile &#x27;/oradata6/EP1/sapdata13/undo.data34&#x27; size 30G ;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exit</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="undo隐藏参数调整"><a href="#undo隐藏参数调整" class="headerlink" title="undo隐藏参数调整"></a>undo隐藏参数调整</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; select a.ksppinm name,b.ksppstvl value,a.ksppdesc description</span><br><span class="line">from x<span class="variable">$ksppi</span> a,x<span class="variable">$ksppcv</span> b</span><br><span class="line"><span class="built_in">where</span> a.indx = b.indx</span><br><span class="line">and a.ksppinm like <span class="string">&#x27;%_undo_autotune%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">VALUE</span><br><span class="line">----------------------------------------------------------------------------------------------------</span><br><span class="line">DESCRIPTION</span><br><span class="line">----------------------------------------------------------------------------------------------------</span><br><span class="line">_undo_autotune</span><br><span class="line">TRUE</span><br><span class="line"><span class="built_in">enable</span> auto tuning of undo_retention</span><br><span class="line"></span><br><span class="line">SQL&gt; alter system <span class="built_in">set</span> <span class="string">&quot;_undo_autotune&quot;</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><h3 id="创建undo表空间"><a href="#创建undo表空间" class="headerlink" title="创建undo表空间"></a>创建undo表空间</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> undo tablespace UNDOTBS1 datafile <span class="string">&#x27;/opt/oracle/oradata/CMCCWAP/undotbs01.dbf&#x27;</span> size <span class="number">200</span>m autoextend <span class="keyword">on</span>;</span><br></pre></td></tr></table></figure><h3 id="undo相关视图"><a href="#undo相关视图" class="headerlink" title="undo相关视图"></a>undo相关视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v$undostat;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_hist_undostat;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Oracle-undo&quot;&gt;&lt;a href=&quot;#Oracle-undo&quot; class=&quot;headerlink&quot; title=&quot;Oracle-undo&quot;&gt;&lt;/a&gt;Oracle-undo&lt;/h2&gt;&lt;h3 id=&quot;查看磁盘空间&quot;&gt;&lt;a href=&quot;#查看磁盘空间&quot; cla</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="oracle" scheme="https://biglovewheat.gihub.io/tags/oracle/"/>
    
  </entry>
  
  <entry>
    <title>Docker-Dockerfile</title>
    <link href="https://biglovewheat.gihub.io/2022/09/06/docker-dockerfile/"/>
    <id>https://biglovewheat.gihub.io/2022/09/06/docker-dockerfile/</id>
    <published>2022-09-05T16:00:00.000Z</published>
    <updated>2022-12-15T13:31:34.520Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker-Dockerfile"><a href="#Docker-Dockerfile" class="headerlink" title="Docker-Dockerfile"></a>Docker-Dockerfile</h2><h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">From</span> nginx:<span class="number">1.20</span>-alpine</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cp</span> -a /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./dist /dist</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./nginx.conf  /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Docker-Dockerfile&quot;&gt;&lt;a href=&quot;#Docker-Dockerfile&quot; class=&quot;headerlink&quot; title=&quot;Docker-Dockerfile&quot;&gt;&lt;/a&gt;Docker-Dockerfile&lt;/h2&gt;&lt;h3 id=&quot;nginx</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="docker" scheme="https://biglovewheat.gihub.io/tags/docker/"/>
    
  </entry>
  
</feed>
