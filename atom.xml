<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>biglovewheat</title>
  
  
  <link href="https://biglovewheat.gihub.io/atom.xml" rel="self"/>
  
  <link href="https://biglovewheat.gihub.io/"/>
  <updated>2022-08-17T02:54:53.868Z</updated>
  <id>https://biglovewheat.gihub.io/</id>
  
  <author>
    <name>biglovewheat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ELK-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/17/elk-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/17/elk-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-16T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ELK-安装"><a href="#ELK-安装" class="headerlink" title="ELK-安装"></a>ELK-安装</h2><h3 id="ElasticSearch-安装配置"><a href="#ElasticSearch-安装配置" class="headerlink" title="ElasticSearch 安装配置"></a>ElasticSearch 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf elasticsearch-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> elasticsearch-7.13.1-linux-x86_64 /usr/local/elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建用户</span></span><br><span class="line">useradd es</span><br><span class="line">passwd es</span><br><span class="line"><span class="built_in">chown</span> -R es:es /usr/local/elasticsearch</span><br><span class="line"></span><br><span class="line"><span class="comment">## linux参数设置</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max=655360</span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">*        soft    <span class="built_in">nproc</span>           20480</span><br><span class="line">*        hard    <span class="built_in">nproc</span>           20480</span><br><span class="line">*        soft    nofile          65536</span><br><span class="line">*        hard    nofile          65536</span><br><span class="line">*        soft    memlock         unlimited</span><br><span class="line">*        hard    memlock         unlimited</span><br><span class="line"><span class="comment">##重新登录生效，查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/elasticsearch/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#cluster.name: elkbigdata</span></span><br><span class="line"><span class="comment">#node.name: server1</span></span><br><span class="line"><span class="comment">#node.master: true</span></span><br><span class="line"><span class="comment">#node.data: true</span></span><br><span class="line">path.data: /data/elasticsearch</span><br><span class="line"><span class="comment">#path.logs: /usr/local/elasticsearch/logs</span></span><br><span class="line"><span class="comment">#bootstrap.memory_lock: true</span></span><br><span class="line">network.host: 192.168.8.221</span><br><span class="line"><span class="comment">#http.port: 9200</span></span><br><span class="line"><span class="comment">#discovery.zen.minimum_master_nodes: 1</span></span><br><span class="line"><span class="comment">#discovery.seed_hosts: [&quot;127.0.0.1&quot;, &quot;[::1]&quot;]</span></span><br><span class="line"><span class="comment">#discovery.seed_providers: file</span></span><br><span class="line">cluster.initial_master_nodes: <span class="string">&quot;vm221&quot;</span></span><br><span class="line"><span class="comment">##discovery.zen.ping.unicast.hosts: [&quot;172.16.213.37:9300&quot;,&quot;172.16.213.78:9300&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">su - es -c <span class="string">&quot;/usr/local/elasticsearch/bin/elasticsearch -d&quot;</span></span><br></pre></td></tr></table></figure><h3 id="ES常用命令"><a href="#ES常用命令" class="headerlink" title="ES常用命令"></a>ES常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看索引</span></span><br><span class="line">curl localhost:9200/_cat/indices?v</span><br></pre></td></tr></table></figure><h3 id="zookepper-安装配置"><a href="#zookepper-安装配置" class="headerlink" title="zookepper 安装配置"></a>zookepper 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf tar -xvf apache-zookeeper-3.6.3-bin.tar.gz</span><br><span class="line"><span class="built_in">mv</span> apache-zookeeper-3.6.3-bin /usr/local/zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/zookeeper/conf/zoo.cfg</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/data/zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line">server.1=192.168.8.225:2888:3888</span><br><span class="line">server.2=192.168.8.226:2888:3888</span><br><span class="line">server.3=192.168.8.227:2888:3888</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> myid file</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;1&quot;</span> &gt;/data/zookeeper/myid</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/zookeeper/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><h3 id="kafka-安装配置"><a href="#kafka-安装配置" class="headerlink" title="kafka 安装配置"></a>kafka 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf kafka_2.11-2.2.2.tgz</span><br><span class="line"><span class="built_in">mv</span> kafka_2.11-2.2.2 /usr/local/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置文件</span></span><br><span class="line">vi /usr/local/kafka/config/server.properties</span><br><span class="line"></span><br><span class="line">broker.id=0</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/usr/local/kafka/logs</span><br><span class="line">num.partitions=3</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=60</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties 1&gt;kafka.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">tail</span> -f kafka.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用操作</span></span><br><span class="line"><span class="comment"># 查看topic</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper 192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181 --list</span><br><span class="line"><span class="comment"># 创建topic</span></span><br><span class="line">bin/kafka-topics.sh --zookeeper 192.168.8.225:2181,192.168.8.226:2181,192.168.8.227:2181 --create --topic elktopic \</span><br><span class="line">&gt;         --partitions 3 --replication-factor 1</span><br><span class="line"><span class="comment"># 查看topic内容</span></span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic elktopic --from-beginning</span><br></pre></td></tr></table></figure><h3 id="filebeat-安装配置"><a href="#filebeat-安装配置" class="headerlink" title="filebeat 安装配置"></a>filebeat 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf filebeat-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> filebeat-7.13.1-linux-x86_64 /usr/local/filebeat</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/filebeat/filebeat.yml</span><br><span class="line"></span><br><span class="line">filebeat.inputs:</span><br><span class="line">- <span class="built_in">type</span>: <span class="built_in">log</span></span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/secure</span><br><span class="line">  fields:</span><br><span class="line">    log_topic: topic1</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">  hosts: [<span class="string">&quot;192.168.8.225:9092&quot;</span>, <span class="string">&quot;192.168.8.226:9092&quot;</span>, <span class="string">&quot;192.168.8.227:9092&quot;</span>]</span><br><span class="line">  enabled: <span class="literal">true</span></span><br><span class="line">  topic: <span class="string">&#x27;%&#123;[fields.log_topic]&#125;&#x27;</span></span><br><span class="line">  partition.round_robin:</span><br><span class="line">    reachable_only: <span class="literal">false</span></span><br><span class="line">  required_acks: 1</span><br><span class="line">  compression: gzip</span><br><span class="line">  max_message_bytes: 1000000</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/filebeat/filebeat -e -c /usr/local/filebeat/filebeat.yml &gt;filebeat.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="built_in">tail</span> -f filebeat.log</span><br></pre></td></tr></table></figure><h3 id="logstash-安装配置"><a href="#logstash-安装配置" class="headerlink" title="logstash 安装配置"></a>logstash 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf logstash-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> logstash-7.13.1-linux-x86_64 /usr/local/logstash</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line"><span class="built_in">cat</span> /usr/local/logstash/config/logstash.conf</span><br><span class="line">input &#123;</span><br><span class="line">        kafka &#123;</span><br><span class="line">        bootstrap_servers =&gt; <span class="string">&quot;192.168.8.225:9092,192.168.8.226:9092,192.168.8.227:9092&quot;</span></span><br><span class="line">        topics =&gt; [<span class="string">&quot;topic1&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">        elasticsearch &#123;</span><br><span class="line">        hosts =&gt; <span class="string">&quot;192.168.8.221:9200&quot;</span></span><br><span class="line">        index =&gt; <span class="string">&quot;securelog-%&#123;+YYYY-MM-dd&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/usr/local/logstash/bin/logstash -f /usr/local/logstash/config/logstash.conf &gt;logstash.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure><h3 id="Kibana-安装配置"><a href="#Kibana-安装配置" class="headerlink" title="Kibana 安装配置"></a>Kibana 安装配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">tar -xvf logstash-7.13.1-linux-x86_64.tar.gz</span><br><span class="line"><span class="built_in">mv</span> logstash-7.13.1-linux-x86_64 /usr/local/logstash</span><br><span class="line"></span><br><span class="line"><span class="comment">## 配置</span></span><br><span class="line">vi /usr/local/kibana/config/kibana.yml</span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: <span class="string">&quot;192.168.8.221&quot;</span></span><br><span class="line">elasticsearch.hosts: <span class="string">&quot;http://192.168.8.221:9200&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 启动脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/kibana/bin/kibana --allow-root &gt;kibana.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 索引设置</span></span><br><span class="line"><span class="comment">## Management--&gt;Stack Management--&gt;Kibana--&gt;Index Patterns</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ELK-安装&quot;&gt;&lt;a href=&quot;#ELK-安装&quot; class=&quot;headerlink&quot; title=&quot;ELK-安装&quot;&gt;&lt;/a&gt;ELK-安装&lt;/h2&gt;&lt;h3 id=&quot;ElasticSearch-安装配置&quot;&gt;&lt;a href=&quot;#ElasticSearch-安装配置&quot;</summary>
      
    
    
    
    <category term="日志" scheme="https://biglovewheat.gihub.io/categories/%E6%97%A5%E5%BF%97/"/>
    
    
    <category term="日志" scheme="https://biglovewheat.gihub.io/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>Linux-Vsftp-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/15/linux-vsftp-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/15/linux-vsftp-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-14T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-Vsftp-安装"><a href="#Linux-Vsftp-安装" class="headerlink" title="Linux-Vsftp-安装"></a>Linux-Vsftp-安装</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vsftpd ftp</span><br><span class="line"></span><br><span class="line">useradd vsftp</span><br><span class="line"><span class="built_in">echo</span> vsftp@123\! |passwd vsftp --stdin</span><br><span class="line"><span class="built_in">mkdir</span> /ftp</span><br><span class="line">usermod vsftp -d /ftp</span><br><span class="line"><span class="built_in">chown</span> vsftp:vsftp /ftp</span><br><span class="line"></span><br><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line"><span class="comment">#anonymous_enable=YES</span></span><br><span class="line"></span><br><span class="line">systemctl start vsftpd</span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd</span><br></pre></td></tr></table></figure><h3 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ftp -n &lt;&lt;- <span class="string">EOF</span></span><br><span class="line"><span class="string">open 192.168.1.1</span></span><br><span class="line"><span class="string">user vsftp vsftp@123!</span></span><br><span class="line"><span class="string">cd /ftp</span></span><br><span class="line"><span class="string">bin</span></span><br><span class="line"><span class="string">prompt</span></span><br><span class="line"><span class="string">mput *.log</span></span><br><span class="line"><span class="string">bye</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭匿名</span></span><br><span class="line">anonymous_enable=NO</span><br><span class="line"><span class="comment">## 开放本地用户</span></span><br><span class="line">local_enable=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">## 需要开放其他用户编辑:</span></span><br><span class="line"><span class="comment">#1 /etc/vsftpd/ftpusers  --&gt;ftp黑名单,名单上的用户不能登录（与设置无关）</span></span><br><span class="line"><span class="comment">#2 /etc/vsftpd/userlist --&gt;ftp黑名单,名单上的用户不能登录（userlist_enable=YES、userlist_deny=YES；都是默认）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#/etc/vsftpd/vsftpd.conf #主配置文件 或 /etc/vsftpd.conf</span></span><br><span class="line"><span class="comment">#/etc/vsftpd/ftpusers #不能访问FTP用户列表 或 /etc/ftpusers</span></span><br><span class="line"><span class="comment">#/etc/vsftpd/user_list #不能访问FTP用户列表</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-Vsftp-安装&quot;&gt;&lt;a href=&quot;#Linux-Vsftp-安装&quot; class=&quot;headerlink&quot; title=&quot;Linux-Vsftp-安装&quot;&gt;&lt;/a&gt;Linux-Vsftp-安装&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot;</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-主从复制配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/11/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/08/11/mysql-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE/</id>
    <published>2022-08-10T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-主从复制配置"><a href="#Mysql-主从复制配置" class="headerlink" title="Mysql-主从复制配置"></a>Mysql-主从复制配置</h2><h3 id="master开启binlog"><a href="#master开启binlog" class="headerlink" title="master开启binlog"></a>master开启binlog</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog_format=mixed</span><br><span class="line">server-id=1</span><br><span class="line">auto_increment_increment=2</span><br><span class="line">auto_increment_offset=1</span><br><span class="line">replicate-do-db=monitor</span><br></pre></td></tr></table></figure><h3 id="master重启"><a href="#master重启" class="headerlink" title="master重启"></a>master重启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h3 id="master设置复制用户"><a href="#master设置复制用户" class="headerlink" title="master设置复制用户"></a>master设置复制用户</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;repuser&#x27;</span>@<span class="string">&#x27;192.168.8.%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;2014Picc!!!&#x27;</span>;</span><br><span class="line">mysql<span class="operator">&gt;</span>FLUSH PRIVILEGES;</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> File             <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span> Executed_Gtid_Set <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span>     <span class="number">1977</span> <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--记录file和position</span></span><br></pre></td></tr></table></figure><h3 id="slave设置参数"><a href="#slave设置参数" class="headerlink" title="slave设置参数"></a>slave设置参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">server-id=2</span><br></pre></td></tr></table></figure><h2 id="slave重启"><a href="#slave重启" class="headerlink" title="slave重启"></a>slave重启</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h2 id="slave开启复制"><a href="#slave开启复制" class="headerlink" title="slave开启复制"></a>slave开启复制</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span>change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.8.201&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;repuser&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;2014Picc!!!&#x27;</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">612</span>;</span><br></pre></td></tr></table></figure><h2 id="slave查看状态"><a href="#slave查看状态" class="headerlink" title="slave查看状态"></a>slave查看状态</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span><span class="keyword">show</span> slave status\G</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-主从复制配置&quot;&gt;&lt;a href=&quot;#Mysql-主从复制配置&quot; class=&quot;headerlink&quot; title=&quot;Mysql-主从复制配置&quot;&gt;&lt;/a&gt;Mysql-主从复制配置&lt;/h2&gt;&lt;h3 id=&quot;master开启binlog&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Mysql-慢日志处理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/11/mysql-%E6%85%A2%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/11/mysql-%E6%85%A2%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/</id>
    <published>2022-08-10T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mysql-慢日志处理"><a href="#Mysql-慢日志处理" class="headerlink" title="Mysql-慢日志处理"></a>Mysql-慢日志处理</h2><h3 id="查看参数"><a href="#查看参数" class="headerlink" title="查看参数"></a>查看参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">| Variable_name       | Value                         |</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">| slow_query_log      | OFF                           |</span><br><span class="line">| slow_query_log_file | /var/lib/mysql/vm201-slow.log |</span><br><span class="line">+---------------------+-------------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="开启慢日志"><a href="#开启慢日志" class="headerlink" title="开启慢日志"></a>开启慢日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">slow_query_log=1</span><br><span class="line">slow_query_log_file=/var/lib/mysql/vm201-slow.log</span><br><span class="line"><span class="comment">#default 10</span></span><br><span class="line">log_query_time=10</span><br></pre></td></tr></table></figure><h2 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s at -t 20  /var/lib/mysql/vm201-slow.log</span><br><span class="line"></span><br><span class="line">-s at <span class="built_in">sort</span> by query time</span><br><span class="line">-t 20 top 20</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Mysql-慢日志处理&quot;&gt;&lt;a href=&quot;#Mysql-慢日志处理&quot; class=&quot;headerlink&quot; title=&quot;Mysql-慢日志处理&quot;&gt;&lt;/a&gt;Mysql-慢日志处理&lt;/h2&gt;&lt;h3 id=&quot;查看参数&quot;&gt;&lt;a href=&quot;#查看参数&quot; class=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysql" scheme="https://biglovewheat.gihub.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>AWS-Linux-Chrony-时间同步</title>
    <link href="https://biglovewheat.gihub.io/2022/08/10/aws-linux-chrony-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/10/aws-linux-chrony-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/</id>
    <published>2022-08-09T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AWS-Linux-Chrony-时间同步"><a href="#AWS-Linux-Chrony-时间同步" class="headerlink" title="AWS-Linux-Chrony-时间同步"></a>AWS-Linux-Chrony-时间同步</h2><h3 id="配置chrony同步"><a href="#配置chrony同步" class="headerlink" title="配置chrony同步"></a>配置chrony同步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置aws时间服务器</span></span><br><span class="line">vi /etc/chrony.conf </span><br><span class="line"></span><br><span class="line">server 169.254.169.123 prefer iburst minpoll 4 maxpoll 4</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启chrony</span></span><br><span class="line">systemctl restart chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看同步情况</span></span><br><span class="line">chronyc sources -v</span><br><span class="line"></span><br><span class="line">210 Number of sources = 1</span><br><span class="line"></span><br><span class="line">  .-- Source mode  <span class="string">&#x27;^&#x27;</span> = server, <span class="string">&#x27;=&#x27;</span> = peer, <span class="string">&#x27;#&#x27;</span> = <span class="built_in">local</span> clock.</span><br><span class="line"> / .- Source state <span class="string">&#x27;*&#x27;</span> = current synced, <span class="string">&#x27;+&#x27;</span> = combined , <span class="string">&#x27;-&#x27;</span> = not combined,</span><br><span class="line">| /   <span class="string">&#x27;?&#x27;</span> = unreachable, <span class="string">&#x27;x&#x27;</span> = time may be <span class="keyword">in</span> error, <span class="string">&#x27;~&#x27;</span> = time too variable.</span><br><span class="line">||                                                 .- xxxx [ yyyy ] +/- zzzz</span><br><span class="line">||      Reachability register (octal) -.           |  xxxx = adjusted offset,</span><br><span class="line">||      Log2(Polling interval) --.      |          |  yyyy = measured offset,</span><br><span class="line">||                                \     |          |  zzzz = estimated error.</span><br><span class="line">||                                 |    |           \</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 169.254.169.123               3   4   377    11  -5483ns[  -10us] +/-  410us</span><br><span class="line"></span><br><span class="line"><span class="comment">## 验证 </span></span><br><span class="line">chronyc tracking</span><br><span class="line">Reference ID    : A9FEA97B (169.254.169.123)</span><br><span class="line">Stratum         : 4</span><br><span class="line">Ref time (UTC)  : Wed Aug 10 03:04:51 2022</span><br><span class="line">System time     : 0.000002134 seconds fast of NTP time</span><br><span class="line">Last offset     : +0.000002142 seconds</span><br><span class="line">RMS offset      : 0.000007061 seconds</span><br><span class="line">Frequency       : 2.554 ppm slow</span><br><span class="line">Residual freq   : +0.003 ppm</span><br><span class="line">Skew            : 0.200 ppm</span><br><span class="line">Root delay      : 0.000296080 seconds</span><br><span class="line">Root dispersion : 0.000277362 seconds</span><br><span class="line">Update interval : 16.3 seconds</span><br><span class="line">Leap status     : Normal</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AWS-Linux-Chrony-时间同步&quot;&gt;&lt;a href=&quot;#AWS-Linux-Chrony-时间同步&quot; class=&quot;headerlink&quot; title=&quot;AWS-Linux-Chrony-时间同步&quot;&gt;&lt;/a&gt;AWS-Linux-Chrony-时间同步&lt;/</summary>
      
    
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/categories/aws/"/>
    
    
    <category term="aws" scheme="https://biglovewheat.gihub.io/tags/aws/"/>
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins-Gitlab-webhook配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Jenkins-Gitlab-webhook配置"><a href="#Jenkins-Gitlab-webhook配置" class="headerlink" title="Jenkins-Gitlab-webhook配置"></a>Jenkins-Gitlab-webhook配置</h2><h3 id="Gitlab设置access-token"><a href="#Gitlab设置access-token" class="headerlink" title="Gitlab设置access token"></a>Gitlab设置access token</h3><p>用户头像–Preferences–访问令牌<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_01.jpg"></p><p>把key复制下来<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_02.jpg"></p><h3 id="Gitlab项目配置webhook"><a href="#Gitlab项目配置webhook" class="headerlink" title="Gitlab项目配置webhook"></a>Gitlab项目配置webhook</h3><p>项目–设置–webhook</p><p>分别填入：</p><p>网址：jenkins网址+generic-webhook-trigger&#x2F;invoke?token&#x3D;yourtoken</p><p>推送事件：可以指定分支或tag</p><p>去掉启用ssl验证<br><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_03.jpg"></p><h3 id="jenkins安装Generic-Webhook-Trigger插件"><a href="#jenkins安装Generic-Webhook-Trigger插件" class="headerlink" title="jenkins安装Generic Webhook Trigger插件"></a>jenkins安装Generic Webhook Trigger插件</h3><h3 id="jenkins项目配置webhook"><a href="#jenkins项目配置webhook" class="headerlink" title="jenkins项目配置webhook"></a>jenkins项目配置webhook</h3><p><img src="/../images/jenkins-gitlab-webhook%E9%85%8D%E7%BD%AE_04.jpg"></p><p>配置完成后，只要分支有推送事件，会触发jenkins构建</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Jenkins-Gitlab-webhook配置&quot;&gt;&lt;a href=&quot;#Jenkins-Gitlab-webhook配置&quot; class=&quot;headerlink&quot; title=&quot;Jenkins-Gitlab-webhook配置&quot;&gt;&lt;/a&gt;Jenkins-Gitlab</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="git" scheme="https://biglovewheat.gihub.io/tags/git/"/>
    
    <category term="jenkins" scheme="https://biglovewheat.gihub.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>K8s-Evicted-Pod处理</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/k8s-evicted-pod%E5%A4%84%E7%90%86/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/k8s-evicted-pod%E5%A4%84%E7%90%86/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-Evicted-Pod处理"><a href="#K8s-Evicted-Pod处理" class="headerlink" title="K8s-Evicted-Pod处理"></a>K8s-Evicted-Pod处理</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>k8s出现很多Evicted Pod</p><h3 id="排查"><a href="#排查" class="headerlink" title="排查"></a>排查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pods farm-server-789ddb7b4c-5jltb -n dev-3 |grep -i message</span><br><span class="line">Message: Pod The node had condition: [DiskPressure].</span><br></pre></td></tr></table></figure><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>k8s节点磁盘达到85%触发node驱逐pod</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.降低磁盘使用率</span></span><br><span class="line"><span class="comment">## 2.修改kubelet启动参数</span></span><br><span class="line">vi /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</span><br><span class="line">Environment=<span class="string">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --eviction-hard=nodefs.available&lt;5%&quot;</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除evicted的pod</span></span><br><span class="line">kubectl -n base get pods |grep Evicted |awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> |xargs kubectl -n base delete pods</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-Evicted-Pod处理&quot;&gt;&lt;a href=&quot;#K8s-Evicted-Pod处理&quot; class=&quot;headerlink&quot; title=&quot;K8s-Evicted-Pod处理&quot;&gt;&lt;/a&gt;K8s-Evicted-Pod处理&lt;/h2&gt;&lt;h3 id=&quot;现象&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8s-ingress-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/k8s-ingress-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/k8s-ingress-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="K8s-ingress-安装"><a href="#K8s-ingress-安装" class="headerlink" title="K8s-ingress-安装"></a>K8s-ingress-安装</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">helm repo add nginx-stable https://helm.nginx.com/stable</span><br><span class="line"></span><br><span class="line">helm upgrade --install nginx-ingress nginx-stable/nginx-ingress -n kube-system \</span><br><span class="line">--<span class="built_in">set</span> controller.kind=daemonset \</span><br><span class="line">--<span class="built_in">set</span> ingressClass=nginx \</span><br><span class="line">--<span class="built_in">set</span> setAsDefaultIngress=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">kubectl patch daemonset nginx-ingress-nginx-ingress -n kube-system -p=<span class="string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;template&quot;: &#123;&quot;spec&quot;:  &#123;&quot;tolerations&quot;: [&#123;&quot;key&quot;: &quot;node-role.kubernetes.io/master&quot;, &quot;effect&quot;: &quot;NoSchedule&quot;&#125;]&#125;&#125;&#125;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## for k8s 1.18</span></span><br><span class="line">--version 0.10.4</span><br></pre></td></tr></table></figure><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ing-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">app</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span>  <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">ng.biglovewheat1.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">saas-operation</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev-3</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span>  <span class="string">nginx</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-credentials:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-headers:</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-methods:</span> <span class="string">PUT,</span> <span class="string">GET,</span> <span class="string">POST,</span> <span class="string">OPTIONS,</span> <span class="string">DELETE</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/cors-allow-origin:</span> <span class="string">http://saas-operation.abc.com</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/enable-cors:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">saas-operation.abc.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">saas-operation</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="ingress-413-错误"><a href="#ingress-413-错误" class="headerlink" title="ingress-413-错误"></a>ingress-413-错误</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ingress error</span></span><br><span class="line"><span class="comment">## 413 Request Entity Too Large</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-body-size:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-read-timeout:</span> <span class="string">&quot;600&quot;</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/proxy-send-timeout:</span> <span class="string">&quot;600&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;K8s-ingress-安装&quot;&gt;&lt;a href=&quot;#K8s-ingress-安装&quot; class=&quot;headerlink&quot; title=&quot;K8s-ingress-安装&quot;&gt;&lt;/a&gt;K8s-ingress-安装&lt;/h2&gt;&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot;</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/tags/devops/"/>
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Linux-iftop-流量监控</title>
    <link href="https://biglovewheat.gihub.io/2022/08/09/linux-iftop-%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/"/>
    <id>https://biglovewheat.gihub.io/2022/08/09/linux-iftop-%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7/</id>
    <published>2022-08-08T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-iftop-流量监控"><a href="#Linux-iftop-流量监控" class="headerlink" title="Linux-iftop-流量监控"></a>Linux-iftop-流量监控</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y iftop</span><br><span class="line"></span><br><span class="line"><span class="comment">## 参数</span></span><br><span class="line">-i 指定网卡</span><br><span class="line">-n 直接显示IP</span><br><span class="line">-N 直接显示端口号</span><br><span class="line">-P 同时显示IP和端口号</span><br><span class="line"></span><br><span class="line">iftop -i eth0 -PNn</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-iftop-流量监控&quot;&gt;&lt;a href=&quot;#Linux-iftop-流量监控&quot; class=&quot;headerlink&quot; title=&quot;Linux-iftop-流量监控&quot;&gt;&lt;/a&gt;Linux-iftop-流量监控&lt;/h2&gt;&lt;figure class=&quot;hi</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>chattr-crontab加锁</title>
    <link href="https://biglovewheat.gihub.io/2022/08/08/chattr-crontab%E5%8A%A0%E9%94%81/"/>
    <id>https://biglovewheat.gihub.io/2022/08/08/chattr-crontab%E5%8A%A0%E9%94%81/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="chattr-crontab加锁"><a href="#chattr-crontab加锁" class="headerlink" title="chattr-crontab加锁"></a>chattr-crontab加锁</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## crontab加锁</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> `<span class="built_in">ls</span> /var/spool/cron/`; <span class="keyword">do</span> chattr +i /var/spool/cron/<span class="variable">$a</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看锁</span></span><br><span class="line">lsattr /var/spool/cron/*</span><br><span class="line"></span><br><span class="line"><span class="comment">## 解锁</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> `<span class="built_in">ls</span> /var/spool/cron/`; <span class="keyword">do</span> chattr -i /var/spool/cron/<span class="variable">$a</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;chattr-crontab加锁&quot;&gt;&lt;a href=&quot;#chattr-crontab加锁&quot; class=&quot;headerlink&quot; title=&quot;chattr-crontab加锁&quot;&gt;&lt;/a&gt;chattr-crontab加锁&lt;/h2&gt;&lt;figure class=&quot;hi</summary>
      
    
    
    
    <category term="安全" scheme="https://biglovewheat.gihub.io/categories/%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="安全" scheme="https://biglovewheat.gihub.io/tags/%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Nmon-监控脚本</title>
    <link href="https://biglovewheat.gihub.io/2022/08/08/nmon-%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/08/nmon-%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nmon-监控脚本"><a href="#Nmon-监控脚本" class="headerlink" title="Nmon-监控脚本"></a>Nmon-监控脚本</h2><h3 id="监控脚本"><a href="#监控脚本" class="headerlink" title="监控脚本"></a>监控脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##保留一周</span></span><br><span class="line"><span class="built_in">cat</span> /data/nmon/moni.sh</span><br><span class="line">a=`hostname`</span><br><span class="line">b=`<span class="built_in">date</span> |awk <span class="string">&#x27;&#123;print substr($3,1,2)&#125;&#x27;</span>`</span><br><span class="line">/usr/bin/nmon -f -s 300 -c 288 -t -F /tmp/nmondata/<span class="variable">$a</span><span class="string">&quot;_&quot;</span><span class="variable">$b</span>.nmon</span><br><span class="line"></span><br><span class="line"><span class="comment">##保留一月</span></span><br><span class="line">a=`hostname`</span><br><span class="line">b=`<span class="built_in">date</span> | awk <span class="string">&#x27;&#123;print substr($0,1,3)&#125;&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [ -f /tmp/nmondata/<span class="variable">$a</span><span class="string">&quot;_&quot;</span><span class="variable">$b</span>.nmon ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">rm</span>  /tmp/nmondata/<span class="variable">$a</span><span class="string">&quot;_&quot;</span><span class="variable">$b</span>.nmon</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">/usr/bin/nmon -f -s 300 -c 288 -t -F /tmp/nmondata/<span class="variable">$a</span><span class="string">&quot;_&quot;</span><span class="variable">$b</span>.nmon</span><br></pre></td></tr></table></figure><h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 * * * /data/nmon/moni.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nmon-监控脚本&quot;&gt;&lt;a href=&quot;#Nmon-监控脚本&quot; class=&quot;headerlink&quot; title=&quot;Nmon-监控脚本&quot;&gt;&lt;/a&gt;Nmon-监控脚本&lt;/h2&gt;&lt;h3 id=&quot;监控脚本&quot;&gt;&lt;a href=&quot;#监控脚本&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/categories/%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="监控" scheme="https://biglovewheat.gihub.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>Shell-if判断</title>
    <link href="https://biglovewheat.gihub.io/2022/08/08/shell-if%E5%88%A4%E6%96%AD/"/>
    <id>https://biglovewheat.gihub.io/2022/08/08/shell-if%E5%88%A4%E6%96%AD/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.870Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell-if判断"><a href="#Shell-if判断" class="headerlink" title="Shell-if判断"></a>Shell-if判断</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;v<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;vstandalone&quot;</span> ]];<span class="keyword">then</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> 111</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell-if判断&quot;&gt;&lt;a href=&quot;#Shell-if判断&quot; class=&quot;headerlink&quot; title=&quot;Shell-if判断&quot;&gt;&lt;/a&gt;Shell-if判断&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Shell清理脚本</title>
    <link href="https://biglovewheat.gihub.io/2022/08/08/shell-%E6%B8%85%E7%90%86%E8%84%9A%E6%9C%AC/"/>
    <id>https://biglovewheat.gihub.io/2022/08/08/shell-%E6%B8%85%E7%90%86%E8%84%9A%E6%9C%AC/</id>
    <published>2022-08-07T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.870Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell清理脚本"><a href="#Shell清理脚本" class="headerlink" title="Shell清理脚本"></a>Shell清理脚本</h2><h3 id="清理脚本"><a href="#清理脚本" class="headerlink" title="清理脚本"></a>清理脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">date</span></span><br><span class="line"><span class="comment">## cleanup /data/webapp/*/bak/*.tar.gz; leave last 10 file</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">find /data/webapp/*/bak -<span class="built_in">type</span> d |<span class="keyword">while</span> <span class="built_in">read</span> row</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$row</span></span><br><span class="line"><span class="built_in">ls</span> -t *.tar.gz |sed -n <span class="string">&#x27;11,$p&#x27;</span> | xargs <span class="built_in">rm</span> -vf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">## cleanup /data/*/logs/*.log</span></span><br><span class="line"><span class="comment">##  找到并清空文件</span></span><br><span class="line">find /data/*/logs/ -name <span class="string">&quot;*.log&quot;</span> |awk <span class="string">&#x27;&#123;print &quot;echo 11 &gt;&quot;$0&#125;&#x27;</span> |sh</span><br><span class="line"><span class="comment">## cleanup /data/*/app/*.jar; leave last 10 file</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">find /data/*/app -<span class="built_in">type</span> d |<span class="keyword">while</span> <span class="built_in">read</span> row</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$row</span></span><br><span class="line"><span class="built_in">ls</span> -t *.jar |sed -n <span class="string">&#x27;11,$p&#x27;</span> | xargs <span class="built_in">rm</span> -vf</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33 5 * * * /data/cleanup.sh &gt;&gt; /data/cleanup.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Shell清理脚本&quot;&gt;&lt;a href=&quot;#Shell清理脚本&quot; class=&quot;headerlink&quot; title=&quot;Shell清理脚本&quot;&gt;&lt;/a&gt;Shell清理脚本&lt;/h2&gt;&lt;h3 id=&quot;清理脚本&quot;&gt;&lt;a href=&quot;#清理脚本&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/categories/shell/"/>
    
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>Https-握手流程</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/https-%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/https-%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B/</id>
    <published>2022-08-04T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Https-握手流程"><a href="#Https-握手流程" class="headerlink" title="Https-握手流程"></a>Https-握手流程</h2><p>1、客户端向服务器端发起https通信请求</p><p>2、服务器端响应并发送公钥</p><p>3、客户端验证公钥</p><p>4、客户端生成通信秘钥（随机数）</p><p>5、客户端用公钥加密通信秘钥并发送到服务器端</p><p>6、服务器端用私钥解密获取通信秘钥</p><p>7、服务器端和客户端利用通信秘钥对数据进行加密通讯</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Https-握手流程&quot;&gt;&lt;a href=&quot;#Https-握手流程&quot; class=&quot;headerlink&quot; title=&quot;Https-握手流程&quot;&gt;&lt;/a&gt;Https-握手流程&lt;/h2&gt;&lt;p&gt;1、客户端向服务器端发起https通信请求&lt;/p&gt;
&lt;p&gt;2、服务器端响应并</summary>
      
    
    
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/categories/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="http" scheme="https://biglovewheat.gihub.io/tags/http/"/>
    
    <category term="理论知识" scheme="https://biglovewheat.gihub.io/tags/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Nginx-too-many-open-files</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/nginx-too-many-open-files/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/nginx-too-many-open-files/</id>
    <published>2022-08-04T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-too-many-open-files"><a href="#Nginx-too-many-open-files" class="headerlink" title="Nginx-too-many-open-files"></a>Nginx-too-many-open-files</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p><em>Too many open files</em></p><h3 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 查看</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改-session生效</span></span><br><span class="line"><span class="built_in">ulimit</span> -n 65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改-永久生效-需重启</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line">* soft <span class="built_in">nproc</span> 65535</span><br><span class="line">* hard <span class="built_in">nproc</span> 65535</span><br><span class="line"></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改配置文件</span></span><br><span class="line">events &#123;</span><br><span class="line">worker_connections 4096;</span><br><span class="line">use epoll;</span><br><span class="line">multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改service参数</span></span><br><span class="line">systemctl status nginx</span><br><span class="line">vi /usr/lib/systemd/system/nginx.service</span><br><span class="line">[Service]增加</span><br><span class="line">LimitNOFILE=65535</span><br><span class="line"></span><br><span class="line"><span class="comment">## 重启nginx</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">## 检查</span></span><br><span class="line">ps -ef |grep nginx</span><br><span class="line"><span class="built_in">cat</span> /proc/31668/limits</span><br><span class="line">Max open files 65535 65535 files</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx-too-many-open-files&quot;&gt;&lt;a href=&quot;#Nginx-too-many-open-files&quot; class=&quot;headerlink&quot; title=&quot;Nginx-too-many-open-files&quot;&gt;&lt;/a&gt;Nginx-too-m</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
    <category term="nginx" scheme="https://biglovewheat.gihub.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Nginx-安装配置</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/nginx-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/nginx-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-04T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Nginx-安装配置"><a href="#Nginx-安装配置" class="headerlink" title="Nginx-安装配置"></a>Nginx-安装配置</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p><em>centos 7</em></p><p><em>nginx 1.2x</em></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install gcc gcc-c++ make automake autoconf pcre \</span><br><span class="line">pcre-devel zlib zlib-devel openssl openssl-devel libtool</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/local/nginx \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--with-pcre --with-stream</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">user root;</span><br><span class="line">worker_processes auto;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.</span></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">use epoll;</span><br><span class="line">worker_connections 65535;</span><br><span class="line"><span class="comment">#worker工作方式：串行</span></span><br><span class="line">multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#stream &#123;</span></span><br><span class="line"><span class="comment"># log_format proxy &#x27;$remote_addr [$time_local] &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;$protocol $status $bytes_sent $bytes_received &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;$session_time &quot;$upstream_addr&quot; &#x27;</span></span><br><span class="line"><span class="comment"># &#x27;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#x27;;</span></span><br><span class="line"><span class="comment"># access_log /var/log/nginx/tcp-access.log proxy ;</span></span><br><span class="line"><span class="comment"># open_log_file_cache off;</span></span><br><span class="line"><span class="comment"># include /etc/nginx/conf.d/*.stream;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">include mime.types;</span><br><span class="line">default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">sendfile on;</span><br><span class="line">tcp_nopush on;</span><br><span class="line"></span><br><span class="line"><span class="comment">## upload</span></span><br><span class="line">client_max_body_size 2g;</span><br><span class="line"></span><br><span class="line"><span class="comment">#keepalive_timeout 0;</span></span><br><span class="line">keepalive_timeout 65;</span><br><span class="line"></span><br><span class="line"><span class="comment">#### gzip module begin ###</span></span><br><span class="line"><span class="comment">#gzip on;</span></span><br><span class="line"><span class="comment">#gzip_comp_level 4;</span></span><br><span class="line"><span class="comment">#gzip_buffers 4 16k;</span></span><br><span class="line"><span class="comment">#gzip_types text/plain application/javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span></span><br><span class="line"><span class="comment">#gzip_min_length 5k;</span></span><br><span class="line"><span class="comment">#gzip_vary on;</span></span><br><span class="line"><span class="comment">#gzip_proxied any</span></span><br><span class="line"><span class="comment">#### gzip module end ###</span></span><br><span class="line"></span><br><span class="line">include /usr/local/nginx/conf/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">root html;</span><br><span class="line">index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="stream模块"><a href="#stream模块" class="headerlink" title="stream模块"></a>stream模块</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## nginx从1.9.0开始，新增加了一个stream模块，用来实现四层协议的转发、代理或者负载均衡等</span></span><br><span class="line"><span class="comment">## stream模块的用法和http模块差不多，语法基本一致，支持server，hash， listen， proxy_pass等指令</span></span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    upstream cloudsocket &#123;</span><br><span class="line">       <span class="built_in">hash</span> <span class="variable">$remote_addr</span> consistent;</span><br><span class="line">      <span class="comment"># $binary_remote_addr;</span></span><br><span class="line">       server 172.19.20.7:3306 weight=5 max_fails=3 fail_timeout=300s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">       listen 3306;<span class="comment">#数据库服务器监听端口</span></span><br><span class="line">       server_name mysql1.tools.hrtop.net;</span><br><span class="line">       proxy_connect_timeout 120s;</span><br><span class="line">       proxy_send_timeout 120;</span><br><span class="line">       proxy_read_timeout 120;</span><br><span class="line">       proxy_buffer_size 256k;</span><br><span class="line">       proxy_buffers 8 128k;</span><br><span class="line">       proxy_pass cloudsocket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ssl配置"><a href="#ssl配置" class="headerlink" title="ssl配置"></a>ssl配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  sit.biglovewheat.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      certs/ssl.crt;</span><br><span class="line">        ssl_certificate_key  certs/ssl.key;</span><br><span class="line"></span><br><span class="line">        ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /nfsdata/dist;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">upstream websocket&#123;</span><br><span class="line">server hx-app-01:8100 weight=1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 8100;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">client_max_body_size 100M;</span><br><span class="line">proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">proxy_set_header Upgrade <span class="variable">$http_upgrade</span>; <span class="comment">#支持wss</span></span><br><span class="line">proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>; <span class="comment">#支持wss</span></span><br><span class="line">proxy_pass http://websocket;</span><br><span class="line">&#125;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="重定向问题"><a href="#重定向问题" class="headerlink" title="重定向问题"></a>重定向问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## https://blog.csdn.net/weixin_34186128/article/details/91742483</span></span><br><span class="line"><span class="keyword">if</span> (-d <span class="variable">$request_filename</span>)&#123;</span><br><span class="line">rewrite [^/]$ <span class="variable">$scheme</span>://$http_host<span class="variable">$uri</span>/ permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    add_header <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span> always;</span><br><span class="line">    root /opt/nginx/dist-saas-operation-new;</span><br><span class="line">    try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    index  index.html index.htm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自动目录"><a href="#自动目录" class="headerlink" title="自动目录"></a>自动目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  location / &#123;</span><br><span class="line">    autoindex on; <span class="comment">#是否打开配置自动列目录</span></span><br><span class="line">    autoindex_exact_size on; <span class="comment">#是否打开文件大小展示</span></span><br><span class="line">    autoindex_localtime on;  <span class="comment">#是否打开显示文件的时间</span></span><br><span class="line">    root /filepath/</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Nginx-安装配置&quot;&gt;&lt;a href=&quot;#Nginx-安装配置&quot; class=&quot;headerlink&quot; title=&quot;Nginx-安装配置&quot;&gt;&lt;/a&gt;Nginx-安装配置&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;#版本&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="middleware" scheme="https://biglovewheat.gihub.io/categories/middleware/"/>
    
    
    <category term="nginx" scheme="https://biglovewheat.gihub.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Postgresql-导入导出</title>
    <link href="https://biglovewheat.gihub.io/2022/08/05/postgresql-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/"/>
    <id>https://biglovewheat.gihub.io/2022/08/05/postgresql-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</id>
    <published>2022-08-04T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Postgresql-导入导出"><a href="#Postgresql-导入导出" class="headerlink" title="Postgresql-导入导出"></a>Postgresql-导入导出</h2><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p><em>postgresql 13</em></p><h3 id="备份脚本"><a href="#备份脚本" class="headerlink" title="备份脚本"></a>备份脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">DATETIME=$(<span class="built_in">date</span> +<span class="string">&quot;%Y%m%d%H%M&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /pgdata_backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#pg_dumpall -p 5083 &gt; all.sql</span></span><br><span class="line">pg_dumpall --exclude-database=common -p 5083 -c --if-exists |gzip &gt; part1-all-exclude-common.sql.gz</span><br><span class="line">pg_dump --dbname=common --exclude-schema=offline_map -p 5083 -c --if-exists|gzip &gt; part2-common-excluede-offline_map.sql.gz</span><br><span class="line"></span><br><span class="line">tar -cvf pgbackup_all_<span class="variable">$&#123;DATETIME&#125;</span>.tar part*.sql.gz --remove-files</span><br><span class="line"></span><br><span class="line">/usr/local/bin/aws s3 <span class="built_in">cp</span> pgbackup_all_<span class="variable">$&#123;DATETIME&#125;</span>.gz s3://aaa/backup/</span><br><span class="line"></span><br><span class="line">find /pgdata_backup -mtime +30 -<span class="built_in">type</span> f -name <span class="string">&quot;*.gz&quot;</span> | xargs <span class="built_in">rm</span> -f</span><br></pre></td></tr></table></figure><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pg_dumpall -p 5083 -c --if-exists |gzip &gt; all.sql.gz</span><br><span class="line">pg_dump --dbname=testdb -p 5083 -c --if-exists|gzip &gt; testdb.sql.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## 只导结构</span></span><br><span class="line">pg_dump --dbname=testdb -p 5083 -c --if-exists -s | &gt; testdb.sql.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 整库</span></span><br><span class="line">psql -f alldb.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 单个数据库</span></span><br><span class="line">create database testdb;</span><br><span class="line">psql -f testdb.sql -d testdb </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Postgresql-导入导出&quot;&gt;&lt;a href=&quot;#Postgresql-导入导出&quot; class=&quot;headerlink&quot; title=&quot;Postgresql-导入导出&quot;&gt;&lt;/a&gt;Postgresql-导入导出&lt;/h2&gt;&lt;h3 id=&quot;版本&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="数据库" scheme="https://biglovewheat.gihub.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="postgresql" scheme="https://biglovewheat.gihub.io/tags/postgresql/"/>
    
  </entry>
  
  <entry>
    <title>Gitlab-异库同步</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/gitlab-%E5%BC%82%E5%BA%93%E5%90%8C%E6%AD%A5/</id>
    <published>2022-08-03T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.868Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Gitlab-异库同步"><a href="#Gitlab-异库同步" class="headerlink" title="Gitlab-异库同步"></a>Gitlab-异库同步</h2><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├── gitlab_sync_ignore.lst      <span class="comment"># 不同步的库</span></span><br><span class="line">├── gitlab_sync_lib.py          <span class="comment"># 计算本次需同步的库，分全量和增量</span></span><br><span class="line">├── gitlab_sync.sh              <span class="comment"># 同步脚本</span></span><br><span class="line">├── gitlab_sync_old.lst</span><br><span class="line">├── gitlab_sync_to_full.lst     <span class="comment"># 全同步列表，脚本生成</span></span><br><span class="line">├── gitlab_sync_to_inc.lst      <span class="comment"># 增量同步列表，脚本生成</span></span><br></pre></td></tr></table></figure><h3 id="gitlab-sync-sh"><a href="#gitlab-sync-sh" class="headerlink" title="gitlab_sync.sh"></a>gitlab_sync.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">ROOT_PATH=/home/gitlab_sync</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">git_url1=<span class="string">&quot;192.168.8.1:8090&quot;</span></span><br><span class="line">git_user1=jenkins</span><br><span class="line">git_key1=xxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_url2=<span class="string">&quot;10.249.2.40:8690&quot;</span></span><br><span class="line">git_user2=abc</span><br><span class="line">git_key2=xxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">git_group2=<span class="string">&#x27;aa/bb/10/operations&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_full</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$ROOT_PATH</span>/repo_inc</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst</span><br><span class="line"><span class="built_in">rm</span> -f <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst</span><br><span class="line"></span><br><span class="line"><span class="variable">$ROOT_PATH</span>/gitlab_sync_lib.py <span class="variable">$git_url1</span> <span class="variable">$git_key1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_full.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start full sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> --bare http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_full/<span class="variable">$gitname2</span></span><br><span class="line">  git push --mirror http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">rm</span> -rf <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git <span class="built_in">clone</span> http://<span class="variable">$&#123;git_user1&#125;</span>:<span class="variable">$&#123;git_key1&#125;</span>@<span class="variable">$&#123;git_url1&#125;</span>/<span class="variable">$gitname1</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$row</span> &gt;&gt; <span class="variable">$ROOT_PATH</span>/gitlab_sync_old.lst</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> <span class="variable">$ROOT_PATH</span>/gitlab_sync_to_inc.lst | <span class="keyword">while</span> <span class="built_in">read</span> row;<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">  gitname1=$(<span class="built_in">echo</span> <span class="variable">$row</span> |awk -F <span class="string">&quot;:8090/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">  gitname2=$(<span class="built_in">echo</span> <span class="variable">$gitname1</span>| sed <span class="string">&#x27;s/\//-/g&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;***start inc sync ... <span class="variable">$row</span>&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span>/repo_inc/<span class="variable">$gitname2</span></span><br><span class="line">  git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br><span class="line">  git fetch --all</span><br><span class="line">  git branch -r  |grep -v HEAD |awk -F<span class="string">&quot;origin/&quot;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> repo; <span class="keyword">do</span> git checkout <span class="variable">$repo</span>;git pull --rebase; <span class="keyword">done</span></span><br><span class="line">  git pull --all --rebase</span><br><span class="line">  git push --all http://<span class="variable">$&#123;git_user2&#125;</span>:<span class="variable">$&#123;git_key2&#125;</span>@<span class="variable">$&#123;git_url2&#125;</span>/<span class="variable">$&#123;git_group2&#125;</span>/<span class="variable">$gitname2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ROOT_PATH</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="gitlab-sync-lib-py"><a href="#gitlab-sync-lib-py" class="headerlink" title="gitlab_sync_lib.py"></a>gitlab_sync_lib.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> gitlab</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">repo_url = <span class="string">&quot;http://&quot;</span> + sys.argv[<span class="number">1</span>]</span><br><span class="line">token = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(columns=[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">g1 = gitlab.Gitlab(repo_url, private_token=token)</span><br><span class="line">projects = g1.projects.<span class="built_in">list</span>(<span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> project <span class="keyword">in</span> projects:</span><br><span class="line">     df1 = df1.append(&#123;<span class="string">&#x27;url&#x27;</span>:project.http_url_to_repo&#125;, ignore_index=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>):</span><br><span class="line">  df2 = pd.read_csv(<span class="string">&quot;gitlab_sync_ignore.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df2.rename(columns=&#123;df2.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df1-df2</span></span><br><span class="line">  df3 = pd.concat([df1, df2, df2]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df3 = df1</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>):</span><br><span class="line">  df4 = pd.read_csv(<span class="string">&quot;gitlab_sync_old.lst&quot;</span>,sep=<span class="string">&#x27; &#x27;</span>,header=<span class="literal">None</span>)</span><br><span class="line">  df4.rename(columns=&#123;df4.columns[<span class="number">0</span>]:<span class="string">&quot;url&quot;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line">  <span class="comment">##df5=df3-df4,df4=df3-df5</span></span><br><span class="line">  df5 = pd.concat([df3, df4, df4]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4 = pd.concat([df3, df5, df5]).drop_duplicates(keep=<span class="literal">False</span>)</span><br><span class="line">  df4.to_csv(<span class="string">&quot;gitlab_sync_to_inc.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  df5 = df3</span><br><span class="line">  df5.to_csv(<span class="string">&quot;gitlab_sync_to_full.lst&quot;</span>,index=<span class="number">0</span>,header=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Gitlab-异库同步&quot;&gt;&lt;a href=&quot;#Gitlab-异库同步&quot; class=&quot;headerlink&quot; title=&quot;Gitlab-异库同步&quot;&gt;&lt;/a&gt;Gitlab-异库同步&lt;/h2&gt;&lt;h3 id=&quot;结构&quot;&gt;&lt;a href=&quot;#结构&quot; class=&quot;head</summary>
      
    
    
    
    <category term="devops" scheme="https://biglovewheat.gihub.io/categories/devops/"/>
    
    
    <category term="gitlab" scheme="https://biglovewheat.gihub.io/tags/gitlab/"/>
    
    <category term="shell" scheme="https://biglovewheat.gihub.io/tags/shell/"/>
    
    <category term="python" scheme="https://biglovewheat.gihub.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Kubernetes-Centos7-安装</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/kubernetes-centos7-%E5%AE%89%E8%A3%85/</id>
    <published>2022-08-03T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Kubernetes-Centos7-安装"><a href="#Kubernetes-Centos7-安装" class="headerlink" title="Kubernetes-Centos7-安装"></a>Kubernetes-Centos7-安装</h2><h2 id="关闭swap-x2F-selinux-x2F-firewalld"><a href="#关闭swap-x2F-selinux-x2F-firewalld" class="headerlink" title="关闭swap&#x2F;selinux&#x2F;firewalld"></a>关闭swap&#x2F;selinux&#x2F;firewalld</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 关闭swap</span></span><br><span class="line">swapoff -a</span><br><span class="line">vi /etc/fstab</span><br><span class="line">注释掉swap的一行</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭selinux</span></span><br><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span> /etc/selinux/config</span><br><span class="line"></span><br><span class="line"><span class="comment">## 关闭防火墙</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum install -y bash-completion</span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum install -y docker-ce-20.10.8</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure><h2 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://nn5bgten.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="修改docker-cgroup驱动为systemd"><a href="#修改docker-cgroup驱动为systemd" class="headerlink" title="修改docker cgroup驱动为systemd"></a>修改docker cgroup驱动为systemd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s|ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock|ExecStart=/usr/bin/dockerd --exec-opt native.cgroupdriver=systemd|g&quot;</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker info | grep -i cgroup</span><br></pre></td></tr></table></figure><h2 id="添加k8s仓库"><a href="#添加k8s仓库" class="headerlink" title="添加k8s仓库"></a>添加k8s仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h2 id="安装kubeadm"><a href="#安装kubeadm" class="headerlink" title="安装kubeadm"></a>安装kubeadm</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum list kubeadm --showduplicates</span><br><span class="line">yum install -y kubeadm-1.20.9 kubectl-1.20.9 kubelet-1.20.9</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet.service</span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure><h2 id="修改网络参数（centos7）"><a href="#修改网络参数（centos7）" class="headerlink" title="修改网络参数（centos7）"></a>修改网络参数（centos7）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><h2 id="kubeadm初始化"><a href="#kubeadm初始化" class="headerlink" title="kubeadm初始化"></a>kubeadm初始化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=127.0.0.1 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.20.9 --pod-network-cidr=10.133.0.0/16 \</span><br><span class="line">--image-repository=registry.aliyuncs.com/google_containers</span><br><span class="line"></span><br><span class="line"><span class="comment">## kubeadm 初始化清理（如果失败，可以reset进行清理）</span></span><br><span class="line">kubeadm reset</span><br></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure><h2 id="安装calico（指定版本）"><a href="#安装calico（指定版本）" class="headerlink" title="安装calico（指定版本）"></a>安装calico（指定版本）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://docs.projectcalico.org/v3.19/manifests/calico.yaml</span><br></pre></td></tr></table></figure><h2 id="节点加入"><a href="#节点加入" class="headerlink" title="节点加入"></a>节点加入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##节点执行到安装完kubeadm</span></span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token 74kuf2.6f1pv9lbrkxw5n0k \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47</span><br><span class="line"></span><br><span class="line"><span class="comment">## master节点加入</span></span><br><span class="line"><span class="comment"># 主节点运行获取证书</span></span><br><span class="line">kubeadm init phase upload-certs --upload-certs</span><br><span class="line">kubeadm <span class="built_in">join</span> 192.168.8.112:6443 --token lb45cr.d5s17hnbgsj6sf5b   \</span><br><span class="line">  --discovery-token-ca-cert-hash sha256:7566c21fdbc491dac295412629680d3778ba04de933902a842a028e5accbeb47 \</span><br><span class="line">--control-plane   --certificate-key f3657ba47289c8994771aaf2ebd2a90ee335f0fff41b9c1470ad15d21e185094</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误：</span></span><br><span class="line"><span class="comment"># unable to add a new control plane instance a cluster that doesn&#x27;t have a stable controlPlaneEndpoint address</span></span><br><span class="line"><span class="comment"># 解决办法：加上controlPlaneEndpoint</span></span><br><span class="line">kubectl edit configmap -n kube-system   kubeadm-config</span><br><span class="line">    clusterName: kubernetes</span><br><span class="line">    controlPlaneEndpoint: 192.168.8.112:6443</span><br></pre></td></tr></table></figure><h2 id="kubectl自动补全"><a href="#kubectl自动补全" class="headerlink" title="kubectl自动补全"></a>kubectl自动补全</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source &lt;(kubectl completion bash)&quot;</span> &gt;&gt; /etc/profile; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h2 id="kubeadm安装后scheduler状态为unhealthy"><a href="#kubeadm安装后scheduler状态为unhealthy" class="headerlink" title="kubeadm安装后scheduler状态为unhealthy"></a>kubeadm安装后scheduler状态为unhealthy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cs</span><br><span class="line"><span class="comment">#备份修改两个文件</span></span><br><span class="line">vi /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class="line">vi /etc/kubernetes/manifests/kube-scheduler.yaml</span><br><span class="line"></span><br><span class="line">去掉 --port=0</span><br><span class="line"><span class="comment">## 重启kubelet</span></span><br><span class="line">systemctl restart kubelet</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;a href=&quot;#Kubernetes-Centos7-安装&quot; class=&quot;headerlink&quot; title=&quot;Kubernetes-Centos7-安装&quot;&gt;&lt;/a&gt;Kubernetes-Centos7-安装&lt;/</summary>
      
    
    
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/categories/k8s/"/>
    
    
    <category term="k8s" scheme="https://biglovewheat.gihub.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Linux-swap扩容</title>
    <link href="https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/"/>
    <id>https://biglovewheat.gihub.io/2022/08/04/linux-swap%E6%89%A9%E5%AE%B9/</id>
    <published>2022-08-03T16:00:00.000Z</published>
    <updated>2022-08-17T02:54:53.869Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-swap扩容"><a href="#Linux-swap扩容" class="headerlink" title="Linux-swap扩容"></a>Linux-swap扩容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#4G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=4096000</span><br><span class="line"><span class="comment">#8G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile01 bs=1024 count=8192000</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定分区类型为swap</span></span><br><span class="line">/sbin/mkswap /swapfile01</span><br><span class="line"><span class="built_in">chmod</span> 0600 /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#激活swap分区</span></span><br><span class="line">/sbin/swapon /swapfile01</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置自动挂载</span></span><br><span class="line">vi /etc/fstab</span><br><span class="line">/swapfile01 swap swap defaults 0 0</span><br><span class="line">mount -a</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Linux-swap扩容&quot;&gt;&lt;a href=&quot;#Linux-swap扩容&quot; class=&quot;headerlink&quot; title=&quot;Linux-swap扩容&quot;&gt;&lt;/a&gt;Linux-swap扩容&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t</summary>
      
    
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/categories/linux/"/>
    
    
    <category term="linux" scheme="https://biglovewheat.gihub.io/tags/linux/"/>
    
  </entry>
  
</feed>
